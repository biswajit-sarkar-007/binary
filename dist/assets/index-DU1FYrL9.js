var tQ=Object.defineProperty;var nQ=(n,e,t)=>e in n?tQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var rQ=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Ie=(n,e,t)=>nQ(n,typeof e!="symbol"?e+"":e,t);var r7e=rQ((g7e,NY)=>{function sQ(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lV(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function iQ(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var uV={exports:{}},g1={},cV={exports:{}},St={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yv=Symbol.for("react.element"),oQ=Symbol.for("react.portal"),aQ=Symbol.for("react.fragment"),lQ=Symbol.for("react.strict_mode"),uQ=Symbol.for("react.profiler"),cQ=Symbol.for("react.provider"),hQ=Symbol.for("react.context"),dQ=Symbol.for("react.forward_ref"),fQ=Symbol.for("react.suspense"),pQ=Symbol.for("react.memo"),mQ=Symbol.for("react.lazy"),rO=Symbol.iterator;function gQ(n){return n===null||typeof n!="object"?null:(n=rO&&n[rO]||n["@@iterator"],typeof n=="function"?n:null)}var hV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dV=Object.assign,fV={};function ap(n,e,t){this.props=n,this.context=e,this.refs=fV,this.updater=t||hV}ap.prototype.isReactComponent={};ap.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ap.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function pV(){}pV.prototype=ap.prototype;function WE(n,e,t){this.props=n,this.context=e,this.refs=fV,this.updater=t||hV}var HE=WE.prototype=new pV;HE.constructor=WE;dV(HE,ap.prototype);HE.isPureReactComponent=!0;var sO=Array.isArray,mV=Object.prototype.hasOwnProperty,GE={current:null},gV={key:!0,ref:!0,__self:!0,__source:!0};function vV(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)mV.call(e,r)&&!gV.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:yv,type:n,key:i,ref:o,props:s,_owner:GE.current}}function vQ(n,e){return{$$typeof:yv,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function qE(n){return typeof n=="object"&&n!==null&&n.$$typeof===yv}function yQ(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var iO=/\/+/g;function dC(n,e){return typeof n=="object"&&n!==null&&n.key!=null?yQ(""+n.key):e.toString(36)}function z0(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case yv:case oQ:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+dC(o,0):r,sO(s)?(t="",n!=null&&(t=n.replace(iO,"$&/")+"/"),z0(s,e,t,"",function(u){return u})):s!=null&&(qE(s)&&(s=vQ(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(iO,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",sO(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+dC(i,a);o+=z0(i,e,t,l,s)}else if(l=gQ(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+dC(i,a++),o+=z0(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Tx(n,e,t){if(n==null)return n;var r=[],s=0;return z0(n,r,"","",function(i){return e.call(t,i,s++)}),r}function xQ(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Bs={current:null},U0={transition:null},bQ={ReactCurrentDispatcher:Bs,ReactCurrentBatchConfig:U0,ReactCurrentOwner:GE};function yV(){throw Error("act(...) is not supported in production builds of React.")}St.Children={map:Tx,forEach:function(n,e,t){Tx(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Tx(n,function(){e++}),e},toArray:function(n){return Tx(n,function(e){return e})||[]},only:function(n){if(!qE(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};St.Component=ap;St.Fragment=aQ;St.Profiler=uQ;St.PureComponent=WE;St.StrictMode=lQ;St.Suspense=fQ;St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bQ;St.act=yV;St.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=dV({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=GE.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)mV.call(e,l)&&!gV.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:yv,type:n.type,key:s,ref:i,props:r,_owner:o}};St.createContext=function(n){return n={$$typeof:hQ,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:cQ,_context:n},n.Consumer=n};St.createElement=vV;St.createFactory=function(n){var e=vV.bind(null,n);return e.type=n,e};St.createRef=function(){return{current:null}};St.forwardRef=function(n){return{$$typeof:dQ,render:n}};St.isValidElement=qE;St.lazy=function(n){return{$$typeof:mQ,_payload:{_status:-1,_result:n},_init:xQ}};St.memo=function(n,e){return{$$typeof:pQ,type:n,compare:e===void 0?null:e}};St.startTransition=function(n){var e=U0.transition;U0.transition={};try{n()}finally{U0.transition=e}};St.unstable_act=yV;St.useCallback=function(n,e){return Bs.current.useCallback(n,e)};St.useContext=function(n){return Bs.current.useContext(n)};St.useDebugValue=function(){};St.useDeferredValue=function(n){return Bs.current.useDeferredValue(n)};St.useEffect=function(n,e){return Bs.current.useEffect(n,e)};St.useId=function(){return Bs.current.useId()};St.useImperativeHandle=function(n,e,t){return Bs.current.useImperativeHandle(n,e,t)};St.useInsertionEffect=function(n,e){return Bs.current.useInsertionEffect(n,e)};St.useLayoutEffect=function(n,e){return Bs.current.useLayoutEffect(n,e)};St.useMemo=function(n,e){return Bs.current.useMemo(n,e)};St.useReducer=function(n,e,t){return Bs.current.useReducer(n,e,t)};St.useRef=function(n){return Bs.current.useRef(n)};St.useState=function(n){return Bs.current.useState(n)};St.useSyncExternalStore=function(n,e,t){return Bs.current.useSyncExternalStore(n,e,t)};St.useTransition=function(){return Bs.current.useTransition()};St.version="18.3.1";cV.exports=St;var q=cV.exports;const xV=lV(q);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wQ=q,_Q=Symbol.for("react.element"),kQ=Symbol.for("react.fragment"),CQ=Object.prototype.hasOwnProperty,IQ=wQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,SQ={key:!0,ref:!0,__self:!0,__source:!0};function bV(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)CQ.call(e,r)&&!SQ.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:_Q,type:n,key:i,ref:o,props:s,_owner:IQ.current}}g1.Fragment=kQ;g1.jsx=bV;g1.jsxs=bV;uV.exports=g1;var k=uV.exports,wV={exports:{}},Ni={},_V={exports:{}},kV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(P,U){var W=P.length;P.push(U);e:for(;0<W;){var X=W-1>>>1,Z=P[X];if(0<s(Z,U))P[X]=U,P[W]=Z,W=X;else break e}}function t(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var U=P[0],W=P.pop();if(W!==U){P[0]=W;e:for(var X=0,Z=P.length,ne=Z>>>1;X<ne;){var he=2*(X+1)-1,le=P[he],pe=he+1,be=P[pe];if(0>s(le,W))pe<Z&&0>s(be,le)?(P[X]=be,P[pe]=W,X=pe):(P[X]=le,P[he]=W,X=he);else if(pe<Z&&0>s(be,W))P[X]=be,P[pe]=W,X=pe;else break e}}return U}function s(P,U){var W=P.sortIndex-U.sortIndex;return W!==0?W:P.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(P){for(var U=t(u);U!==null;){if(U.callback===null)r(u);else if(U.startTime<=P)r(u),U.sortIndex=U.expirationTime,e(l,U);else break;U=t(u)}}function b(P){if(m=!1,x(P),!p)if(t(l)!==null)p=!0,O(_);else{var U=t(u);U!==null&&F(b,U.startTime-P)}}function _(P,U){p=!1,m&&(m=!1,v(C),C=-1),f=!0;var W=d;try{for(x(U),h=t(l);h!==null&&(!(h.expirationTime>U)||P&&!N());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var Z=X(h.expirationTime<=U);U=n.unstable_now(),typeof Z=="function"?h.callback=Z:h===t(l)&&r(l),x(U)}else r(l);h=t(l)}if(h!==null)var ne=!0;else{var he=t(u);he!==null&&F(b,he.startTime-U),ne=!1}return ne}finally{h=null,d=W,f=!1}}var E=!1,I=null,C=-1,S=5,T=-1;function N(){return!(n.unstable_now()-T<S)}function R(){if(I!==null){var P=n.unstable_now();T=P;var U=!0;try{U=I(!0,P)}finally{U?D():(E=!1,I=null)}}else E=!1}var D;if(typeof y=="function")D=function(){y(R)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,L=z.port2;z.port1.onmessage=R,D=function(){L.postMessage(null)}}else D=function(){g(R,0)};function O(P){I=P,E||(E=!0,D())}function F(P,U){C=g(function(){P(n.unstable_now())},U)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(P){P.callback=null},n.unstable_continueExecution=function(){p||f||(p=!0,O(_))},n.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<P?Math.floor(1e3/P):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(P){switch(d){case 1:case 2:case 3:var U=3;break;default:U=d}var W=d;d=U;try{return P()}finally{d=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(P,U){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var W=d;d=P;try{return U()}finally{d=W}},n.unstable_scheduleCallback=function(P,U,W){var X=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?X+W:X):W=X,P){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=W+Z,P={id:c++,callback:U,priorityLevel:P,startTime:W,expirationTime:Z,sortIndex:-1},W>X?(P.sortIndex=W,e(u,P),t(l)===null&&P===t(u)&&(m?(v(C),C=-1):m=!0,F(b,W-X))):(P.sortIndex=Z,e(l,P),p||f||(p=!0,O(_))),P},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(P){var U=d;return function(){var W=d;d=U;try{return P.apply(this,arguments)}finally{d=W}}}})(kV);_V.exports=kV;var EQ=_V.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TQ=q,Ii=EQ;function _e(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var CV=new Set,fg={};function Wh(n,e){If(n,e),If(n+"Capture",e)}function If(n,e){for(fg[n]=e,n=0;n<e.length;n++)CV.add(e[n])}var pl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rI=Object.prototype.hasOwnProperty,NQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,oO={},aO={};function AQ(n){return rI.call(aO,n)?!0:rI.call(oO,n)?!1:NQ.test(n)?aO[n]=!0:(oO[n]=!0,!1)}function RQ(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function DQ(n,e,t,r){if(e===null||typeof e>"u"||RQ(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vs(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Xr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Xr[n]=new Vs(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Xr[e]=new Vs(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Xr[n]=new Vs(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Xr[n]=new Vs(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Xr[n]=new Vs(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Xr[n]=new Vs(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Xr[n]=new Vs(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Xr[n]=new Vs(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Xr[n]=new Vs(n,5,!1,n.toLowerCase(),null,!1,!1)});var KE=/[\-:]([a-z])/g;function XE(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(KE,XE);Xr[e]=new Vs(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(KE,XE);Xr[e]=new Vs(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(KE,XE);Xr[e]=new Vs(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Xr[n]=new Vs(n,1,!1,n.toLowerCase(),null,!1,!1)});Xr.xlinkHref=new Vs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Xr[n]=new Vs(n,1,!1,n.toLowerCase(),null,!0,!0)});function YE(n,e,t,r){var s=Xr.hasOwnProperty(e)?Xr[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(DQ(e,t,s,r)&&(t=null),r||s===null?AQ(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Al=TQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Nx=Symbol.for("react.element"),zd=Symbol.for("react.portal"),Ud=Symbol.for("react.fragment"),QE=Symbol.for("react.strict_mode"),sI=Symbol.for("react.profiler"),IV=Symbol.for("react.provider"),SV=Symbol.for("react.context"),JE=Symbol.for("react.forward_ref"),iI=Symbol.for("react.suspense"),oI=Symbol.for("react.suspense_list"),ZE=Symbol.for("react.memo"),ru=Symbol.for("react.lazy"),EV=Symbol.for("react.offscreen"),lO=Symbol.iterator;function Zp(n){return n===null||typeof n!="object"?null:(n=lO&&n[lO]||n["@@iterator"],typeof n=="function"?n:null)}var On=Object.assign,fC;function _m(n){if(fC===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);fC=e&&e[1]||""}return`
`+fC+n}var pC=!1;function mC(n,e){if(!n||pC)return"";pC=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{pC=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?_m(n):""}function $Q(n){switch(n.tag){case 5:return _m(n.type);case 16:return _m("Lazy");case 13:return _m("Suspense");case 19:return _m("SuspenseList");case 0:case 2:case 15:return n=mC(n.type,!1),n;case 11:return n=mC(n.type.render,!1),n;case 1:return n=mC(n.type,!0),n;default:return""}}function aI(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ud:return"Fragment";case zd:return"Portal";case sI:return"Profiler";case QE:return"StrictMode";case iI:return"Suspense";case oI:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case SV:return(n.displayName||"Context")+".Consumer";case IV:return(n._context.displayName||"Context")+".Provider";case JE:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ZE:return e=n.displayName||null,e!==null?e:aI(n.type)||"Memo";case ru:e=n._payload,n=n._init;try{return aI(n(e))}catch{}}return null}function PQ(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return aI(e);case 8:return e===QE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Hu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function TV(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function OQ(n){var e=TV(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ax(n){n._valueTracker||(n._valueTracker=OQ(n))}function NV(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=TV(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function bb(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function lI(n,e){var t=e.checked;return On({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function uO(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Hu(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function AV(n,e){e=e.checked,e!=null&&YE(n,"checked",e,!1)}function uI(n,e){AV(n,e);var t=Hu(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?cI(n,e.type,t):e.hasOwnProperty("defaultValue")&&cI(n,e.type,Hu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function cO(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function cI(n,e,t){(e!=="number"||bb(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var km=Array.isArray;function tf(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Hu(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function hI(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(_e(91));return On({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function hO(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(_e(92));if(km(t)){if(1<t.length)throw Error(_e(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Hu(t)}}function RV(n,e){var t=Hu(e.value),r=Hu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function dO(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function DV(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dI(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?DV(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Rx,$V=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Rx=Rx||document.createElement("div"),Rx.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rx.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function pg(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Um={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},FQ=["Webkit","ms","Moz","O"];Object.keys(Um).forEach(function(n){FQ.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Um[e]=Um[n]})});function PV(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Um.hasOwnProperty(n)&&Um[n]?(""+e).trim():e+"px"}function OV(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=PV(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var MQ=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fI(n,e){if(e){if(MQ[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(_e(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(_e(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(_e(61))}if(e.style!=null&&typeof e.style!="object")throw Error(_e(62))}}function pI(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mI=null;function eT(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var gI=null,nf=null,rf=null;function fO(n){if(n=wv(n)){if(typeof gI!="function")throw Error(_e(280));var e=n.stateNode;e&&(e=w1(e),gI(n.stateNode,n.type,e))}}function FV(n){nf?rf?rf.push(n):rf=[n]:nf=n}function MV(){if(nf){var n=nf,e=rf;if(rf=nf=null,fO(n),e)for(n=0;n<e.length;n++)fO(e[n])}}function LV(n,e){return n(e)}function BV(){}var gC=!1;function VV(n,e,t){if(gC)return n(e,t);gC=!0;try{return LV(n,e,t)}finally{gC=!1,(nf!==null||rf!==null)&&(BV(),MV())}}function mg(n,e){var t=n.stateNode;if(t===null)return null;var r=w1(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(_e(231,e,typeof t));return t}var vI=!1;if(pl)try{var em={};Object.defineProperty(em,"passive",{get:function(){vI=!0}}),window.addEventListener("test",em,em),window.removeEventListener("test",em,em)}catch{vI=!1}function LQ(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var jm=!1,wb=null,_b=!1,yI=null,BQ={onError:function(n){jm=!0,wb=n}};function VQ(n,e,t,r,s,i,o,a,l){jm=!1,wb=null,LQ.apply(BQ,arguments)}function zQ(n,e,t,r,s,i,o,a,l){if(VQ.apply(this,arguments),jm){if(jm){var u=wb;jm=!1,wb=null}else throw Error(_e(198));_b||(_b=!0,yI=u)}}function Hh(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function zV(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function pO(n){if(Hh(n)!==n)throw Error(_e(188))}function UQ(n){var e=n.alternate;if(!e){if(e=Hh(n),e===null)throw Error(_e(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return pO(s),n;if(i===r)return pO(s),e;i=i.sibling}throw Error(_e(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(_e(189))}}if(t.alternate!==r)throw Error(_e(190))}if(t.tag!==3)throw Error(_e(188));return t.stateNode.current===t?n:e}function UV(n){return n=UQ(n),n!==null?jV(n):null}function jV(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=jV(n);if(e!==null)return e;n=n.sibling}return null}var WV=Ii.unstable_scheduleCallback,mO=Ii.unstable_cancelCallback,jQ=Ii.unstable_shouldYield,WQ=Ii.unstable_requestPaint,Jn=Ii.unstable_now,HQ=Ii.unstable_getCurrentPriorityLevel,tT=Ii.unstable_ImmediatePriority,HV=Ii.unstable_UserBlockingPriority,kb=Ii.unstable_NormalPriority,GQ=Ii.unstable_LowPriority,GV=Ii.unstable_IdlePriority,v1=null,da=null;function qQ(n){if(da&&typeof da.onCommitFiberRoot=="function")try{da.onCommitFiberRoot(v1,n,void 0,(n.current.flags&128)===128)}catch{}}var No=Math.clz32?Math.clz32:YQ,KQ=Math.log,XQ=Math.LN2;function YQ(n){return n>>>=0,n===0?32:31-(KQ(n)/XQ|0)|0}var Dx=64,$x=4194304;function Cm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Cb(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Cm(a):(i&=o,i!==0&&(r=Cm(i)))}else o=t&~s,o!==0?r=Cm(o):i!==0&&(r=Cm(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-No(e),s=1<<t,r|=n[t],e&=~s;return r}function QQ(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JQ(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-No(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=QQ(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function xI(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function qV(){var n=Dx;return Dx<<=1,!(Dx&4194240)&&(Dx=64),n}function vC(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function xv(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-No(e),n[e]=t}function ZQ(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-No(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function nT(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-No(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var en=0;function KV(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var XV,rT,YV,QV,JV,bI=!1,Px=[],ku=null,Cu=null,Iu=null,gg=new Map,vg=new Map,ou=[],eJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gO(n,e){switch(n){case"focusin":case"focusout":ku=null;break;case"dragenter":case"dragleave":Cu=null;break;case"mouseover":case"mouseout":Iu=null;break;case"pointerover":case"pointerout":gg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vg.delete(e.pointerId)}}function tm(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=wv(e),e!==null&&rT(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function tJ(n,e,t,r,s){switch(e){case"focusin":return ku=tm(ku,n,e,t,r,s),!0;case"dragenter":return Cu=tm(Cu,n,e,t,r,s),!0;case"mouseover":return Iu=tm(Iu,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return gg.set(i,tm(gg.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,vg.set(i,tm(vg.get(i)||null,n,e,t,r,s)),!0}return!1}function ZV(n){var e=Kc(n.target);if(e!==null){var t=Hh(e);if(t!==null){if(e=t.tag,e===13){if(e=zV(t),e!==null){n.blockedOn=e,JV(n.priority,function(){YV(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function j0(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=wI(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);mI=r,t.target.dispatchEvent(r),mI=null}else return e=wv(t),e!==null&&rT(e),n.blockedOn=t,!1;e.shift()}return!0}function vO(n,e,t){j0(n)&&t.delete(e)}function nJ(){bI=!1,ku!==null&&j0(ku)&&(ku=null),Cu!==null&&j0(Cu)&&(Cu=null),Iu!==null&&j0(Iu)&&(Iu=null),gg.forEach(vO),vg.forEach(vO)}function nm(n,e){n.blockedOn===e&&(n.blockedOn=null,bI||(bI=!0,Ii.unstable_scheduleCallback(Ii.unstable_NormalPriority,nJ)))}function yg(n){function e(s){return nm(s,n)}if(0<Px.length){nm(Px[0],n);for(var t=1;t<Px.length;t++){var r=Px[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ku!==null&&nm(ku,n),Cu!==null&&nm(Cu,n),Iu!==null&&nm(Iu,n),gg.forEach(e),vg.forEach(e),t=0;t<ou.length;t++)r=ou[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<ou.length&&(t=ou[0],t.blockedOn===null);)ZV(t),t.blockedOn===null&&ou.shift()}var sf=Al.ReactCurrentBatchConfig,Ib=!0;function rJ(n,e,t,r){var s=en,i=sf.transition;sf.transition=null;try{en=1,sT(n,e,t,r)}finally{en=s,sf.transition=i}}function sJ(n,e,t,r){var s=en,i=sf.transition;sf.transition=null;try{en=4,sT(n,e,t,r)}finally{en=s,sf.transition=i}}function sT(n,e,t,r){if(Ib){var s=wI(n,e,t,r);if(s===null)EC(n,e,r,Sb,t),gO(n,r);else if(tJ(s,n,e,t,r))r.stopPropagation();else if(gO(n,r),e&4&&-1<eJ.indexOf(n)){for(;s!==null;){var i=wv(s);if(i!==null&&XV(i),i=wI(n,e,t,r),i===null&&EC(n,e,r,Sb,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else EC(n,e,r,null,t)}}var Sb=null;function wI(n,e,t,r){if(Sb=null,n=eT(r),n=Kc(n),n!==null)if(e=Hh(n),e===null)n=null;else if(t=e.tag,t===13){if(n=zV(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Sb=n,null}function ez(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(HQ()){case tT:return 1;case HV:return 4;case kb:case GQ:return 16;case GV:return 536870912;default:return 16}default:return 16}}var du=null,iT=null,W0=null;function tz(){if(W0)return W0;var n,e=iT,t=e.length,r,s="value"in du?du.value:du.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return W0=s.slice(n,1<r?1-r:void 0)}function H0(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Ox(){return!0}function yO(){return!1}function Ai(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ox:yO,this.isPropagationStopped=yO,this}return On(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ox)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ox)},persist:function(){},isPersistent:Ox}),e}var lp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oT=Ai(lp),bv=On({},lp,{view:0,detail:0}),iJ=Ai(bv),yC,xC,rm,y1=On({},bv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:aT,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==rm&&(rm&&n.type==="mousemove"?(yC=n.screenX-rm.screenX,xC=n.screenY-rm.screenY):xC=yC=0,rm=n),yC)},movementY:function(n){return"movementY"in n?n.movementY:xC}}),xO=Ai(y1),oJ=On({},y1,{dataTransfer:0}),aJ=Ai(oJ),lJ=On({},bv,{relatedTarget:0}),bC=Ai(lJ),uJ=On({},lp,{animationName:0,elapsedTime:0,pseudoElement:0}),cJ=Ai(uJ),hJ=On({},lp,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),dJ=Ai(hJ),fJ=On({},lp,{data:0}),bO=Ai(fJ),pJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vJ(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=gJ[n])?!!e[n]:!1}function aT(){return vJ}var yJ=On({},bv,{key:function(n){if(n.key){var e=pJ[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=H0(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?mJ[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:aT,charCode:function(n){return n.type==="keypress"?H0(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?H0(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),xJ=Ai(yJ),bJ=On({},y1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wO=Ai(bJ),wJ=On({},bv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:aT}),_J=Ai(wJ),kJ=On({},lp,{propertyName:0,elapsedTime:0,pseudoElement:0}),CJ=Ai(kJ),IJ=On({},y1,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),SJ=Ai(IJ),EJ=[9,13,27,32],lT=pl&&"CompositionEvent"in window,Wm=null;pl&&"documentMode"in document&&(Wm=document.documentMode);var TJ=pl&&"TextEvent"in window&&!Wm,nz=pl&&(!lT||Wm&&8<Wm&&11>=Wm),_O=" ",kO=!1;function rz(n,e){switch(n){case"keyup":return EJ.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sz(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var jd=!1;function NJ(n,e){switch(n){case"compositionend":return sz(e);case"keypress":return e.which!==32?null:(kO=!0,_O);case"textInput":return n=e.data,n===_O&&kO?null:n;default:return null}}function AJ(n,e){if(jd)return n==="compositionend"||!lT&&rz(n,e)?(n=tz(),W0=iT=du=null,jd=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return nz&&e.locale!=="ko"?null:e.data;default:return null}}var RJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function CO(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!RJ[n.type]:e==="textarea"}function iz(n,e,t,r){FV(r),e=Eb(e,"onChange"),0<e.length&&(t=new oT("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Hm=null,xg=null;function DJ(n){gz(n,0)}function x1(n){var e=Gd(n);if(NV(e))return n}function $J(n,e){if(n==="change")return e}var oz=!1;if(pl){var wC;if(pl){var _C="oninput"in document;if(!_C){var IO=document.createElement("div");IO.setAttribute("oninput","return;"),_C=typeof IO.oninput=="function"}wC=_C}else wC=!1;oz=wC&&(!document.documentMode||9<document.documentMode)}function SO(){Hm&&(Hm.detachEvent("onpropertychange",az),xg=Hm=null)}function az(n){if(n.propertyName==="value"&&x1(xg)){var e=[];iz(e,xg,n,eT(n)),VV(DJ,e)}}function PJ(n,e,t){n==="focusin"?(SO(),Hm=e,xg=t,Hm.attachEvent("onpropertychange",az)):n==="focusout"&&SO()}function OJ(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return x1(xg)}function FJ(n,e){if(n==="click")return x1(e)}function MJ(n,e){if(n==="input"||n==="change")return x1(e)}function LJ(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Oo=typeof Object.is=="function"?Object.is:LJ;function bg(n,e){if(Oo(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!rI.call(e,s)||!Oo(n[s],e[s]))return!1}return!0}function EO(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function TO(n,e){var t=EO(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=EO(t)}}function lz(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?lz(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function uz(){for(var n=window,e=bb();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=bb(n.document)}return e}function uT(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function BJ(n){var e=uz(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&lz(t.ownerDocument.documentElement,t)){if(r!==null&&uT(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=TO(t,i);var o=TO(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var VJ=pl&&"documentMode"in document&&11>=document.documentMode,Wd=null,_I=null,Gm=null,kI=!1;function NO(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;kI||Wd==null||Wd!==bb(r)||(r=Wd,"selectionStart"in r&&uT(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Gm&&bg(Gm,r)||(Gm=r,r=Eb(_I,"onSelect"),0<r.length&&(e=new oT("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Wd)))}function Fx(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Hd={animationend:Fx("Animation","AnimationEnd"),animationiteration:Fx("Animation","AnimationIteration"),animationstart:Fx("Animation","AnimationStart"),transitionend:Fx("Transition","TransitionEnd")},kC={},cz={};pl&&(cz=document.createElement("div").style,"AnimationEvent"in window||(delete Hd.animationend.animation,delete Hd.animationiteration.animation,delete Hd.animationstart.animation),"TransitionEvent"in window||delete Hd.transitionend.transition);function b1(n){if(kC[n])return kC[n];if(!Hd[n])return n;var e=Hd[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in cz)return kC[n]=e[t];return n}var hz=b1("animationend"),dz=b1("animationiteration"),fz=b1("animationstart"),pz=b1("transitionend"),mz=new Map,AO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ac(n,e){mz.set(n,e),Wh(e,[n])}for(var CC=0;CC<AO.length;CC++){var IC=AO[CC],zJ=IC.toLowerCase(),UJ=IC[0].toUpperCase()+IC.slice(1);ac(zJ,"on"+UJ)}ac(hz,"onAnimationEnd");ac(dz,"onAnimationIteration");ac(fz,"onAnimationStart");ac("dblclick","onDoubleClick");ac("focusin","onFocus");ac("focusout","onBlur");ac(pz,"onTransitionEnd");If("onMouseEnter",["mouseout","mouseover"]);If("onMouseLeave",["mouseout","mouseover"]);If("onPointerEnter",["pointerout","pointerover"]);If("onPointerLeave",["pointerout","pointerover"]);Wh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Im="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(Im));function RO(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,zQ(r,e,void 0,n),n.currentTarget=null}function gz(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;RO(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;RO(s,a,u),i=l}}}if(_b)throw n=yI,_b=!1,yI=null,n}function gn(n,e){var t=e[TI];t===void 0&&(t=e[TI]=new Set);var r=n+"__bubble";t.has(r)||(vz(e,n,2,!1),t.add(r))}function SC(n,e,t){var r=0;e&&(r|=4),vz(t,n,r,e)}var Mx="_reactListening"+Math.random().toString(36).slice(2);function wg(n){if(!n[Mx]){n[Mx]=!0,CV.forEach(function(t){t!=="selectionchange"&&(jJ.has(t)||SC(t,!1,n),SC(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Mx]||(e[Mx]=!0,SC("selectionchange",!1,e))}}function vz(n,e,t,r){switch(ez(e)){case 1:var s=rJ;break;case 4:s=sJ;break;default:s=sT}t=s.bind(null,e,t,n),s=void 0,!vI||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function EC(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Kc(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}VV(function(){var u=i,c=eT(t),h=[];e:{var d=mz.get(n);if(d!==void 0){var f=oT,p=n;switch(n){case"keypress":if(H0(t)===0)break e;case"keydown":case"keyup":f=xJ;break;case"focusin":p="focus",f=bC;break;case"focusout":p="blur",f=bC;break;case"beforeblur":case"afterblur":f=bC;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=xO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=aJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=_J;break;case hz:case dz:case fz:f=cJ;break;case pz:f=CJ;break;case"scroll":f=iJ;break;case"wheel":f=SJ;break;case"copy":case"cut":case"paste":f=dJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=wO}var m=(e&4)!==0,g=!m&&n==="scroll",v=m?d!==null?d+"Capture":null:d;m=[];for(var y=u,x;y!==null;){x=y;var b=x.stateNode;if(x.tag===5&&b!==null&&(x=b,v!==null&&(b=mg(y,v),b!=null&&m.push(_g(y,b,x)))),g)break;y=y.return}0<m.length&&(d=new f(d,p,null,t,c),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&t!==mI&&(p=t.relatedTarget||t.fromElement)&&(Kc(p)||p[ml]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=u,p=p?Kc(p):null,p!==null&&(g=Hh(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=xO,b="onMouseLeave",v="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(m=wO,b="onPointerLeave",v="onPointerEnter",y="pointer"),g=f==null?d:Gd(f),x=p==null?d:Gd(p),d=new m(b,y+"leave",f,t,c),d.target=g,d.relatedTarget=x,b=null,Kc(c)===u&&(m=new m(v,y+"enter",p,t,c),m.target=x,m.relatedTarget=g,b=m),g=b,f&&p)t:{for(m=f,v=p,y=0,x=m;x;x=xd(x))y++;for(x=0,b=v;b;b=xd(b))x++;for(;0<y-x;)m=xd(m),y--;for(;0<x-y;)v=xd(v),x--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=xd(m),v=xd(v)}m=null}else m=null;f!==null&&DO(h,d,f,m,!1),p!==null&&g!==null&&DO(h,g,p,m,!0)}}e:{if(d=u?Gd(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var _=$J;else if(CO(d))if(oz)_=MJ;else{_=OJ;var E=PJ}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(_=FJ);if(_&&(_=_(n,u))){iz(h,_,t,c);break e}E&&E(n,d,u),n==="focusout"&&(E=d._wrapperState)&&E.controlled&&d.type==="number"&&cI(d,"number",d.value)}switch(E=u?Gd(u):window,n){case"focusin":(CO(E)||E.contentEditable==="true")&&(Wd=E,_I=u,Gm=null);break;case"focusout":Gm=_I=Wd=null;break;case"mousedown":kI=!0;break;case"contextmenu":case"mouseup":case"dragend":kI=!1,NO(h,t,c);break;case"selectionchange":if(VJ)break;case"keydown":case"keyup":NO(h,t,c)}var I;if(lT)e:{switch(n){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else jd?rz(n,t)&&(C="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(nz&&t.locale!=="ko"&&(jd||C!=="onCompositionStart"?C==="onCompositionEnd"&&jd&&(I=tz()):(du=c,iT="value"in du?du.value:du.textContent,jd=!0)),E=Eb(u,C),0<E.length&&(C=new bO(C,n,null,t,c),h.push({event:C,listeners:E}),I?C.data=I:(I=sz(t),I!==null&&(C.data=I)))),(I=TJ?NJ(n,t):AJ(n,t))&&(u=Eb(u,"onBeforeInput"),0<u.length&&(c=new bO("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=I))}gz(h,e)})}function _g(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Eb(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=mg(n,t),i!=null&&r.unshift(_g(n,i,s)),i=mg(n,e),i!=null&&r.push(_g(n,i,s))),n=n.return}return r}function xd(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function DO(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=mg(t,i),l!=null&&o.unshift(_g(t,l,a))):s||(l=mg(t,i),l!=null&&o.push(_g(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var WJ=/\r\n?/g,HJ=/\u0000|\uFFFD/g;function $O(n){return(typeof n=="string"?n:""+n).replace(WJ,`
`).replace(HJ,"")}function Lx(n,e,t){if(e=$O(e),$O(n)!==e&&t)throw Error(_e(425))}function Tb(){}var CI=null,II=null;function SI(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var EI=typeof setTimeout=="function"?setTimeout:void 0,GJ=typeof clearTimeout=="function"?clearTimeout:void 0,PO=typeof Promise=="function"?Promise:void 0,qJ=typeof queueMicrotask=="function"?queueMicrotask:typeof PO<"u"?function(n){return PO.resolve(null).then(n).catch(KJ)}:EI;function KJ(n){setTimeout(function(){throw n})}function TC(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),yg(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);yg(e)}function Su(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function OO(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var up=Math.random().toString(36).slice(2),oa="__reactFiber$"+up,kg="__reactProps$"+up,ml="__reactContainer$"+up,TI="__reactEvents$"+up,XJ="__reactListeners$"+up,YJ="__reactHandles$"+up;function Kc(n){var e=n[oa];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ml]||t[oa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=OO(n);n!==null;){if(t=n[oa])return t;n=OO(n)}return e}n=t,t=n.parentNode}return null}function wv(n){return n=n[oa]||n[ml],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Gd(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(_e(33))}function w1(n){return n[kg]||null}var NI=[],qd=-1;function lc(n){return{current:n}}function bn(n){0>qd||(n.current=NI[qd],NI[qd]=null,qd--)}function un(n,e){qd++,NI[qd]=n.current,n.current=e}var Gu={},Cs=lc(Gu),Zs=lc(!1),gh=Gu;function Sf(n,e){var t=n.type.contextTypes;if(!t)return Gu;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function ei(n){return n=n.childContextTypes,n!=null}function Nb(){bn(Zs),bn(Cs)}function FO(n,e,t){if(Cs.current!==Gu)throw Error(_e(168));un(Cs,e),un(Zs,t)}function yz(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(_e(108,PQ(n)||"Unknown",s));return On({},t,r)}function Ab(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Gu,gh=Cs.current,un(Cs,n),un(Zs,Zs.current),!0}function MO(n,e,t){var r=n.stateNode;if(!r)throw Error(_e(169));t?(n=yz(n,e,gh),r.__reactInternalMemoizedMergedChildContext=n,bn(Zs),bn(Cs),un(Cs,n)):bn(Zs),un(Zs,t)}var Ja=null,_1=!1,NC=!1;function xz(n){Ja===null?Ja=[n]:Ja.push(n)}function QJ(n){_1=!0,xz(n)}function uc(){if(!NC&&Ja!==null){NC=!0;var n=0,e=en;try{var t=Ja;for(en=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Ja=null,_1=!1}catch(s){throw Ja!==null&&(Ja=Ja.slice(n+1)),WV(tT,uc),s}finally{en=e,NC=!1}}return null}var Kd=[],Xd=0,Rb=null,Db=0,Vi=[],zi=0,vh=null,rl=1,sl="";function Fc(n,e){Kd[Xd++]=Db,Kd[Xd++]=Rb,Rb=n,Db=e}function bz(n,e,t){Vi[zi++]=rl,Vi[zi++]=sl,Vi[zi++]=vh,vh=n;var r=rl;n=sl;var s=32-No(r)-1;r&=~(1<<s),t+=1;var i=32-No(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,rl=1<<32-No(e)+s|t<<s|r,sl=i+n}else rl=1<<i|t<<s|r,sl=n}function cT(n){n.return!==null&&(Fc(n,1),bz(n,1,0))}function hT(n){for(;n===Rb;)Rb=Kd[--Xd],Kd[Xd]=null,Db=Kd[--Xd],Kd[Xd]=null;for(;n===vh;)vh=Vi[--zi],Vi[zi]=null,sl=Vi[--zi],Vi[zi]=null,rl=Vi[--zi],Vi[zi]=null}var wi=null,gi=null,Sn=!1,wo=null;function wz(n,e){var t=qi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function LO(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,wi=n,gi=Su(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,wi=n,gi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=vh!==null?{id:rl,overflow:sl}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=qi(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,wi=n,gi=null,!0):!1;default:return!1}}function AI(n){return(n.mode&1)!==0&&(n.flags&128)===0}function RI(n){if(Sn){var e=gi;if(e){var t=e;if(!LO(n,e)){if(AI(n))throw Error(_e(418));e=Su(t.nextSibling);var r=wi;e&&LO(n,e)?wz(r,t):(n.flags=n.flags&-4097|2,Sn=!1,wi=n)}}else{if(AI(n))throw Error(_e(418));n.flags=n.flags&-4097|2,Sn=!1,wi=n}}}function BO(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;wi=n}function Bx(n){if(n!==wi)return!1;if(!Sn)return BO(n),Sn=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!SI(n.type,n.memoizedProps)),e&&(e=gi)){if(AI(n))throw _z(),Error(_e(418));for(;e;)wz(n,e),e=Su(e.nextSibling)}if(BO(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(_e(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){gi=Su(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}gi=null}}else gi=wi?Su(n.stateNode.nextSibling):null;return!0}function _z(){for(var n=gi;n;)n=Su(n.nextSibling)}function Ef(){gi=wi=null,Sn=!1}function dT(n){wo===null?wo=[n]:wo.push(n)}var JJ=Al.ReactCurrentBatchConfig;function sm(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(_e(309));var r=t.stateNode}if(!r)throw Error(_e(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(_e(284));if(!t._owner)throw Error(_e(290,n))}return n}function Vx(n,e){throw n=Object.prototype.toString.call(e),Error(_e(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function VO(n){var e=n._init;return e(n._payload)}function kz(n){function e(v,y){if(n){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function t(v,y){if(!n)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function s(v,y){return v=Au(v,y),v.index=0,v.sibling=null,v}function i(v,y,x){return v.index=x,n?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,y,x,b){return y===null||y.tag!==6?(y=FC(x,v.mode,b),y.return=v,y):(y=s(y,x),y.return=v,y)}function l(v,y,x,b){var _=x.type;return _===Ud?c(v,y,x.props.children,b,x.key):y!==null&&(y.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ru&&VO(_)===y.type)?(b=s(y,x.props),b.ref=sm(v,y,x),b.return=v,b):(b=J0(x.type,x.key,x.props,null,v.mode,b),b.ref=sm(v,y,x),b.return=v,b)}function u(v,y,x,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=MC(x,v.mode,b),y.return=v,y):(y=s(y,x.children||[]),y.return=v,y)}function c(v,y,x,b,_){return y===null||y.tag!==7?(y=oh(x,v.mode,b,_),y.return=v,y):(y=s(y,x),y.return=v,y)}function h(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=FC(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Nx:return x=J0(y.type,y.key,y.props,null,v.mode,x),x.ref=sm(v,null,y),x.return=v,x;case zd:return y=MC(y,v.mode,x),y.return=v,y;case ru:var b=y._init;return h(v,b(y._payload),x)}if(km(y)||Zp(y))return y=oh(y,v.mode,x,null),y.return=v,y;Vx(v,y)}return null}function d(v,y,x,b){var _=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return _!==null?null:a(v,y,""+x,b);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Nx:return x.key===_?l(v,y,x,b):null;case zd:return x.key===_?u(v,y,x,b):null;case ru:return _=x._init,d(v,y,_(x._payload),b)}if(km(x)||Zp(x))return _!==null?null:c(v,y,x,b,null);Vx(v,x)}return null}function f(v,y,x,b,_){if(typeof b=="string"&&b!==""||typeof b=="number")return v=v.get(x)||null,a(y,v,""+b,_);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Nx:return v=v.get(b.key===null?x:b.key)||null,l(y,v,b,_);case zd:return v=v.get(b.key===null?x:b.key)||null,u(y,v,b,_);case ru:var E=b._init;return f(v,y,x,E(b._payload),_)}if(km(b)||Zp(b))return v=v.get(x)||null,c(y,v,b,_,null);Vx(y,b)}return null}function p(v,y,x,b){for(var _=null,E=null,I=y,C=y=0,S=null;I!==null&&C<x.length;C++){I.index>C?(S=I,I=null):S=I.sibling;var T=d(v,I,x[C],b);if(T===null){I===null&&(I=S);break}n&&I&&T.alternate===null&&e(v,I),y=i(T,y,C),E===null?_=T:E.sibling=T,E=T,I=S}if(C===x.length)return t(v,I),Sn&&Fc(v,C),_;if(I===null){for(;C<x.length;C++)I=h(v,x[C],b),I!==null&&(y=i(I,y,C),E===null?_=I:E.sibling=I,E=I);return Sn&&Fc(v,C),_}for(I=r(v,I);C<x.length;C++)S=f(I,v,C,x[C],b),S!==null&&(n&&S.alternate!==null&&I.delete(S.key===null?C:S.key),y=i(S,y,C),E===null?_=S:E.sibling=S,E=S);return n&&I.forEach(function(N){return e(v,N)}),Sn&&Fc(v,C),_}function m(v,y,x,b){var _=Zp(x);if(typeof _!="function")throw Error(_e(150));if(x=_.call(x),x==null)throw Error(_e(151));for(var E=_=null,I=y,C=y=0,S=null,T=x.next();I!==null&&!T.done;C++,T=x.next()){I.index>C?(S=I,I=null):S=I.sibling;var N=d(v,I,T.value,b);if(N===null){I===null&&(I=S);break}n&&I&&N.alternate===null&&e(v,I),y=i(N,y,C),E===null?_=N:E.sibling=N,E=N,I=S}if(T.done)return t(v,I),Sn&&Fc(v,C),_;if(I===null){for(;!T.done;C++,T=x.next())T=h(v,T.value,b),T!==null&&(y=i(T,y,C),E===null?_=T:E.sibling=T,E=T);return Sn&&Fc(v,C),_}for(I=r(v,I);!T.done;C++,T=x.next())T=f(I,v,C,T.value,b),T!==null&&(n&&T.alternate!==null&&I.delete(T.key===null?C:T.key),y=i(T,y,C),E===null?_=T:E.sibling=T,E=T);return n&&I.forEach(function(R){return e(v,R)}),Sn&&Fc(v,C),_}function g(v,y,x,b){if(typeof x=="object"&&x!==null&&x.type===Ud&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Nx:e:{for(var _=x.key,E=y;E!==null;){if(E.key===_){if(_=x.type,_===Ud){if(E.tag===7){t(v,E.sibling),y=s(E,x.props.children),y.return=v,v=y;break e}}else if(E.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ru&&VO(_)===E.type){t(v,E.sibling),y=s(E,x.props),y.ref=sm(v,E,x),y.return=v,v=y;break e}t(v,E);break}else e(v,E);E=E.sibling}x.type===Ud?(y=oh(x.props.children,v.mode,b,x.key),y.return=v,v=y):(b=J0(x.type,x.key,x.props,null,v.mode,b),b.ref=sm(v,y,x),b.return=v,v=b)}return o(v);case zd:e:{for(E=x.key;y!==null;){if(y.key===E)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){t(v,y.sibling),y=s(y,x.children||[]),y.return=v,v=y;break e}else{t(v,y);break}else e(v,y);y=y.sibling}y=MC(x,v.mode,b),y.return=v,v=y}return o(v);case ru:return E=x._init,g(v,y,E(x._payload),b)}if(km(x))return p(v,y,x,b);if(Zp(x))return m(v,y,x,b);Vx(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(t(v,y.sibling),y=s(y,x),y.return=v,v=y):(t(v,y),y=FC(x,v.mode,b),y.return=v,v=y),o(v)):t(v,y)}return g}var Tf=kz(!0),Cz=kz(!1),$b=lc(null),Pb=null,Yd=null,fT=null;function pT(){fT=Yd=Pb=null}function mT(n){var e=$b.current;bn($b),n._currentValue=e}function DI(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function of(n,e){Pb=n,fT=Yd=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Ys=!0),n.firstContext=null)}function ro(n){var e=n._currentValue;if(fT!==n)if(n={context:n,memoizedValue:e,next:null},Yd===null){if(Pb===null)throw Error(_e(308));Yd=n,Pb.dependencies={lanes:0,firstContext:n}}else Yd=Yd.next=n;return e}var Xc=null;function gT(n){Xc===null?Xc=[n]:Xc.push(n)}function Iz(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,gT(e)):(t.next=s.next,s.next=t),e.interleaved=t,gl(n,r)}function gl(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var su=!1;function vT(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sz(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ul(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Eu(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ft&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,gl(n,t)}return s=r.interleaved,s===null?(e.next=e,gT(r)):(e.next=s.next,s.next=e),r.interleaved=e,gl(n,t)}function G0(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,nT(n,t)}}function zO(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ob(n,e,t,r){var s=n.updateQueue;su=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,c=u=l=null,a=i;do{var d=a.lane,f=a.eventTime;if((r&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,m=a;switch(d=e,f=t,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=On({},h,d);break e;case 2:su=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,d=s.effects,d===null?s.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,o|=d;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;d=a,a=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(c===null&&(l=h),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);xh|=o,n.lanes=o,n.memoizedState=h}}function UO(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(_e(191,s));s.call(r)}}}var _v={},fa=lc(_v),Cg=lc(_v),Ig=lc(_v);function Yc(n){if(n===_v)throw Error(_e(174));return n}function yT(n,e){switch(un(Ig,e),un(Cg,n),un(fa,_v),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:dI(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=dI(e,n)}bn(fa),un(fa,e)}function Nf(){bn(fa),bn(Cg),bn(Ig)}function Ez(n){Yc(Ig.current);var e=Yc(fa.current),t=dI(e,n.type);e!==t&&(un(Cg,n),un(fa,t))}function xT(n){Cg.current===n&&(bn(fa),bn(Cg))}var An=lc(0);function Fb(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var AC=[];function bT(){for(var n=0;n<AC.length;n++)AC[n]._workInProgressVersionPrimary=null;AC.length=0}var q0=Al.ReactCurrentDispatcher,RC=Al.ReactCurrentBatchConfig,yh=0,$n=null,gr=null,Ar=null,Mb=!1,qm=!1,Sg=0,ZJ=0;function is(){throw Error(_e(321))}function wT(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Oo(n[t],e[t]))return!1;return!0}function _T(n,e,t,r,s,i){if(yh=i,$n=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,q0.current=n===null||n.memoizedState===null?rZ:sZ,n=t(r,s),qm){i=0;do{if(qm=!1,Sg=0,25<=i)throw Error(_e(301));i+=1,Ar=gr=null,e.updateQueue=null,q0.current=iZ,n=t(r,s)}while(qm)}if(q0.current=Lb,e=gr!==null&&gr.next!==null,yh=0,Ar=gr=$n=null,Mb=!1,e)throw Error(_e(300));return n}function kT(){var n=Sg!==0;return Sg=0,n}function Yo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?$n.memoizedState=Ar=n:Ar=Ar.next=n,Ar}function so(){if(gr===null){var n=$n.alternate;n=n!==null?n.memoizedState:null}else n=gr.next;var e=Ar===null?$n.memoizedState:Ar.next;if(e!==null)Ar=e,gr=n;else{if(n===null)throw Error(_e(310));gr=n,n={memoizedState:gr.memoizedState,baseState:gr.baseState,baseQueue:gr.baseQueue,queue:gr.queue,next:null},Ar===null?$n.memoizedState=Ar=n:Ar=Ar.next=n}return Ar}function Eg(n,e){return typeof e=="function"?e(n):e}function DC(n){var e=so(),t=e.queue;if(t===null)throw Error(_e(311));t.lastRenderedReducer=n;var r=gr,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((yh&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,$n.lanes|=c,xh|=c}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Oo(r,e.memoizedState)||(Ys=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,$n.lanes|=i,xh|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function $C(n){var e=so(),t=e.queue;if(t===null)throw Error(_e(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Oo(i,e.memoizedState)||(Ys=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Tz(){}function Nz(n,e){var t=$n,r=so(),s=e(),i=!Oo(r.memoizedState,s);if(i&&(r.memoizedState=s,Ys=!0),r=r.queue,CT(Dz.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Ar!==null&&Ar.memoizedState.tag&1){if(t.flags|=2048,Tg(9,Rz.bind(null,t,r,s,e),void 0,null),$r===null)throw Error(_e(349));yh&30||Az(t,e,s)}return s}function Az(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Rz(n,e,t,r){e.value=t,e.getSnapshot=r,$z(e)&&Pz(n)}function Dz(n,e,t){return t(function(){$z(e)&&Pz(n)})}function $z(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Oo(n,t)}catch{return!0}}function Pz(n){var e=gl(n,1);e!==null&&Ao(e,n,1,-1)}function jO(n){var e=Yo();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eg,lastRenderedState:n},e.queue=n,n=n.dispatch=nZ.bind(null,$n,n),[e.memoizedState,n]}function Tg(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Oz(){return so().memoizedState}function K0(n,e,t,r){var s=Yo();$n.flags|=n,s.memoizedState=Tg(1|e,t,void 0,r===void 0?null:r)}function k1(n,e,t,r){var s=so();r=r===void 0?null:r;var i=void 0;if(gr!==null){var o=gr.memoizedState;if(i=o.destroy,r!==null&&wT(r,o.deps)){s.memoizedState=Tg(e,t,i,r);return}}$n.flags|=n,s.memoizedState=Tg(1|e,t,i,r)}function WO(n,e){return K0(8390656,8,n,e)}function CT(n,e){return k1(2048,8,n,e)}function Fz(n,e){return k1(4,2,n,e)}function Mz(n,e){return k1(4,4,n,e)}function Lz(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Bz(n,e,t){return t=t!=null?t.concat([n]):null,k1(4,4,Lz.bind(null,e,n),t)}function IT(){}function Vz(n,e){var t=so();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&wT(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function zz(n,e){var t=so();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&wT(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Uz(n,e,t){return yh&21?(Oo(t,e)||(t=qV(),$n.lanes|=t,xh|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Ys=!0),n.memoizedState=t)}function eZ(n,e){var t=en;en=t!==0&&4>t?t:4,n(!0);var r=RC.transition;RC.transition={};try{n(!1),e()}finally{en=t,RC.transition=r}}function jz(){return so().memoizedState}function tZ(n,e,t){var r=Nu(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Wz(n))Hz(e,t);else if(t=Iz(n,e,t,r),t!==null){var s=Os();Ao(t,n,r,s),Gz(t,e,r)}}function nZ(n,e,t){var r=Nu(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Wz(n))Hz(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Oo(a,o)){var l=e.interleaved;l===null?(s.next=s,gT(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=Iz(n,e,s,r),t!==null&&(s=Os(),Ao(t,n,r,s),Gz(t,e,r))}}function Wz(n){var e=n.alternate;return n===$n||e!==null&&e===$n}function Hz(n,e){qm=Mb=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Gz(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,nT(n,t)}}var Lb={readContext:ro,useCallback:is,useContext:is,useEffect:is,useImperativeHandle:is,useInsertionEffect:is,useLayoutEffect:is,useMemo:is,useReducer:is,useRef:is,useState:is,useDebugValue:is,useDeferredValue:is,useTransition:is,useMutableSource:is,useSyncExternalStore:is,useId:is,unstable_isNewReconciler:!1},rZ={readContext:ro,useCallback:function(n,e){return Yo().memoizedState=[n,e===void 0?null:e],n},useContext:ro,useEffect:WO,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,K0(4194308,4,Lz.bind(null,e,n),t)},useLayoutEffect:function(n,e){return K0(4194308,4,n,e)},useInsertionEffect:function(n,e){return K0(4,2,n,e)},useMemo:function(n,e){var t=Yo();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Yo();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=tZ.bind(null,$n,n),[r.memoizedState,n]},useRef:function(n){var e=Yo();return n={current:n},e.memoizedState=n},useState:jO,useDebugValue:IT,useDeferredValue:function(n){return Yo().memoizedState=n},useTransition:function(){var n=jO(!1),e=n[0];return n=eZ.bind(null,n[1]),Yo().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=$n,s=Yo();if(Sn){if(t===void 0)throw Error(_e(407));t=t()}else{if(t=e(),$r===null)throw Error(_e(349));yh&30||Az(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,WO(Dz.bind(null,r,i,n),[n]),r.flags|=2048,Tg(9,Rz.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Yo(),e=$r.identifierPrefix;if(Sn){var t=sl,r=rl;t=(r&~(1<<32-No(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Sg++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=ZJ++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},sZ={readContext:ro,useCallback:Vz,useContext:ro,useEffect:CT,useImperativeHandle:Bz,useInsertionEffect:Fz,useLayoutEffect:Mz,useMemo:zz,useReducer:DC,useRef:Oz,useState:function(){return DC(Eg)},useDebugValue:IT,useDeferredValue:function(n){var e=so();return Uz(e,gr.memoizedState,n)},useTransition:function(){var n=DC(Eg)[0],e=so().memoizedState;return[n,e]},useMutableSource:Tz,useSyncExternalStore:Nz,useId:jz,unstable_isNewReconciler:!1},iZ={readContext:ro,useCallback:Vz,useContext:ro,useEffect:CT,useImperativeHandle:Bz,useInsertionEffect:Fz,useLayoutEffect:Mz,useMemo:zz,useReducer:$C,useRef:Oz,useState:function(){return $C(Eg)},useDebugValue:IT,useDeferredValue:function(n){var e=so();return gr===null?e.memoizedState=n:Uz(e,gr.memoizedState,n)},useTransition:function(){var n=$C(Eg)[0],e=so().memoizedState;return[n,e]},useMutableSource:Tz,useSyncExternalStore:Nz,useId:jz,unstable_isNewReconciler:!1};function xo(n,e){if(n&&n.defaultProps){e=On({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function $I(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:On({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var C1={isMounted:function(n){return(n=n._reactInternals)?Hh(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Os(),s=Nu(n),i=ul(r,s);i.payload=e,t!=null&&(i.callback=t),e=Eu(n,i,s),e!==null&&(Ao(e,n,s,r),G0(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Os(),s=Nu(n),i=ul(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Eu(n,i,s),e!==null&&(Ao(e,n,s,r),G0(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Os(),r=Nu(n),s=ul(t,r);s.tag=2,e!=null&&(s.callback=e),e=Eu(n,s,r),e!==null&&(Ao(e,n,r,t),G0(e,n,r))}};function HO(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!bg(t,r)||!bg(s,i):!0}function qz(n,e,t){var r=!1,s=Gu,i=e.contextType;return typeof i=="object"&&i!==null?i=ro(i):(s=ei(e)?gh:Cs.current,r=e.contextTypes,i=(r=r!=null)?Sf(n,s):Gu),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=C1,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function GO(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&C1.enqueueReplaceState(e,e.state,null)}function PI(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},vT(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ro(i):(i=ei(e)?gh:Cs.current,s.context=Sf(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&($I(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&C1.enqueueReplaceState(s,s.state,null),Ob(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Af(n,e){try{var t="",r=e;do t+=$Q(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function PC(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function OI(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var oZ=typeof WeakMap=="function"?WeakMap:Map;function Kz(n,e,t){t=ul(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Vb||(Vb=!0,HI=r),OI(n,e)},t}function Xz(n,e,t){t=ul(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){OI(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){OI(n,e),typeof r!="function"&&(Tu===null?Tu=new Set([this]):Tu.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function qO(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new oZ;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=bZ.bind(null,n,e,t),e.then(n,n))}function KO(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function XO(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ul(-1,1),e.tag=2,Eu(t,e,1))),t.lanes|=1),n)}var aZ=Al.ReactCurrentOwner,Ys=!1;function As(n,e,t,r){e.child=n===null?Cz(e,null,t,r):Tf(e,n.child,t,r)}function YO(n,e,t,r,s){t=t.render;var i=e.ref;return of(e,s),r=_T(n,e,t,r,i,s),t=kT(),n!==null&&!Ys?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vl(n,e,s)):(Sn&&t&&cT(e),e.flags|=1,As(n,e,r,s),e.child)}function QO(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!$T(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Yz(n,e,i,r,s)):(n=J0(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:bg,t(o,r)&&n.ref===e.ref)return vl(n,e,s)}return e.flags|=1,n=Au(i,r),n.ref=e.ref,n.return=e,e.child=n}function Yz(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(bg(i,r)&&n.ref===e.ref)if(Ys=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Ys=!0);else return e.lanes=n.lanes,vl(n,e,s)}return FI(n,e,t,r,s)}function Qz(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(Jd,hi),hi|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,un(Jd,hi),hi|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,un(Jd,hi),hi|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,un(Jd,hi),hi|=r;return As(n,e,s,t),e.child}function Jz(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function FI(n,e,t,r,s){var i=ei(t)?gh:Cs.current;return i=Sf(e,i),of(e,s),t=_T(n,e,t,r,i,s),r=kT(),n!==null&&!Ys?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vl(n,e,s)):(Sn&&r&&cT(e),e.flags|=1,As(n,e,t,s),e.child)}function JO(n,e,t,r,s){if(ei(t)){var i=!0;Ab(e)}else i=!1;if(of(e,s),e.stateNode===null)X0(n,e),qz(e,t,r),PI(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=ro(u):(u=ei(t)?gh:Cs.current,u=Sf(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&GO(e,o,r,u),su=!1;var d=e.memoizedState;o.state=d,Ob(e,r,o,s),l=e.memoizedState,a!==r||d!==l||Zs.current||su?(typeof c=="function"&&($I(e,t,c,r),l=e.memoizedState),(a=su||HO(e,t,a,r,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Sz(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:xo(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=ro(l):(l=ei(t)?gh:Cs.current,l=Sf(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&GO(e,o,r,l),su=!1,d=e.memoizedState,o.state=d,Ob(e,r,o,s);var p=e.memoizedState;a!==h||d!==p||Zs.current||su?(typeof f=="function"&&($I(e,t,f,r),p=e.memoizedState),(u=su||HO(e,t,u,r,d,p,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),r=!1)}return MI(n,e,t,r,i,s)}function MI(n,e,t,r,s,i){Jz(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&MO(e,t,!1),vl(n,e,i);r=e.stateNode,aZ.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Tf(e,n.child,null,i),e.child=Tf(e,null,a,i)):As(n,e,a,i),e.memoizedState=r.state,s&&MO(e,t,!0),e.child}function Zz(n){var e=n.stateNode;e.pendingContext?FO(n,e.pendingContext,e.pendingContext!==e.context):e.context&&FO(n,e.context,!1),yT(n,e.containerInfo)}function ZO(n,e,t,r,s){return Ef(),dT(s),e.flags|=256,As(n,e,t,r),e.child}var LI={dehydrated:null,treeContext:null,retryLane:0};function BI(n){return{baseLanes:n,cachePool:null,transitions:null}}function eU(n,e,t){var r=e.pendingProps,s=An.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),un(An,s&1),n===null)return RI(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=E1(o,r,0,null),n=oh(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=BI(t),e.memoizedState=LI,n):ST(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return lZ(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Au(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Au(a,i):(i=oh(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?BI(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=LI,r}return i=n.child,n=i.sibling,r=Au(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function ST(n,e){return e=E1({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function zx(n,e,t,r){return r!==null&&dT(r),Tf(e,n.child,null,t),n=ST(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function lZ(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=PC(Error(_e(422))),zx(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=E1({mode:"visible",children:r.children},s,0,null),i=oh(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Tf(e,n.child,null,o),e.child.memoizedState=BI(o),e.memoizedState=LI,i);if(!(e.mode&1))return zx(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(_e(419)),r=PC(i,r,void 0),zx(n,e,o,r)}if(a=(o&n.childLanes)!==0,Ys||a){if(r=$r,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,gl(n,s),Ao(r,n,s,-1))}return DT(),r=PC(Error(_e(421))),zx(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=wZ.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,gi=Su(s.nextSibling),wi=e,Sn=!0,wo=null,n!==null&&(Vi[zi++]=rl,Vi[zi++]=sl,Vi[zi++]=vh,rl=n.id,sl=n.overflow,vh=e),e=ST(e,r.children),e.flags|=4096,e)}function eF(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),DI(n.return,e,t)}function OC(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function tU(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(As(n,e,r.children,t),r=An.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&eF(n,t,e);else if(n.tag===19)eF(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(un(An,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Fb(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),OC(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Fb(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}OC(e,!0,t,null,i);break;case"together":OC(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function X0(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function vl(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),xh|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(_e(153));if(e.child!==null){for(n=e.child,t=Au(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Au(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function uZ(n,e,t){switch(e.tag){case 3:Zz(e),Ef();break;case 5:Ez(e);break;case 1:ei(e.type)&&Ab(e);break;case 4:yT(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;un($b,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(un(An,An.current&1),e.flags|=128,null):t&e.child.childLanes?eU(n,e,t):(un(An,An.current&1),n=vl(n,e,t),n!==null?n.sibling:null);un(An,An.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return tU(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),un(An,An.current),r)break;return null;case 22:case 23:return e.lanes=0,Qz(n,e,t)}return vl(n,e,t)}var nU,VI,rU,sU;nU=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};VI=function(){};rU=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Yc(fa.current);var i=null;switch(t){case"input":s=lI(n,s),r=lI(n,r),i=[];break;case"select":s=On({},s,{value:void 0}),r=On({},r,{value:void 0}),i=[];break;case"textarea":s=hI(n,s),r=hI(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Tb)}fI(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(fg.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(fg.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&gn("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};sU=function(n,e,t,r){t!==r&&(e.flags|=4)};function im(n,e){if(!Sn)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function os(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function cZ(n,e,t){var r=e.pendingProps;switch(hT(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return os(e),null;case 1:return ei(e.type)&&Nb(),os(e),null;case 3:return r=e.stateNode,Nf(),bn(Zs),bn(Cs),bT(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Bx(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wo!==null&&(KI(wo),wo=null))),VI(n,e),os(e),null;case 5:xT(e);var s=Yc(Ig.current);if(t=e.type,n!==null&&e.stateNode!=null)rU(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(_e(166));return os(e),null}if(n=Yc(fa.current),Bx(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[oa]=e,r[kg]=i,n=(e.mode&1)!==0,t){case"dialog":gn("cancel",r),gn("close",r);break;case"iframe":case"object":case"embed":gn("load",r);break;case"video":case"audio":for(s=0;s<Im.length;s++)gn(Im[s],r);break;case"source":gn("error",r);break;case"img":case"image":case"link":gn("error",r),gn("load",r);break;case"details":gn("toggle",r);break;case"input":uO(r,i),gn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},gn("invalid",r);break;case"textarea":hO(r,i),gn("invalid",r)}fI(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Lx(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Lx(r.textContent,a,n),s=["children",""+a]):fg.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&gn("scroll",r)}switch(t){case"input":Ax(r),cO(r,i,!0);break;case"textarea":Ax(r),dO(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Tb)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=DV(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[oa]=e,n[kg]=r,nU(n,e,!1,!1),e.stateNode=n;e:{switch(o=pI(t,r),t){case"dialog":gn("cancel",n),gn("close",n),s=r;break;case"iframe":case"object":case"embed":gn("load",n),s=r;break;case"video":case"audio":for(s=0;s<Im.length;s++)gn(Im[s],n);s=r;break;case"source":gn("error",n),s=r;break;case"img":case"image":case"link":gn("error",n),gn("load",n),s=r;break;case"details":gn("toggle",n),s=r;break;case"input":uO(n,r),s=lI(n,r),gn("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=On({},r,{value:void 0}),gn("invalid",n);break;case"textarea":hO(n,r),s=hI(n,r),gn("invalid",n);break;default:s=r}fI(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?OV(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&$V(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&pg(n,l):typeof l=="number"&&pg(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(fg.hasOwnProperty(i)?l!=null&&i==="onScroll"&&gn("scroll",n):l!=null&&YE(n,i,l,o))}switch(t){case"input":Ax(n),cO(n,r,!1);break;case"textarea":Ax(n),dO(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Hu(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?tf(n,!!r.multiple,i,!1):r.defaultValue!=null&&tf(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Tb)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return os(e),null;case 6:if(n&&e.stateNode!=null)sU(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(_e(166));if(t=Yc(Ig.current),Yc(fa.current),Bx(e)){if(r=e.stateNode,t=e.memoizedProps,r[oa]=e,(i=r.nodeValue!==t)&&(n=wi,n!==null))switch(n.tag){case 3:Lx(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Lx(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[oa]=e,e.stateNode=r}return os(e),null;case 13:if(bn(An),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Sn&&gi!==null&&e.mode&1&&!(e.flags&128))_z(),Ef(),e.flags|=98560,i=!1;else if(i=Bx(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(_e(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(_e(317));i[oa]=e}else Ef(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;os(e),i=!1}else wo!==null&&(KI(wo),wo=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||An.current&1?xr===0&&(xr=3):DT())),e.updateQueue!==null&&(e.flags|=4),os(e),null);case 4:return Nf(),VI(n,e),n===null&&wg(e.stateNode.containerInfo),os(e),null;case 10:return mT(e.type._context),os(e),null;case 17:return ei(e.type)&&Nb(),os(e),null;case 19:if(bn(An),i=e.memoizedState,i===null)return os(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)im(i,!1);else{if(xr!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Fb(n),o!==null){for(e.flags|=128,im(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return un(An,An.current&1|2),e.child}n=n.sibling}i.tail!==null&&Jn()>Rf&&(e.flags|=128,r=!0,im(i,!1),e.lanes=4194304)}else{if(!r)if(n=Fb(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),im(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Sn)return os(e),null}else 2*Jn()-i.renderingStartTime>Rf&&t!==1073741824&&(e.flags|=128,r=!0,im(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Jn(),e.sibling=null,t=An.current,un(An,r?t&1|2:t&1),e):(os(e),null);case 22:case 23:return RT(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?hi&1073741824&&(os(e),e.subtreeFlags&6&&(e.flags|=8192)):os(e),null;case 24:return null;case 25:return null}throw Error(_e(156,e.tag))}function hZ(n,e){switch(hT(e),e.tag){case 1:return ei(e.type)&&Nb(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Nf(),bn(Zs),bn(Cs),bT(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return xT(e),null;case 13:if(bn(An),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(_e(340));Ef()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return bn(An),null;case 4:return Nf(),null;case 10:return mT(e.type._context),null;case 22:case 23:return RT(),null;case 24:return null;default:return null}}var Ux=!1,ps=!1,dZ=typeof WeakSet=="function"?WeakSet:Set,Fe=null;function Qd(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Un(n,e,r)}else t.current=null}function zI(n,e,t){try{t()}catch(r){Un(n,e,r)}}var tF=!1;function fZ(n,e){if(CI=Ib,n=uz(),uT(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=n,d=null;t:for(;;){for(var f;h!==t||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===n)break t;if(d===t&&++u===s&&(a=o),d===i&&++c===r&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(II={focusedElem:n,selectionRange:t},Ib=!1,Fe=e;Fe!==null;)if(e=Fe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Fe=n;else for(;Fe!==null;){e=Fe;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?m:xo(e.type,m),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_e(163))}}catch(b){Un(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,Fe=n;break}Fe=e.return}return p=tF,tF=!1,p}function Km(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&zI(e,t,i)}s=s.next}while(s!==r)}}function I1(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function UI(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function iU(n){var e=n.alternate;e!==null&&(n.alternate=null,iU(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[oa],delete e[kg],delete e[TI],delete e[XJ],delete e[YJ])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function oU(n){return n.tag===5||n.tag===3||n.tag===4}function nF(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||oU(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function jI(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Tb));else if(r!==4&&(n=n.child,n!==null))for(jI(n,e,t),n=n.sibling;n!==null;)jI(n,e,t),n=n.sibling}function WI(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(WI(n,e,t),n=n.sibling;n!==null;)WI(n,e,t),n=n.sibling}var Ur=null,bo=!1;function Ql(n,e,t){for(t=t.child;t!==null;)aU(n,e,t),t=t.sibling}function aU(n,e,t){if(da&&typeof da.onCommitFiberUnmount=="function")try{da.onCommitFiberUnmount(v1,t)}catch{}switch(t.tag){case 5:ps||Qd(t,e);case 6:var r=Ur,s=bo;Ur=null,Ql(n,e,t),Ur=r,bo=s,Ur!==null&&(bo?(n=Ur,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Ur.removeChild(t.stateNode));break;case 18:Ur!==null&&(bo?(n=Ur,t=t.stateNode,n.nodeType===8?TC(n.parentNode,t):n.nodeType===1&&TC(n,t),yg(n)):TC(Ur,t.stateNode));break;case 4:r=Ur,s=bo,Ur=t.stateNode.containerInfo,bo=!0,Ql(n,e,t),Ur=r,bo=s;break;case 0:case 11:case 14:case 15:if(!ps&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&zI(t,e,o),s=s.next}while(s!==r)}Ql(n,e,t);break;case 1:if(!ps&&(Qd(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Un(t,e,a)}Ql(n,e,t);break;case 21:Ql(n,e,t);break;case 22:t.mode&1?(ps=(r=ps)||t.memoizedState!==null,Ql(n,e,t),ps=r):Ql(n,e,t);break;default:Ql(n,e,t)}}function rF(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new dZ),e.forEach(function(r){var s=_Z.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function go(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ur=a.stateNode,bo=!1;break e;case 3:Ur=a.stateNode.containerInfo,bo=!0;break e;case 4:Ur=a.stateNode.containerInfo,bo=!0;break e}a=a.return}if(Ur===null)throw Error(_e(160));aU(i,o,s),Ur=null,bo=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Un(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)lU(e,n),e=e.sibling}function lU(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(go(e,n),Go(n),r&4){try{Km(3,n,n.return),I1(3,n)}catch(m){Un(n,n.return,m)}try{Km(5,n,n.return)}catch(m){Un(n,n.return,m)}}break;case 1:go(e,n),Go(n),r&512&&t!==null&&Qd(t,t.return);break;case 5:if(go(e,n),Go(n),r&512&&t!==null&&Qd(t,t.return),n.flags&32){var s=n.stateNode;try{pg(s,"")}catch(m){Un(n,n.return,m)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&AV(s,i),pI(a,o);var u=pI(a,i);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?OV(s,h):c==="dangerouslySetInnerHTML"?$V(s,h):c==="children"?pg(s,h):YE(s,c,h,u)}switch(a){case"input":uI(s,i);break;case"textarea":RV(s,i);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?tf(s,!!i.multiple,f,!1):d!==!!i.multiple&&(i.defaultValue!=null?tf(s,!!i.multiple,i.defaultValue,!0):tf(s,!!i.multiple,i.multiple?[]:"",!1))}s[kg]=i}catch(m){Un(n,n.return,m)}}break;case 6:if(go(e,n),Go(n),r&4){if(n.stateNode===null)throw Error(_e(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(m){Un(n,n.return,m)}}break;case 3:if(go(e,n),Go(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{yg(e.containerInfo)}catch(m){Un(n,n.return,m)}break;case 4:go(e,n),Go(n);break;case 13:go(e,n),Go(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(NT=Jn())),r&4&&rF(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(ps=(u=ps)||c,go(e,n),ps=u):go(e,n),Go(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(Fe=n,c=n.child;c!==null;){for(h=Fe=c;Fe!==null;){switch(d=Fe,f=d.child,d.tag){case 0:case 11:case 14:case 15:Km(4,d,d.return);break;case 1:Qd(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){r=d,t=d.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){Un(r,t,m)}}break;case 5:Qd(d,d.return);break;case 22:if(d.memoizedState!==null){iF(h);continue}}f!==null?(f.return=d,Fe=f):iF(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=PV("display",o))}catch(m){Un(n,n.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){Un(n,n.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:go(e,n),Go(n),r&4&&rF(n);break;case 21:break;default:go(e,n),Go(n)}}function Go(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(oU(t)){var r=t;break e}t=t.return}throw Error(_e(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(pg(s,""),r.flags&=-33);var i=nF(n);WI(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=nF(n);jI(n,a,o);break;default:throw Error(_e(161))}}catch(l){Un(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function pZ(n,e,t){Fe=n,uU(n)}function uU(n,e,t){for(var r=(n.mode&1)!==0;Fe!==null;){var s=Fe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Ux;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ps;a=Ux;var u=ps;if(Ux=o,(ps=l)&&!u)for(Fe=s;Fe!==null;)o=Fe,l=o.child,o.tag===22&&o.memoizedState!==null?oF(s):l!==null?(l.return=o,Fe=l):oF(s);for(;i!==null;)Fe=i,uU(i),i=i.sibling;Fe=s,Ux=a,ps=u}sF(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Fe=i):sF(n)}}function sF(n){for(;Fe!==null;){var e=Fe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ps||I1(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ps)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:xo(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&UO(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}UO(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&yg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_e(163))}ps||e.flags&512&&UI(e)}catch(d){Un(e,e.return,d)}}if(e===n){Fe=null;break}if(t=e.sibling,t!==null){t.return=e.return,Fe=t;break}Fe=e.return}}function iF(n){for(;Fe!==null;){var e=Fe;if(e===n){Fe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Fe=t;break}Fe=e.return}}function oF(n){for(;Fe!==null;){var e=Fe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{I1(4,e)}catch(l){Un(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Un(e,s,l)}}var i=e.return;try{UI(e)}catch(l){Un(e,i,l)}break;case 5:var o=e.return;try{UI(e)}catch(l){Un(e,o,l)}}}catch(l){Un(e,e.return,l)}if(e===n){Fe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Fe=a;break}Fe=e.return}}var mZ=Math.ceil,Bb=Al.ReactCurrentDispatcher,ET=Al.ReactCurrentOwner,no=Al.ReactCurrentBatchConfig,Ft=0,$r=null,or=null,Kr=0,hi=0,Jd=lc(0),xr=0,Ng=null,xh=0,S1=0,TT=0,Xm=null,Hs=null,NT=0,Rf=1/0,Qa=null,Vb=!1,HI=null,Tu=null,jx=!1,fu=null,zb=0,Ym=0,GI=null,Y0=-1,Q0=0;function Os(){return Ft&6?Jn():Y0!==-1?Y0:Y0=Jn()}function Nu(n){return n.mode&1?Ft&2&&Kr!==0?Kr&-Kr:JJ.transition!==null?(Q0===0&&(Q0=qV()),Q0):(n=en,n!==0||(n=window.event,n=n===void 0?16:ez(n.type)),n):1}function Ao(n,e,t,r){if(50<Ym)throw Ym=0,GI=null,Error(_e(185));xv(n,t,r),(!(Ft&2)||n!==$r)&&(n===$r&&(!(Ft&2)&&(S1|=t),xr===4&&au(n,Kr)),ti(n,r),t===1&&Ft===0&&!(e.mode&1)&&(Rf=Jn()+500,_1&&uc()))}function ti(n,e){var t=n.callbackNode;JQ(n,e);var r=Cb(n,n===$r?Kr:0);if(r===0)t!==null&&mO(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&mO(t),e===1)n.tag===0?QJ(aF.bind(null,n)):xz(aF.bind(null,n)),qJ(function(){!(Ft&6)&&uc()}),t=null;else{switch(KV(r)){case 1:t=tT;break;case 4:t=HV;break;case 16:t=kb;break;case 536870912:t=GV;break;default:t=kb}t=vU(t,cU.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function cU(n,e){if(Y0=-1,Q0=0,Ft&6)throw Error(_e(327));var t=n.callbackNode;if(af()&&n.callbackNode!==t)return null;var r=Cb(n,n===$r?Kr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ub(n,r);else{e=r;var s=Ft;Ft|=2;var i=dU();($r!==n||Kr!==e)&&(Qa=null,Rf=Jn()+500,ih(n,e));do try{yZ();break}catch(a){hU(n,a)}while(!0);pT(),Bb.current=i,Ft=s,or!==null?e=0:($r=null,Kr=0,e=xr)}if(e!==0){if(e===2&&(s=xI(n),s!==0&&(r=s,e=qI(n,s))),e===1)throw t=Ng,ih(n,0),au(n,r),ti(n,Jn()),t;if(e===6)au(n,r);else{if(s=n.current.alternate,!(r&30)&&!gZ(s)&&(e=Ub(n,r),e===2&&(i=xI(n),i!==0&&(r=i,e=qI(n,i))),e===1))throw t=Ng,ih(n,0),au(n,r),ti(n,Jn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(_e(345));case 2:Mc(n,Hs,Qa);break;case 3:if(au(n,r),(r&130023424)===r&&(e=NT+500-Jn(),10<e)){if(Cb(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Os(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=EI(Mc.bind(null,n,Hs,Qa),e);break}Mc(n,Hs,Qa);break;case 4:if(au(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-No(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Jn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*mZ(r/1960))-r,10<r){n.timeoutHandle=EI(Mc.bind(null,n,Hs,Qa),r);break}Mc(n,Hs,Qa);break;case 5:Mc(n,Hs,Qa);break;default:throw Error(_e(329))}}}return ti(n,Jn()),n.callbackNode===t?cU.bind(null,n):null}function qI(n,e){var t=Xm;return n.current.memoizedState.isDehydrated&&(ih(n,e).flags|=256),n=Ub(n,e),n!==2&&(e=Hs,Hs=t,e!==null&&KI(e)),n}function KI(n){Hs===null?Hs=n:Hs.push.apply(Hs,n)}function gZ(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Oo(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function au(n,e){for(e&=~TT,e&=~S1,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-No(e),r=1<<t;n[t]=-1,e&=~r}}function aF(n){if(Ft&6)throw Error(_e(327));af();var e=Cb(n,0);if(!(e&1))return ti(n,Jn()),null;var t=Ub(n,e);if(n.tag!==0&&t===2){var r=xI(n);r!==0&&(e=r,t=qI(n,r))}if(t===1)throw t=Ng,ih(n,0),au(n,e),ti(n,Jn()),t;if(t===6)throw Error(_e(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Mc(n,Hs,Qa),ti(n,Jn()),null}function AT(n,e){var t=Ft;Ft|=1;try{return n(e)}finally{Ft=t,Ft===0&&(Rf=Jn()+500,_1&&uc())}}function bh(n){fu!==null&&fu.tag===0&&!(Ft&6)&&af();var e=Ft;Ft|=1;var t=no.transition,r=en;try{if(no.transition=null,en=1,n)return n()}finally{en=r,no.transition=t,Ft=e,!(Ft&6)&&uc()}}function RT(){hi=Jd.current,bn(Jd)}function ih(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,GJ(t)),or!==null)for(t=or.return;t!==null;){var r=t;switch(hT(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Nb();break;case 3:Nf(),bn(Zs),bn(Cs),bT();break;case 5:xT(r);break;case 4:Nf();break;case 13:bn(An);break;case 19:bn(An);break;case 10:mT(r.type._context);break;case 22:case 23:RT()}t=t.return}if($r=n,or=n=Au(n.current,null),Kr=hi=e,xr=0,Ng=null,TT=S1=xh=0,Hs=Xm=null,Xc!==null){for(e=0;e<Xc.length;e++)if(t=Xc[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Xc=null}return n}function hU(n,e){do{var t=or;try{if(pT(),q0.current=Lb,Mb){for(var r=$n.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Mb=!1}if(yh=0,Ar=gr=$n=null,qm=!1,Sg=0,ET.current=null,t===null||t.return===null){xr=1,Ng=e,or=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Kr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=KO(o);if(f!==null){f.flags&=-257,XO(f,o,a,i,e),f.mode&1&&qO(i,u,e),e=f,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){qO(i,u,e),DT();break e}l=Error(_e(426))}}else if(Sn&&a.mode&1){var g=KO(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),XO(g,o,a,i,e),dT(Af(l,a));break e}}i=l=Af(l,a),xr!==4&&(xr=2),Xm===null?Xm=[i]:Xm.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=Kz(i,l,e);zO(i,v);break e;case 1:a=l;var y=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Tu===null||!Tu.has(x)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=Xz(i,a,e);zO(i,b);break e}}i=i.return}while(i!==null)}pU(t)}catch(_){e=_,or===t&&t!==null&&(or=t=t.return);continue}break}while(!0)}function dU(){var n=Bb.current;return Bb.current=Lb,n===null?Lb:n}function DT(){(xr===0||xr===3||xr===2)&&(xr=4),$r===null||!(xh&268435455)&&!(S1&268435455)||au($r,Kr)}function Ub(n,e){var t=Ft;Ft|=2;var r=dU();($r!==n||Kr!==e)&&(Qa=null,ih(n,e));do try{vZ();break}catch(s){hU(n,s)}while(!0);if(pT(),Ft=t,Bb.current=r,or!==null)throw Error(_e(261));return $r=null,Kr=0,xr}function vZ(){for(;or!==null;)fU(or)}function yZ(){for(;or!==null&&!jQ();)fU(or)}function fU(n){var e=gU(n.alternate,n,hi);n.memoizedProps=n.pendingProps,e===null?pU(n):or=e,ET.current=null}function pU(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=hZ(t,e),t!==null){t.flags&=32767,or=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{xr=6,or=null;return}}else if(t=cZ(t,e,hi),t!==null){or=t;return}if(e=e.sibling,e!==null){or=e;return}or=e=n}while(e!==null);xr===0&&(xr=5)}function Mc(n,e,t){var r=en,s=no.transition;try{no.transition=null,en=1,xZ(n,e,t,r)}finally{no.transition=s,en=r}return null}function xZ(n,e,t,r){do af();while(fu!==null);if(Ft&6)throw Error(_e(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(_e(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(ZQ(n,i),n===$r&&(or=$r=null,Kr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||jx||(jx=!0,vU(kb,function(){return af(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=no.transition,no.transition=null;var o=en;en=1;var a=Ft;Ft|=4,ET.current=null,fZ(n,t),lU(t,n),BJ(II),Ib=!!CI,II=CI=null,n.current=t,pZ(t),WQ(),Ft=a,en=o,no.transition=i}else n.current=t;if(jx&&(jx=!1,fu=n,zb=s),i=n.pendingLanes,i===0&&(Tu=null),qQ(t.stateNode),ti(n,Jn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Vb)throw Vb=!1,n=HI,HI=null,n;return zb&1&&n.tag!==0&&af(),i=n.pendingLanes,i&1?n===GI?Ym++:(Ym=0,GI=n):Ym=0,uc(),null}function af(){if(fu!==null){var n=KV(zb),e=no.transition,t=en;try{if(no.transition=null,en=16>n?16:n,fu===null)var r=!1;else{if(n=fu,fu=null,zb=0,Ft&6)throw Error(_e(331));var s=Ft;for(Ft|=4,Fe=n.current;Fe!==null;){var i=Fe,o=i.child;if(Fe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Fe=u;Fe!==null;){var c=Fe;switch(c.tag){case 0:case 11:case 15:Km(8,c,i)}var h=c.child;if(h!==null)h.return=c,Fe=h;else for(;Fe!==null;){c=Fe;var d=c.sibling,f=c.return;if(iU(c),c===u){Fe=null;break}if(d!==null){d.return=f,Fe=d;break}Fe=f}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}Fe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Fe=o;else e:for(;Fe!==null;){if(i=Fe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Km(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,Fe=v;break e}Fe=i.return}}var y=n.current;for(Fe=y;Fe!==null;){o=Fe;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,Fe=x;else e:for(o=y;Fe!==null;){if(a=Fe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:I1(9,a)}}catch(_){Un(a,a.return,_)}if(a===o){Fe=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,Fe=b;break e}Fe=a.return}}if(Ft=s,uc(),da&&typeof da.onPostCommitFiberRoot=="function")try{da.onPostCommitFiberRoot(v1,n)}catch{}r=!0}return r}finally{en=t,no.transition=e}}return!1}function lF(n,e,t){e=Af(t,e),e=Kz(n,e,1),n=Eu(n,e,1),e=Os(),n!==null&&(xv(n,1,e),ti(n,e))}function Un(n,e,t){if(n.tag===3)lF(n,n,t);else for(;e!==null;){if(e.tag===3){lF(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Tu===null||!Tu.has(r))){n=Af(t,n),n=Xz(e,n,1),e=Eu(e,n,1),n=Os(),e!==null&&(xv(e,1,n),ti(e,n));break}}e=e.return}}function bZ(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Os(),n.pingedLanes|=n.suspendedLanes&t,$r===n&&(Kr&t)===t&&(xr===4||xr===3&&(Kr&130023424)===Kr&&500>Jn()-NT?ih(n,0):TT|=t),ti(n,e)}function mU(n,e){e===0&&(n.mode&1?(e=$x,$x<<=1,!($x&130023424)&&($x=4194304)):e=1);var t=Os();n=gl(n,e),n!==null&&(xv(n,e,t),ti(n,t))}function wZ(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),mU(n,t)}function _Z(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(_e(314))}r!==null&&r.delete(e),mU(n,t)}var gU;gU=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Zs.current)Ys=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Ys=!1,uZ(n,e,t);Ys=!!(n.flags&131072)}else Ys=!1,Sn&&e.flags&1048576&&bz(e,Db,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;X0(n,e),n=e.pendingProps;var s=Sf(e,Cs.current);of(e,t),s=_T(null,e,r,n,s,t);var i=kT();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ei(r)?(i=!0,Ab(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,vT(e),s.updater=C1,e.stateNode=s,s._reactInternals=e,PI(e,r,n,t),e=MI(null,e,r,!0,i,t)):(e.tag=0,Sn&&i&&cT(e),As(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(X0(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=CZ(r),n=xo(r,n),s){case 0:e=FI(null,e,r,n,t);break e;case 1:e=JO(null,e,r,n,t);break e;case 11:e=YO(null,e,r,n,t);break e;case 14:e=QO(null,e,r,xo(r.type,n),t);break e}throw Error(_e(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xo(r,s),FI(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xo(r,s),JO(n,e,r,s,t);case 3:e:{if(Zz(e),n===null)throw Error(_e(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Sz(n,e),Ob(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Af(Error(_e(423)),e),e=ZO(n,e,r,t,s);break e}else if(r!==s){s=Af(Error(_e(424)),e),e=ZO(n,e,r,t,s);break e}else for(gi=Su(e.stateNode.containerInfo.firstChild),wi=e,Sn=!0,wo=null,t=Cz(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ef(),r===s){e=vl(n,e,t);break e}As(n,e,r,t)}e=e.child}return e;case 5:return Ez(e),n===null&&RI(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,SI(r,s)?o=null:i!==null&&SI(r,i)&&(e.flags|=32),Jz(n,e),As(n,e,o,t),e.child;case 6:return n===null&&RI(e),null;case 13:return eU(n,e,t);case 4:return yT(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Tf(e,null,r,t):As(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xo(r,s),YO(n,e,r,s,t);case 7:return As(n,e,e.pendingProps,t),e.child;case 8:return As(n,e,e.pendingProps.children,t),e.child;case 12:return As(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,un($b,r._currentValue),r._currentValue=o,i!==null)if(Oo(i.value,o)){if(i.children===s.children&&!Zs.current){e=vl(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=ul(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),DI(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(_e(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),DI(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}As(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,of(e,t),s=ro(s),r=r(s),e.flags|=1,As(n,e,r,t),e.child;case 14:return r=e.type,s=xo(r,e.pendingProps),s=xo(r.type,s),QO(n,e,r,s,t);case 15:return Yz(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xo(r,s),X0(n,e),e.tag=1,ei(r)?(n=!0,Ab(e)):n=!1,of(e,t),qz(e,r,s),PI(e,r,s,t),MI(null,e,r,!0,n,t);case 19:return tU(n,e,t);case 22:return Qz(n,e,t)}throw Error(_e(156,e.tag))};function vU(n,e){return WV(n,e)}function kZ(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(n,e,t,r){return new kZ(n,e,t,r)}function $T(n){return n=n.prototype,!(!n||!n.isReactComponent)}function CZ(n){if(typeof n=="function")return $T(n)?1:0;if(n!=null){if(n=n.$$typeof,n===JE)return 11;if(n===ZE)return 14}return 2}function Au(n,e){var t=n.alternate;return t===null?(t=qi(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function J0(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")$T(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Ud:return oh(t.children,s,i,e);case QE:o=8,s|=8;break;case sI:return n=qi(12,t,e,s|2),n.elementType=sI,n.lanes=i,n;case iI:return n=qi(13,t,e,s),n.elementType=iI,n.lanes=i,n;case oI:return n=qi(19,t,e,s),n.elementType=oI,n.lanes=i,n;case EV:return E1(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case IV:o=10;break e;case SV:o=9;break e;case JE:o=11;break e;case ZE:o=14;break e;case ru:o=16,r=null;break e}throw Error(_e(130,n==null?n:typeof n,""))}return e=qi(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function oh(n,e,t,r){return n=qi(7,n,r,e),n.lanes=t,n}function E1(n,e,t,r){return n=qi(22,n,r,e),n.elementType=EV,n.lanes=t,n.stateNode={isHidden:!1},n}function FC(n,e,t){return n=qi(6,n,null,e),n.lanes=t,n}function MC(n,e,t){return e=qi(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function IZ(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vC(0),this.expirationTimes=vC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vC(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function PT(n,e,t,r,s,i,o,a,l){return n=new IZ(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=qi(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},vT(i),n}function SZ(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zd,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function yU(n){if(!n)return Gu;n=n._reactInternals;e:{if(Hh(n)!==n||n.tag!==1)throw Error(_e(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ei(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(_e(171))}if(n.tag===1){var t=n.type;if(ei(t))return yz(n,t,e)}return e}function xU(n,e,t,r,s,i,o,a,l){return n=PT(t,r,!0,n,s,i,o,a,l),n.context=yU(null),t=n.current,r=Os(),s=Nu(t),i=ul(r,s),i.callback=e??null,Eu(t,i,s),n.current.lanes=s,xv(n,s,r),ti(n,r),n}function T1(n,e,t,r){var s=e.current,i=Os(),o=Nu(s);return t=yU(t),e.context===null?e.context=t:e.pendingContext=t,e=ul(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Eu(s,e,o),n!==null&&(Ao(n,s,o,i),G0(n,s,o)),o}function jb(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function uF(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function OT(n,e){uF(n,e),(n=n.alternate)&&uF(n,e)}function EZ(){return null}var bU=typeof reportError=="function"?reportError:function(n){console.error(n)};function FT(n){this._internalRoot=n}N1.prototype.render=FT.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(_e(409));T1(n,e,null,null)};N1.prototype.unmount=FT.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;bh(function(){T1(null,n,null,null)}),e[ml]=null}};function N1(n){this._internalRoot=n}N1.prototype.unstable_scheduleHydration=function(n){if(n){var e=QV();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ou.length&&e!==0&&e<ou[t].priority;t++);ou.splice(t,0,n),t===0&&ZV(n)}};function MT(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function A1(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function cF(){}function TZ(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=jb(o);i.call(u)}}var o=xU(e,r,n,0,null,!1,!1,"",cF);return n._reactRootContainer=o,n[ml]=o.current,wg(n.nodeType===8?n.parentNode:n),bh(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=jb(l);a.call(u)}}var l=PT(n,0,!1,null,null,!1,!1,"",cF);return n._reactRootContainer=l,n[ml]=l.current,wg(n.nodeType===8?n.parentNode:n),bh(function(){T1(e,l,t,r)}),l}function R1(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=jb(o);a.call(l)}}T1(e,o,n,s)}else o=TZ(t,e,n,s,r);return jb(o)}XV=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Cm(e.pendingLanes);t!==0&&(nT(e,t|1),ti(e,Jn()),!(Ft&6)&&(Rf=Jn()+500,uc()))}break;case 13:bh(function(){var r=gl(n,1);if(r!==null){var s=Os();Ao(r,n,1,s)}}),OT(n,1)}};rT=function(n){if(n.tag===13){var e=gl(n,134217728);if(e!==null){var t=Os();Ao(e,n,134217728,t)}OT(n,134217728)}};YV=function(n){if(n.tag===13){var e=Nu(n),t=gl(n,e);if(t!==null){var r=Os();Ao(t,n,e,r)}OT(n,e)}};QV=function(){return en};JV=function(n,e){var t=en;try{return en=n,e()}finally{en=t}};gI=function(n,e,t){switch(e){case"input":if(uI(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=w1(r);if(!s)throw Error(_e(90));NV(r),uI(r,s)}}}break;case"textarea":RV(n,t);break;case"select":e=t.value,e!=null&&tf(n,!!t.multiple,e,!1)}};LV=AT;BV=bh;var NZ={usingClientEntryPoint:!1,Events:[wv,Gd,w1,FV,MV,AT]},om={findFiberByHostInstance:Kc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},AZ={bundleType:om.bundleType,version:om.version,rendererPackageName:om.rendererPackageName,rendererConfig:om.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Al.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=UV(n),n===null?null:n.stateNode},findFiberByHostInstance:om.findFiberByHostInstance||EZ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wx.isDisabled&&Wx.supportsFiber)try{v1=Wx.inject(AZ),da=Wx}catch{}}Ni.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NZ;Ni.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!MT(e))throw Error(_e(200));return SZ(n,e,null,t)};Ni.createRoot=function(n,e){if(!MT(n))throw Error(_e(299));var t=!1,r="",s=bU;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=PT(n,1,!1,null,null,t,!1,r,s),n[ml]=e.current,wg(n.nodeType===8?n.parentNode:n),new FT(e)};Ni.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(_e(188)):(n=Object.keys(n).join(","),Error(_e(268,n)));return n=UV(e),n=n===null?null:n.stateNode,n};Ni.flushSync=function(n){return bh(n)};Ni.hydrate=function(n,e,t){if(!A1(e))throw Error(_e(200));return R1(null,n,e,!0,t)};Ni.hydrateRoot=function(n,e,t){if(!MT(n))throw Error(_e(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=bU;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=xU(e,null,n,1,t??null,s,!1,i,o),n[ml]=e.current,wg(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new N1(e)};Ni.render=function(n,e,t){if(!A1(e))throw Error(_e(200));return R1(null,n,e,!1,t)};Ni.unmountComponentAtNode=function(n){if(!A1(n))throw Error(_e(40));return n._reactRootContainer?(bh(function(){R1(null,null,n,!1,function(){n._reactRootContainer=null,n[ml]=null})}),!0):!1};Ni.unstable_batchedUpdates=AT;Ni.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!A1(t))throw Error(_e(200));if(n==null||n._reactInternals===void 0)throw Error(_e(38));return R1(n,e,t,!1,r)};Ni.version="18.3.1-next-f1338f8080-20240426";function wU(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wU)}catch(n){console.error(n)}}wU(),wV.exports=Ni;var RZ=wV.exports,_U,hF=RZ;_U=hF.createRoot,hF.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var DZ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Z=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),mt=(n,e)=>{const t=q.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:a="",children:l,...u},c)=>q.createElement("svg",{ref:c,...DZ,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:["lucide",`lucide-${$Z(n)}`,a].join(" "),...u},[...e.map(([h,d])=>q.createElement(h,d)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=mt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PZ=mt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LC=mt("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=mt("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OZ=mt("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FZ=mt("Bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MZ=mt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LZ=mt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BZ=mt("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kU=mt("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VZ=mt("BrainCog",[["path",{d:"M12 5a3 3 0 1 0-5.997.142 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588 4 4 0 0 0 7.636 2.106 3.2 3.2 0 0 0 .164-.546c.028-.13.306-.13.335 0a3.2 3.2 0 0 0 .163.546 4 4 0 0 0 7.636-2.106 4 4 0 0 0 .556-6.588 4 4 0 0 0-2.526-5.77A3 3 0 1 0 12 5",key:"1kgmhc"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m15.7 10.4-.9.4",key:"ayzo6p"}],["path",{d:"m9.2 13.2-.9.4",key:"1uzb3g"}],["path",{d:"m13.6 15.7-.4-.9",key:"11ifqf"}],["path",{d:"m10.8 9.2-.4-.9",key:"1pmk2v"}],["path",{d:"m15.7 13.5-.9-.4",key:"7ng02m"}],["path",{d:"m9.2 10.9-.9-.4",key:"1x66zd"}],["path",{d:"m10.5 15.7.4-.9",key:"3js94g"}],["path",{d:"m13.1 9.2.4-.9",key:"18n7mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=mt("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BT=mt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=mt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=mt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zZ=mt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UZ=mt("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jZ=mt("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WZ=mt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dF=mt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HZ=mt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GZ=mt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qZ=mt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KZ=mt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CU=mt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XZ=mt("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IU=mt("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=mt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SU=mt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EU=mt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XI=mt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TU=mt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YZ=mt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VT=mt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=mt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QZ=mt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JZ=mt("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YI=mt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NU=mt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZZ=mt("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eee=mt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var UT={};Object.defineProperty(UT,"__esModule",{value:!0});UT.parse=aee;UT.serialize=lee;const tee=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,nee=/^[\u0021-\u003A\u003C-\u007E]*$/,ree=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,see=/^[\u0020-\u003A\u003D-\u007E]*$/,iee=Object.prototype.toString,oee=(()=>{const n=function(){};return n.prototype=Object.create(null),n})();function aee(n,e){const t=new oee,r=n.length;if(r<2)return t;const s=(e==null?void 0:e.decode)||uee;let i=0;do{const o=n.indexOf("=",i);if(o===-1)break;const a=n.indexOf(";",i),l=a===-1?r:a;if(o>l){i=n.lastIndexOf(";",o-1)+1;continue}const u=fF(n,i,o),c=pF(n,o,u),h=n.slice(u,c);if(t[h]===void 0){let d=fF(n,o+1,l),f=pF(n,l,d);const p=s(n.slice(d,f));t[h]=p}i=l+1}while(i<r);return t}function fF(n,e,t){do{const r=n.charCodeAt(e);if(r!==32&&r!==9)return e}while(++e<t);return t}function pF(n,e,t){for(;e>t;){const r=n.charCodeAt(--e);if(r!==32&&r!==9)return e+1}return t}function lee(n,e,t){const r=(t==null?void 0:t.encode)||encodeURIComponent;if(!tee.test(n))throw new TypeError(`argument name is invalid: ${n}`);const s=r(e);if(!nee.test(s))throw new TypeError(`argument val is invalid: ${e}`);let i=n+"="+s;if(!t)return i;if(t.maxAge!==void 0){if(!Number.isInteger(t.maxAge))throw new TypeError(`option maxAge is invalid: ${t.maxAge}`);i+="; Max-Age="+t.maxAge}if(t.domain){if(!ree.test(t.domain))throw new TypeError(`option domain is invalid: ${t.domain}`);i+="; Domain="+t.domain}if(t.path){if(!see.test(t.path))throw new TypeError(`option path is invalid: ${t.path}`);i+="; Path="+t.path}if(t.expires){if(!cee(t.expires)||!Number.isFinite(t.expires.valueOf()))throw new TypeError(`option expires is invalid: ${t.expires}`);i+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.partitioned&&(i+="; Partitioned"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${t.priority}`)}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${t.sameSite}`)}return i}function uee(n){if(n.indexOf("%")===-1)return n;try{return decodeURIComponent(n)}catch{return n}}function cee(n){return iee.call(n)==="[object Date]"}/**
 * react-router v7.4.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var mF="popstate";function hee(n={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return QI("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Ag(s)}return fee(e,t,null,n)}function Pn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Ea(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function dee(){return Math.random().toString(36).substring(2,10)}function gF(n,e){return{usr:n.state,key:n.key,idx:e}}function QI(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?hp(e):e,state:t,key:e&&e.key||r||dee()}}function Ag({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function hp(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function fee(n,e,t,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=c();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function c(){return(o.state||{idx:null}).idx}function h(){a="POP";let g=c(),v=g==null?null:g-u;u=g,l&&l({action:a,location:m.location,delta:v})}function d(g,v){a="PUSH";let y=QI(m.location,g,v);u=c()+1;let x=gF(y,u),b=m.createHref(y);try{o.pushState(x,"",b)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;s.location.assign(b)}i&&l&&l({action:a,location:m.location,delta:1})}function f(g,v){a="REPLACE";let y=QI(m.location,g,v);u=c();let x=gF(y,u),b=m.createHref(y);o.replaceState(x,"",b),i&&l&&l({action:a,location:m.location,delta:0})}function p(g){let v=s.location.origin!=="null"?s.location.origin:s.location.href,y=typeof g=="string"?g:Ag(g);return y=y.replace(/ $/,"%20"),Pn(v,`No window.location.(origin|href) available to create URL for href: ${y}`),new URL(y,v)}let m={get action(){return a},get location(){return n(s,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(mF,h),l=g,()=>{s.removeEventListener(mF,h),l=null}},createHref(g){return e(s,g)},createURL:p,encodeLocation(g){let v=p(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:f,go(g){return o.go(g)}};return m}function AU(n,e,t="/"){return pee(n,e,t,!1)}function pee(n,e,t,r){let s=typeof e=="string"?hp(e):e,i=yl(s.pathname||"/",t);if(i==null)return null;let o=RU(n);mee(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=See(i);a=Cee(o[l],u,r)}return a}function RU(n,e=[],t=[],r=""){let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Pn(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let u=hl([r,l.relativePath]),c=t.concat(l);i.children&&i.children.length>0&&(Pn(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),RU(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:_ee(u,i.index),routesMeta:c})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of DU(i.path))s(i,o,l)}),e}function DU(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=DU(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function mee(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:kee(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var gee=/^:[\w-]+$/,vee=3,yee=2,xee=1,bee=10,wee=-2,vF=n=>n==="*";function _ee(n,e){let t=n.split("/"),r=t.length;return t.some(vF)&&(r+=wee),e&&(r+=yee),t.filter(s=>!vF(s)).reduce((s,i)=>s+(gee.test(i)?vee:i===""?xee:bee),r)}function kee(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function Cee(n,e,t=!1){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,c=i==="/"?e:e.slice(i.length)||"/",h=Wb({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h&&u&&t&&!r[r.length-1].route.index&&(h=Wb({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:hl([i,h.pathname]),pathnameBase:Aee(hl([i,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(i=hl([i,h.pathnameBase]))}return o}function Wb(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=Iee(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:c,isOptional:h},d)=>{if(c==="*"){let p=a[d]||"";o=i.slice(0,i.length-p.length).replace(/(.)\/+$/,"$1")}const f=a[d];return h&&!f?u[c]=void 0:u[c]=(f||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function Iee(n,e=!1,t=!0){Ea(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function See(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ea(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function yl(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function Eee(n,e="/"){let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?hp(n):n;return{pathname:t?t.startsWith("/")?t:Tee(t,e):e,search:Ree(r),hash:Dee(s)}}function Tee(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function zC(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Nee(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function $U(n){let e=Nee(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function PU(n,e,t,r=!1){let s;typeof n=="string"?s=hp(n):(s={...n},Pn(!s.pathname||!s.pathname.includes("?"),zC("?","pathname","search",s)),Pn(!s.pathname||!s.pathname.includes("#"),zC("#","pathname","hash",s)),Pn(!s.search||!s.search.includes("#"),zC("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;s.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=Eee(s,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var hl=n=>n.join("/").replace(/\/\/+/g,"/"),Aee=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Ree=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Dee=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function $ee(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var OU=["POST","PUT","PATCH","DELETE"];new Set(OU);var Pee=["GET",...OU];new Set(Pee);var dp=q.createContext(null);dp.displayName="DataRouter";var D1=q.createContext(null);D1.displayName="DataRouterState";var FU=q.createContext({isTransitioning:!1});FU.displayName="ViewTransition";var Oee=q.createContext(new Map);Oee.displayName="Fetchers";var Fee=q.createContext(null);Fee.displayName="Await";var Fa=q.createContext(null);Fa.displayName="Navigation";var kv=q.createContext(null);kv.displayName="Location";var Rl=q.createContext({outlet:null,matches:[],isDataRoute:!1});Rl.displayName="Route";var jT=q.createContext(null);jT.displayName="RouteError";function Mee(n,{relative:e}={}){Pn(Cv(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=q.useContext(Fa),{hash:s,pathname:i,search:o}=Sv(n,{relative:e}),a=i;return t!=="/"&&(a=i==="/"?t:hl([t,i])),r.createHref({pathname:a,search:o,hash:s})}function Cv(){return q.useContext(kv)!=null}function Dl(){return Pn(Cv(),"useLocation() may be used only in the context of a <Router> component."),q.useContext(kv).location}var MU="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function LU(n){q.useContext(Fa).static||q.useLayoutEffect(n)}function Iv(){let{isDataRoute:n}=q.useContext(Rl);return n?Yee():Lee()}function Lee(){Pn(Cv(),"useNavigate() may be used only in the context of a <Router> component.");let n=q.useContext(dp),{basename:e,navigator:t}=q.useContext(Fa),{matches:r}=q.useContext(Rl),{pathname:s}=Dl(),i=JSON.stringify($U(r)),o=q.useRef(!1);return LU(()=>{o.current=!0}),q.useCallback((l,u={})=>{if(Ea(o.current,MU),!o.current)return;if(typeof l=="number"){t.go(l);return}let c=PU(l,JSON.parse(i),s,u.relative==="path");n==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:hl([e,c.pathname])),(u.replace?t.replace:t.push)(c,u.state,u)},[e,t,i,s,n])}q.createContext(null);function Sv(n,{relative:e}={}){let{matches:t}=q.useContext(Rl),{pathname:r}=Dl(),s=JSON.stringify($U(t));return q.useMemo(()=>PU(n,JSON.parse(s),r,e==="path"),[n,s,r,e])}function Bee(n,e){return BU(n,e)}function BU(n,e,t,r){var y;Pn(Cv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s,static:i}=q.useContext(Fa),{matches:o}=q.useContext(Rl),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",c=a?a.pathnameBase:"/",h=a&&a.route;{let x=h&&h.path||"";VU(u,!h||x.endsWith("*")||x.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${x}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${x}"> to <Route path="${x==="/"?"*":`${x}/*`}">.`)}let d=Dl(),f;if(e){let x=typeof e=="string"?hp(e):e;Pn(c==="/"||((y=x.pathname)==null?void 0:y.startsWith(c)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${x.pathname}" was given in the \`location\` prop.`),f=x}else f=d;let p=f.pathname||"/",m=p;if(c!=="/"){let x=c.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(x.length).join("/")}let g=!i&&t&&t.matches&&t.matches.length>0?t.matches:AU(n,{pathname:m});Ea(h||g!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),Ea(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let v=Wee(g&&g.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:hl([c,s.encodeLocation?s.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:hl([c,s.encodeLocation?s.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),o,t,r);return e&&v?q.createElement(kv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},v):v}function Vee(){let n=Xee(),e=$ee(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=q.createElement(q.Fragment,null,q.createElement("p",null,"💿 Hey developer 👋"),q.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",q.createElement("code",{style:i},"ErrorBoundary")," or"," ",q.createElement("code",{style:i},"errorElement")," prop on your route.")),q.createElement(q.Fragment,null,q.createElement("h2",null,"Unexpected Application Error!"),q.createElement("h3",{style:{fontStyle:"italic"}},e),t?q.createElement("pre",{style:s},t):null,o)}var zee=q.createElement(Vee,null),Uee=class extends q.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?q.createElement(Rl.Provider,{value:this.props.routeContext},q.createElement(jT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function jee({routeContext:n,match:e,children:t}){let r=q.useContext(dp);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),q.createElement(Rl.Provider,{value:n},t)}function Wee(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let s=n,i=t==null?void 0:t.errors;if(i!=null){let l=s.findIndex(u=>u.route.id&&(i==null?void 0:i[u.route.id])!==void 0);Pn(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),s=s.slice(0,Math.min(s.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<s.length;l++){let u=s[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:c,errors:h}=t,d=u.route.loader&&!c.hasOwnProperty(u.route.id)&&(!h||h[u.route.id]===void 0);if(u.route.lazy||d){o=!0,a>=0?s=s.slice(0,a+1):s=[s[0]];break}}}return s.reduceRight((l,u,c)=>{let h,d=!1,f=null,p=null;t&&(h=i&&u.route.id?i[u.route.id]:void 0,f=u.route.errorElement||zee,o&&(a<0&&c===0?(VU("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,p=null):a===c&&(d=!0,p=u.route.hydrateFallbackElement||null)));let m=e.concat(s.slice(0,c+1)),g=()=>{let v;return h?v=f:d?v=p:u.route.Component?v=q.createElement(u.route.Component,null):u.route.element?v=u.route.element:v=l,q.createElement(jee,{match:u,routeContext:{outlet:l,matches:m,isDataRoute:t!=null},children:v})};return t&&(u.route.ErrorBoundary||u.route.errorElement||c===0)?q.createElement(Uee,{location:t.location,revalidation:t.revalidation,component:f,error:h,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}function WT(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Hee(n){let e=q.useContext(dp);return Pn(e,WT(n)),e}function Gee(n){let e=q.useContext(D1);return Pn(e,WT(n)),e}function qee(n){let e=q.useContext(Rl);return Pn(e,WT(n)),e}function HT(n){let e=qee(n),t=e.matches[e.matches.length-1];return Pn(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function Kee(){return HT("useRouteId")}function Xee(){var r;let n=q.useContext(jT),e=Gee("useRouteError"),t=HT("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function Yee(){let{router:n}=Hee("useNavigate"),e=HT("useNavigate"),t=q.useRef(!1);return LU(()=>{t.current=!0}),q.useCallback(async(s,i={})=>{Ea(t.current,MU),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...i}))},[n,e])}var yF={};function VU(n,e,t){!e&&!yF[n]&&(yF[n]=!0,Ea(!1,t))}q.memo(Qee);function Qee({routes:n,future:e,state:t}){return BU(n,void 0,t,e)}function us(n){Pn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Jee({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:s,static:i=!1}){Pn(!Cv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=q.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof t=="string"&&(t=hp(t));let{pathname:l="/",search:u="",hash:c="",state:h=null,key:d="default"}=t,f=q.useMemo(()=>{let p=yl(l,o);return p==null?null:{location:{pathname:p,search:u,hash:c,state:h,key:d},navigationType:r}},[o,l,u,c,h,d,r]);return Ea(f!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:q.createElement(Fa.Provider,{value:a},q.createElement(kv.Provider,{children:e,value:f}))}function zU({children:n,location:e}){return Bee(JI(n),e)}function JI(n,e=[]){let t=[];return q.Children.forEach(n,(r,s)=>{if(!q.isValidElement(r))return;let i=[...e,s];if(r.type===q.Fragment){t.push.apply(t,JI(r.props.children,i));return}Pn(r.type===us,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Pn(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=JI(r.props.children,i)),t.push(o)}),t}var Z0="get",eb="application/x-www-form-urlencoded";function $1(n){return n!=null&&typeof n.tagName=="string"}function Zee(n){return $1(n)&&n.tagName.toLowerCase()==="button"}function ete(n){return $1(n)&&n.tagName.toLowerCase()==="form"}function tte(n){return $1(n)&&n.tagName.toLowerCase()==="input"}function nte(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function rte(n,e){return n.button===0&&(!e||e==="_self")&&!nte(n)}var Hx=null;function ste(){if(Hx===null)try{new FormData(document.createElement("form"),0),Hx=!1}catch{Hx=!0}return Hx}var ite=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function UC(n){return n!=null&&!ite.has(n)?(Ea(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${eb}"`),null):n}function ote(n,e){let t,r,s,i,o;if(ete(n)){let a=n.getAttribute("action");r=a?yl(a,e):null,t=n.getAttribute("method")||Z0,s=UC(n.getAttribute("enctype"))||eb,i=new FormData(n)}else if(Zee(n)||tte(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(r=l?yl(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Z0,s=UC(n.getAttribute("formenctype"))||UC(a.getAttribute("enctype"))||eb,i=new FormData(a,n),!ste()){let{name:u,type:c,value:h}=n;if(c==="image"){let d=u?`${u}.`:"";i.append(`${d}x`,"0"),i.append(`${d}y`,"0")}else u&&i.append(u,h)}}else{if($1(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Z0,r=null,s=eb,o=n}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:t.toLowerCase(),encType:s,formData:i,body:o}}function GT(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}async function ate(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function lte(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function ute(n,e,t){let r=await Promise.all(n.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await ate(i,t);return o.links?o.links():[]}return[]}));return fte(r.flat(1).filter(lte).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function xF(n,e,t,r,s,i){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,a=(l,u)=>{var c;return t[u].pathname!==l.pathname||((c=t[u].route.path)==null?void 0:c.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var h;let c=r.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=t[0])==null?void 0:h.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function cte(n,e,{includeHydrateFallback:t}={}){return hte(n.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function hte(n){return[...new Set(n)]}function dte(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function fte(n,e){let t=new Set;return new Set(e),n.reduce((r,s)=>{let i=JSON.stringify(dte(s));return t.has(i)||(t.add(i),r.push({key:i,link:s})),r},[])}function pte(n,e){let t=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return t.pathname==="/"?t.pathname="_root.data":e&&yl(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function UU(){let n=q.useContext(dp);return GT(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function mte(){let n=q.useContext(D1);return GT(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var qT=q.createContext(void 0);qT.displayName="FrameworkContext";function jU(){let n=q.useContext(qT);return GT(n,"You must render this element inside a <HydratedRouter> element"),n}function gte(n,e){let t=q.useContext(qT),[r,s]=q.useState(!1),[i,o]=q.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:h}=e,d=q.useRef(null);q.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let m=v=>{v.forEach(y=>{o(y.isIntersecting)})},g=new IntersectionObserver(m,{threshold:.5});return d.current&&g.observe(d.current),()=>{g.disconnect()}}},[n]),q.useEffect(()=>{if(r){let m=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(m)}}},[r]);let f=()=>{s(!0)},p=()=>{s(!1),o(!1)};return t?n!=="intent"?[i,d,{}]:[i,d,{onFocus:am(a,f),onBlur:am(l,p),onMouseEnter:am(u,f),onMouseLeave:am(c,p),onTouchStart:am(h,f)}]:[!1,d,{}]}function am(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function vte({page:n,...e}){let{router:t}=UU(),r=q.useMemo(()=>AU(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?q.createElement(xte,{page:n,matches:r,...e}):null}function yte(n){let{manifest:e,routeModules:t}=jU(),[r,s]=q.useState([]);return q.useEffect(()=>{let i=!1;return ute(n,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[n,e,t]),r}function xte({page:n,matches:e,...t}){let r=Dl(),{manifest:s,routeModules:i}=jU(),{basename:o}=UU(),{loaderData:a,matches:l}=mte(),u=q.useMemo(()=>xF(n,e,l,s,r,"data"),[n,e,l,s,r]),c=q.useMemo(()=>xF(n,e,l,s,r,"assets"),[n,e,l,s,r]),h=q.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let p=new Set,m=!1;if(e.forEach(v=>{var x;let y=s.routes[v.route.id];!y||!y.hasLoader||(!u.some(b=>b.route.id===v.route.id)&&v.route.id in a&&((x=i[v.route.id])!=null&&x.shouldRevalidate)||y.hasClientLoader?m=!0:p.add(v.route.id))}),p.size===0)return[];let g=pte(n,o);return m&&p.size>0&&g.searchParams.set("_routes",e.filter(v=>p.has(v.route.id)).map(v=>v.route.id).join(",")),[g.pathname+g.search]},[o,a,r,s,u,e,n,i]),d=q.useMemo(()=>cte(c,s),[c,s]),f=yte(c);return q.createElement(q.Fragment,null,h.map(p=>q.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...t})),d.map(p=>q.createElement("link",{key:p,rel:"modulepreload",href:p,...t})),f.map(({key:p,link:m})=>q.createElement("link",{key:p,...m})))}function bte(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var WU=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{WU&&(window.__reactRouterVersion="7.4.1")}catch{}function wte({basename:n,children:e,window:t}){let r=q.useRef();r.current==null&&(r.current=hee({window:t,v5Compat:!0}));let s=r.current,[i,o]=q.useState({action:s.action,location:s.location}),a=q.useCallback(l=>{q.startTransition(()=>o(l))},[o]);return q.useLayoutEffect(()=>s.listen(a),[s,a]),q.createElement(Jee,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:s})}var HU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ui=q.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:h,...d},f){let{basename:p}=q.useContext(Fa),m=typeof u=="string"&&HU.test(u),g,v=!1;if(typeof u=="string"&&m&&(g=u,WU))try{let S=new URL(window.location.href),T=u.startsWith("//")?new URL(S.protocol+u):new URL(u),N=yl(T.pathname,p);T.origin===S.origin&&N!=null?u=N+T.search+T.hash:v=!0}catch{Ea(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let y=Mee(u,{relative:s}),[x,b,_]=gte(r,d),E=Ite(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:s,viewTransition:h});function I(S){e&&e(S),S.defaultPrevented||E(S)}let C=q.createElement("a",{...d,..._,href:g||y,onClick:v||i?e:I,ref:bte(f,b),target:l,"data-discover":!m&&t==="render"?"true":void 0});return x&&!m?q.createElement(q.Fragment,null,C,q.createElement(vte,{page:y})):C});Ui.displayName="Link";var _te=q.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},c){let h=Sv(o,{relative:u.relative}),d=Dl(),f=q.useContext(D1),{navigator:p,basename:m}=q.useContext(Fa),g=f!=null&&Ate(h)&&a===!0,v=p.encodeLocation?p.encodeLocation(h).pathname:h.pathname,y=d.pathname,x=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;t||(y=y.toLowerCase(),x=x?x.toLowerCase():null,v=v.toLowerCase()),x&&m&&(x=yl(x,m)||x);const b=v!=="/"&&v.endsWith("/")?v.length-1:v.length;let _=y===v||!s&&y.startsWith(v)&&y.charAt(b)==="/",E=x!=null&&(x===v||!s&&x.startsWith(v)&&x.charAt(v.length)==="/"),I={isActive:_,isPending:E,isTransitioning:g},C=_?e:void 0,S;typeof r=="function"?S=r(I):S=[r,_?"active":null,E?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let T=typeof i=="function"?i(I):i;return q.createElement(Ui,{...u,"aria-current":C,className:S,ref:c,style:T,to:o,viewTransition:a},typeof l=="function"?l(I):l)});_te.displayName="NavLink";var kte=q.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:s,state:i,method:o=Z0,action:a,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:h,...d},f)=>{let p=Tte(),m=Nte(a,{relative:u}),g=o.toLowerCase()==="get"?"get":"post",v=typeof a=="string"&&HU.test(a),y=x=>{if(l&&l(x),x.defaultPrevented)return;x.preventDefault();let b=x.nativeEvent.submitter,_=(b==null?void 0:b.getAttribute("formmethod"))||o;p(b||x.currentTarget,{fetcherKey:e,method:_,navigate:t,replace:s,state:i,relative:u,preventScrollReset:c,viewTransition:h})};return q.createElement("form",{ref:f,method:g,action:m,onSubmit:r?l:y,...d,"data-discover":!v&&n==="render"?"true":void 0})});kte.displayName="Form";function Cte(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GU(n){let e=q.useContext(dp);return Pn(e,Cte(n)),e}function Ite(n,{target:e,replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let a=Iv(),l=Dl(),u=Sv(n,{relative:i});return q.useCallback(c=>{if(rte(c,e)){c.preventDefault();let h=t!==void 0?t:Ag(l)===Ag(u);a(n,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[l,a,u,t,r,e,n,s,i,o])}var Ste=0,Ete=()=>`__${String(++Ste)}__`;function Tte(){let{router:n}=GU("useSubmit"),{basename:e}=q.useContext(Fa),t=Kee();return q.useCallback(async(r,s={})=>{let{action:i,method:o,encType:a,formData:l,body:u}=ote(r,e);if(s.navigate===!1){let c=s.fetcherKey||Ete();await n.fetch(c,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||a,flushSync:s.flushSync})}else await n.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||a,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function Nte(n,{relative:e}={}){let{basename:t}=q.useContext(Fa),r=q.useContext(Rl);Pn(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Sv(n||".",{relative:e})},o=Dl();if(n==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(c=>c==="")){a.delete("index"),l.filter(h=>h).forEach(h=>a.append("index",h));let c=a.toString();i.search=c?`?${c}`:""}}return(!n||n===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:hl([t,i.pathname])),Ag(i)}function Ate(n,e={}){let t=q.useContext(FU);Pn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=GU("useViewTransitionState"),s=Sv(n,{relative:e.relative});if(!t.isTransitioning)return!1;let i=yl(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=yl(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Wb(s.pathname,o)!=null||Wb(s.pathname,i)!=null}new TextEncoder;/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Ev(n){return n+.5|0}const pu=(n,e,t)=>Math.max(Math.min(n,t),e);function Sm(n){return pu(Ev(n*2.55),0,255)}function Ru(n){return pu(Ev(n*255),0,255)}function Za(n){return pu(Ev(n/2.55)/100,0,1)}function bF(n){return pu(Ev(n*100),0,100)}const Pi={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ZI=[..."0123456789ABCDEF"],Rte=n=>ZI[n&15],Dte=n=>ZI[(n&240)>>4]+ZI[n&15],Gx=n=>(n&240)>>4===(n&15),$te=n=>Gx(n.r)&&Gx(n.g)&&Gx(n.b)&&Gx(n.a);function Pte(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&Pi[n[1]]*17,g:255&Pi[n[2]]*17,b:255&Pi[n[3]]*17,a:e===5?Pi[n[4]]*17:255}:(e===7||e===9)&&(t={r:Pi[n[1]]<<4|Pi[n[2]],g:Pi[n[3]]<<4|Pi[n[4]],b:Pi[n[5]]<<4|Pi[n[6]],a:e===9?Pi[n[7]]<<4|Pi[n[8]]:255})),t}const Ote=(n,e)=>n<255?e(n):"";function Fte(n){var e=$te(n)?Rte:Dte;return n?"#"+e(n.r)+e(n.g)+e(n.b)+Ote(n.a,e):void 0}const Mte=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function qU(n,e,t){const r=e*Math.min(t,1-t),s=(i,o=(i+n/30)%12)=>t-r*Math.max(Math.min(o-3,9-o,1),-1);return[s(0),s(8),s(4)]}function Lte(n,e,t){const r=(s,i=(s+n/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function Bte(n,e,t){const r=qU(n,1,.5);let s;for(e+t>1&&(s=1/(e+t),e*=s,t*=s),s=0;s<3;s++)r[s]*=1-e-t,r[s]+=e;return r}function Vte(n,e,t,r,s){return n===s?(e-t)/r+(e<t?6:0):e===s?(t-n)/r+2:(n-e)/r+4}function KT(n){const t=n.r/255,r=n.g/255,s=n.b/255,i=Math.max(t,r,s),o=Math.min(t,r,s),a=(i+o)/2;let l,u,c;return i!==o&&(c=i-o,u=a>.5?c/(2-i-o):c/(i+o),l=Vte(t,r,s,c,i),l=l*60+.5),[l|0,u||0,a]}function XT(n,e,t,r){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,r)).map(Ru)}function YT(n,e,t){return XT(qU,n,e,t)}function zte(n,e,t){return XT(Bte,n,e,t)}function Ute(n,e,t){return XT(Lte,n,e,t)}function KU(n){return(n%360+360)%360}function jte(n){const e=Mte.exec(n);let t=255,r;if(!e)return;e[5]!==r&&(t=e[6]?Sm(+e[5]):Ru(+e[5]));const s=KU(+e[2]),i=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?r=zte(s,i,o):e[1]==="hsv"?r=Ute(s,i,o):r=YT(s,i,o),{r:r[0],g:r[1],b:r[2],a:t}}function Wte(n,e){var t=KT(n);t[0]=KU(t[0]+e),t=YT(t),n.r=t[0],n.g=t[1],n.b=t[2]}function Hte(n){if(!n)return;const e=KT(n),t=e[0],r=bF(e[1]),s=bF(e[2]);return n.a<255?`hsla(${t}, ${r}%, ${s}%, ${Za(n.a)})`:`hsl(${t}, ${r}%, ${s}%)`}const wF={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},_F={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Gte(){const n={},e=Object.keys(_F),t=Object.keys(wF);let r,s,i,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],s=0;s<t.length;s++)i=t[s],a=a.replace(i,wF[i]);i=parseInt(_F[o],16),n[a]=[i>>16&255,i>>8&255,i&255]}return n}let qx;function qte(n){qx||(qx=Gte(),qx.transparent=[0,0,0,0]);const e=qx[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const Kte=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Xte(n){const e=Kte.exec(n);let t=255,r,s,i;if(e){if(e[7]!==r){const o=+e[7];t=e[8]?Sm(o):pu(o*255,0,255)}return r=+e[1],s=+e[3],i=+e[5],r=255&(e[2]?Sm(r):pu(r,0,255)),s=255&(e[4]?Sm(s):pu(s,0,255)),i=255&(e[6]?Sm(i):pu(i,0,255)),{r,g:s,b:i,a:t}}}function Yte(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Za(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const jC=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,bd=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Qte(n,e,t){const r=bd(Za(n.r)),s=bd(Za(n.g)),i=bd(Za(n.b));return{r:Ru(jC(r+t*(bd(Za(e.r))-r))),g:Ru(jC(s+t*(bd(Za(e.g))-s))),b:Ru(jC(i+t*(bd(Za(e.b))-i))),a:n.a+t*(e.a-n.a)}}function Kx(n,e,t){if(n){let r=KT(n);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,e===0?360:1)),r=YT(r),n.r=r[0],n.g=r[1],n.b=r[2]}}function XU(n,e){return n&&Object.assign(e||{},n)}function kF(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=Ru(n[3]))):(e=XU(n,{r:0,g:0,b:0,a:1}),e.a=Ru(e.a)),e}function Jte(n){return n.charAt(0)==="r"?Xte(n):jte(n)}class Rg{constructor(e){if(e instanceof Rg)return e;const t=typeof e;let r;t==="object"?r=kF(e):t==="string"&&(r=Pte(e)||qte(e)||Jte(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=XU(this._rgb);return e&&(e.a=Za(e.a)),e}set rgb(e){this._rgb=kF(e)}rgbString(){return this._valid?Yte(this._rgb):void 0}hexString(){return this._valid?Fte(this._rgb):void 0}hslString(){return this._valid?Hte(this._rgb):void 0}mix(e,t){if(e){const r=this.rgb,s=e.rgb;let i;const o=t===i?.5:t,a=2*o-1,l=r.a-s.a,u=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;i=1-u,r.r=255&u*r.r+i*s.r+.5,r.g=255&u*r.g+i*s.g+.5,r.b=255&u*r.b+i*s.b+.5,r.a=o*r.a+(1-o)*s.a,this.rgb=r}return this}interpolate(e,t){return e&&(this._rgb=Qte(this._rgb,e._rgb,t)),this}clone(){return new Rg(this.rgb)}alpha(e){return this._rgb.a=Ru(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Ev(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Kx(this._rgb,2,e),this}darken(e){return Kx(this._rgb,2,-e),this}saturate(e){return Kx(this._rgb,1,e),this}desaturate(e){return Kx(this._rgb,1,-e),this}rotate(e){return Wte(this._rgb,e),this}}/*!
 * Chart.js v4.4.8
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Ha(){}const Zte=(()=>{let n=0;return()=>n++})();function cn(n){return n==null}function Rr(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Wt(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function io(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function qo(n,e){return io(n)?n:e}function $t(n,e){return typeof n>"u"?e:n}const ene=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function yn(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function Zt(n,e,t,r){let s,i,o;if(Rr(n))for(i=n.length,s=0;s<i;s++)e.call(t,n[s],s);else if(Wt(n))for(o=Object.keys(n),i=o.length,s=0;s<i;s++)e.call(t,n[o[s]],o[s])}function Hb(n,e){let t,r,s,i;if(!n||!e||n.length!==e.length)return!1;for(t=0,r=n.length;t<r;++t)if(s=n[t],i=e[t],s.datasetIndex!==i.datasetIndex||s.index!==i.index)return!1;return!0}function Gb(n){if(Rr(n))return n.map(Gb);if(Wt(n)){const e=Object.create(null),t=Object.keys(n),r=t.length;let s=0;for(;s<r;++s)e[t[s]]=Gb(n[t[s]]);return e}return n}function YU(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function tne(n,e,t,r){if(!YU(n))return;const s=e[n],i=t[n];Wt(s)&&Wt(i)?Dg(s,i,r):e[n]=Gb(i)}function Dg(n,e,t){const r=Rr(e)?e:[e],s=r.length;if(!Wt(n))return n;t=t||{};const i=t.merger||tne;let o;for(let a=0;a<s;++a){if(o=r[a],!Wt(o))continue;const l=Object.keys(o);for(let u=0,c=l.length;u<c;++u)i(l[u],n,o,t)}return n}function Qm(n,e){return Dg(n,e,{merger:nne})}function nne(n,e,t){if(!YU(n))return;const r=e[n],s=t[n];Wt(r)&&Wt(s)?Qm(r,s):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=Gb(s))}const CF={"":n=>n,x:n=>n.x,y:n=>n.y};function rne(n){const e=n.split("."),t=[];let r="";for(const s of e)r+=s,r.endsWith("\\")?r=r.slice(0,-1)+".":(t.push(r),r="");return t}function sne(n){const e=rne(n);return t=>{for(const r of e){if(r==="")break;t=t&&t[r]}return t}}function qb(n,e){return(CF[e]||(CF[e]=sne(e)))(n)}function QT(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Kb=n=>typeof n<"u",qu=n=>typeof n=="function",IF=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function ine(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Pr=Math.PI,pa=2*Pr,one=pa+Pr,Xb=Number.POSITIVE_INFINITY,ane=Pr/180,Io=Pr/2,Tc=Pr/4,SF=Pr*2/3,QU=Math.log10,Df=Math.sign;function Jm(n,e,t){return Math.abs(n-e)<t}function EF(n){const e=Math.round(n);n=Jm(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(QU(n))),r=n/t;return(r<=1?1:r<=2?2:r<=5?5:10)*t}function lne(n){const e=[],t=Math.sqrt(n);let r;for(r=1;r<t;r++)n%r===0&&(e.push(r),e.push(n/r));return t===(t|0)&&e.push(t),e.sort((s,i)=>s-i).pop(),e}function une(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function $g(n){return!une(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function cne(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function hne(n,e,t){let r,s,i;for(r=0,s=n.length;r<s;r++)i=n[r][t],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Qc(n){return n*(Pr/180)}function dne(n){return n*(180/Pr)}function TF(n){if(!io(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function fne(n,e){const t=e.x-n.x,r=e.y-n.y,s=Math.sqrt(t*t+r*r);let i=Math.atan2(r,t);return i<-.5*Pr&&(i+=pa),{angle:i,distance:s}}function eS(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function pne(n,e){return(n-e+one)%pa-Pr}function nu(n){return(n%pa+pa)%pa}function JU(n,e,t,r){const s=nu(n),i=nu(e),o=nu(t),a=nu(i-s),l=nu(o-s),u=nu(s-i),c=nu(s-o);return s===i||s===o||r&&i===o||a>l&&u<c}function Ki(n,e,t){return Math.max(e,Math.min(t,n))}function mne(n){return Ki(n,-32768,32767)}function Em(n,e,t,r=1e-6){return n>=Math.min(e,t)-r&&n<=Math.max(e,t)+r}function JT(n,e,t){t=t||(o=>n[o]<e);let r=n.length-1,s=0,i;for(;r-s>1;)i=s+r>>1,t(i)?s=i:r=i;return{lo:s,hi:r}}const Jc=(n,e,t,r)=>JT(n,t,r?s=>{const i=n[s][e];return i<t||i===t&&n[s+1][e]===t}:s=>n[s][e]<t),gne=(n,e,t)=>JT(n,t,r=>n[r][e]>=t);function vne(n,e,t){let r=0,s=n.length;for(;r<s&&n[r]<e;)r++;for(;s>r&&n[s-1]>t;)s--;return r>0||s<n.length?n.slice(r,s):n}const ZU=["push","pop","shift","splice","unshift"];function yne(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),ZU.forEach(t=>{const r="_onData"+QT(t),s=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...i){const o=s.apply(this,i);return n._chartjs.listeners.forEach(a=>{typeof a[r]=="function"&&a[r](...i)}),o}})})}function NF(n,e){const t=n._chartjs;if(!t)return;const r=t.listeners,s=r.indexOf(e);s!==-1&&r.splice(s,1),!(r.length>0)&&(ZU.forEach(i=>{delete n[i]}),delete n._chartjs)}function xne(n){const e=new Set(n);return e.size===n.length?n:Array.from(e)}const ej=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function tj(n,e){let t=[],r=!1;return function(...s){t=s,r||(r=!0,ej.call(window,()=>{r=!1,n.apply(e,t)}))}}function bne(n,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(n,e,r)):n.apply(this,r),e}}const ZT=n=>n==="start"?"left":n==="end"?"right":"center",ls=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,wne=(n,e,t,r)=>n===(r?"left":"right")?t:n==="center"?(e+t)/2:e;function _ne(n,e,t){const r=e.length;let s=0,i=r;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,u=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,c=o.axis,{min:h,max:d,minDefined:f,maxDefined:p}=o.getUserBounds();if(f){if(s=Math.min(Jc(l,c,h).lo,t?r:Jc(e,c,o.getPixelForValue(h)).lo),u){const m=l.slice(0,s+1).reverse().findIndex(g=>!cn(g[a.axis]));s-=Math.max(0,m)}s=Ki(s,0,r-1)}if(p){let m=Math.max(Jc(l,o.axis,d,!0).hi+1,t?0:Jc(e,c,o.getPixelForValue(d),!0).hi+1);if(u){const g=l.slice(m-1).findIndex(v=>!cn(v[a.axis]));m+=Math.max(0,g)}i=Ki(m,s,r)-s}else i=r-s}return{start:s,count:i}}function kne(n){const{xScale:e,yScale:t,_scaleRanges:r}=n,s={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!r)return n._scaleRanges=s,!0;const i=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==t.min||r.ymax!==t.max;return Object.assign(r,s),i}const Xx=n=>n===0||n===1,AF=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*pa/t)),RF=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*pa/t)+1,Zm={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Io)+1,easeOutSine:n=>Math.sin(n*Io),easeInOutSine:n=>-.5*(Math.cos(Pr*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Xx(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Xx(n)?n:AF(n,.075,.3),easeOutElastic:n=>Xx(n)?n:RF(n,.075,.3),easeInOutElastic(n){return Xx(n)?n:n<.5?.5*AF(n*2,.1125,.45):.5+.5*RF(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-Zm.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Zm.easeInBounce(n*2)*.5:Zm.easeOutBounce(n*2-1)*.5+.5};function eN(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function DF(n){return eN(n)?n:new Rg(n)}function WC(n){return eN(n)?n:new Rg(n).saturate(.5).darken(.1).hexString()}const Cne=["x","y","borderWidth","radius","tension"],Ine=["color","borderColor","backgroundColor"];function Sne(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),n.set("animations",{colors:{type:"color",properties:Ine},numbers:{type:"number",properties:Cne}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Ene(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const $F=new Map;function Tne(n,e){e=e||{};const t=n+JSON.stringify(e);let r=$F.get(t);return r||(r=new Intl.NumberFormat(n,e),$F.set(t,r)),r}function nj(n,e,t){return Tne(e,t).format(n)}const Nne={values(n){return Rr(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const r=this.chart.options.locale;let s,i=n;if(t.length>1){const u=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(u<1e-4||u>1e15)&&(s="scientific"),i=Ane(n,t)}const o=QU(Math.abs(i)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),nj(n,r,l)}};function Ane(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var rj={formatters:Nne};function Rne(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:rj.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const wh=Object.create(null),tS=Object.create(null);function eg(n,e){if(!e)return n;const t=e.split(".");for(let r=0,s=t.length;r<s;++r){const i=t[r];n=n[i]||(n[i]=Object.create(null))}return n}function HC(n,e,t){return typeof e=="string"?Dg(eg(n,e),t):Dg(eg(n,""),e)}class Dne{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,s)=>WC(s.backgroundColor),this.hoverBorderColor=(r,s)=>WC(s.borderColor),this.hoverColor=(r,s)=>WC(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return HC(this,e,t)}get(e){return eg(this,e)}describe(e,t){return HC(tS,e,t)}override(e,t){return HC(wh,e,t)}route(e,t,r,s){const i=eg(this,e),o=eg(this,r),a="_"+t;Object.defineProperties(i,{[a]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[a],u=o[s];return Wt(l)?Object.assign({},u,l):$t(l,u)},set(l){this[a]=l}}})}apply(e){e.forEach(t=>t(this))}}var er=new Dne({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Sne,Ene,Rne]);function $ne(n){return!n||cn(n.size)||cn(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function PF(n,e,t,r,s){let i=e[s];return i||(i=e[s]=n.measureText(s).width,t.push(s)),i>r&&(r=i),r}function Nc(n,e,t){const r=n.currentDevicePixelRatio,s=t!==0?Math.max(t/2,.5):0;return Math.round((e-s)*r)/r+s}function OF(n,e){!e&&!n||(e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore())}function nS(n,e,t,r){sj(n,e,t,r,null)}function sj(n,e,t,r,s){let i,o,a,l,u,c,h,d;const f=e.pointStyle,p=e.rotation,m=e.radius;let g=(p||0)*ane;if(f&&typeof f=="object"&&(i=f.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){n.save(),n.translate(t,r),n.rotate(g),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(m)||m<=0)){switch(n.beginPath(),f){default:s?n.ellipse(t,r,s/2,m,0,0,pa):n.arc(t,r,m,0,pa),n.closePath();break;case"triangle":c=s?s/2:m,n.moveTo(t+Math.sin(g)*c,r-Math.cos(g)*m),g+=SF,n.lineTo(t+Math.sin(g)*c,r-Math.cos(g)*m),g+=SF,n.lineTo(t+Math.sin(g)*c,r-Math.cos(g)*m),n.closePath();break;case"rectRounded":u=m*.516,l=m-u,o=Math.cos(g+Tc)*l,h=Math.cos(g+Tc)*(s?s/2-u:l),a=Math.sin(g+Tc)*l,d=Math.sin(g+Tc)*(s?s/2-u:l),n.arc(t-h,r-a,u,g-Pr,g-Io),n.arc(t+d,r-o,u,g-Io,g),n.arc(t+h,r+a,u,g,g+Io),n.arc(t-d,r+o,u,g+Io,g+Pr),n.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,c=s?s/2:l,n.rect(t-c,r-l,2*c,2*l);break}g+=Tc;case"rectRot":h=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(s?s/2:m),n.moveTo(t-h,r-a),n.lineTo(t+d,r-o),n.lineTo(t+h,r+a),n.lineTo(t-d,r+o),n.closePath();break;case"crossRot":g+=Tc;case"cross":h=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(s?s/2:m),n.moveTo(t-h,r-a),n.lineTo(t+h,r+a),n.moveTo(t+d,r-o),n.lineTo(t-d,r+o);break;case"star":h=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(s?s/2:m),n.moveTo(t-h,r-a),n.lineTo(t+h,r+a),n.moveTo(t+d,r-o),n.lineTo(t-d,r+o),g+=Tc,h=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(s?s/2:m),n.moveTo(t-h,r-a),n.lineTo(t+h,r+a),n.moveTo(t+d,r-o),n.lineTo(t-d,r+o);break;case"line":o=s?s/2:Math.cos(g)*m,a=Math.sin(g)*m,n.moveTo(t-o,r-a),n.lineTo(t+o,r+a);break;case"dash":n.moveTo(t,r),n.lineTo(t+Math.cos(g)*(s?s/2:m),r+Math.sin(g)*m);break;case!1:n.closePath();break}n.fill(),e.borderWidth>0&&n.stroke()}}function Pg(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function tN(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function nN(n){n.restore()}function Pne(n,e,t,r,s){if(!e)return n.lineTo(t.x,t.y);if(s==="middle"){const i=(e.x+t.x)/2;n.lineTo(i,e.y),n.lineTo(i,t.y)}else s==="after"!=!!r?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function One(n,e,t,r){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?t.cp2x:t.cp1x,r?t.cp2y:t.cp1y,t.x,t.y)}function Fne(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),cn(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function Mne(n,e,t,r,s){if(s.strikethrough||s.underline){const i=n.measureText(r),o=e-i.actualBoundingBoxLeft,a=e+i.actualBoundingBoxRight,l=t-i.actualBoundingBoxAscent,u=t+i.actualBoundingBoxDescent,c=s.strikethrough?(l+u)/2:u;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(o,c),n.lineTo(a,c),n.stroke()}}function Lne(n,e){const t=n.fillStyle;n.fillStyle=e.color,n.fillRect(e.left,e.top,e.width,e.height),n.fillStyle=t}function Og(n,e,t,r,s,i={}){const o=Rr(e)?e:[e],a=i.strokeWidth>0&&i.strokeColor!=="";let l,u;for(n.save(),n.font=s.string,Fne(n,i),l=0;l<o.length;++l)u=o[l],i.backdrop&&Lne(n,i.backdrop),a&&(i.strokeColor&&(n.strokeStyle=i.strokeColor),cn(i.strokeWidth)||(n.lineWidth=i.strokeWidth),n.strokeText(u,t,r,i.maxWidth)),n.fillText(u,t,r,i.maxWidth),Mne(n,t,r,u,i),r+=Number(s.lineHeight);n.restore()}function rS(n,e){const{x:t,y:r,w:s,h:i,radius:o}=e;n.arc(t+o.topLeft,r+o.topLeft,o.topLeft,1.5*Pr,Pr,!0),n.lineTo(t,r+i-o.bottomLeft),n.arc(t+o.bottomLeft,r+i-o.bottomLeft,o.bottomLeft,Pr,Io,!0),n.lineTo(t+s-o.bottomRight,r+i),n.arc(t+s-o.bottomRight,r+i-o.bottomRight,o.bottomRight,Io,0,!0),n.lineTo(t+s,r+o.topRight),n.arc(t+s-o.topRight,r+o.topRight,o.topRight,0,-Io,!0),n.lineTo(t+o.topLeft,r)}const Bne=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Vne=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function zne(n,e){const t=(""+n).match(Bne);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const Une=n=>+n||0;function ij(n,e){const t={},r=Wt(e),s=r?Object.keys(e):e,i=Wt(n)?r?o=>$t(n[o],n[e[o]]):o=>n[o]:()=>n;for(const o of s)t[o]=Une(i(o));return t}function jne(n){return ij(n,{top:"y",right:"x",bottom:"y",left:"x"})}function tg(n){return ij(n,["topLeft","topRight","bottomLeft","bottomRight"])}function oo(n){const e=jne(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function ws(n,e){n=n||{},e=e||er.font;let t=$t(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let r=$t(n.style,e.style);r&&!(""+r).match(Vne)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const s={family:$t(n.family,e.family),lineHeight:zne($t(n.lineHeight,e.lineHeight),t),size:t,style:r,weight:$t(n.weight,e.weight),string:""};return s.string=$ne(s),s}function Yx(n,e,t,r){let s,i,o;for(s=0,i=n.length;s<i;++s)if(o=n[s],o!==void 0&&o!==void 0)return o}function Wne(n,e,t){const{min:r,max:s}=n,i=ene(e,(s-r)/2),o=(a,l)=>t&&a===0?0:a+l;return{min:o(r,-Math.abs(i)),max:o(s,i)}}function Gh(n,e){return Object.assign(Object.create(n),e)}function rN(n,e=[""],t,r,s=()=>n[0]){const i=t||n;typeof r>"u"&&(r=uj("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:i,_fallback:r,_getTarget:s,override:a=>rN([a,...n],e,i,r)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return aj(a,l,()=>Jne(l,e,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return MF(a).includes(l)},ownKeys(a){return MF(a)},set(a,l,u){const c=a._storage||(a._storage=s());return a[l]=c[l]=u,delete a._keys,!0}})}function $f(n,e,t,r){const s={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:oj(n,r),setContext:i=>$f(n,i,t,r),override:i=>$f(n.override(i),e,t,r)};return new Proxy(s,{deleteProperty(i,o){return delete i[o],delete n[o],!0},get(i,o,a){return aj(i,o,()=>Gne(i,o,a))},getOwnPropertyDescriptor(i,o){return i._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(i,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(i,o,a){return n[o]=a,delete i[o],!0}})}function oj(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:s=e.allKeys}=n;return{allKeys:s,scriptable:t,indexable:r,isScriptable:qu(t)?t:()=>t,isIndexable:qu(r)?r:()=>r}}const Hne=(n,e)=>n?n+QT(e):e,sN=(n,e)=>Wt(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function aj(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e)||e==="constructor")return n[e];const r=t();return n[e]=r,r}function Gne(n,e,t){const{_proxy:r,_context:s,_subProxy:i,_descriptors:o}=n;let a=r[e];return qu(a)&&o.isScriptable(e)&&(a=qne(e,a,n,t)),Rr(a)&&a.length&&(a=Kne(e,a,n,o.isIndexable)),sN(e,a)&&(a=$f(a,s,i&&i[e],o)),a}function qne(n,e,t,r){const{_proxy:s,_context:i,_subProxy:o,_stack:a}=t;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=e(i,o||r);return a.delete(n),sN(n,l)&&(l=iN(s._scopes,s,n,l)),l}function Kne(n,e,t,r){const{_proxy:s,_context:i,_subProxy:o,_descriptors:a}=t;if(typeof i.index<"u"&&r(n))return e[i.index%e.length];if(Wt(e[0])){const l=e,u=s._scopes.filter(c=>c!==l);e=[];for(const c of l){const h=iN(u,s,n,c);e.push($f(h,i,o&&o[n],a))}}return e}function lj(n,e,t){return qu(n)?n(e,t):n}const Xne=(n,e)=>n===!0?e:typeof n=="string"?qb(e,n):void 0;function Yne(n,e,t,r,s){for(const i of e){const o=Xne(t,i);if(o){n.add(o);const a=lj(o._fallback,t,s);if(typeof a<"u"&&a!==t&&a!==r)return a}else if(o===!1&&typeof r<"u"&&t!==r)return null}return!1}function iN(n,e,t,r){const s=e._rootScopes,i=lj(e._fallback,t,r),o=[...n,...s],a=new Set;a.add(r);let l=FF(a,o,t,i||t,r);return l===null||typeof i<"u"&&i!==t&&(l=FF(a,o,i,l,r),l===null)?!1:rN(Array.from(a),[""],s,i,()=>Qne(e,t,r))}function FF(n,e,t,r,s){for(;t;)t=Yne(n,e,t,r,s);return t}function Qne(n,e,t){const r=n._getTarget();e in r||(r[e]={});const s=r[e];return Rr(s)&&Wt(t)?t:s||{}}function Jne(n,e,t,r){let s;for(const i of e)if(s=uj(Hne(i,n),t),typeof s<"u")return sN(n,s)?iN(t,r,n,s):s}function uj(n,e){for(const t of e){if(!t)continue;const r=t[n];if(typeof r<"u")return r}}function MF(n){let e=n._keys;return e||(e=n._keys=Zne(n._scopes)),e}function Zne(n){const e=new Set;for(const t of n)for(const r of Object.keys(t).filter(s=>!s.startsWith("_")))e.add(r);return Array.from(e)}const ere=Number.EPSILON||1e-14,Pf=(n,e)=>e<n.length&&!n[e].skip&&n[e],cj=n=>n==="x"?"y":"x";function tre(n,e,t,r){const s=n.skip?e:n,i=e,o=t.skip?e:t,a=eS(i,s),l=eS(o,i);let u=a/(a+l),c=l/(a+l);u=isNaN(u)?0:u,c=isNaN(c)?0:c;const h=r*u,d=r*c;return{previous:{x:i.x-h*(o.x-s.x),y:i.y-h*(o.y-s.y)},next:{x:i.x+d*(o.x-s.x),y:i.y+d*(o.y-s.y)}}}function nre(n,e,t){const r=n.length;let s,i,o,a,l,u=Pf(n,0);for(let c=0;c<r-1;++c)if(l=u,u=Pf(n,c+1),!(!l||!u)){if(Jm(e[c],0,ere)){t[c]=t[c+1]=0;continue}s=t[c]/e[c],i=t[c+1]/e[c],a=Math.pow(s,2)+Math.pow(i,2),!(a<=9)&&(o=3/Math.sqrt(a),t[c]=s*o*e[c],t[c+1]=i*o*e[c])}}function rre(n,e,t="x"){const r=cj(t),s=n.length;let i,o,a,l=Pf(n,0);for(let u=0;u<s;++u){if(o=a,a=l,l=Pf(n,u+1),!a)continue;const c=a[t],h=a[r];o&&(i=(c-o[t])/3,a[`cp1${t}`]=c-i,a[`cp1${r}`]=h-i*e[u]),l&&(i=(l[t]-c)/3,a[`cp2${t}`]=c+i,a[`cp2${r}`]=h+i*e[u])}}function sre(n,e="x"){const t=cj(e),r=n.length,s=Array(r).fill(0),i=Array(r);let o,a,l,u=Pf(n,0);for(o=0;o<r;++o)if(a=l,l=u,u=Pf(n,o+1),!!l){if(u){const c=u[e]-l[e];s[o]=c!==0?(u[t]-l[t])/c:0}i[o]=a?u?Df(s[o-1])!==Df(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}nre(n,s,i),rre(n,i,e)}function Qx(n,e,t){return Math.max(Math.min(n,t),e)}function ire(n,e){let t,r,s,i,o,a=Pg(n[0],e);for(t=0,r=n.length;t<r;++t)o=i,i=a,a=t<r-1&&Pg(n[t+1],e),i&&(s=n[t],o&&(s.cp1x=Qx(s.cp1x,e.left,e.right),s.cp1y=Qx(s.cp1y,e.top,e.bottom)),a&&(s.cp2x=Qx(s.cp2x,e.left,e.right),s.cp2y=Qx(s.cp2y,e.top,e.bottom)))}function ore(n,e,t,r,s){let i,o,a,l;if(e.spanGaps&&(n=n.filter(u=>!u.skip)),e.cubicInterpolationMode==="monotone")sre(n,s);else{let u=r?n[n.length-1]:n[0];for(i=0,o=n.length;i<o;++i)a=n[i],l=tre(u,a,n[Math.min(i+1,o-(r?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,u=a}e.capBezierPoints&&ire(n,t)}function oN(){return typeof window<"u"&&typeof document<"u"}function aN(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Yb(n,e,t){let r;return typeof n=="string"?(r=parseInt(n,10),n.indexOf("%")!==-1&&(r=r/100*e.parentNode[t])):r=n,r}const P1=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function are(n,e){return P1(n).getPropertyValue(e)}const lre=["top","right","bottom","left"];function lh(n,e,t){const r={};t=t?"-"+t:"";for(let s=0;s<4;s++){const i=lre[s];r[i]=parseFloat(n[e+"-"+i+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const ure=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function cre(n,e){const t=n.touches,r=t&&t.length?t[0]:n,{offsetX:s,offsetY:i}=r;let o=!1,a,l;if(ure(s,i,n.target))a=s,l=i;else{const u=e.getBoundingClientRect();a=r.clientX-u.left,l=r.clientY-u.top,o=!0}return{x:a,y:l,box:o}}function Lc(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:r}=e,s=P1(t),i=s.boxSizing==="border-box",o=lh(s,"padding"),a=lh(s,"border","width"),{x:l,y:u,box:c}=cre(n,t),h=o.left+(c&&a.left),d=o.top+(c&&a.top);let{width:f,height:p}=e;return i&&(f-=o.width+a.width,p-=o.height+a.height),{x:Math.round((l-h)/f*t.width/r),y:Math.round((u-d)/p*t.height/r)}}function hre(n,e,t){let r,s;if(e===void 0||t===void 0){const i=n&&aN(n);if(!i)e=n.clientWidth,t=n.clientHeight;else{const o=i.getBoundingClientRect(),a=P1(i),l=lh(a,"border","width"),u=lh(a,"padding");e=o.width-u.width-l.width,t=o.height-u.height-l.height,r=Yb(a.maxWidth,i,"clientWidth"),s=Yb(a.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:r||Xb,maxHeight:s||Xb}}const Jx=n=>Math.round(n*10)/10;function dre(n,e,t,r){const s=P1(n),i=lh(s,"margin"),o=Yb(s.maxWidth,n,"clientWidth")||Xb,a=Yb(s.maxHeight,n,"clientHeight")||Xb,l=hre(n,e,t);let{width:u,height:c}=l;if(s.boxSizing==="content-box"){const d=lh(s,"border","width"),f=lh(s,"padding");u-=f.width+d.width,c-=f.height+d.height}return u=Math.max(0,u-i.width),c=Math.max(0,r?u/r:c-i.height),u=Jx(Math.min(u,o,l.maxWidth)),c=Jx(Math.min(c,a,l.maxHeight)),u&&!c&&(c=Jx(u/2)),(e!==void 0||t!==void 0)&&r&&l.height&&c>l.height&&(c=l.height,u=Jx(Math.floor(c*r))),{width:u,height:c}}function LF(n,e,t){const r=e||1,s=Math.floor(n.height*r),i=Math.floor(n.width*r);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const o=n.canvas;return o.style&&(t||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==r||o.height!==s||o.width!==i?(n.currentDevicePixelRatio=r,o.height=s,o.width=i,n.ctx.setTransform(r,0,0,r,0,0),!0):!1}const fre=function(){let n=!1;try{const e={get passive(){return n=!0,!1}};oN()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return n}();function BF(n,e){const t=are(n,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Bc(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function pre(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:r==="middle"?t<.5?n.y:e.y:r==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function mre(n,e,t,r){const s={x:n.cp2x,y:n.cp2y},i={x:e.cp1x,y:e.cp1y},o=Bc(n,s,t),a=Bc(s,i,t),l=Bc(i,e,t),u=Bc(o,a,t),c=Bc(a,l,t);return Bc(u,c,t)}const gre=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,r){return t-r},leftForLtr(t,r){return t-r}}},vre=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function lf(n,e,t){return n?gre(e,t):vre()}function hj(n,e){let t,r;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=r)}function dj(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function fj(n){return n==="angle"?{between:JU,compare:pne,normalize:nu}:{between:Em,compare:(e,t)=>e-t,normalize:e=>e}}function VF({start:n,end:e,count:t,loop:r,style:s}){return{start:n%t,end:e%t,loop:r&&(e-n+1)%t===0,style:s}}function yre(n,e,t){const{property:r,start:s,end:i}=t,{between:o,normalize:a}=fj(r),l=e.length;let{start:u,end:c,loop:h}=n,d,f;if(h){for(u+=l,c+=l,d=0,f=l;d<f&&o(a(e[u%l][r]),s,i);++d)u--,c--;u%=l,c%=l}return c<u&&(c+=l),{start:u,end:c,loop:h,style:n.style}}function xre(n,e,t){if(!t)return[n];const{property:r,start:s,end:i}=t,o=e.length,{compare:a,between:l,normalize:u}=fj(r),{start:c,end:h,loop:d,style:f}=yre(n,e,t),p=[];let m=!1,g=null,v,y,x;const b=()=>l(s,x,v)&&a(s,x)!==0,_=()=>a(i,v)===0||l(i,x,v),E=()=>m||b(),I=()=>!m||_();for(let C=c,S=c;C<=h;++C)y=e[C%o],!y.skip&&(v=u(y[r]),v!==x&&(m=l(v,s,i),g===null&&E()&&(g=a(v,s)===0?C:S),g!==null&&I()&&(p.push(VF({start:g,end:C,loop:d,count:o,style:f})),g=null),S=C,x=v));return g!==null&&p.push(VF({start:g,end:h,loop:d,count:o,style:f})),p}function bre(n,e){const t=[],r=n.segments;for(let s=0;s<r.length;s++){const i=xre(r[s],n.points,e);i.length&&t.push(...i)}return t}function wre(n,e,t,r){let s=0,i=e-1;if(t&&!r)for(;s<e&&!n[s].skip;)s++;for(;s<e&&n[s].skip;)s++;for(s%=e,t&&(i+=s);i>s&&n[i%e].skip;)i--;return i%=e,{start:s,end:i}}function _re(n,e,t,r){const s=n.length,i=[];let o=e,a=n[e],l;for(l=e+1;l<=t;++l){const u=n[l%s];u.skip||u.stop?a.skip||(r=!1,i.push({start:e%s,end:(l-1)%s,loop:r}),e=o=u.stop?l:null):(o=l,a.skip&&(e=l)),a=u}return o!==null&&i.push({start:e%s,end:o%s,loop:r}),i}function kre(n,e){const t=n.points,r=n.options.spanGaps,s=t.length;if(!s)return[];const i=!!n._loop,{start:o,end:a}=wre(t,s,i,r);if(r===!0)return zF(n,[{start:o,end:a,loop:i}],t,e);const l=a<o?a+s:a,u=!!n._fullLoop&&o===0&&a===s-1;return zF(n,_re(t,o,l,u),t,e)}function zF(n,e,t,r){return!r||!r.setContext||!t?e:Cre(n,e,t,r)}function Cre(n,e,t,r){const s=n._chart.getContext(),i=UF(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=t.length,u=[];let c=i,h=e[0].start,d=h;function f(p,m,g,v){const y=a?-1:1;if(p!==m){for(p+=l;t[p%l].skip;)p-=y;for(;t[m%l].skip;)m+=y;p%l!==m%l&&(u.push({start:p%l,end:m%l,loop:g,style:v}),c=v,h=m%l)}}for(const p of e){h=a?h:p.start;let m=t[h%l],g;for(d=h+1;d<=p.end;d++){const v=t[d%l];g=UF(r.setContext(Gh(s,{type:"segment",p0:m,p1:v,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),Ire(g,c)&&f(h,d-1,p.loop,c),m=v,c=g}h<d-1&&f(h,d-1,p.loop,c)}return u}function UF(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function Ire(n,e){if(!e)return!1;const t=[],r=function(s,i){return eN(i)?(t.includes(i)||t.push(i),t.indexOf(i)):i};return JSON.stringify(n,r)!==JSON.stringify(e,r)}/*!
 * Chart.js v4.4.8
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Sre{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,s){const i=t.listeners[s],o=t.duration;i.forEach(a=>a({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(r-t.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=ej.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,s)=>{if(!r.running||!r.items.length)return;const i=r.items;let o=i.length-1,a=!1,l;for(;o>=0;--o)l=i[o],l._active?(l._total>r.duration&&(r.duration=l._total),l.tick(e),a=!0):(i[o]=i[i.length-1],i.pop());a&&(s.draw(),this._notify(s,r,e,"progress")),i.length||(r.running=!1,this._notify(s,r,e,"complete"),r.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,s)=>Math.max(r,s._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let s=r.length-1;for(;s>=0;--s)r[s].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var qa=new Sre;const jF="transparent",Ere={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const r=DF(n||jF),s=r.valid&&DF(e||jF);return s&&s.valid?s.mix(r,t).hexString():e},number(n,e,t){return n+(e-n)*t}};class Tre{constructor(e,t,r,s){const i=t[r];s=Yx([e.to,s,i,e.from]);const o=Yx([e.from,i,s]);this._active=!0,this._fn=e.fn||Ere[e.type||typeof o],this._easing=Zm[e.easing]||Zm.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const s=this._target[this._prop],i=r-this._start,o=this._duration-i;this._start=r,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=Yx([e.to,t,s,e.from]),this._from=Yx([e.from,s,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,s=this._prop,i=this._from,o=this._loop,a=this._to;let l;if(this._active=i!==a&&(o||t<r),!this._active){this._target[s]=a,this._notify(!0);return}if(t<0){this._target[s]=i;return}l=t/r%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(i,a,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let s=0;s<r.length;s++)r[s][t]()}}class pj{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!Wt(e))return;const t=Object.keys(er.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(s=>{const i=e[s];if(!Wt(i))return;const o={};for(const a of t)o[a]=i[a];(Rr(i.properties)&&i.properties||[s]).forEach(a=>{(a===s||!r.has(a))&&r.set(a,o)})})}_animateOptions(e,t){const r=t.options,s=Are(e,r);if(!s)return[];const i=this._createAnimations(s,r);return r.$shared&&Nre(e.options.$animations,r).then(()=>{e.options=r},()=>{}),i}_createAnimations(e,t){const r=this._properties,s=[],i=e.$animations||(e.$animations={}),o=Object.keys(t),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const u=o[l];if(u.charAt(0)==="$")continue;if(u==="options"){s.push(...this._animateOptions(e,t));continue}const c=t[u];let h=i[u];const d=r.get(u);if(h)if(d&&h.active()){h.update(d,c,a);continue}else h.cancel();if(!d||!d.duration){e[u]=c;continue}i[u]=h=new Tre(d,e,u,c),s.push(h)}return s}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const r=this._createAnimations(e,t);if(r.length)return qa.add(this._chart,r),!0}}function Nre(n,e){const t=[],r=Object.keys(e);for(let s=0;s<r.length;s++){const i=n[r[s]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function Are(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function WF(n,e){const t=n&&n.options||{},r=t.reverse,s=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:r?i:s,end:r?s:i}}function Rre(n,e,t){if(t===!1)return!1;const r=WF(n,t),s=WF(e,t);return{top:s.end,right:r.end,bottom:s.start,left:r.start}}function Dre(n){let e,t,r,s;return Wt(n)?(e=n.top,t=n.right,r=n.bottom,s=n.left):e=t=r=s=n,{top:e,right:t,bottom:r,left:s,disabled:n===!1}}function mj(n,e){const t=[],r=n._getSortedDatasetMetas(e);let s,i;for(s=0,i=r.length;s<i;++s)t.push(r[s].index);return t}function HF(n,e,t,r={}){const s=n.keys,i=r.mode==="single";let o,a,l,u;if(e===null)return;let c=!1;for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===t){if(c=!0,r.all)continue;break}u=n.values[l],io(u)&&(i||e===0||Df(e)===Df(u))&&(e+=u)}return!c&&!r.all?0:e}function $re(n,e){const{iScale:t,vScale:r}=e,s=t.axis==="x"?"x":"y",i=r.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,u,c;for(l=0,u=o.length;l<u;++l)c=o[l],a[l]={[s]:c,[i]:n[c]};return a}function GC(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function Pre(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function Ore(n){const{min:e,max:t,minDefined:r,maxDefined:s}=n.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:s?t:Number.POSITIVE_INFINITY}}function Fre(n,e,t){const r=n[e]||(n[e]={});return r[t]||(r[t]={})}function GF(n,e,t,r){for(const s of e.getMatchingVisibleMetas(r).reverse()){const i=n[s.index];if(t&&i>0||!t&&i<0)return s.index}return null}function qF(n,e){const{chart:t,_cachedMeta:r}=n,s=t._stacks||(t._stacks={}),{iScale:i,vScale:o,index:a}=r,l=i.axis,u=o.axis,c=Pre(i,o,r),h=e.length;let d;for(let f=0;f<h;++f){const p=e[f],{[l]:m,[u]:g}=p,v=p._stacks||(p._stacks={});d=v[u]=Fre(s,c,m),d[a]=g,d._top=GF(d,o,!0,r.type),d._bottom=GF(d,o,!1,r.type);const y=d._visualValues||(d._visualValues={});y[a]=g}}function qC(n,e){const t=n.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function Mre(n,e){return Gh(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Lre(n,e,t){return Gh(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function lm(n,e){const t=n.controller.index,r=n.vScale&&n.vScale.axis;if(r){e=e||n._parsed;for(const s of e){const i=s._stacks;if(!i||i[r]===void 0||i[r][t]===void 0)return;delete i[r][t],i[r]._visualValues!==void 0&&i[r]._visualValues[t]!==void 0&&delete i[r]._visualValues[t]}}}const KC=n=>n==="reset"||n==="none",KF=(n,e)=>e?n:Object.assign({},n),Bre=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:mj(t,!0),values:null};class ng{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=GC(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&lm(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,r=this.getDataset(),s=(h,d,f,p)=>h==="x"?d:h==="r"?p:f,i=t.xAxisID=$t(r.xAxisID,qC(e,"x")),o=t.yAxisID=$t(r.yAxisID,qC(e,"y")),a=t.rAxisID=$t(r.rAxisID,qC(e,"r")),l=t.indexAxis,u=t.iAxisID=s(l,i,o,a),c=t.vAxisID=s(l,o,i,a);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(o),t.rScale=this.getScaleForId(a),t.iScale=this.getScaleForId(u),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&NF(this._data,this),e._stacked&&lm(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),r=this._data;if(Wt(t)){const s=this._cachedMeta;this._data=$re(t,s)}else if(r!==t){if(r){NF(r,this);const s=this._cachedMeta;lm(s),s._parsed=[]}t&&Object.isExtensible(t)&&yne(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,r=this.getDataset();let s=!1;this._dataCheck();const i=t._stacked;t._stacked=GC(t.vScale,t),t.stack!==r.stack&&(s=!0,lm(t),t.stack=r.stack),this._resyncElements(e),(s||i!==t._stacked)&&(qF(this,t._parsed),t._stacked=GC(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:r,_data:s}=this,{iScale:i,_stacked:o}=r,a=i.axis;let l=e===0&&t===s.length?!0:r._sorted,u=e>0&&r._parsed[e-1],c,h,d;if(this._parsing===!1)r._parsed=s,r._sorted=!0,d=s;else{Rr(s[e])?d=this.parseArrayData(r,s,e,t):Wt(s[e])?d=this.parseObjectData(r,s,e,t):d=this.parsePrimitiveData(r,s,e,t);const f=()=>h[a]===null||u&&h[a]<u[a];for(c=0;c<t;++c)r._parsed[c+e]=h=d[c],l&&(f()&&(l=!1),u=h);r._sorted=l}o&&qF(this,d)}parsePrimitiveData(e,t,r,s){const{iScale:i,vScale:o}=e,a=i.axis,l=o.axis,u=i.getLabels(),c=i===o,h=new Array(s);let d,f,p;for(d=0,f=s;d<f;++d)p=d+r,h[d]={[a]:c||i.parse(u[p],p),[l]:o.parse(t[p],p)};return h}parseArrayData(e,t,r,s){const{xScale:i,yScale:o}=e,a=new Array(s);let l,u,c,h;for(l=0,u=s;l<u;++l)c=l+r,h=t[c],a[l]={x:i.parse(h[0],c),y:o.parse(h[1],c)};return a}parseObjectData(e,t,r,s){const{xScale:i,yScale:o}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=new Array(s);let c,h,d,f;for(c=0,h=s;c<h;++c)d=c+r,f=t[d],u[c]={x:i.parse(qb(f,a),d),y:o.parse(qb(f,l),d)};return u}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,r){const s=this.chart,i=this._cachedMeta,o=t[e.axis],a={keys:mj(s,!0),values:t._stacks[e.axis]._visualValues};return HF(a,o,i.index,{mode:r})}updateRangeFromParsed(e,t,r,s){const i=r[t.axis];let o=i===null?NaN:i;const a=s&&r._stacks[t.axis];s&&a&&(s.values=a,o=HF(s,i,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,t){const r=this._cachedMeta,s=r._parsed,i=r._sorted&&e===r.iScale,o=s.length,a=this._getOtherScale(e),l=Bre(t,r,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:h}=Ore(a);let d,f;function p(){f=s[d];const m=f[a.axis];return!io(f[e.axis])||c>m||h<m}for(d=0;d<o&&!(!p()&&(this.updateRangeFromParsed(u,e,f,l),i));++d);if(i){for(d=o-1;d>=0;--d)if(!p()){this.updateRangeFromParsed(u,e,f,l);break}}return u}getAllParsedValues(e){const t=this._cachedMeta._parsed,r=[];let s,i,o;for(s=0,i=t.length;s<i;++s)o=t[s][e.axis],io(o)&&r.push(o);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,r=t.iScale,s=t.vScale,i=this.getParsed(e);return{label:r?""+r.getLabelForValue(i[r.axis]):"",value:s?""+s.getLabelForValue(i[s.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=Dre($t(this.options.clip,Rre(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,r=this._cachedMeta,s=r.data||[],i=t.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||s.length-a,u=this.options.drawActiveElementsOnTop;let c;for(r.dataset&&r.dataset.draw(e,i,a,l),c=a;c<a+l;++c){const h=s[c];h.hidden||(h.active&&u?o.push(h):h.draw(e,i))}for(c=0;c<o.length;++c)o[c].draw(e,i)}getStyle(e,t){const r=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,t,r){const s=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];i=o.$context||(o.$context=Lre(this.getContext(),e,o)),i.parsed=this.getParsed(e),i.raw=s.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=Mre(this.chart.getContext(),this.index)),i.dataset=s,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=r,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",r){const s=t==="active",i=this._cachedDataOpts,o=e+"-"+t,a=i[o],l=this.enableOptionSharing&&Kb(r);if(a)return KF(a,l);const u=this.chart.config,c=u.datasetElementScopeKeys(this._type,e),h=s?[`${e}Hover`,"hover",e,""]:[e,""],d=u.getOptionScopes(this.getDataset(),c),f=Object.keys(er.elements[e]),p=()=>this.getContext(r,s,t),m=u.resolveNamedOptions(d,f,p,h);return m.$shared&&(m.$shared=l,i[o]=Object.freeze(KF(m,l))),m}_resolveAnimations(e,t,r){const s=this.chart,i=this._cachedDataOpts,o=`animation-${t}`,a=i[o];if(a)return a;let l;if(s.options.animation!==!1){const c=this.chart.config,h=c.datasetAnimationScopeKeys(this._type,t),d=c.getOptionScopes(this.getDataset(),h);l=c.createResolver(d,this.getContext(e,r,t))}const u=new pj(s,l&&l.animations);return l&&l._cacheable&&(i[o]=Object.freeze(u)),u}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||KC(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const r=this.resolveDataElementOptions(e,t),s=this._sharedOptions,i=this.getSharedOptions(r),o=this.includeOptions(t,i)||i!==s;return this.updateSharedOptions(i,t,r),{sharedOptions:i,includeOptions:o}}updateElement(e,t,r,s){KC(s)?Object.assign(e,r):this._resolveAnimations(t,s).update(e,r)}updateSharedOptions(e,t,r){e&&!KC(t)&&this._resolveAnimations(void 0,t).update(e,r)}_setStyle(e,t,r,s){e.active=s;const i=this.getStyle(t,s);this._resolveAnimations(t,r,s).update(e,{options:!s&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,t,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,r=this._cachedMeta.data;for(const[a,l,u]of this._syncList)this[a](l,u);this._syncList=[];const s=r.length,i=t.length,o=Math.min(i,s);o&&this.parse(0,o),i>s?this._insertElements(s,i-s,e):i<s&&this._removeElements(i,s-i)}_insertElements(e,t,r=!0){const s=this._cachedMeta,i=s.data,o=e+t;let a;const l=u=>{for(u.length+=t,a=u.length-1;a>=o;a--)u[a]=u[a-t]};for(l(i),a=e;a<o;++a)i[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(e,t),r&&this.updateElements(i,e,t,"reset")}updateElements(e,t,r,s){}_removeElements(e,t){const r=this._cachedMeta;if(this._parsing){const s=r._parsed.splice(e,t);r._stacked&&lm(r,s)}r.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,r,s]=e;this[t](r,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ie(ng,"defaults",{}),Ie(ng,"datasetElementType",null),Ie(ng,"dataElementType",null);class tb extends ng{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:r,data:s=[],_dataset:i}=t,o=this.chart._animationsDisabled;let{start:a,count:l}=_ne(t,s,o);this._drawStart=a,this._drawCount=l,kne(t)&&(a=0,l=s.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!i._decimated,r.points=s;const u=this.resolveDatasetElementOptions(e);this.options.showLine||(u.borderWidth=0),u.segment=this.options.segment,this.updateElement(r,void 0,{animated:!o,options:u},e),this.updateElements(s,a,l,e)}updateElements(e,t,r,s){const i=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:u}=this._cachedMeta,{sharedOptions:c,includeOptions:h}=this._getSharedOptions(t,s),d=o.axis,f=a.axis,{spanGaps:p,segment:m}=this.options,g=$g(p)?p:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||i||s==="none",y=t+r,x=e.length;let b=t>0&&this.getParsed(t-1);for(let _=0;_<x;++_){const E=e[_],I=v?E:{};if(_<t||_>=y){I.skip=!0;continue}const C=this.getParsed(_),S=cn(C[f]),T=I[d]=o.getPixelForValue(C[d],_),N=I[f]=i||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,C,l):C[f],_);I.skip=isNaN(T)||isNaN(N)||S,I.stop=_>0&&Math.abs(C[d]-b[d])>g,m&&(I.parsed=C,I.raw=u.data[_]),h&&(I.options=c||this.resolveDataElementOptions(_,E.active?"active":s)),v||this.updateElement(E,_,I,s),b=C}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,r=t.options&&t.options.borderWidth||0,s=e.data||[];if(!s.length)return r;const i=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(r,i,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}Ie(tb,"id","line"),Ie(tb,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Ie(tb,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function Ac(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class lN{constructor(e){Ie(this,"options");this.options=e||{}}static override(e){Object.assign(lN.prototype,e)}init(){}formats(){return Ac()}parse(){return Ac()}format(){return Ac()}add(){return Ac()}diff(){return Ac()}startOf(){return Ac()}endOf(){return Ac()}}var Vre={_date:lN};function zre(n,e,t,r){const{controller:s,data:i,_sorted:o}=n,a=s._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&e===a.axis&&e!=="r"&&o&&i.length){const u=a._reversePixels?gne:Jc;if(r){if(s._sharedOptions){const c=i[0],h=typeof c.getRange=="function"&&c.getRange(e);if(h){const d=u(i,e,t-h),f=u(i,e,t+h);return{lo:d.lo,hi:f.hi}}}}else{const c=u(i,e,t);if(l){const{vScale:h}=s._cachedMeta,{_parsed:d}=n,f=d.slice(0,c.lo+1).reverse().findIndex(m=>!cn(m[h.axis]));c.lo-=Math.max(0,f);const p=d.slice(c.hi).findIndex(m=>!cn(m[h.axis]));c.hi+=Math.max(0,p)}return c}}return{lo:0,hi:i.length-1}}function O1(n,e,t,r,s){const i=n.getSortedVisibleDatasetMetas(),o=t[e];for(let a=0,l=i.length;a<l;++a){const{index:u,data:c}=i[a],{lo:h,hi:d}=zre(i[a],e,o,s);for(let f=h;f<=d;++f){const p=c[f];p.skip||r(p,u,f)}}}function Ure(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(r,s){const i=e?Math.abs(r.x-s.x):0,o=t?Math.abs(r.y-s.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(o,2))}}function XC(n,e,t,r,s){const i=[];return!s&&!n.isPointInArea(e)||O1(n,t,e,function(a,l,u){!s&&!Pg(a,n.chartArea,0)||a.inRange(e.x,e.y,r)&&i.push({element:a,datasetIndex:l,index:u})},!0),i}function jre(n,e,t,r){let s=[];function i(o,a,l){const{startAngle:u,endAngle:c}=o.getProps(["startAngle","endAngle"],r),{angle:h}=fne(o,{x:e.x,y:e.y});JU(h,u,c)&&s.push({element:o,datasetIndex:a,index:l})}return O1(n,t,e,i),s}function Wre(n,e,t,r,s,i){let o=[];const a=Ure(t);let l=Number.POSITIVE_INFINITY;function u(c,h,d){const f=c.inRange(e.x,e.y,s);if(r&&!f)return;const p=c.getCenterPoint(s);if(!(!!i||n.isPointInArea(p))&&!f)return;const g=a(e,p);g<l?(o=[{element:c,datasetIndex:h,index:d}],l=g):g===l&&o.push({element:c,datasetIndex:h,index:d})}return O1(n,t,e,u),o}function YC(n,e,t,r,s,i){return!i&&!n.isPointInArea(e)?[]:t==="r"&&!r?jre(n,e,t,s):Wre(n,e,t,r,s,i)}function XF(n,e,t,r,s){const i=[],o=t==="x"?"inXRange":"inYRange";let a=!1;return O1(n,t,e,(l,u,c)=>{l[o]&&l[o](e[t],s)&&(i.push({element:l,datasetIndex:u,index:c}),a=a||l.inRange(e.x,e.y,s))}),r&&!a?[]:i}var Hre={modes:{index(n,e,t,r){const s=Lc(e,n),i=t.axis||"x",o=t.includeInvisible||!1,a=t.intersect?XC(n,s,i,r,o):YC(n,s,i,!1,r,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(u=>{const c=a[0].index,h=u.data[c];h&&!h.skip&&l.push({element:h,datasetIndex:u.index,index:c})}),l):[]},dataset(n,e,t,r){const s=Lc(e,n),i=t.axis||"xy",o=t.includeInvisible||!1;let a=t.intersect?XC(n,s,i,r,o):YC(n,s,i,!1,r,o);if(a.length>0){const l=a[0].datasetIndex,u=n.getDatasetMeta(l).data;a=[];for(let c=0;c<u.length;++c)a.push({element:u[c],datasetIndex:l,index:c})}return a},point(n,e,t,r){const s=Lc(e,n),i=t.axis||"xy",o=t.includeInvisible||!1;return XC(n,s,i,r,o)},nearest(n,e,t,r){const s=Lc(e,n),i=t.axis||"xy",o=t.includeInvisible||!1;return YC(n,s,i,t.intersect,r,o)},x(n,e,t,r){const s=Lc(e,n);return XF(n,s,"x",t.intersect,r)},y(n,e,t,r){const s=Lc(e,n);return XF(n,s,"y",t.intersect,r)}}};const gj=["left","top","right","bottom"];function um(n,e){return n.filter(t=>t.pos===e)}function YF(n,e){return n.filter(t=>gj.indexOf(t.pos)===-1&&t.box.axis===e)}function cm(n,e){return n.sort((t,r)=>{const s=e?r:t,i=e?t:r;return s.weight===i.weight?s.index-i.index:s.weight-i.weight})}function Gre(n){const e=[];let t,r,s,i,o,a;for(t=0,r=(n||[]).length;t<r;++t)s=n[t],{position:i,options:{stack:o,stackWeight:a=1}}=s,e.push({index:t,box:s,pos:i,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&i+o,stackWeight:a});return e}function qre(n){const e={};for(const t of n){const{stack:r,pos:s,stackWeight:i}=t;if(!r||!gj.includes(s))continue;const o=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=i}return e}function Kre(n,e){const t=qre(n),{vBoxMaxWidth:r,hBoxMaxHeight:s}=e;let i,o,a;for(i=0,o=n.length;i<o;++i){a=n[i];const{fullSize:l}=a.box,u=t[a.stack],c=u&&a.stackWeight/u.weight;a.horizontal?(a.width=c?c*r:l&&e.availableWidth,a.height=s):(a.width=r,a.height=c?c*s:l&&e.availableHeight)}return t}function Xre(n){const e=Gre(n),t=cm(e.filter(u=>u.box.fullSize),!0),r=cm(um(e,"left"),!0),s=cm(um(e,"right")),i=cm(um(e,"top"),!0),o=cm(um(e,"bottom")),a=YF(e,"x"),l=YF(e,"y");return{fullSize:t,leftAndTop:r.concat(i),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:um(e,"chartArea"),vertical:r.concat(s).concat(l),horizontal:i.concat(o).concat(a)}}function QF(n,e,t,r){return Math.max(n[t],e[t])+Math.max(n[r],e[r])}function vj(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function Yre(n,e,t,r){const{pos:s,box:i}=t,o=n.maxPadding;if(!Wt(s)){t.size&&(n[s]-=t.size);const h=r[t.stack]||{size:0,count:1};h.size=Math.max(h.size,t.horizontal?i.height:i.width),t.size=h.size/h.count,n[s]+=t.size}i.getPadding&&vj(o,i.getPadding());const a=Math.max(0,e.outerWidth-QF(o,n,"left","right")),l=Math.max(0,e.outerHeight-QF(o,n,"top","bottom")),u=a!==n.w,c=l!==n.h;return n.w=a,n.h=l,t.horizontal?{same:u,other:c}:{same:c,other:u}}function Qre(n){const e=n.maxPadding;function t(r){const s=Math.max(e[r]-n[r],0);return n[r]+=s,s}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function Jre(n,e){const t=e.maxPadding;function r(s){const i={left:0,top:0,right:0,bottom:0};return s.forEach(o=>{i[o]=Math.max(e[o],t[o])}),i}return r(n?["left","right"]:["top","bottom"])}function Tm(n,e,t,r){const s=[];let i,o,a,l,u,c;for(i=0,o=n.length,u=0;i<o;++i){a=n[i],l=a.box,l.update(a.width||e.w,a.height||e.h,Jre(a.horizontal,e));const{same:h,other:d}=Yre(e,t,a,r);u|=h&&s.length,c=c||d,l.fullSize||s.push(a)}return u&&Tm(s,e,t,r)||c}function Zx(n,e,t,r,s){n.top=t,n.left=e,n.right=e+r,n.bottom=t+s,n.width=r,n.height=s}function JF(n,e,t,r){const s=t.padding;let{x:i,y:o}=e;for(const a of n){const l=a.box,u=r[a.stack]||{placed:0,weight:1},c=a.stackWeight/u.weight||1;if(a.horizontal){const h=e.w*c,d=u.size||l.height;Kb(u.start)&&(o=u.start),l.fullSize?Zx(l,s.left,o,t.outerWidth-s.right-s.left,d):Zx(l,e.left+u.placed,o,h,d),u.start=o,u.placed+=h,o=l.bottom}else{const h=e.h*c,d=u.size||l.width;Kb(u.start)&&(i=u.start),l.fullSize?Zx(l,i,s.top,d,t.outerHeight-s.bottom-s.top):Zx(l,i,e.top+u.placed,d,h),u.start=i,u.placed+=h,i=l.right}}e.x=i,e.y=o}var Xi={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,r){if(!n)return;const s=oo(n.options.layout.padding),i=Math.max(e-s.width,0),o=Math.max(t-s.height,0),a=Xre(n.boxes),l=a.vertical,u=a.horizontal;Zt(n.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const c=l.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:t,padding:s,availableWidth:i,availableHeight:o,vBoxMaxWidth:i/2/c,hBoxMaxHeight:o/2}),d=Object.assign({},s);vj(d,oo(r));const f=Object.assign({maxPadding:d,w:i,h:o,x:s.left,y:s.top},s),p=Kre(l.concat(u),h);Tm(a.fullSize,f,h,p),Tm(l,f,h,p),Tm(u,f,h,p)&&Tm(l,f,h,p),Qre(f),JF(a.leftAndTop,f,h,p),f.x+=f.w,f.y+=f.h,JF(a.rightAndBottom,f,h,p),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Zt(a.chartArea,m=>{const g=m.box;Object.assign(g,n.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class yj{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,s){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,s?Math.floor(t/s):r)}}isAttached(e){return!0}updateConfig(e){}}class Zre extends yj{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const nb="$chartjs",ese={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ZF=n=>n===null||n==="";function tse(n,e){const t=n.style,r=n.getAttribute("height"),s=n.getAttribute("width");if(n[nb]={initial:{height:r,width:s,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",ZF(s)){const i=BF(n,"width");i!==void 0&&(n.width=i)}if(ZF(r))if(n.style.height==="")n.height=n.width/(e||2);else{const i=BF(n,"height");i!==void 0&&(n.height=i)}return n}const xj=fre?{passive:!0}:!1;function nse(n,e,t){n&&n.addEventListener(e,t,xj)}function rse(n,e,t){n&&n.canvas&&n.canvas.removeEventListener(e,t,xj)}function sse(n,e){const t=ese[n.type]||n.type,{x:r,y:s}=Lc(n,e);return{type:t,chart:e,native:n,x:r!==void 0?r:null,y:s!==void 0?s:null}}function Qb(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function ise(n,e,t){const r=n.canvas,s=new MutationObserver(i=>{let o=!1;for(const a of i)o=o||Qb(a.addedNodes,r),o=o&&!Qb(a.removedNodes,r);o&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}function ose(n,e,t){const r=n.canvas,s=new MutationObserver(i=>{let o=!1;for(const a of i)o=o||Qb(a.removedNodes,r),o=o&&!Qb(a.addedNodes,r);o&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}const Fg=new Map;let eM=0;function bj(){const n=window.devicePixelRatio;n!==eM&&(eM=n,Fg.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function ase(n,e){Fg.size||window.addEventListener("resize",bj),Fg.set(n,e)}function lse(n){Fg.delete(n),Fg.size||window.removeEventListener("resize",bj)}function use(n,e,t){const r=n.canvas,s=r&&aN(r);if(!s)return;const i=tj((a,l)=>{const u=s.clientWidth;t(a,l),u<s.clientWidth&&t()},window),o=new ResizeObserver(a=>{const l=a[0],u=l.contentRect.width,c=l.contentRect.height;u===0&&c===0||i(u,c)});return o.observe(s),ase(n,i),o}function QC(n,e,t){t&&t.disconnect(),e==="resize"&&lse(n)}function cse(n,e,t){const r=n.canvas,s=tj(i=>{n.ctx!==null&&t(sse(i,n))},n);return nse(r,e,s),s}class hse extends yj{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(tse(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[nb])return!1;const r=t[nb].initial;["height","width"].forEach(i=>{const o=r[i];cn(o)?t.removeAttribute(i):t.setAttribute(i,o)});const s=r.style||{};return Object.keys(s).forEach(i=>{t.style[i]=s[i]}),t.width=t.width,delete t[nb],!0}addEventListener(e,t,r){this.removeEventListener(e,t);const s=e.$proxies||(e.$proxies={}),o={attach:ise,detach:ose,resize:use}[t]||cse;s[t]=o(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),s=r[t];if(!s)return;({attach:QC,detach:QC,resize:QC}[t]||rse)(e,t,s),r[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,s){return dre(e,t,r,s)}isAttached(e){const t=e&&aN(e);return!!(t&&t.isConnected)}}function dse(n){return!oN()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Zre:hse}class xl{constructor(){Ie(this,"x");Ie(this,"y");Ie(this,"active",!1);Ie(this,"options");Ie(this,"$animations")}tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return $g(this.x)&&$g(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const s={};return e.forEach(i=>{s[i]=r[i]&&r[i].active()?r[i]._to:this[i]}),s}}Ie(xl,"defaults",{}),Ie(xl,"defaultRoutes");function fse(n,e){const t=n.options.ticks,r=pse(n),s=Math.min(t.maxTicksLimit||r,r),i=t.major.enabled?gse(e):[],o=i.length,a=i[0],l=i[o-1],u=[];if(o>s)return vse(e,u,i,o/s),u;const c=mse(i,e,s);if(o>0){let h,d;const f=o>1?Math.round((l-a)/(o-1)):null;for(e0(e,u,c,cn(f)?0:a-f,a),h=0,d=o-1;h<d;h++)e0(e,u,c,i[h],i[h+1]);return e0(e,u,c,l,cn(f)?e.length:l+f),u}return e0(e,u,c),u}function pse(n){const e=n.options.offset,t=n._tickSize(),r=n._length/t+(e?0:1),s=n._maxLength/t;return Math.floor(Math.min(r,s))}function mse(n,e,t){const r=yse(n),s=e.length/t;if(!r)return Math.max(s,1);const i=lne(r);for(let o=0,a=i.length-1;o<a;o++){const l=i[o];if(l>s)return l}return Math.max(s,1)}function gse(n){const e=[];let t,r;for(t=0,r=n.length;t<r;t++)n[t].major&&e.push(t);return e}function vse(n,e,t,r){let s=0,i=t[0],o;for(r=Math.ceil(r),o=0;o<n.length;o++)o===i&&(e.push(n[o]),s++,i=t[s*r])}function e0(n,e,t,r,s){const i=$t(r,0),o=Math.min($t(s,n.length),n.length);let a=0,l,u,c;for(t=Math.ceil(t),s&&(l=s-r,t=l/Math.floor(l/t)),c=i;c<0;)a++,c=Math.round(i+a*t);for(u=Math.max(i,0);u<o;u++)u===c&&(e.push(n[u]),a++,c=Math.round(i+a*t))}function yse(n){const e=n.length;let t,r;if(e<2)return!1;for(r=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==r)return!1;return r}const xse=n=>n==="left"?"right":n==="right"?"left":n,tM=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t,nM=(n,e)=>Math.min(e||n,n);function rM(n,e){const t=[],r=n.length/e,s=n.length;let i=0;for(;i<s;i+=r)t.push(n[Math.floor(i)]);return t}function bse(n,e,t){const r=n.ticks.length,s=Math.min(e,r-1),i=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(s),u;if(!(t&&(r===1?u=Math.max(l-i,o-l):e===0?u=(n.getPixelForTick(1)-l)/2:u=(l-n.getPixelForTick(s-1))/2,l+=s<e?u:-u,l<i-a||l>o+a)))return l}function wse(n,e){Zt(n,t=>{const r=t.gc,s=r.length/2;let i;if(s>e){for(i=0;i<s;++i)delete t.data[r[i]];r.splice(0,s)}})}function hm(n){return n.drawTicks?n.tickLength:0}function sM(n,e){if(!n.display)return 0;const t=ws(n.font,e),r=oo(n.padding);return(Rr(n.text)?n.text.length:1)*t.lineHeight+r.height}function _se(n,e){return Gh(n,{scale:e,type:"scale"})}function kse(n,e,t){return Gh(n,{tick:t,index:e,type:"tick"})}function Cse(n,e,t){let r=ZT(n);return(t&&e!=="right"||!t&&e==="right")&&(r=xse(r)),r}function Ise(n,e,t,r){const{top:s,left:i,bottom:o,right:a,chart:l}=n,{chartArea:u,scales:c}=l;let h=0,d,f,p;const m=o-s,g=a-i;if(n.isHorizontal()){if(f=ls(r,i,a),Wt(t)){const v=Object.keys(t)[0],y=t[v];p=c[v].getPixelForValue(y)+m-e}else t==="center"?p=(u.bottom+u.top)/2+m-e:p=tM(n,t,e);d=a-i}else{if(Wt(t)){const v=Object.keys(t)[0],y=t[v];f=c[v].getPixelForValue(y)-g+e}else t==="center"?f=(u.left+u.right)/2-g+e:f=tM(n,t,e);p=ls(r,o,s),h=t==="left"?-Io:Io}return{titleX:f,titleY:p,maxWidth:d,rotation:h}}class fp extends xl{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:s}=this;return e=qo(e,Number.POSITIVE_INFINITY),t=qo(t,Number.NEGATIVE_INFINITY),r=qo(r,Number.POSITIVE_INFINITY),s=qo(s,Number.NEGATIVE_INFINITY),{min:qo(e,r),max:qo(t,s),minDefined:io(e),maxDefined:io(t)}}getMinMax(e){let{min:t,max:r,minDefined:s,maxDefined:i}=this.getUserBounds(),o;if(s&&i)return{min:t,max:r};const a=this.getMatchingVisibleMetas();for(let l=0,u=a.length;l<u;++l)o=a[l].controller.getMinMax(this,e),s||(t=Math.min(t,o.min)),i||(r=Math.max(r,o.max));return t=i&&t>r?r:t,r=s&&t>r?t:r,{min:qo(t,qo(r,t)),max:qo(r,qo(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){yn(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:s,grace:i,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Wne(this,i,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?rM(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=fse(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,r;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){yn(this.options.afterUpdate,[this])}beforeSetDimensions(){yn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){yn(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),yn(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){yn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,s,i;for(r=0,s=e.length;r<s;r++)i=e[r],i.label=yn(t.callback,[i.value,r,e],this)}afterTickToLabelConversion(){yn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){yn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=nM(this.ticks.length,e.ticks.maxTicksLimit),s=t.minRotation||0,i=t.maxRotation;let o=s,a,l,u;if(!this._isVisible()||!t.display||s>=i||r<=1||!this.isHorizontal()){this.labelRotation=s;return}const c=this._getLabelSizes(),h=c.widest.width,d=c.highest.height,f=Ki(this.chart.width-h,0,this.maxWidth);a=e.offset?this.maxWidth/r:f/(r-1),h+6>a&&(a=f/(r-(e.offset?.5:1)),l=this.maxHeight-hm(e.grid)-t.padding-sM(e.title,this.chart.options.font),u=Math.sqrt(h*h+d*d),o=dne(Math.min(Math.asin(Ki((c.highest.height+6)/a,-1,1)),Math.asin(Ki(l/u,-1,1))-Math.asin(Ki(d/u,-1,1)))),o=Math.max(s,Math.min(i,o))),this.labelRotation=o}afterCalculateLabelRotation(){yn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){yn(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:s,grid:i}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=sM(s,t.options.font);if(a?(e.width=this.maxWidth,e.height=hm(i)+l):(e.height=this.maxHeight,e.width=hm(i)+l),r.display&&this.ticks.length){const{first:u,last:c,widest:h,highest:d}=this._getLabelSizes(),f=r.padding*2,p=Qc(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(a){const v=r.mirror?0:g*h.width+m*d.height;e.height=Math.min(this.maxHeight,e.height+v+f)}else{const v=r.mirror?0:m*h.width+g*d.height;e.width=Math.min(this.maxWidth,e.width+v+f)}this._calculatePadding(u,c,g,m)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,s){const{ticks:{align:i,padding:o},position:a}=this.options,l=this.labelRotation!==0,u=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const c=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,f=0;l?u?(d=s*e.width,f=r*t.height):(d=r*e.height,f=s*t.width):i==="start"?f=t.width:i==="end"?d=e.width:i!=="inner"&&(d=e.width/2,f=t.width/2),this.paddingLeft=Math.max((d-c+o)*this.width/(this.width-c),0),this.paddingRight=Math.max((f-h+o)*this.width/(this.width-h),0)}else{let c=t.height/2,h=e.height/2;i==="start"?(c=0,h=e.height):i==="end"&&(c=t.height,h=0),this.paddingTop=c+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){yn(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,r;for(t=0,r=e.length;t<r;t++)cn(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=rM(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,r){const{ctx:s,_longestTextCache:i}=this,o=[],a=[],l=Math.floor(t/nM(t,r));let u=0,c=0,h,d,f,p,m,g,v,y,x,b,_;for(h=0;h<t;h+=l){if(p=e[h].label,m=this._resolveTickFontOptions(h),s.font=g=m.string,v=i[g]=i[g]||{data:{},gc:[]},y=m.lineHeight,x=b=0,!cn(p)&&!Rr(p))x=PF(s,v.data,v.gc,x,p),b=y;else if(Rr(p))for(d=0,f=p.length;d<f;++d)_=p[d],!cn(_)&&!Rr(_)&&(x=PF(s,v.data,v.gc,x,_),b+=y);o.push(x),a.push(b),u=Math.max(x,u),c=Math.max(b,c)}wse(i,t);const E=o.indexOf(u),I=a.indexOf(c),C=S=>({width:o[S]||0,height:a[S]||0});return{first:C(0),last:C(t-1),widest:C(E),highest:C(I),widths:o,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return mne(this._alignToPixels?Nc(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=kse(this.getContext(),e,r))}return this.$context||(this.$context=_se(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Qc(this.labelRotation),r=Math.abs(Math.cos(t)),s=Math.abs(Math.sin(t)),i=this._getLabelSizes(),o=e.autoSkipPadding||0,a=i?i.widest.width+o:0,l=i?i.highest.height+o:0;return this.isHorizontal()?l*r>a*s?a/r:l/s:l*s<a*r?l/r:a/s}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,s=this.options,{grid:i,position:o,border:a}=s,l=i.offset,u=this.isHorizontal(),h=this.ticks.length+(l?1:0),d=hm(i),f=[],p=a.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,v=function(O){return Nc(r,O,m)};let y,x,b,_,E,I,C,S,T,N,R,D;if(o==="top")y=v(this.bottom),I=this.bottom-d,S=y-g,N=v(e.top)+g,D=e.bottom;else if(o==="bottom")y=v(this.top),N=e.top,D=v(e.bottom)-g,I=y+g,S=this.top+d;else if(o==="left")y=v(this.right),E=this.right-d,C=y-g,T=v(e.left)+g,R=e.right;else if(o==="right")y=v(this.left),T=e.left,R=v(e.right)-g,E=y+g,C=this.left+d;else if(t==="x"){if(o==="center")y=v((e.top+e.bottom)/2+.5);else if(Wt(o)){const O=Object.keys(o)[0],F=o[O];y=v(this.chart.scales[O].getPixelForValue(F))}N=e.top,D=e.bottom,I=y+g,S=I+d}else if(t==="y"){if(o==="center")y=v((e.left+e.right)/2);else if(Wt(o)){const O=Object.keys(o)[0],F=o[O];y=v(this.chart.scales[O].getPixelForValue(F))}E=y-g,C=E-d,T=e.left,R=e.right}const z=$t(s.ticks.maxTicksLimit,h),L=Math.max(1,Math.ceil(h/z));for(x=0;x<h;x+=L){const O=this.getContext(x),F=i.setContext(O),P=a.setContext(O),U=F.lineWidth,W=F.color,X=P.dash||[],Z=P.dashOffset,ne=F.tickWidth,he=F.tickColor,le=F.tickBorderDash||[],pe=F.tickBorderDashOffset;b=bse(this,x,l),b!==void 0&&(_=Nc(r,b,U),u?E=C=T=R=_:I=S=N=D=_,f.push({tx1:E,ty1:I,tx2:C,ty2:S,x1:T,y1:N,x2:R,y2:D,width:U,color:W,borderDash:X,borderDashOffset:Z,tickWidth:ne,tickColor:he,tickBorderDash:le,tickBorderDashOffset:pe}))}return this._ticksLength=h,this._borderValue=y,f}_computeLabelItems(e){const t=this.axis,r=this.options,{position:s,ticks:i}=r,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:u,padding:c,mirror:h}=i,d=hm(r.grid),f=d+c,p=h?-c:f,m=-Qc(this.labelRotation),g=[];let v,y,x,b,_,E,I,C,S,T,N,R,D="middle";if(s==="top")E=this.bottom-p,I=this._getXAxisLabelAlignment();else if(s==="bottom")E=this.top+p,I=this._getXAxisLabelAlignment();else if(s==="left"){const L=this._getYAxisLabelAlignment(d);I=L.textAlign,_=L.x}else if(s==="right"){const L=this._getYAxisLabelAlignment(d);I=L.textAlign,_=L.x}else if(t==="x"){if(s==="center")E=(e.top+e.bottom)/2+f;else if(Wt(s)){const L=Object.keys(s)[0],O=s[L];E=this.chart.scales[L].getPixelForValue(O)+f}I=this._getXAxisLabelAlignment()}else if(t==="y"){if(s==="center")_=(e.left+e.right)/2-f;else if(Wt(s)){const L=Object.keys(s)[0],O=s[L];_=this.chart.scales[L].getPixelForValue(O)}I=this._getYAxisLabelAlignment(d).textAlign}t==="y"&&(l==="start"?D="top":l==="end"&&(D="bottom"));const z=this._getLabelSizes();for(v=0,y=a.length;v<y;++v){x=a[v],b=x.label;const L=i.setContext(this.getContext(v));C=this.getPixelForTick(v)+i.labelOffset,S=this._resolveTickFontOptions(v),T=S.lineHeight,N=Rr(b)?b.length:1;const O=N/2,F=L.color,P=L.textStrokeColor,U=L.textStrokeWidth;let W=I;o?(_=C,I==="inner"&&(v===y-1?W=this.options.reverse?"left":"right":v===0?W=this.options.reverse?"right":"left":W="center"),s==="top"?u==="near"||m!==0?R=-N*T+T/2:u==="center"?R=-z.highest.height/2-O*T+T:R=-z.highest.height+T/2:u==="near"||m!==0?R=T/2:u==="center"?R=z.highest.height/2-O*T:R=z.highest.height-N*T,h&&(R*=-1),m!==0&&!L.showLabelBackdrop&&(_+=T/2*Math.sin(m))):(E=C,R=(1-N)*T/2);let X;if(L.showLabelBackdrop){const Z=oo(L.backdropPadding),ne=z.heights[v],he=z.widths[v];let le=R-Z.top,pe=0-Z.left;switch(D){case"middle":le-=ne/2;break;case"bottom":le-=ne;break}switch(I){case"center":pe-=he/2;break;case"right":pe-=he;break;case"inner":v===y-1?pe-=he:v>0&&(pe-=he/2);break}X={left:pe,top:le,width:he+Z.width,height:ne+Z.height,color:L.backdropColor}}g.push({label:b,font:S,textOffset:R,options:{rotation:m,color:F,strokeColor:P,strokeWidth:U,textAlign:W,textBaseline:D,translation:[_,E],backdrop:X}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Qc(this.labelRotation))return e==="top"?"left":"right";let s="center";return t.align==="start"?s="left":t.align==="end"?s="right":t.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:s,padding:i}}=this.options,o=this._getLabelSizes(),a=e+i,l=o.widest.width;let u,c;return t==="left"?s?(c=this.right+i,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c+=l)):(c=this.right-a,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c=this.left)):t==="right"?s?(c=this.left+i,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c-=l)):(c=this.left+a,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c=this.right)):u="right",{textAlign:u,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:s,width:i,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,s,i,o),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(i=>i.value===e);return s>=0?t.setContext(this.getContext(s)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,o;const a=(l,u,c)=>{!c.width||!c.color||(r.save(),r.lineWidth=c.width,r.strokeStyle=c.color,r.setLineDash(c.borderDash||[]),r.lineDashOffset=c.borderDashOffset,r.beginPath(),r.moveTo(l.x,l.y),r.lineTo(u.x,u.y),r.stroke(),r.restore())};if(t.display)for(i=0,o=s.length;i<o;++i){const l=s[i];t.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:r,grid:s}}=this,i=r.setContext(this.getContext()),o=r.display?i.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let u,c,h,d;this.isHorizontal()?(u=Nc(e,this.left,o)-o/2,c=Nc(e,this.right,a)+a/2,h=d=l):(h=Nc(e,this.top,o)-o/2,d=Nc(e,this.bottom,a)+a/2,u=c=l),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(u,h),t.lineTo(c,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,s=this._computeLabelArea();s&&tN(r,s);const i=this.getLabelItems(e);for(const o of i){const a=o.options,l=o.font,u=o.label,c=o.textOffset;Og(r,u,0,c,l,a)}s&&nN(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:s}}=this;if(!r.display)return;const i=ws(r.font),o=oo(r.padding),a=r.align;let l=i.lineHeight/2;t==="bottom"||t==="center"||Wt(t)?(l+=o.bottom,Rr(r.text)&&(l+=i.lineHeight*(r.text.length-1))):l+=o.top;const{titleX:u,titleY:c,maxWidth:h,rotation:d}=Ise(this,l,t,a);Og(e,r.text,0,0,i,{color:r.color,maxWidth:h,rotation:d,textAlign:Cse(a,t,s),textBaseline:"middle",translation:[u,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=$t(e.grid&&e.grid.z,-1),s=$t(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==fp.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",s=[];let i,o;for(i=0,o=t.length;i<o;++i){const a=t[i];a[r]===this.id&&(!e||a.type===e)&&s.push(a)}return s}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return ws(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class t0{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;Tse(t)&&(r=this.register(t));const s=this.items,i=e.id,o=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in s||(s[i]=e,Sse(e,o,r),this.override&&er.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,s=this.scope;r in t&&delete t[r],s&&r in er[s]&&(delete er[s][r],this.override&&delete wh[r])}}function Sse(n,e,t){const r=Dg(Object.create(null),[t?er.get(t):{},er.get(e),n.defaults]);er.set(e,r),n.defaultRoutes&&Ese(e,n.defaultRoutes),n.descriptors&&er.describe(e,n.descriptors)}function Ese(n,e){Object.keys(e).forEach(t=>{const r=t.split("."),s=r.pop(),i=[n].concat(r).join("."),o=e[t].split("."),a=o.pop(),l=o.join(".");er.route(i,s,l,a)})}function Tse(n){return"id"in n&&"defaults"in n}class Nse{constructor(){this.controllers=new t0(ng,"datasets",!0),this.elements=new t0(xl,"elements"),this.plugins=new t0(Object,"plugins"),this.scales=new t0(fp,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(s=>{const i=r||this._getRegistryForType(s);r||i.isForType(s)||i===this.plugins&&s.id?this._exec(e,i,s):Zt(s,o=>{const a=r||this._getRegistryForType(o);this._exec(e,a,o)})})}_exec(e,t,r){const s=QT(e);yn(r["before"+s],[],r),t[e](r),yn(r["after"+s],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const s=t.get(e);if(s===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return s}}var Qo=new Nse;class Ase{constructor(){this._init=[]}notify(e,t,r,s){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=s?this._descriptors(e).filter(s):this._descriptors(e),o=this._notify(i,e,t,r);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,t,r,s){s=s||{};for(const i of e){const o=i.plugin,a=o[r],l=[t,s,i.options];if(yn(a,l,o)===!1&&s.cancelable)return!1}return!0}invalidate(){cn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,s=$t(r.options&&r.options.plugins,{}),i=Rse(r);return s===!1&&!t?[]:$se(e,i,s,t)}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,s=(i,o)=>i.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(s(t,r),e,"stop"),this._notify(s(r,t),e,"start")}}function Rse(n){const e={},t=[],r=Object.keys(Qo.plugins.items);for(let i=0;i<r.length;i++)t.push(Qo.getPlugin(r[i]));const s=n.plugins||[];for(let i=0;i<s.length;i++){const o=s[i];t.indexOf(o)===-1&&(t.push(o),e[o.id]=!0)}return{plugins:t,localIds:e}}function Dse(n,e){return!e&&n===!1?null:n===!0?{}:n}function $se(n,{plugins:e,localIds:t},r,s){const i=[],o=n.getContext();for(const a of e){const l=a.id,u=Dse(r[l],s);u!==null&&i.push({plugin:a,options:Pse(n.config,{plugin:a,local:t[l]},u,o)})}return i}function Pse(n,{plugin:e,local:t},r,s){const i=n.pluginScopeKeys(e),o=n.getOptionScopes(r,i);return t&&e.defaults&&o.push(e.defaults),n.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function sS(n,e){const t=er.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function Ose(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function Fse(n,e){return n===e?"_index_":"_value_"}function iM(n){if(n==="x"||n==="y"||n==="r")return n}function Mse(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function iS(n,...e){if(iM(n))return n;for(const t of e){const r=t.axis||Mse(t.position)||n.length>1&&iM(n[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function oM(n,e,t){if(t[e+"AxisID"]===n)return{axis:e}}function Lse(n,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(r=>r.xAxisID===n||r.yAxisID===n);if(t.length)return oM(n,"x",t[0])||oM(n,"y",t[0])}return{}}function Bse(n,e){const t=wh[n.type]||{scales:{}},r=e.scales||{},s=sS(n.type,e),i=Object.create(null);return Object.keys(r).forEach(o=>{const a=r[o];if(!Wt(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=iS(o,a,Lse(o,n),er.scales[a.type]),u=Fse(l,s),c=t.scales||{};i[o]=Qm(Object.create(null),[{axis:l},a,c[l],c[u]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||sS(a,e),c=(wh[a]||{}).scales||{};Object.keys(c).forEach(h=>{const d=Ose(h,l),f=o[d+"AxisID"]||d;i[f]=i[f]||Object.create(null),Qm(i[f],[{axis:d},r[f],c[h]])})}),Object.keys(i).forEach(o=>{const a=i[o];Qm(a,[er.scales[a.type],er.scale])}),i}function wj(n){const e=n.options||(n.options={});e.plugins=$t(e.plugins,{}),e.scales=Bse(n,e)}function _j(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Vse(n){return n=n||{},n.data=_j(n.data),wj(n),n}const aM=new Map,kj=new Set;function n0(n,e){let t=aM.get(n);return t||(t=e(),aM.set(n,t),kj.add(t)),t}const dm=(n,e,t)=>{const r=qb(e,t);r!==void 0&&n.add(r)};class zse{constructor(e){this._config=Vse(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=_j(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),wj(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return n0(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return n0(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return n0(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,r=this.type;return n0(`${r}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let s=r.get(e);return(!s||t)&&(s=new Map,r.set(e,s)),s}getOptionScopes(e,t,r){const{options:s,type:i}=this,o=this._cachedScopes(e,r),a=o.get(t);if(a)return a;const l=new Set;t.forEach(c=>{e&&(l.add(e),c.forEach(h=>dm(l,e,h))),c.forEach(h=>dm(l,s,h)),c.forEach(h=>dm(l,wh[i]||{},h)),c.forEach(h=>dm(l,er,h)),c.forEach(h=>dm(l,tS,h))});const u=Array.from(l);return u.length===0&&u.push(Object.create(null)),kj.has(t)&&o.set(t,u),u}chartOptionScopes(){const{options:e,type:t}=this;return[e,wh[t]||{},er.datasets[t]||{},{type:t},er,tS]}resolveNamedOptions(e,t,r,s=[""]){const i={$shared:!0},{resolver:o,subPrefixes:a}=lM(this._resolverCache,e,s);let l=o;if(jse(o,t)){i.$shared=!1,r=qu(r)?r():r;const u=this.createResolver(e,r,a);l=$f(o,r,u)}for(const u of t)i[u]=l[u];return i}createResolver(e,t,r=[""],s){const{resolver:i}=lM(this._resolverCache,e,r);return Wt(t)?$f(i,t,void 0,s):i}}function lM(n,e,t){let r=n.get(e);r||(r=new Map,n.set(e,r));const s=t.join();let i=r.get(s);return i||(i={resolver:rN(e,t),subPrefixes:t.filter(a=>!a.toLowerCase().includes("hover"))},r.set(s,i)),i}const Use=n=>Wt(n)&&Object.getOwnPropertyNames(n).some(e=>qu(n[e]));function jse(n,e){const{isScriptable:t,isIndexable:r}=oj(n);for(const s of e){const i=t(s),o=r(s),a=(o||i)&&n[s];if(i&&(qu(a)||Use(a))||o&&Rr(a))return!0}return!1}var Wse="4.4.8";const Hse=["top","bottom","left","right","chartArea"];function uM(n,e){return n==="top"||n==="bottom"||Hse.indexOf(n)===-1&&e==="x"}function cM(n,e){return function(t,r){return t[n]===r[n]?t[e]-r[e]:t[n]-r[n]}}function hM(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),yn(t&&t.onComplete,[n],e)}function Gse(n){const e=n.chart,t=e.options.animation;yn(t&&t.onProgress,[n],e)}function Cj(n){return oN()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const rb={},dM=n=>{const e=Cj(n);return Object.values(rb).filter(t=>t.canvas===e).pop()};function qse(n,e,t){const r=Object.keys(n);for(const s of r){const i=+s;if(i>=e){const o=n[s];delete n[s],(t>0||i>e)&&(n[i+t]=o)}}}function Kse(n,e,t,r){return!t||n.type==="mouseout"?null:r?e:n}function r0(n,e,t){return n.options.clip?n[t]:e[t]}function Xse(n,e){const{xScale:t,yScale:r}=n;return t&&r?{left:r0(t,e,"left"),right:r0(t,e,"right"),top:r0(r,e,"top"),bottom:r0(r,e,"bottom")}:e}var tu;let F1=(tu=class{static register(...e){Qo.add(...e),fM()}static unregister(...e){Qo.remove(...e),fM()}constructor(e,t){const r=this.config=new zse(t),s=Cj(e),i=dM(s);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const o=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||dse(s)),this.platform.updateConfig(r);const a=this.platform.acquireContext(s,o.aspectRatio),l=a&&a.canvas,u=l&&l.height,c=l&&l.width;if(this.id=Zte(),this.ctx=a,this.canvas=l,this.width=c,this.height=u,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Ase,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=bne(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],rb[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}qa.listen(this,"complete",hM),qa.listen(this,"progress",Gse),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:s,_aspectRatio:i}=this;return cn(e)?t&&i?i:s?r/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Qo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LF(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return OF(this.canvas,this.ctx),this}stop(){return qa.stop(this),this}resize(e,t){qa.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,s=this.canvas,i=r.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,e,t,i),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,LF(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),yn(r.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};Zt(t,(r,s)=>{r.id=s})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,s=Object.keys(r).reduce((o,a)=>(o[a]=!1,o),{});let i=[];t&&(i=i.concat(Object.keys(t).map(o=>{const a=t[o],l=iS(o,a),u=l==="r",c=l==="x";return{options:a,dposition:u?"chartArea":c?"bottom":"left",dtype:u?"radialLinear":c?"category":"linear"}}))),Zt(i,o=>{const a=o.options,l=a.id,u=iS(l,a),c=$t(a.type,o.dtype);(a.position===void 0||uM(a.position,u)!==uM(o.dposition))&&(a.position=o.dposition),s[l]=!0;let h=null;if(l in r&&r[l].type===c)h=r[l];else{const d=Qo.getScale(c);h=new d({id:l,type:c,ctx:this.ctx,chart:this}),r[h.id]=h}h.init(a,e)}),Zt(s,(o,a)=>{o||delete r[a]}),Zt(r,o=>{Xi.configure(this,o,o.options),Xi.addBox(this,o)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((s,i)=>s.index-i.index),r>t){for(let s=t;s<r;++s)this._destroyDatasetMeta(s);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(cM("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,s)=>{t.filter(i=>i===r._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,s;for(this._removeUnreferencedMetasets(),r=0,s=t.length;r<s;r++){const i=t[r];let o=this.getDatasetMeta(r);const a=i.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(r),o=this.getDatasetMeta(r)),o.type=a,o.indexAxis=i.indexAxis||sS(a,this.options),o.order=i.order||0,o.index=r,o.label=""+i.label,o.visible=this.isDatasetVisible(r),o.controller)o.controller.updateIndex(r),o.controller.linkScales();else{const l=Qo.getController(a),{datasetElementType:u,dataElementType:c}=er.datasets[a];Object.assign(l,{dataElementType:Qo.getElement(c),datasetElementType:u&&Qo.getElement(u)}),o.controller=new l(this,r),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){Zt(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let u=0,c=this.data.datasets.length;u<c;u++){const{controller:h}=this.getDatasetMeta(u),d=!s&&i.indexOf(h)===-1;h.buildOrUpdateElements(d),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=r.layout.autoPadding?o:0,this._updateLayout(o),s||Zt(i,u=>{u.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(cM("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Zt(this.scales,e=>{Xi.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!IF(t,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:r,start:s,count:i}of t){const o=r==="_removeElements"?-i:i;qse(e,s,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,r=i=>new Set(e.filter(o=>o[0]===i).map((o,a)=>a+","+o.splice(1).join(","))),s=r(0);for(let i=1;i<t;i++)if(!IF(s,r(i)))return;return Array.from(s).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Xi.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],Zt(this.boxes,s=>{r&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,i)=>{s._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,r=this.data.datasets.length;t<r;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,qu(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),s={meta:r,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(r.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(qa.has(this)?this.attached&&!qa.running(this)&&qa.start(this):(this.draw(),hM({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let s,i;for(s=0,i=t.length;s<i;++s){const o=t[s];(!e||o.visible)&&r.push(o)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r=e._clip,s=!r.disabled,i=Xse(e,this.chartArea),o={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",o)!==!1&&(s&&tN(t,{left:r.left===!1?0:i.left-r.left,right:r.right===!1?this.width:i.right+r.right,top:r.top===!1?0:i.top-r.top,bottom:r.bottom===!1?this.height:i.bottom+r.bottom}),e.controller.draw(),s&&nN(t),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(e){return Pg(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,r,s){const i=Hre.modes[t];return typeof i=="function"?i(this,e,r,s):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let s=r.filter(i=>i&&i._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(s)),s}getContext(){return this.$context||(this.$context=Gh(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!t.hidden}setDatasetVisibility(e,t){const r=this.getDatasetMeta(e);r.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const s=r?"show":"hide",i=this.getDatasetMeta(e),o=i.controller._resolveAnimations(void 0,s);Kb(t)?(i.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),o.update(i,{visible:r}),this.update(a=>a.datasetIndex===e?s:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),qa.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),OF(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete rb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(i,o)=>{t.addEventListener(this,i,o),e[i]=o},s=(i,o,a)=>{i.offsetX=o,i.offsetY=a,this._eventHandler(i)};Zt(this.options.events,i=>r(i,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(l,u)=>{t.addEventListener(this,l,u),e[l]=u},s=(l,u)=>{e[l]&&(t.removeEventListener(this,l,u),delete e[l])},i=(l,u)=>{this.canvas&&this.resize(l,u)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),r("resize",i),r("detach",o)};o=()=>{this.attached=!1,s("resize",i),this._stop(),this._resize(0,0),r("attach",a)},t.isAttached(this.canvas)?a():o()}unbindEvents(){Zt(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Zt(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const s=r?"set":"remove";let i,o,a,l;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){o=e[a];const u=o&&this.getDatasetMeta(o.datasetIndex).controller;u&&u[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:i,index:o})=>{const a=this.getDatasetMeta(i);if(!a)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:a.data[o],index:o}});!Hb(r,t)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,r){const s=this.options.hover,i=(l,u)=>l.filter(c=>!u.some(h=>c.datasetIndex===h.datasetIndex&&c.index===h.index)),o=i(t,e),a=r?e:i(e,t);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},s=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,s)===!1)return;const i=this._handleEvent(e,t,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,s),(i||r.changed)&&this.render(),this}_handleEvent(e,t,r){const{_active:s=[],options:i}=this,o=t,a=this._getActiveElements(e,s,r,o),l=ine(e),u=Kse(e,this._lastEvent,r,l);r&&(this._lastEvent=null,yn(i.onHover,[e,a,this],this),l&&yn(i.onClick,[e,a,this],this));const c=!Hb(a,s);return(c||t)&&(this._active=a,this._updateHoverStyles(a,s,t)),this._lastEvent=u,c}_getActiveElements(e,t,r,s){if(e.type==="mouseout")return[];if(!r)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,s)}},Ie(tu,"defaults",er),Ie(tu,"instances",rb),Ie(tu,"overrides",wh),Ie(tu,"registry",Qo),Ie(tu,"version",Wse),Ie(tu,"getChart",dM),tu);function fM(){return Zt(F1.instances,n=>n._plugins.invalidate())}function Ij(n,e,t=e){n.lineCap=$t(t.borderCapStyle,e.borderCapStyle),n.setLineDash($t(t.borderDash,e.borderDash)),n.lineDashOffset=$t(t.borderDashOffset,e.borderDashOffset),n.lineJoin=$t(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=$t(t.borderWidth,e.borderWidth),n.strokeStyle=$t(t.borderColor,e.borderColor)}function Yse(n,e,t){n.lineTo(t.x,t.y)}function Qse(n){return n.stepped?Pne:n.tension||n.cubicInterpolationMode==="monotone"?One:Yse}function Sj(n,e,t={}){const r=n.length,{start:s=0,end:i=r-1}=t,{start:o,end:a}=e,l=Math.max(s,o),u=Math.min(i,a),c=s<o&&i<o||s>a&&i>a;return{count:r,start:l,loop:e.loop,ilen:u<l&&!c?r+u-l:u-l}}function Jse(n,e,t,r){const{points:s,options:i}=e,{count:o,start:a,loop:l,ilen:u}=Sj(s,t,r),c=Qse(i);let{move:h=!0,reverse:d}=r||{},f,p,m;for(f=0;f<=u;++f)p=s[(a+(d?u-f:f))%o],!p.skip&&(h?(n.moveTo(p.x,p.y),h=!1):c(n,m,p,d,i.stepped),m=p);return l&&(p=s[(a+(d?u:0))%o],c(n,m,p,d,i.stepped)),!!l}function Zse(n,e,t,r){const s=e.points,{count:i,start:o,ilen:a}=Sj(s,t,r),{move:l=!0,reverse:u}=r||{};let c=0,h=0,d,f,p,m,g,v;const y=b=>(o+(u?a-b:b))%i,x=()=>{m!==g&&(n.lineTo(c,g),n.lineTo(c,m),n.lineTo(c,v))};for(l&&(f=s[y(0)],n.moveTo(f.x,f.y)),d=0;d<=a;++d){if(f=s[y(d)],f.skip)continue;const b=f.x,_=f.y,E=b|0;E===p?(_<m?m=_:_>g&&(g=_),c=(h*c+b)/++h):(x(),n.lineTo(b,_),p=E,h=0,m=g=_),v=_}x()}function oS(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?Zse:Jse}function eie(n){return n.stepped?pre:n.tension||n.cubicInterpolationMode==="monotone"?mre:Bc}function tie(n,e,t,r){let s=e._path;s||(s=e._path=new Path2D,e.path(s,t,r)&&s.closePath()),Ij(n,e.options),n.stroke(s)}function nie(n,e,t,r){const{segments:s,options:i}=e,o=oS(e);for(const a of s)Ij(n,i,a.style),n.beginPath(),o(n,e,a,{start:t,end:t+r-1})&&n.closePath(),n.stroke()}const rie=typeof Path2D=="function";function sie(n,e,t,r){rie&&!e.options.segment?tie(n,e,t,r):nie(n,e,t,r)}class Nm extends xl{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const s=r.spanGaps?this._loop:this._fullLoop;ore(this._points,r,e,s,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=kre(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,r=e.length;return r&&t[e[r-1].end]}interpolate(e,t){const r=this.options,s=e[t],i=this.points,o=bre(this,{property:t,start:s,end:s});if(!o.length)return;const a=[],l=eie(r);let u,c;for(u=0,c=o.length;u<c;++u){const{start:h,end:d}=o[u],f=i[h],p=i[d];if(f===p){a.push(f);continue}const m=Math.abs((s-f[t])/(p[t]-f[t])),g=l(f,p,m,r.stepped);g[t]=e[t],a.push(g)}return a.length===1?a[0]:a}pathSegment(e,t,r){return oS(this)(e,this,t,r)}path(e,t,r){const s=this.segments,i=oS(this);let o=this._loop;t=t||0,r=r||this.points.length-t;for(const a of s)o&=i(e,this,a,{start:t,end:t+r-1});return!!o}draw(e,t,r,s){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),sie(e,this,r,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Ie(Nm,"id","line"),Ie(Nm,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Ie(Nm,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Ie(Nm,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function pM(n,e,t,r){const s=n.options,{[t]:i}=n.getProps([t],r);return Math.abs(e-i)<s.radius+s.hitRadius}class sb extends xl{constructor(t){super();Ie(this,"parsed");Ie(this,"skip");Ie(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,r,s){const i=this.options,{x:o,y:a}=this.getProps(["x","y"],s);return Math.pow(t-o,2)+Math.pow(r-a,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,r){return pM(this,t,"x",r)}inYRange(t,r){return pM(this,t,"y",r)}getCenterPoint(t){const{x:r,y:s}=this.getProps(["x","y"],t);return{x:r,y:s}}size(t){t=t||this.options||{};let r=t.radius||0;r=Math.max(r,r&&t.hoverRadius||0);const s=r&&t.borderWidth||0;return(r+s)*2}draw(t,r){const s=this.options;this.skip||s.radius<.1||!Pg(this,r,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,nS(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}Ie(sb,"id","point"),Ie(sb,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Ie(sb,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const mM=(n,e)=>{let{boxHeight:t=e,boxWidth:r=e}=n;return n.usePointStyle&&(t=Math.min(t,e),r=n.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}},iie=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class gM extends xl{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=yn(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,s)=>e.sort(r,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,s=ws(r.font),i=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=mM(r,i);let u,c;t.font=s.string,this.isHorizontal()?(u=this.maxWidth,c=this._fitRows(o,i,a,l)+10):(c=this.maxHeight,u=this._fitCols(o,s,a,l)+10),this.width=Math.min(u,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,s){const{ctx:i,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.lineWidths=[0],c=s+a;let h=e;i.textAlign="left",i.textBaseline="middle";let d=-1,f=-c;return this.legendItems.forEach((p,m)=>{const g=r+t/2+i.measureText(p.text).width;(m===0||u[u.length-1]+g+2*a>o)&&(h+=c,u[u.length-(m>0?0:1)]=0,f+=c,d++),l[m]={left:0,top:f,row:d,width:g,height:s},u[u.length-1]+=g+a}),h}_fitCols(e,t,r,s){const{ctx:i,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.columnSizes=[],c=o-e;let h=a,d=0,f=0,p=0,m=0;return this.legendItems.forEach((g,v)=>{const{itemWidth:y,itemHeight:x}=oie(r,t,i,g,s);v>0&&f+x+2*a>c&&(h+=d+a,u.push({width:d,height:f}),p+=d+a,m++,d=f=0),l[v]={left:p,top:f,col:m,width:y,height:x},d=Math.max(d,y),f+=x+a}),h+=d,u.push({width:d,height:f}),h}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:s},rtl:i}}=this,o=lf(i,this.left,this.width);if(this.isHorizontal()){let a=0,l=ls(r,this.left+s,this.right-this.lineWidths[a]);for(const u of t)a!==u.row&&(a=u.row,l=ls(r,this.left+s,this.right-this.lineWidths[a])),u.top+=this.top+e+s,u.left=o.leftForLtr(o.x(l),u.width),l+=u.width+s}else{let a=0,l=ls(r,this.top+e+s,this.bottom-this.columnSizes[a].height);for(const u of t)u.col!==a&&(a=u.col,l=ls(r,this.top+e+s,this.bottom-this.columnSizes[a].height)),u.top=l,u.left+=this.left+s,u.left=o.leftForLtr(o.x(u.left),u.width),l+=u.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;tN(e,this),this._draw(),nN(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:s}=this,{align:i,labels:o}=e,a=er.color,l=lf(e.rtl,this.left,this.width),u=ws(o.font),{padding:c}=o,h=u.size,d=h/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=u.string;const{boxWidth:p,boxHeight:m,itemHeight:g}=mM(o,h),v=function(E,I,C){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;s.save();const S=$t(C.lineWidth,1);if(s.fillStyle=$t(C.fillStyle,a),s.lineCap=$t(C.lineCap,"butt"),s.lineDashOffset=$t(C.lineDashOffset,0),s.lineJoin=$t(C.lineJoin,"miter"),s.lineWidth=S,s.strokeStyle=$t(C.strokeStyle,a),s.setLineDash($t(C.lineDash,[])),o.usePointStyle){const T={radius:m*Math.SQRT2/2,pointStyle:C.pointStyle,rotation:C.rotation,borderWidth:S},N=l.xPlus(E,p/2),R=I+d;sj(s,T,N,R,o.pointStyleWidth&&p)}else{const T=I+Math.max((h-m)/2,0),N=l.leftForLtr(E,p),R=tg(C.borderRadius);s.beginPath(),Object.values(R).some(D=>D!==0)?rS(s,{x:N,y:T,w:p,h:m,radius:R}):s.rect(N,T,p,m),s.fill(),S!==0&&s.stroke()}s.restore()},y=function(E,I,C){Og(s,C.text,E,I+g/2,u,{strikethrough:C.hidden,textAlign:l.textAlign(C.textAlign)})},x=this.isHorizontal(),b=this._computeTitleHeight();x?f={x:ls(i,this.left+c,this.right-r[0]),y:this.top+c+b,line:0}:f={x:this.left+c,y:ls(i,this.top+b+c,this.bottom-t[0].height),line:0},hj(this.ctx,e.textDirection);const _=g+c;this.legendItems.forEach((E,I)=>{s.strokeStyle=E.fontColor,s.fillStyle=E.fontColor;const C=s.measureText(E.text).width,S=l.textAlign(E.textAlign||(E.textAlign=o.textAlign)),T=p+d+C;let N=f.x,R=f.y;l.setWidth(this.width),x?I>0&&N+T+c>this.right&&(R=f.y+=_,f.line++,N=f.x=ls(i,this.left+c,this.right-r[f.line])):I>0&&R+_>this.bottom&&(N=f.x=N+t[f.line].width+c,f.line++,R=f.y=ls(i,this.top+b+c,this.bottom-t[f.line].height));const D=l.x(N);if(v(D,R,E),N=wne(S,N+p+d,x?N+T:this.right,e.rtl),y(l.x(N),R,E),x)f.x+=T+c;else if(typeof E.text!="string"){const z=u.lineHeight;f.y+=Ej(E,z)+c}else f.y+=_}),dj(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=ws(t.font),s=oo(t.padding);if(!t.display)return;const i=lf(e.rtl,this.left,this.width),o=this.ctx,a=t.position,l=r.size/2,u=s.top+l;let c,h=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),c=this.top+u,h=ls(e.align,h,this.right-d);else{const p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);c=u+ls(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=ls(a,h,h+d);o.textAlign=i.textAlign(ZT(a)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=r.string,Og(o,t.text,f,c,r)}_computeTitleHeight(){const e=this.options.title,t=ws(e.font),r=oo(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,s,i;if(Em(e,this.left,this.right)&&Em(t,this.top,this.bottom)){for(i=this.legendHitBoxes,r=0;r<i.length;++r)if(s=i[r],Em(e,s.left,s.left+s.width)&&Em(t,s.top,s.top+s.height))return this.legendItems[r]}return null}handleEvent(e){const t=this.options;if(!uie(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const s=this._hoveredItem,i=iie(s,r);s&&!i&&yn(t.onLeave,[e,s,this],this),this._hoveredItem=r,r&&!i&&yn(t.onHover,[e,r,this],this)}else r&&yn(t.onClick,[e,r,this],this)}}function oie(n,e,t,r,s){const i=aie(r,n,e,t),o=lie(s,r,e.lineHeight);return{itemWidth:i,itemHeight:o}}function aie(n,e,t,r){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((i,o)=>i.length>o.length?i:o)),e+t.size/2+r.measureText(s).width}function lie(n,e,t){let r=n;return typeof e.text!="string"&&(r=Ej(e,t)),r}function Ej(n,e){const t=n.text?n.text.length:0;return e*t}function uie(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var cie={id:"legend",_element:gM,start(n,e,t){const r=n.legend=new gM({ctx:n.ctx,options:t,chart:n});Xi.configure(n,r,t),Xi.addBox(n,r)},stop(n){Xi.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const r=n.legend;Xi.configure(n,r,t),r.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const r=e.datasetIndex,s=t.chart;s.isDatasetVisible(r)?(s.hide(r),e.hidden=!0):(s.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:s,color:i,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const u=l.controller.getStyle(t?0:void 0),c=oo(u.borderWidth);return{text:e[l.index].label,fillStyle:u.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:u.borderCapStyle,lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:u.borderColor,pointStyle:r||u.pointStyle,rotation:u.rotation,textAlign:s||u.textAlign,borderRadius:o&&(a||u.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Tj extends xl{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const s=Rr(r.text)?r.text.length:1;this._padding=oo(r.padding);const i=s*ws(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:r,bottom:s,right:i,options:o}=this,a=o.align;let l=0,u,c,h;return this.isHorizontal()?(c=ls(a,r,i),h=t+e,u=i-r):(o.position==="left"?(c=r+e,h=ls(a,s,t),l=Pr*-.5):(c=i-e,h=ls(a,t,s),l=Pr*.5),u=s-t),{titleX:c,titleY:h,maxWidth:u,rotation:l}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const r=ws(t.font),i=r.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:u}=this._drawArgs(i);Og(e,t.text,0,0,r,{color:t.color,maxWidth:l,rotation:u,textAlign:ZT(t.align),textBaseline:"middle",translation:[o,a]})}}function hie(n,e){const t=new Tj({ctx:n.ctx,options:e,chart:n});Xi.configure(n,t,e),Xi.addBox(n,t),n.titleBlock=t}var die={id:"title",_element:Tj,start(n,e,t){hie(n,t)},stop(n){const e=n.titleBlock;Xi.removeBox(n,e),delete n.titleBlock},beforeUpdate(n,e,t){const r=n.titleBlock;Xi.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Am={average(n){if(!n.length)return!1;let e,t,r=new Set,s=0,i=0;for(e=0,t=n.length;e<t;++e){const a=n[e].element;if(a&&a.hasValue()){const l=a.tooltipPosition();r.add(l.x),s+=l.y,++i}}return i===0||r.size===0?!1:{x:[...r].reduce((a,l)=>a+l)/r.size,y:s/i}},nearest(n,e){if(!n.length)return!1;let t=e.x,r=e.y,s=Number.POSITIVE_INFINITY,i,o,a;for(i=0,o=n.length;i<o;++i){const l=n[i].element;if(l&&l.hasValue()){const u=l.getCenterPoint(),c=eS(e,u);c<s&&(s=c,a=l)}}if(a){const l=a.tooltipPosition();t=l.x,r=l.y}return{x:t,y:r}}};function Xo(n,e){return e&&(Rr(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function Ka(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function fie(n,e){const{element:t,datasetIndex:r,index:s}=e,i=n.getDatasetMeta(r).controller,{label:o,value:a}=i.getLabelAndValue(s);return{chart:n,label:o,parsed:i.getParsed(s),raw:n.data.datasets[r].data[s],formattedValue:a,dataset:i.getDataset(),dataIndex:s,datasetIndex:r,element:t}}function vM(n,e){const t=n.chart.ctx,{body:r,footer:s,title:i}=n,{boxWidth:o,boxHeight:a}=e,l=ws(e.bodyFont),u=ws(e.titleFont),c=ws(e.footerFont),h=i.length,d=s.length,f=r.length,p=oo(e.padding);let m=p.height,g=0,v=r.reduce((b,_)=>b+_.before.length+_.lines.length+_.after.length,0);if(v+=n.beforeBody.length+n.afterBody.length,h&&(m+=h*u.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),v){const b=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;m+=f*b+(v-f)*l.lineHeight+(v-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*c.lineHeight+(d-1)*e.footerSpacing);let y=0;const x=function(b){g=Math.max(g,t.measureText(b).width+y)};return t.save(),t.font=u.string,Zt(n.title,x),t.font=l.string,Zt(n.beforeBody.concat(n.afterBody),x),y=e.displayColors?o+2+e.boxPadding:0,Zt(r,b=>{Zt(b.before,x),Zt(b.lines,x),Zt(b.after,x)}),y=0,t.font=c.string,Zt(n.footer,x),t.restore(),g+=p.width,{width:g,height:m}}function pie(n,e){const{y:t,height:r}=e;return t<r/2?"top":t>n.height-r/2?"bottom":"center"}function mie(n,e,t,r){const{x:s,width:i}=r,o=t.caretSize+t.caretPadding;if(n==="left"&&s+i+o>e.width||n==="right"&&s-i-o<0)return!0}function gie(n,e,t,r){const{x:s,width:i}=t,{width:o,chartArea:{left:a,right:l}}=n;let u="center";return r==="center"?u=s<=(a+l)/2?"left":"right":s<=i/2?u="left":s>=o-i/2&&(u="right"),mie(u,n,e,t)&&(u="center"),u}function yM(n,e,t){const r=t.yAlign||e.yAlign||pie(n,t);return{xAlign:t.xAlign||e.xAlign||gie(n,e,t,r),yAlign:r}}function vie(n,e){let{x:t,width:r}=n;return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function yie(n,e,t){let{y:r,height:s}=n;return e==="top"?r+=t:e==="bottom"?r-=s+t:r-=s/2,r}function xM(n,e,t,r){const{caretSize:s,caretPadding:i,cornerRadius:o}=n,{xAlign:a,yAlign:l}=t,u=s+i,{topLeft:c,topRight:h,bottomLeft:d,bottomRight:f}=tg(o);let p=vie(e,a);const m=yie(e,l,u);return l==="center"?a==="left"?p+=u:a==="right"&&(p-=u):a==="left"?p-=Math.max(c,d)+s:a==="right"&&(p+=Math.max(h,f)+s),{x:Ki(p,0,r.width-e.width),y:Ki(m,0,r.height-e.height)}}function s0(n,e,t){const r=oo(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-r.right:n.x+r.left}function bM(n){return Xo([],Ka(n))}function xie(n,e,t){return Gh(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function wM(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}const Nj={beforeTitle:Ha,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:Ha,beforeBody:Ha,beforeLabel:Ha,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return cn(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Ha,afterBody:Ha,beforeFooter:Ha,footer:Ha,afterFooter:Ha};function Us(n,e,t,r){const s=n[e].call(t,r);return typeof s>"u"?Nj[e].call(t,r):s}class aS extends xl{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,r=this.options.setContext(this.getContext()),s=r.enabled&&t.options.animation&&r.animations,i=new pj(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=xie(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:r}=t,s=Us(r,"beforeTitle",this,e),i=Us(r,"title",this,e),o=Us(r,"afterTitle",this,e);let a=[];return a=Xo(a,Ka(s)),a=Xo(a,Ka(i)),a=Xo(a,Ka(o)),a}getBeforeBody(e,t){return bM(Us(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:r}=t,s=[];return Zt(e,i=>{const o={before:[],lines:[],after:[]},a=wM(r,i);Xo(o.before,Ka(Us(a,"beforeLabel",this,i))),Xo(o.lines,Us(a,"label",this,i)),Xo(o.after,Ka(Us(a,"afterLabel",this,i))),s.push(o)}),s}getAfterBody(e,t){return bM(Us(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:r}=t,s=Us(r,"beforeFooter",this,e),i=Us(r,"footer",this,e),o=Us(r,"afterFooter",this,e);let a=[];return a=Xo(a,Ka(s)),a=Xo(a,Ka(i)),a=Xo(a,Ka(o)),a}_createItems(e){const t=this._active,r=this.chart.data,s=[],i=[],o=[];let a=[],l,u;for(l=0,u=t.length;l<u;++l)a.push(fie(this.chart,t[l]));return e.filter&&(a=a.filter((c,h,d)=>e.filter(c,h,d,r))),e.itemSort&&(a=a.sort((c,h)=>e.itemSort(c,h,r))),Zt(a,c=>{const h=wM(e.callbacks,c);s.push(Us(h,"labelColor",this,c)),i.push(Us(h,"labelPointStyle",this,c)),o.push(Us(h,"labelTextColor",this,c))}),this.labelColors=s,this.labelPointStyles=i,this.labelTextColors=o,this.dataPoints=a,a}update(e,t){const r=this.options.setContext(this.getContext()),s=this._active;let i,o=[];if(!s.length)this.opacity!==0&&(i={opacity:0});else{const a=Am[r.position].call(this,s,this._eventPosition);o=this._createItems(r),this.title=this.getTitle(o,r),this.beforeBody=this.getBeforeBody(o,r),this.body=this.getBody(o,r),this.afterBody=this.getAfterBody(o,r),this.footer=this.getFooter(o,r);const l=this._size=vM(this,r),u=Object.assign({},a,l),c=yM(this.chart,r,u),h=xM(r,u,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,i={opacity:1,x:h.x,y:h.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,r,s){const i=this.getCaretPosition(e,r,s);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,r){const{xAlign:s,yAlign:i}=this,{caretSize:o,cornerRadius:a}=r,{topLeft:l,topRight:u,bottomLeft:c,bottomRight:h}=tg(a),{x:d,y:f}=e,{width:p,height:m}=t;let g,v,y,x,b,_;return i==="center"?(b=f+m/2,s==="left"?(g=d,v=g-o,x=b+o,_=b-o):(g=d+p,v=g+o,x=b-o,_=b+o),y=g):(s==="left"?v=d+Math.max(l,c)+o:s==="right"?v=d+p-Math.max(u,h)-o:v=this.caretX,i==="top"?(x=f,b=x-o,g=v-o,y=v+o):(x=f+m,b=x+o,g=v+o,y=v-o),_=x),{x1:g,x2:v,x3:y,y1:x,y2:b,y3:_}}drawTitle(e,t,r){const s=this.title,i=s.length;let o,a,l;if(i){const u=lf(r.rtl,this.x,this.width);for(e.x=s0(this,r.titleAlign,r),t.textAlign=u.textAlign(r.titleAlign),t.textBaseline="middle",o=ws(r.titleFont),a=r.titleSpacing,t.fillStyle=r.titleColor,t.font=o.string,l=0;l<i;++l)t.fillText(s[l],u.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+a,l+1===i&&(e.y+=r.titleMarginBottom-a)}}_drawColorBox(e,t,r,s,i){const o=this.labelColors[r],a=this.labelPointStyles[r],{boxHeight:l,boxWidth:u}=i,c=ws(i.bodyFont),h=s0(this,"left",i),d=s.x(h),f=l<c.lineHeight?(c.lineHeight-l)/2:0,p=t.y+f;if(i.usePointStyle){const m={radius:Math.min(u,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},g=s.leftForLtr(d,u)+u/2,v=p+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,nS(e,m,g,v),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,nS(e,m,g,v)}else{e.lineWidth=Wt(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const m=s.leftForLtr(d,u),g=s.leftForLtr(s.xPlus(d,1),u-2),v=tg(o.borderRadius);Object.values(v).some(y=>y!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,rS(e,{x:m,y:p,w:u,h:l,radius:v}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),rS(e,{x:g,y:p+1,w:u-2,h:l-2,radius:v}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(m,p,u,l),e.strokeRect(m,p,u,l),e.fillStyle=o.backgroundColor,e.fillRect(g,p+1,u-2,l-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,t,r){const{body:s}=this,{bodySpacing:i,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:u,boxPadding:c}=r,h=ws(r.bodyFont);let d=h.lineHeight,f=0;const p=lf(r.rtl,this.x,this.width),m=function(C){t.fillText(C,p.x(e.x+f),e.y+d/2),e.y+=d+i},g=p.textAlign(o);let v,y,x,b,_,E,I;for(t.textAlign=o,t.textBaseline="middle",t.font=h.string,e.x=s0(this,g,r),t.fillStyle=r.bodyColor,Zt(this.beforeBody,m),f=a&&g!=="right"?o==="center"?u/2+c:u+2+c:0,b=0,E=s.length;b<E;++b){for(v=s[b],y=this.labelTextColors[b],t.fillStyle=y,Zt(v.before,m),x=v.lines,a&&x.length&&(this._drawColorBox(t,e,b,p,r),d=Math.max(h.lineHeight,l)),_=0,I=x.length;_<I;++_)m(x[_]),d=h.lineHeight;Zt(v.after,m)}f=0,d=h.lineHeight,Zt(this.afterBody,m),e.y-=i}drawFooter(e,t,r){const s=this.footer,i=s.length;let o,a;if(i){const l=lf(r.rtl,this.x,this.width);for(e.x=s0(this,r.footerAlign,r),e.y+=r.footerMarginTop,t.textAlign=l.textAlign(r.footerAlign),t.textBaseline="middle",o=ws(r.footerFont),t.fillStyle=r.footerColor,t.font=o.string,a=0;a<i;++a)t.fillText(s[a],l.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+r.footerSpacing}}drawBackground(e,t,r,s){const{xAlign:i,yAlign:o}=this,{x:a,y:l}=e,{width:u,height:c}=r,{topLeft:h,topRight:d,bottomLeft:f,bottomRight:p}=tg(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(a+h,l),o==="top"&&this.drawCaret(e,t,r,s),t.lineTo(a+u-d,l),t.quadraticCurveTo(a+u,l,a+u,l+d),o==="center"&&i==="right"&&this.drawCaret(e,t,r,s),t.lineTo(a+u,l+c-p),t.quadraticCurveTo(a+u,l+c,a+u-p,l+c),o==="bottom"&&this.drawCaret(e,t,r,s),t.lineTo(a+f,l+c),t.quadraticCurveTo(a,l+c,a,l+c-f),o==="center"&&i==="left"&&this.drawCaret(e,t,r,s),t.lineTo(a,l+h),t.quadraticCurveTo(a,l,a+h,l),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,r=this.$animations,s=r&&r.x,i=r&&r.y;if(s||i){const o=Am[e.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=vM(this,e),l=Object.assign({},o,this._size),u=yM(t,e,l),c=xM(e,l,u,t);(s._to!==c.x||i._to!==c.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},i={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const o=oo(t.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&a&&(e.save(),e.globalAlpha=r,this.drawBackground(i,e,s,t),hj(e,t.textDirection),i.y+=o.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),dj(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const r=this._active,s=e.map(({datasetIndex:a,index:l})=>{const u=this.chart.getDatasetMeta(a);if(!u)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:u.data[l],index:l}}),i=!Hb(r,s),o=this._positionChanged(s,t);(i||o)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,r=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,i=this._active||[],o=this._getActiveElements(e,i,t,r),a=this._positionChanged(o,e),l=t||!Hb(o,i)||a;return l&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,r,s){const i=this.options;if(e.type==="mouseout")return[];if(!s)return t.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(e,i.mode,i,r);return i.reverse&&o.reverse(),o}_positionChanged(e,t){const{caretX:r,caretY:s,options:i}=this,o=Am[i.position].call(this,e,t);return o!==!1&&(r!==o.x||s!==o.y)}}Ie(aS,"positioners",Am);var bie={id:"tooltip",_element:aS,positioners:Am,afterInit(n,e,t){t&&(n.tooltip=new aS({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Nj},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const wie=(n,e,t,r)=>(typeof e=="string"?(t=n.push(e)-1,r.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function _ie(n,e,t,r){const s=n.indexOf(e);if(s===-1)return wie(n,e,t,r);const i=n.lastIndexOf(e);return s!==i?t:s}const kie=(n,e)=>n===null?null:Ki(Math.round(n),0,e);function _M(n){const e=this.getLabels();return n>=0&&n<e.length?e[n]:n}class lS extends fp{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const r=this.getLabels();for(const{index:s,label:i}of t)r[s]===i&&r.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(cn(e))return null;const r=this.getLabels();return t=isFinite(t)&&r[t]===e?t:_ie(r,e,$t(t,e),this._addedLabels),kie(t,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:r,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),t||(s=this.getLabels().length-1)),this.min=r,this.max=s}buildTicks(){const e=this.min,t=this.max,r=this.options.offset,s=[];let i=this.getLabels();i=e===0&&t===i.length-1?i:i.slice(e,t+1),this._valueRange=Math.max(i.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let o=e;o<=t;o++)s.push({value:o});return s}getLabelForValue(e){return _M.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}Ie(lS,"id","category"),Ie(lS,"defaults",{ticks:{callback:_M}});function Cie(n,e){const t=[],{bounds:s,step:i,min:o,max:a,precision:l,count:u,maxTicks:c,maxDigits:h,includeBounds:d}=n,f=i||1,p=c-1,{min:m,max:g}=e,v=!cn(o),y=!cn(a),x=!cn(u),b=(g-m)/(h+1);let _=EF((g-m)/p/f)*f,E,I,C,S;if(_<1e-14&&!v&&!y)return[{value:m},{value:g}];S=Math.ceil(g/_)-Math.floor(m/_),S>p&&(_=EF(S*_/p/f)*f),cn(l)||(E=Math.pow(10,l),_=Math.ceil(_*E)/E),s==="ticks"?(I=Math.floor(m/_)*_,C=Math.ceil(g/_)*_):(I=m,C=g),v&&y&&i&&cne((a-o)/i,_/1e3)?(S=Math.round(Math.min((a-o)/_,c)),_=(a-o)/S,I=o,C=a):x?(I=v?o:I,C=y?a:C,S=u-1,_=(C-I)/S):(S=(C-I)/_,Jm(S,Math.round(S),_/1e3)?S=Math.round(S):S=Math.ceil(S));const T=Math.max(TF(_),TF(I));E=Math.pow(10,cn(l)?T:l),I=Math.round(I*E)/E,C=Math.round(C*E)/E;let N=0;for(v&&(d&&I!==o?(t.push({value:o}),I<o&&N++,Jm(Math.round((I+N*_)*E)/E,o,kM(o,b,n))&&N++):I<o&&N++);N<S;++N){const R=Math.round((I+N*_)*E)/E;if(y&&R>a)break;t.push({value:R})}return y&&d&&C!==a?t.length&&Jm(t[t.length-1].value,a,kM(a,b,n))?t[t.length-1].value=a:t.push({value:a}):(!y||C===a)&&t.push({value:C}),t}function kM(n,e,{horizontal:t,minRotation:r}){const s=Qc(r),i=(t?Math.sin(s):Math.cos(s))||.001,o=.75*e*(""+n).length;return Math.min(e/i,o)}class Iie extends fp{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return cn(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:r}=this.getUserBounds();let{min:s,max:i}=this;const o=l=>s=t?s:l,a=l=>i=r?i:l;if(e){const l=Df(s),u=Df(i);l<0&&u<0?a(0):l>0&&u>0&&o(0)}if(s===i){let l=i===0?1:Math.abs(i*.05);a(i+l),e||o(s-l)}this.min=s,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:r}=e,s;return r?(s=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),t=t||11),t&&(s=Math.min(t,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const s={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},i=this._range||this,o=Cie(s,i);return e.bounds==="ticks"&&hne(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let t=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const s=(r-t)/Math.max(e.length-1,1)/2;t-=s,r+=s}this._startValue=t,this._endValue=r,this._valueRange=r-t}getLabelForValue(e){return nj(e,this.chart.options.locale,this.options.ticks.format)}}class uS extends Iie{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=io(e)?e:0,this.max=io(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,r=Qc(this.options.ticks.minRotation),s=(e?Math.sin(r):Math.cos(r))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,i.lineHeight/s))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}Ie(uS,"id","linear"),Ie(uS,"defaults",{ticks:{callback:rj.formatters.numeric}});const M1={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},qs=Object.keys(M1);function CM(n,e){return n-e}function IM(n,e){if(cn(e))return null;const t=n._adapter,{parser:r,round:s,isoWeekday:i}=n._parseOpts;let o=e;return typeof r=="function"&&(o=r(o)),io(o)||(o=typeof r=="string"?t.parse(o,r):t.parse(o)),o===null?null:(s&&(o=s==="week"&&($g(i)||i===!0)?t.startOf(o,"isoWeek",i):t.startOf(o,s)),+o)}function SM(n,e,t,r){const s=qs.length;for(let i=qs.indexOf(n);i<s-1;++i){const o=M1[qs[i]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((t-e)/(a*o.size))<=r)return qs[i]}return qs[s-1]}function Sie(n,e,t,r,s){for(let i=qs.length-1;i>=qs.indexOf(t);i--){const o=qs[i];if(M1[o].common&&n._adapter.diff(s,r,o)>=e-1)return o}return qs[t?qs.indexOf(t):0]}function Eie(n){for(let e=qs.indexOf(n)+1,t=qs.length;e<t;++e)if(M1[qs[e]].common)return qs[e]}function EM(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:r,hi:s}=JT(t,e),i=t[r]>=e?t[r]:t[s];n[i]=!0}}function Tie(n,e,t,r){const s=n._adapter,i=+s.startOf(e[0].value,r),o=e[e.length-1].value;let a,l;for(a=i;a<=o;a=+s.add(a,1,r))l=t[a],l>=0&&(e[l].major=!0);return e}function TM(n,e,t){const r=[],s={},i=e.length;let o,a;for(o=0;o<i;++o)a=e[o],s[a]=o,r.push({value:a,major:!1});return i===0||!t?r:Tie(n,r,s,t)}class Jb extends fp{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const r=e.time||(e.time={}),s=this._adapter=new Vre._date(e.adapters.date);s.init(t),Qm(r.displayFormats,s.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:IM(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,r=e.time.unit||"day";let{min:s,max:i,minDefined:o,maxDefined:a}=this.getUserBounds();function l(u){!o&&!isNaN(u.min)&&(s=Math.min(s,u.min)),!a&&!isNaN(u.max)&&(i=Math.max(i,u.max))}(!o||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=io(s)&&!isNaN(s)?s:+t.startOf(Date.now(),r),i=io(i)&&!isNaN(i)?i:+t.endOf(Date.now(),r)+1,this.min=Math.min(s,i-1),this.max=Math.max(s+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],r=e[e.length-1]),{min:t,max:r}}buildTicks(){const e=this.options,t=e.time,r=e.ticks,s=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const i=this.min,o=this.max,a=vne(s,i,o);return this._unit=t.unit||(r.autoSkip?SM(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):Sie(this,a.length,t.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:Eie(this._unit),this.initOffsets(s),e.reverse&&a.reverse(),TM(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,r=0,s,i;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),e.length===1?t=1-s:t=(this.getDecimalForValue(e[1])-s)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?r=i:r=(i-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;t=Ki(t,0,o),r=Ki(r,0,o),this._offsets={start:t,end:r,factor:1/(t+1+r)}}_generate(){const e=this._adapter,t=this.min,r=this.max,s=this.options,i=s.time,o=i.unit||SM(i.minUnit,t,r,this._getLabelCapacity(t)),a=$t(s.ticks.stepSize,1),l=o==="week"?i.isoWeekday:!1,u=$g(l)||l===!0,c={};let h=t,d,f;if(u&&(h=+e.startOf(h,"isoWeek",l)),h=+e.startOf(h,u?"day":o),e.diff(r,t,o)>1e5*a)throw new Error(t+" and "+r+" are too far apart with stepSize of "+a+" "+o);const p=s.ticks.source==="data"&&this.getDataTimestamps();for(d=h,f=0;d<r;d=+e.add(d,a,o),f++)EM(c,d,p);return(d===r||s.bounds==="ticks"||f===1)&&EM(c,d,p),Object.keys(c).sort(CM).map(m=>+m)}getLabelForValue(e){const t=this._adapter,r=this.options.time;return r.tooltipFormat?t.format(e,r.tooltipFormat):t.format(e,r.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,i=this._unit,o=t||s[i];return this._adapter.format(e,o)}_tickFormatFunction(e,t,r,s){const i=this.options,o=i.ticks.callback;if(o)return yn(o,[e,t,r],this);const a=i.time.displayFormats,l=this._unit,u=this._majorUnit,c=l&&a[l],h=u&&a[u],d=r[t],f=u&&h&&d&&d.major;return this._adapter.format(e,s||(f?h:c))}generateTickLabels(e){let t,r,s;for(t=0,r=e.length;t<r;++t)s=e[t],s.label=this._tickFormatFunction(s.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+r)*t.factor)}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,r=this.ctx.measureText(e).width,s=Qc(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:r*i+a*o,h:r*o+a*i}}_getLabelCapacity(e){const t=this.options.time,r=t.displayFormats,s=r[t.unit]||r.millisecond,i=this._tickFormatFunction(e,0,TM(this,[e],this._majorUnit),s),o=this._getLabelSize(i),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],t,r;if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,r=s.length;t<r;++t)e=e.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,r;if(e.length)return e;const s=this.getLabels();for(t=0,r=s.length;t<r;++t)e.push(IM(this,s[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return xne(e.sort(CM))}}Ie(Jb,"id","time"),Ie(Jb,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function i0(n,e,t){let r=0,s=n.length-1,i,o,a,l;t?(e>=n[r].pos&&e<=n[s].pos&&({lo:r,hi:s}=Jc(n,"pos",e)),{pos:i,time:a}=n[r],{pos:o,time:l}=n[s]):(e>=n[r].time&&e<=n[s].time&&({lo:r,hi:s}=Jc(n,"time",e)),{time:i,pos:a}=n[r],{time:o,pos:l}=n[s]);const u=o-i;return u?a+(l-a)*(e-i)/u:a}class NM extends Jb{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=i0(t,this.min),this._tableRange=i0(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,s=[],i=[];let o,a,l,u,c;for(o=0,a=e.length;o<a;++o)u=e[o],u>=t&&u<=r&&s.push(u);if(s.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(o=0,a=s.length;o<a;++o)c=s[o+1],l=s[o-1],u=s[o],Math.round((c+l)/2)!==u&&i.push({time:u,pos:o/(a-1)});return i}_generate(){const e=this.min,t=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(t)||r.length===1)&&r.push(t),r.sort((s,i)=>s-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return t.length&&r.length?e=this.normalize(t.concat(r)):e=t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return(i0(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return i0(this._table,r*this._tableRange+this._minPos,!0)}}Ie(NM,"id","timeseries"),Ie(NM,"defaults",Jb.defaults);const Aj="label";function AM(n,e){typeof n=="function"?n(e):n&&(n.current=e)}function Nie(n,e){const t=n.options;t&&e&&Object.assign(t,e)}function Rj(n,e){n.labels=e}function Dj(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Aj;const r=[];n.datasets=e.map(s=>{const i=n.datasets.find(o=>o[t]===s[t]);return!i||!s.data||r.includes(i)?{...s}:(r.push(i),Object.assign(i,s),i)})}function Aie(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Aj;const t={labels:[],datasets:[]};return Rj(t,n.labels),Dj(t,n.datasets,e),t}function Rie(n,e){const{height:t=150,width:r=300,redraw:s=!1,datasetIdKey:i,type:o,data:a,options:l,plugins:u=[],fallbackContent:c,updateMode:h,...d}=n,f=q.useRef(null),p=q.useRef(null),m=()=>{f.current&&(p.current=new F1(f.current,{type:o,data:Aie(a,i),options:l&&{...l},plugins:u}),AM(e,p.current))},g=()=>{AM(e,null),p.current&&(p.current.destroy(),p.current=null)};return q.useEffect(()=>{!s&&p.current&&l&&Nie(p.current,l)},[s,l]),q.useEffect(()=>{!s&&p.current&&Rj(p.current.config.data,a.labels)},[s,a.labels]),q.useEffect(()=>{!s&&p.current&&a.datasets&&Dj(p.current.config.data,a.datasets,i)},[s,a.datasets]),q.useEffect(()=>{p.current&&(s?(g(),setTimeout(m)):p.current.update(h))},[s,l,a.labels,a.datasets,h]),q.useEffect(()=>{p.current&&(g(),setTimeout(m))},[o]),q.useEffect(()=>(m(),()=>g()),[]),xV.createElement("canvas",{ref:f,role:"img",height:t,width:r,...d},c)}const Die=q.forwardRef(Rie);function $ie(n,e){return F1.register(e),q.forwardRef((t,r)=>xV.createElement(Die,{...t,ref:r,type:n}))}const Pie=$ie("line",tb);F1.register(lS,uS,sb,Nm,die,bie,cie);const Oie=({data:n})=>{const e={labels:n.map(r=>new Date(r.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})).reverse(),datasets:[{label:"Stress Level",data:n.map(r=>r.stressLevel).reverse(),borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.5)",tension:.4},{label:"Sleep Hours",data:n.map(r=>r.sleepHours).reverse(),borderColor:"rgb(139, 92, 246)",backgroundColor:"rgba(139, 92, 246, 0.5)",tension:.4},{label:"Screen Time",data:n.map(r=>r.screenTime).reverse(),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.5)",tension:.4}]},t={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Stress, Sleep, and Screen Time Trends"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Hours / Level"}},x:{title:{display:!0,text:"Date & Time"}}}};return k.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:k.jsx(Pie,{options:t,data:e})})},Fie=(n,e,t)=>{const r=[];return n>=8?r.push({type:"stress",message:"Your stress level is very high. Consider taking a short break, practicing deep breathing, or going for a walk.",priority:"high"}):n>=6&&r.push({type:"stress",message:"Your stress level is elevated. Try some stress management techniques like meditation or stretching.",priority:"medium"}),e<6?r.push({type:"sleep",message:"You're not getting enough sleep. Try to establish a consistent sleep schedule and create a relaxing bedtime routine.",priority:"high"}):e<7&&r.push({type:"sleep",message:"Your sleep duration is slightly below optimal. Consider going to bed 30 minutes earlier.",priority:"medium"}),t>=8?r.push({type:"screen",message:"Your screen time is quite high. Take regular breaks and try to reduce screen time, especially before bedtime.",priority:"high"}):t>=6&&r.push({type:"screen",message:"Your screen time is elevated. Consider implementing the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.",priority:"medium"}),n>=7&&e<7&&r.push({type:"stress",message:"High stress and insufficient sleep can create a cycle. Try to prioritize sleep and relaxation techniques.",priority:"high"}),t>=6&&e<7&&r.push({type:"screen",message:"High screen time might be affecting your sleep. Try to reduce screen time at least 1 hour before bedtime.",priority:"medium"}),r},Mie=({stressLevel:n,sleepHours:e,screenTime:t})=>{const r=Fie(n,e,t),s=i=>{switch(i){case"stress":return k.jsx(cl,{className:"w-5 h-5 text-red-500"});case"sleep":return k.jsx(ah,{className:"w-5 h-5 text-indigo-500"});case"screen":return k.jsx(IU,{className:"w-5 h-5 text-blue-500"});default:return k.jsx(PZ,{className:"w-5 h-5 text-yellow-500"})}};return r.length===0?k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[k.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Recommendations"}),k.jsx("div",{className:"bg-green-50 border border-green-100 rounded-lg p-4",children:k.jsxs("div",{className:"flex items-start gap-3",children:[k.jsx("div",{className:"mt-1",children:k.jsx("span",{className:"text-2xl",children:"🌟"})}),k.jsxs("div",{children:[k.jsx("p",{className:"text-gray-800",children:"Your current metrics look good! Keep up the healthy habits!"}),k.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Current Status:"}),k.jsxs("ul",{className:"text-sm text-gray-600 mt-1 space-y-1",children:[k.jsxs("li",{children:["• Stress Level: ",n,"/10"]}),k.jsxs("li",{children:["• Sleep: ",e," hours"]}),k.jsxs("li",{children:["• Screen Time: ",t," hours"]})]})]})]})})]}):k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[k.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Recommendations"}),k.jsx("div",{className:"space-y-4",children:r.map((i,o)=>k.jsx("div",{className:`p-4 rounded-lg ${i.priority==="high"?"bg-red-50 border border-red-100":i.priority==="medium"?"bg-yellow-50 border border-yellow-100":"bg-green-50 border border-green-100"}`,children:k.jsxs("div",{className:"flex items-start gap-3",children:[k.jsx("div",{className:"mt-1",children:s(i.type)}),k.jsxs("div",{children:[k.jsx("p",{className:"text-gray-800",children:i.message}),k.jsxs("div",{className:"mt-2",children:[k.jsx("p",{className:"text-sm text-gray-500",children:"Current Status:"}),k.jsxs("ul",{className:"text-sm text-gray-600 mt-1 space-y-1",children:[i.type==="stress"&&k.jsxs("li",{children:["• Stress Level: ",n,"/10"]}),i.type==="sleep"&&k.jsxs("li",{children:["• Sleep: ",e," hours"]}),i.type==="screen"&&k.jsxs("li",{children:["• Screen Time: ",t," hours"]})]})]}),k.jsx("span",{className:`inline-block mt-2 text-sm font-medium ${i.priority==="high"?"text-red-600":i.priority==="medium"?"text-yellow-600":"text-green-600"}`,children:i.priority==="high"?"High Priority":i.priority==="medium"?"Medium Priority":"Low Priority"})]})]})},o))})]})},Lie=({data:n})=>{const[e,t]=q.useState({averageStress:0,averageSleep:0,averageScreenTime:0,trend:"stable",stressChange:0,sleepChange:0});return q.useEffect(()=>{if(n.length===0)return;const r=n.reduce((u,c)=>u+c.stressLevel,0)/n.length,s=n.reduce((u,c)=>u+c.sleepHours,0)/n.length,i=n.reduce((u,c)=>u+c.screenTime,0)/n.length;let o=0,a=0;if(n.length>=2){const u=n.slice(0,2);o=u[0].stressLevel-u[1].stressLevel,a=u[0].sleepHours-u[1].sleepHours}let l="stable";Math.abs(o)>.5&&(l=o>0?"increasing":"decreasing"),t({averageStress:Number(r.toFixed(1)),averageSleep:Number(s.toFixed(1)),averageScreenTime:Number(i.toFixed(1)),trend:l,stressChange:Number(o.toFixed(1)),sleepChange:Number(a.toFixed(1))})},[n]),n.length===0?k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[k.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Dashboard"}),k.jsx("p",{className:"text-gray-600 text-center py-4",children:"No data available yet. Start by logging your stress levels!"})]}):k.jsxs("div",{className:"space-y-8",children:[k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[k.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[k.jsx(cl,{className:"w-6 h-6 text-red-500"}),k.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Average Stress"})]}),k.jsxs("div",{className:"flex items-baseline gap-2",children:[k.jsx("p",{className:"text-3xl font-bold text-gray-900",children:e.averageStress}),k.jsx("p",{className:"text-sm text-gray-500",children:"/10"})]}),k.jsx("div",{className:"flex items-center gap-1 mt-2",children:e.stressChange!==0&&k.jsxs(k.Fragment,{children:[e.stressChange>0?k.jsx(BC,{className:"w-4 h-4 text-red-500"}):k.jsx(LC,{className:"w-4 h-4 text-green-500"}),k.jsxs("span",{className:`text-sm ${e.stressChange>0?"text-red-500":"text-green-500"}`,children:[Math.abs(e.stressChange)," from last entry"]})]})})]}),k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[k.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[k.jsx(ah,{className:"w-6 h-6 text-indigo-500"}),k.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Average Sleep"})]}),k.jsxs("div",{className:"flex items-baseline gap-2",children:[k.jsx("p",{className:"text-3xl font-bold text-gray-900",children:e.averageSleep}),k.jsx("p",{className:"text-sm text-gray-500",children:"hours"})]}),k.jsx("div",{className:"flex items-center gap-1 mt-2",children:e.sleepChange!==0&&k.jsxs(k.Fragment,{children:[e.sleepChange>0?k.jsx(BC,{className:"w-4 h-4 text-green-500"}):k.jsx(LC,{className:"w-4 h-4 text-red-500"}),k.jsxs("span",{className:`text-sm ${e.sleepChange>0?"text-green-500":"text-red-500"}`,children:[Math.abs(e.sleepChange)," hours from last entry"]})]})})]}),k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[k.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[k.jsx(IU,{className:"w-6 h-6 text-blue-500"}),k.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Average Screen Time"})]}),k.jsxs("div",{className:"flex items-baseline gap-2",children:[k.jsx("p",{className:"text-3xl font-bold text-gray-900",children:e.averageScreenTime}),k.jsx("p",{className:"text-sm text-gray-500",children:"hours"})]}),k.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"per day"})]})]}),k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[k.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[k.jsx(YI,{className:"w-6 h-6 text-green-500"}),k.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Stress Trend"})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[e.trend==="increasing"?k.jsx(BC,{className:"w-6 h-6 text-red-500"}):e.trend==="decreasing"?k.jsx(LC,{className:"w-6 h-6 text-green-500"}):k.jsx(XZ,{className:"w-6 h-6 text-yellow-500"}),k.jsx("span",{className:`text-lg font-medium ${e.trend==="increasing"?"text-red-500":e.trend==="decreasing"?"text-green-500":"text-yellow-500"}`,children:e.trend.charAt(0).toUpperCase()+e.trend.slice(1)})]})]}),k.jsx(Oie,{data:n}),k.jsx(Mie,{stressLevel:n[0].stressLevel,sleepHours:n[0].sleepHours,screenTime:n[0].screenTime})]})},Bie={transformers:["audio-classification","automatic-speech-recognition","depth-estimation","document-question-answering","feature-extraction","fill-mask","image-classification","image-feature-extraction","image-segmentation","image-to-image","image-to-text","image-text-to-text","mask-generation","object-detection","question-answering","summarization","table-question-answering","text2text-generation","text-classification","text-generation","text-to-audio","text-to-speech","token-classification","translation","video-classification","visual-question-answering","zero-shot-classification","zero-shot-image-classification","zero-shot-object-detection"]},uN={"text-classification":{name:"Text Classification",subtasks:[{type:"acceptability-classification",name:"Acceptability Classification"},{type:"entity-linking-classification",name:"Entity Linking Classification"},{type:"fact-checking",name:"Fact Checking"},{type:"intent-classification",name:"Intent Classification"},{type:"language-identification",name:"Language Identification"},{type:"multi-class-classification",name:"Multi Class Classification"},{type:"multi-label-classification",name:"Multi Label Classification"},{type:"multi-input-text-classification",name:"Multi-input Text Classification"},{type:"natural-language-inference",name:"Natural Language Inference"},{type:"semantic-similarity-classification",name:"Semantic Similarity Classification"},{type:"sentiment-classification",name:"Sentiment Classification"},{type:"topic-classification",name:"Topic Classification"},{type:"semantic-similarity-scoring",name:"Semantic Similarity Scoring"},{type:"sentiment-scoring",name:"Sentiment Scoring"},{type:"sentiment-analysis",name:"Sentiment Analysis"},{type:"hate-speech-detection",name:"Hate Speech Detection"},{type:"text-scoring",name:"Text Scoring"}],modality:"nlp",color:"orange"},"token-classification":{name:"Token Classification",subtasks:[{type:"named-entity-recognition",name:"Named Entity Recognition"},{type:"part-of-speech",name:"Part of Speech"},{type:"parsing",name:"Parsing"},{type:"lemmatization",name:"Lemmatization"},{type:"word-sense-disambiguation",name:"Word Sense Disambiguation"},{type:"coreference-resolution",name:"Coreference-resolution"}],modality:"nlp",color:"blue"},"table-question-answering":{name:"Table Question Answering",modality:"nlp",color:"green"},"question-answering":{name:"Question Answering",subtasks:[{type:"extractive-qa",name:"Extractive QA"},{type:"open-domain-qa",name:"Open Domain QA"},{type:"closed-domain-qa",name:"Closed Domain QA"}],modality:"nlp",color:"blue"},"zero-shot-classification":{name:"Zero-Shot Classification",modality:"nlp",color:"yellow"},translation:{name:"Translation",modality:"nlp",color:"green"},summarization:{name:"Summarization",subtasks:[{type:"news-articles-summarization",name:"News Articles Summarization"},{type:"news-articles-headline-generation",name:"News Articles Headline Generation"}],modality:"nlp",color:"indigo"},"feature-extraction":{name:"Feature Extraction",modality:"nlp",color:"red"},"text-generation":{name:"Text Generation",subtasks:[{type:"dialogue-modeling",name:"Dialogue Modeling"},{type:"dialogue-generation",name:"Dialogue Generation"},{type:"conversational",name:"Conversational"},{type:"language-modeling",name:"Language Modeling"}],modality:"nlp",color:"indigo"},"text2text-generation":{name:"Text2Text Generation",subtasks:[{type:"text-simplification",name:"Text simplification"},{type:"explanation-generation",name:"Explanation Generation"},{type:"abstractive-qa",name:"Abstractive QA"},{type:"open-domain-abstractive-qa",name:"Open Domain Abstractive QA"},{type:"closed-domain-qa",name:"Closed Domain QA"},{type:"open-book-qa",name:"Open Book QA"},{type:"closed-book-qa",name:"Closed Book QA"}],modality:"nlp",color:"indigo"},"fill-mask":{name:"Fill-Mask",subtasks:[{type:"slot-filling",name:"Slot Filling"},{type:"masked-language-modeling",name:"Masked Language Modeling"}],modality:"nlp",color:"red"},"sentence-similarity":{name:"Sentence Similarity",modality:"nlp",color:"yellow"},"text-to-speech":{name:"Text-to-Speech",modality:"audio",color:"yellow"},"text-to-audio":{name:"Text-to-Audio",modality:"audio",color:"yellow"},"automatic-speech-recognition":{name:"Automatic Speech Recognition",modality:"audio",color:"yellow"},"audio-to-audio":{name:"Audio-to-Audio",modality:"audio",color:"blue"},"audio-classification":{name:"Audio Classification",subtasks:[{type:"keyword-spotting",name:"Keyword Spotting"},{type:"speaker-identification",name:"Speaker Identification"},{type:"audio-intent-classification",name:"Audio Intent Classification"},{type:"audio-emotion-recognition",name:"Audio Emotion Recognition"},{type:"audio-language-identification",name:"Audio Language Identification"}],modality:"audio",color:"green"},"audio-text-to-text":{name:"Audio-Text-to-Text",modality:"multimodal",color:"red",hideInDatasets:!0},"voice-activity-detection":{name:"Voice Activity Detection",modality:"audio",color:"red"},"depth-estimation":{name:"Depth Estimation",modality:"cv",color:"yellow"},"image-classification":{name:"Image Classification",subtasks:[{type:"multi-label-image-classification",name:"Multi Label Image Classification"},{type:"multi-class-image-classification",name:"Multi Class Image Classification"}],modality:"cv",color:"blue"},"object-detection":{name:"Object Detection",subtasks:[{type:"face-detection",name:"Face Detection"},{type:"vehicle-detection",name:"Vehicle Detection"}],modality:"cv",color:"yellow"},"image-segmentation":{name:"Image Segmentation",subtasks:[{type:"instance-segmentation",name:"Instance Segmentation"},{type:"semantic-segmentation",name:"Semantic Segmentation"},{type:"panoptic-segmentation",name:"Panoptic Segmentation"}],modality:"cv",color:"green"},"text-to-image":{name:"Text-to-Image",modality:"cv",color:"yellow"},"image-to-text":{name:"Image-to-Text",subtasks:[{type:"image-captioning",name:"Image Captioning"}],modality:"cv",color:"red"},"image-to-image":{name:"Image-to-Image",subtasks:[{type:"image-inpainting",name:"Image Inpainting"},{type:"image-colorization",name:"Image Colorization"},{type:"super-resolution",name:"Super Resolution"}],modality:"cv",color:"indigo"},"image-to-video":{name:"Image-to-Video",modality:"cv",color:"indigo"},"unconditional-image-generation":{name:"Unconditional Image Generation",modality:"cv",color:"green"},"video-classification":{name:"Video Classification",modality:"cv",color:"blue"},"reinforcement-learning":{name:"Reinforcement Learning",modality:"rl",color:"red"},robotics:{name:"Robotics",modality:"rl",subtasks:[{type:"grasping",name:"Grasping"},{type:"task-planning",name:"Task Planning"}],color:"blue"},"tabular-classification":{name:"Tabular Classification",modality:"tabular",subtasks:[{type:"tabular-multi-class-classification",name:"Tabular Multi Class Classification"},{type:"tabular-multi-label-classification",name:"Tabular Multi Label Classification"}],color:"blue"},"tabular-regression":{name:"Tabular Regression",modality:"tabular",subtasks:[{type:"tabular-single-column-regression",name:"Tabular Single Column Regression"}],color:"blue"},"tabular-to-text":{name:"Tabular to Text",modality:"tabular",subtasks:[{type:"rdf-to-text",name:"RDF to text"}],color:"blue",hideInModels:!0},"table-to-text":{name:"Table to Text",modality:"nlp",color:"blue",hideInModels:!0},"multiple-choice":{name:"Multiple Choice",subtasks:[{type:"multiple-choice-qa",name:"Multiple Choice QA"},{type:"multiple-choice-coreference-resolution",name:"Multiple Choice Coreference Resolution"}],modality:"nlp",color:"blue",hideInModels:!0},"text-ranking":{name:"Text Ranking",modality:"nlp",color:"red"},"text-retrieval":{name:"Text Retrieval",subtasks:[{type:"document-retrieval",name:"Document Retrieval"},{type:"utterance-retrieval",name:"Utterance Retrieval"},{type:"entity-linking-retrieval",name:"Entity Linking Retrieval"},{type:"fact-checking-retrieval",name:"Fact Checking Retrieval"}],modality:"nlp",color:"indigo",hideInModels:!0},"time-series-forecasting":{name:"Time Series Forecasting",modality:"tabular",subtasks:[{type:"univariate-time-series-forecasting",name:"Univariate Time Series Forecasting"},{type:"multivariate-time-series-forecasting",name:"Multivariate Time Series Forecasting"}],color:"blue"},"text-to-video":{name:"Text-to-Video",modality:"cv",color:"green"},"image-text-to-text":{name:"Image-Text-to-Text",modality:"multimodal",color:"red",hideInDatasets:!0},"visual-question-answering":{name:"Visual Question Answering",subtasks:[{type:"visual-question-answering",name:"Visual Question Answering"}],modality:"multimodal",color:"red"},"document-question-answering":{name:"Document Question Answering",subtasks:[{type:"document-question-answering",name:"Document Question Answering"}],modality:"multimodal",color:"blue",hideInDatasets:!0},"zero-shot-image-classification":{name:"Zero-Shot Image Classification",modality:"cv",color:"yellow"},"graph-ml":{name:"Graph Machine Learning",modality:"other",color:"green"},"mask-generation":{name:"Mask Generation",modality:"cv",color:"indigo"},"zero-shot-object-detection":{name:"Zero-Shot Object Detection",modality:"cv",color:"yellow"},"text-to-3d":{name:"Text-to-3D",modality:"cv",color:"yellow"},"image-to-3d":{name:"Image-to-3D",modality:"cv",color:"green"},"image-feature-extraction":{name:"Image Feature Extraction",modality:"cv",color:"indigo"},"video-text-to-text":{name:"Video-Text-to-Text",modality:"multimodal",color:"blue",hideInDatasets:!1},"keypoint-detection":{name:"Keypoint Detection",subtasks:[{type:"pose-estimation",name:"Pose Estimation"}],modality:"cv",color:"red",hideInDatasets:!0},"visual-document-retrieval":{name:"Visual Document Retrieval",modality:"multimodal",color:"yellow",hideInDatasets:!0},"any-to-any":{name:"Any-to-Any",modality:"multimodal",color:"yellow",hideInDatasets:!0},other:{name:"Other",modality:"other",color:"blue",hideInModels:!0,hideInDatasets:!0}},Vie=Object.keys(uN);Object.values(uN).flatMap(n=>"subtasks"in n?n.subtasks:[]).map(n=>n.type);new Set(Vie);const zie={datasets:[{description:"A benchmark of 10 different audio tasks.",id:"s3prl/superb"},{description:"A dataset of YouTube clips and their sound categories.",id:"agkphysics/AudioSet"}],demo:{inputs:[{filename:"audio.wav",type:"audio"}],outputs:[{data:[{label:"Up",score:.2},{label:"Down",score:.8}],type:"chart"}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"",id:"f1"}],models:[{description:"An easy-to-use model for command recognition.",id:"speechbrain/google_speech_command_xvector"},{description:"An emotion recognition model.",id:"ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition"},{description:"A language identification model.",id:"facebook/mms-lid-126"}],spaces:[{description:"An application that can classify music into different genre.",id:"kurianbenoy/audioclassification"}],summary:"Audio classification is the task of assigning a label or class to a given audio. It can be used for recognizing which command a user is giving or the emotion of a statement, as well as identifying a speaker.",widgetModels:["MIT/ast-finetuned-audioset-10-10-0.4593"],youtubeId:"KWwzcmG98Ds"},Uie={datasets:[{description:"512-element X-vector embeddings of speakers from CMU ARCTIC dataset.",id:"Matthijs/cmu-arctic-xvectors"}],demo:{inputs:[{filename:"input.wav",type:"audio"}],outputs:[{filename:"label-0.wav",type:"audio"},{filename:"label-1.wav",type:"audio"}]},metrics:[{description:"The Signal-to-Noise ratio is the relationship between the target signal level and the background noise level. It is calculated as the logarithm of the target signal divided by the background noise, in decibels.",id:"snri"},{description:"The Signal-to-Distortion ratio is the relationship between the target signal and the sum of noise, interference, and artifact errors",id:"sdri"}],models:[{description:"A speech enhancement model.",id:"ResembleAI/resemble-enhance"},{description:"A model that can change the voice in a speech recording.",id:"microsoft/speecht5_vc"}],spaces:[{description:"An application for speech separation.",id:"younver/speechbrain-speech-separation"},{description:"An application for audio style transfer.",id:"nakas/audio-diffusion_style_transfer"}],summary:"Audio-to-Audio is a family of tasks in which the input is an audio and the output is one or multiple generated audios. Some example tasks are speech enhancement and source separation.",widgetModels:["speechbrain/sepformer-wham"],youtubeId:"iohj7nCCYoM"},jie={datasets:[{description:"31,175 hours of multilingual audio-text dataset in 108 languages.",id:"mozilla-foundation/common_voice_17_0"},{description:"Multilingual and diverse audio dataset with 101k hours of audio.",id:"amphion/Emilia-Dataset"},{description:"A dataset with 44.6k hours of English speaker data and 6k hours of other language speakers.",id:"parler-tts/mls_eng"},{description:"A multilingual audio dataset with 370K hours of audio.",id:"espnet/yodas"}],demo:{inputs:[{filename:"input.flac",type:"audio"}],outputs:[{label:"Transcript",content:"Going along slushy country roads and speaking to damp audiences in...",type:"text"}]},metrics:[{description:"",id:"wer"},{description:"",id:"cer"}],models:[{description:"A powerful ASR model by OpenAI.",id:"openai/whisper-large-v3"},{description:"A good generic speech model by MetaAI for fine-tuning.",id:"facebook/w2v-bert-2.0"},{description:"An end-to-end model that performs ASR and Speech Translation by MetaAI.",id:"facebook/seamless-m4t-v2-large"},{description:"A powerful multilingual ASR and Speech Translation model by Nvidia.",id:"nvidia/canary-1b"},{description:"Powerful speaker diarization model.",id:"pyannote/speaker-diarization-3.1"}],spaces:[{description:"A powerful general-purpose speech recognition application.",id:"hf-audio/whisper-large-v3"},{description:"Latest ASR model from Useful Sensors.",id:"mrfakename/Moonshinex"},{description:"A high quality speech and text translation model by Meta.",id:"facebook/seamless_m4t"},{description:"A powerful multilingual ASR and Speech Translation model by Nvidia",id:"nvidia/canary-1b"}],summary:"Automatic Speech Recognition (ASR), also known as Speech to Text (STT), is the task of transcribing a given audio to text. It has many applications, such as voice user interfaces.",widgetModels:["openai/whisper-large-v3"],youtubeId:"TksaY_FDgnk"},Wie={datasets:[{description:"Largest document understanding dataset.",id:"HuggingFaceM4/Docmatix"},{description:"Dataset from the 2020 DocVQA challenge. The documents are taken from the UCSF Industry Documents Library.",id:"eliolio/docvqa"}],demo:{inputs:[{label:"Question",content:"What is the idea behind the consumer relations efficiency team?",type:"text"},{filename:"document-question-answering-input.png",type:"img"}],outputs:[{label:"Answer",content:"Balance cost efficiency with quality customer service",type:"text"}]},metrics:[{description:"The evaluation metric for the DocVQA challenge is the Average Normalized Levenshtein Similarity (ANLS). This metric is flexible to character regognition errors and compares the predicted answer with the ground truth answer.",id:"anls"},{description:"Exact Match is a metric based on the strict character match of the predicted answer and the right answer. For answers predicted correctly, the Exact Match will be 1. Even if only one character is different, Exact Match will be 0",id:"exact-match"}],models:[{description:"A robust document question answering model.",id:"impira/layoutlm-document-qa"},{description:"A document question answering model specialized in invoices.",id:"impira/layoutlm-invoices"},{description:"A special model for OCR-free document question answering.",id:"microsoft/udop-large"},{description:"A powerful model for document question answering.",id:"google/pix2struct-docvqa-large"}],spaces:[{description:"A robust document question answering application.",id:"impira/docquery"},{description:"An application that can answer questions from invoices.",id:"impira/invoices"},{description:"An application to compare different document question answering models.",id:"merve/compare_docvqa_models"}],summary:"Document Question Answering (also known as Document Visual Question Answering) is the task of answering questions on document images. Document question answering models take a (document, question) pair as input and return an answer in natural language. Models usually rely on multi-modal features, combining text, position of words (bounding-boxes) and image.",widgetModels:["impira/layoutlm-invoices"],youtubeId:""},Hie={datasets:[{description:"Wikipedia dataset containing cleaned articles of all languages. Can be used to train `feature-extraction` models.",id:"wikipedia"}],demo:{inputs:[{label:"Input",content:"India, officially the Republic of India, is a country in South Asia.",type:"text"}],outputs:[{table:[["Dimension 1","Dimension 2","Dimension 3"],["2.583383083343506","2.757075071334839","0.9023529887199402"],["8.29393482208252","1.1071064472198486","2.03399395942688"],["-0.7754912972450256","-1.647324562072754","-0.6113331913948059"],["0.07087723910808563","1.5942802429199219","1.4610432386398315"]],type:"tabular"}]},metrics:[],models:[{description:"A powerful feature extraction model for natural language processing tasks.",id:"thenlper/gte-large"},{description:"A strong feature extraction model for retrieval.",id:"Alibaba-NLP/gte-Qwen1.5-7B-instruct"}],spaces:[{description:"A leaderboard to rank text feature extraction models based on a benchmark.",id:"mteb/leaderboard"},{description:"A leaderboard to rank best feature extraction models based on human feedback.",id:"mteb/arena"}],summary:"Feature extraction is the task of extracting features learnt in a model.",widgetModels:["facebook/bart-base"]},Gie={datasets:[{description:"A common dataset that is used to train models for many languages.",id:"wikipedia"},{description:"A large English dataset with text crawled from the web.",id:"c4"}],demo:{inputs:[{label:"Input",content:"The <mask> barked at me",type:"text"}],outputs:[{type:"chart",data:[{label:"wolf",score:.487},{label:"dog",score:.061},{label:"cat",score:.058},{label:"fox",score:.047},{label:"squirrel",score:.025}]}]},metrics:[{description:"Cross Entropy is a metric that calculates the difference between two probability distributions. Each probability distribution is the distribution of predicted words",id:"cross_entropy"},{description:"Perplexity is the exponential of the cross-entropy loss. It evaluates the probabilities assigned to the next word by the model. Lower perplexity indicates better performance",id:"perplexity"}],models:[{description:"State-of-the-art masked language model.",id:"answerdotai/ModernBERT-large"},{description:"A multilingual model trained on 100 languages.",id:"FacebookAI/xlm-roberta-base"}],spaces:[],summary:"Masked language modeling is the task of masking some of the words in a sentence and predicting which words should replace those masks. These models are useful when we want to get a statistical understanding of the language in which the model is trained in.",widgetModels:["distilroberta-base"],youtubeId:"mqElG5QJWUg"},qie={datasets:[{description:"Benchmark dataset used for image classification with images that belong to 100 classes.",id:"cifar100"},{description:"Dataset consisting of images of garments.",id:"fashion_mnist"}],demo:{inputs:[{filename:"image-classification-input.jpeg",type:"img"}],outputs:[{type:"chart",data:[{label:"Egyptian cat",score:.514},{label:"Tabby cat",score:.193},{label:"Tiger cat",score:.068}]}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"",id:"f1"}],models:[{description:"A strong image classification model.",id:"google/vit-base-patch16-224"},{description:"A robust image classification model.",id:"facebook/deit-base-distilled-patch16-224"},{description:"A strong image classification model.",id:"facebook/convnext-large-224"}],spaces:[{description:"A leaderboard to evaluate different image classification models.",id:"timm/leaderboard"}],summary:"Image classification is the task of assigning a label or class to an entire image. Images are expected to have only one class for each image. Image classification models take an image as input and return a prediction about which class the image belongs to.",widgetModels:["google/vit-base-patch16-224"],youtubeId:"tjAIM7BOYhw"},Kie={datasets:[{description:"ImageNet-1K is a image classification dataset in which images are used to train image-feature-extraction models.",id:"imagenet-1k"}],demo:{inputs:[{filename:"mask-generation-input.png",type:"img"}],outputs:[{table:[["Dimension 1","Dimension 2","Dimension 3"],["0.21236686408519745","1.0919708013534546","0.8512550592422485"],["0.809657871723175","-0.18544459342956543","-0.7851548194885254"],["1.3103108406066895","-0.2479034662246704","-0.9107287526130676"],["1.8536205291748047","-0.36419737339019775","0.09717650711536407"]],type:"tabular"}]},metrics:[],models:[{description:"A powerful image feature extraction model.",id:"timm/vit_large_patch14_dinov2.lvd142m"},{description:"A strong image feature extraction model.",id:"nvidia/MambaVision-T-1K"},{description:"A robust image feature extraction model.",id:"facebook/dino-vitb16"},{description:"Cutting-edge image feature extraction model.",id:"apple/aimv2-large-patch14-336-distilled"},{description:"Strong image feature extraction model that can be used on images and documents.",id:"OpenGVLab/InternViT-6B-448px-V1-2"}],spaces:[{description:"A leaderboard to evaluate different image-feature-extraction models on classification performances",id:"timm/leaderboard"}],summary:"Image feature extraction is the task of extracting features learnt in a computer vision model.",widgetModels:[]},Xie={datasets:[{description:"Synthetic dataset, for image relighting",id:"VIDIT"},{description:"Multiple images of celebrities, used for facial expression translation",id:"huggan/CelebA-faces"},{description:"12M image-caption pairs.",id:"Spawning/PD12M"}],demo:{inputs:[{filename:"image-to-image-input.jpeg",type:"img"}],outputs:[{filename:"image-to-image-output.png",type:"img"}]},isPlaceholder:!1,metrics:[{description:"Peak Signal to Noise Ratio (PSNR) is an approximation of the human perception, considering the ratio of the absolute intensity with respect to the variations. Measured in dB, a high value indicates a high fidelity.",id:"PSNR"},{description:"Structural Similarity Index (SSIM) is a perceptual metric which compares the luminance, contrast and structure of two images. The values of SSIM range between -1 and 1, and higher values indicate closer resemblance to the original image.",id:"SSIM"},{description:"Inception Score (IS) is an analysis of the labels predicted by an image classification model when presented with a sample of the generated images.",id:"IS"}],models:[{description:"An image-to-image model to improve image resolution.",id:"fal/AuraSR-v2"},{description:"A model that increases the resolution of an image.",id:"keras-io/super-resolution"},{description:"A model for applying edits to images through image controls.",id:"Yuanshi/OminiControl"},{description:"A model that generates images based on segments in the input image and the text prompt.",id:"mfidabel/controlnet-segment-anything"},{description:"Strong model for inpainting and outpainting.",id:"black-forest-labs/FLUX.1-Fill-dev"},{description:"Strong model for image editing using depth maps.",id:"black-forest-labs/FLUX.1-Depth-dev-lora"}],spaces:[{description:"Image enhancer application for low light.",id:"keras-io/low-light-image-enhancement"},{description:"Style transfer application.",id:"keras-io/neural-style-transfer"},{description:"An application that generates images based on segment control.",id:"mfidabel/controlnet-segment-anything"},{description:"Image generation application that takes image control and text prompt.",id:"hysts/ControlNet"},{description:"Colorize any image using this app.",id:"ioclab/brightness-controlnet"},{description:"Edit images with instructions.",id:"timbrooks/instruct-pix2pix"}],summary:"Image-to-image is the task of transforming an input image through a variety of possible manipulations and enhancements, such as super-resolution, image inpainting, colorization, and more.",widgetModels:["stabilityai/stable-diffusion-2-inpainting"],youtubeId:""},Yie={datasets:[{description:"Dataset from 12M image-text of Reddit",id:"red_caps"},{description:"Dataset from 3.3M images of Google",id:"datasets/conceptual_captions"}],demo:{inputs:[{filename:"savanna.jpg",type:"img"}],outputs:[{label:"Detailed description",content:"a herd of giraffes and zebras grazing in a field",type:"text"}]},metrics:[],models:[{description:"A robust image captioning model.",id:"Salesforce/blip2-opt-2.7b"},{description:"A powerful and accurate image-to-text model that can also localize concepts in images.",id:"microsoft/kosmos-2-patch14-224"},{description:"A strong optical character recognition model.",id:"facebook/nougat-base"},{description:"A powerful model that lets you have a conversation with the image.",id:"llava-hf/llava-1.5-7b-hf"}],spaces:[{description:"An application that compares various image captioning models.",id:"nielsr/comparing-captioning-models"},{description:"A robust image captioning application.",id:"flax-community/image-captioning"},{description:"An application that transcribes handwritings into text.",id:"nielsr/TrOCR-handwritten"},{description:"An application that can caption images and answer questions about a given image.",id:"Salesforce/BLIP"},{description:"An application that can caption images and answer questions with a conversational agent.",id:"Salesforce/BLIP2"},{description:"An image captioning application that demonstrates the effect of noise on captions.",id:"johko/capdec-image-captioning"}],summary:"Image to text models output a text from a given image. Image captioning or optical character recognition can be considered as the most common applications of image to text.",widgetModels:["Salesforce/blip-image-captioning-large"],youtubeId:""},Qie={datasets:[{description:"Instructions composed of image and text.",id:"liuhaotian/LLaVA-Instruct-150K"},{description:"Collection of image-text pairs on scientific topics.",id:"DAMO-NLP-SG/multimodal_textbook"},{description:"A collection of datasets made for model fine-tuning.",id:"HuggingFaceM4/the_cauldron"},{description:"Screenshots of websites with their HTML/CSS codes.",id:"HuggingFaceM4/WebSight"}],demo:{inputs:[{filename:"image-text-to-text-input.png",type:"img"},{label:"Text Prompt",content:"Describe the position of the bee in detail.",type:"text"}],outputs:[{label:"Answer",content:"The bee is sitting on a pink flower, surrounded by other flowers. The bee is positioned in the center of the flower, with its head and front legs sticking out.",type:"text"}]},metrics:[],models:[{description:"Small and efficient yet powerful vision language model.",id:"HuggingFaceTB/SmolVLM-Instruct"},{description:"A screenshot understanding model used to control computers.",id:"microsoft/OmniParser-v2.0"},{description:"Cutting-edge vision language model.",id:"allenai/Molmo-7B-D-0924"},{description:"Small yet powerful model.",id:"vikhyatk/moondream2"},{description:"Strong image-text-to-text model.",id:"Qwen/Qwen2.5-VL-7B-Instruct"},{description:"Image-text-to-text model with agentic capabilities.",id:"microsoft/Magma-8B"},{description:"Strong image-text-to-text model focused on documents.",id:"allenai/olmOCR-7B-0225-preview"},{description:"Small yet strong image-text-to-text model.",id:"ibm-granite/granite-vision-3.2-2b"}],spaces:[{description:"Leaderboard to evaluate vision language models.",id:"opencompass/open_vlm_leaderboard"},{description:"Vision language models arena, where models are ranked by votes of users.",id:"WildVision/vision-arena"},{description:"Powerful vision-language model assistant.",id:"akhaliq/Molmo-7B-D-0924"},{description:"Powerful vision language assistant that can understand multiple images.",id:"HuggingFaceTB/SmolVLM2"},{description:"An application for chatting with an image-text-to-text model.",id:"GanymedeNil/Qwen2-VL-7B"},{description:"An application that parses screenshots into actions.",id:"showlab/ShowUI"},{description:"An application that detects gaze.",id:"moondream/gaze-demo"}],summary:"Image-text-to-text models take in an image and text prompt and output text. These models are also called vision-language models, or VLMs. The difference from image-to-text models is that these models take an additional text input, not restricting the model to certain use cases like image captioning, and may also be trained to accept a conversation as input.",widgetModels:["Qwen/Qwen2-VL-7B-Instruct"],youtubeId:"IoGaGfU1CIg"},Jie={datasets:[{description:"Scene segmentation dataset.",id:"scene_parse_150"}],demo:{inputs:[{filename:"image-segmentation-input.jpeg",type:"img"}],outputs:[{filename:"image-segmentation-output.png",type:"img"}]},metrics:[{description:"Average Precision (AP) is the Area Under the PR Curve (AUC-PR). It is calculated for each semantic class separately",id:"Average Precision"},{description:"Mean Average Precision (mAP) is the overall average of the AP values",id:"Mean Average Precision"},{description:"Intersection over Union (IoU) is the overlap of segmentation masks. Mean IoU is the average of the IoU of all semantic classes",id:"Mean Intersection over Union"},{description:"APα is the Average Precision at the IoU threshold of a α value, for example, AP50 and AP75",id:"APα"}],models:[{description:"Solid semantic segmentation model trained on ADE20k.",id:"openmmlab/upernet-convnext-small"},{description:"Background removal model.",id:"briaai/RMBG-1.4"},{description:"A multipurpose image segmentation model for high resolution images.",id:"ZhengPeng7/BiRefNet"},{description:"Powerful human-centric image segmentation model.",id:"facebook/sapiens-seg-1b"},{description:"Panoptic segmentation model trained on the COCO (common objects) dataset.",id:"facebook/mask2former-swin-large-coco-panoptic"}],spaces:[{description:"A semantic segmentation application that can predict unseen instances out of the box.",id:"facebook/ov-seg"},{description:"One of the strongest segmentation applications.",id:"jbrinkma/segment-anything"},{description:"A human-centric segmentation model.",id:"facebook/sapiens-pose"},{description:"An instance segmentation application to predict neuronal cell types from microscopy images.",id:"rashmi/sartorius-cell-instance-segmentation"},{description:"An application that segments videos.",id:"ArtGAN/Segment-Anything-Video"},{description:"An panoptic segmentation application built for outdoor environments.",id:"segments/panoptic-segment-anything"}],summary:"Image Segmentation divides an image into segments where each pixel in the image is mapped to an object. This task has multiple variants such as instance segmentation, panoptic segmentation and semantic segmentation.",widgetModels:["nvidia/segformer-b0-finetuned-ade-512-512"],youtubeId:"dKE8SIt9C-w"},Zie={datasets:[{description:"Widely used benchmark dataset for multiple Vision tasks.",id:"merve/coco2017"},{description:"Medical Imaging dataset of the Human Brain for segmentation and mask generating tasks",id:"rocky93/BraTS_segmentation"}],demo:{inputs:[{filename:"mask-generation-input.png",type:"img"}],outputs:[{filename:"mask-generation-output.png",type:"img"}]},metrics:[{description:"IoU is used to measure the overlap between predicted mask and the ground truth mask.",id:"Intersection over Union (IoU)"}],models:[{description:"Small yet powerful mask generation model.",id:"Zigeng/SlimSAM-uniform-50"},{description:"Very strong mask generation model.",id:"facebook/sam2-hiera-large"}],spaces:[{description:"An application that combines a mask generation model with a zero-shot object detection model for text-guided image segmentation.",id:"merve/OWLSAM2"},{description:"An application that compares the performance of a large and a small mask generation model.",id:"merve/slimsam"},{description:"An application based on an improved mask generation model.",id:"SkalskiP/segment-anything-model-2"},{description:"An application to remove objects from videos using mask generation models.",id:"SkalskiP/SAM_and_ProPainter"}],summary:"Mask generation is the task of generating masks that identify a specific object or region of interest in a given image. Masks are often used in segmentation tasks, where they provide a precise way to isolate the object of interest for further processing or analysis.",widgetModels:[],youtubeId:""},eoe={datasets:[{description:"Widely used benchmark dataset for multiple vision tasks.",id:"merve/coco2017"},{description:"Multi-task computer vision benchmark.",id:"merve/pascal-voc"}],demo:{inputs:[{filename:"object-detection-input.jpg",type:"img"}],outputs:[{filename:"object-detection-output.jpg",type:"img"}]},metrics:[{description:"The Average Precision (AP) metric is the Area Under the PR Curve (AUC-PR). It is calculated for each class separately",id:"Average Precision"},{description:"The Mean Average Precision (mAP) metric is the overall average of the AP values",id:"Mean Average Precision"},{description:"The APα metric is the Average Precision at the IoU threshold of a α value, for example, AP50 and AP75",id:"APα"}],models:[{description:"Solid object detection model pre-trained on the COCO 2017 dataset.",id:"facebook/detr-resnet-50"},{description:"Accurate object detection model.",id:"IDEA-Research/dab-detr-resnet-50"},{description:"Fast and accurate object detection model.",id:"PekingU/rtdetr_v2_r50vd"},{description:"Object detection model for low-lying objects.",id:"StephanST/WALDO30"}],spaces:[{description:"Leaderboard to compare various object detection models across several metrics.",id:"hf-vision/object_detection_leaderboard"},{description:"An application that contains various object detection models to try from.",id:"Gradio-Blocks/Object-Detection-With-DETR-and-YOLOS"},{description:"A cutting-edge object detection application.",id:"sunsmarterjieleaf/yolov12"},{description:"An object tracking, segmentation and inpainting application.",id:"VIPLab/Track-Anything"},{description:"Very fast object tracking application based on object detection.",id:"merve/RT-DETR-tracking-coco"}],summary:"Object Detection models allow users to identify objects of certain defined classes. Object detection models receive an image as input and output the images with bounding boxes and labels on detected objects.",widgetModels:["facebook/detr-resnet-50"],youtubeId:"WdAeKSOpxhw"},toe={datasets:[{description:"NYU Depth V2 Dataset: Video dataset containing both RGB and depth sensor data.",id:"sayakpaul/nyu_depth_v2"},{description:"Monocular depth estimation benchmark based without noise and errors.",id:"depth-anything/DA-2K"}],demo:{inputs:[{filename:"depth-estimation-input.jpg",type:"img"}],outputs:[{filename:"depth-estimation-output.png",type:"img"}]},metrics:[],models:[{description:"Cutting-edge depth estimation model.",id:"depth-anything/Depth-Anything-V2-Large"},{description:"A strong monocular depth estimation model.",id:"jingheya/lotus-depth-g-v1-0"},{description:"A depth estimation model that predicts depth in videos.",id:"tencent/DepthCrafter"},{description:"A robust depth estimation model.",id:"apple/DepthPro-hf"}],spaces:[{description:"An application that predicts the depth of an image and then reconstruct the 3D model as voxels.",id:"radames/dpt-depth-estimation-3d-voxels"},{description:"An application for bleeding-edge depth estimation.",id:"akhaliq/depth-pro"},{description:"An application on cutting-edge depth estimation in videos.",id:"tencent/DepthCrafter"},{description:"A human-centric depth estimation application.",id:"facebook/sapiens-depth"}],summary:"Depth estimation is the task of predicting depth of the objects present in an image.",widgetModels:[""],youtubeId:""},ib={datasets:[],demo:{inputs:[],outputs:[]},isPlaceholder:!0,metrics:[],models:[],spaces:[],summary:"",widgetModels:[],youtubeId:void 0,canonicalId:void 0},noe={datasets:[{description:"A curation of widely used datasets for Data Driven Deep Reinforcement Learning (D4RL)",id:"edbeeching/decision_transformer_gym_replay"}],demo:{inputs:[{label:"State",content:"Red traffic light, pedestrians are about to pass.",type:"text"}],outputs:[{label:"Action",content:"Stop the car.",type:"text"},{label:"Next State",content:"Yellow light, pedestrians have crossed.",type:"text"}]},metrics:[{description:"Accumulated reward across all time steps discounted by a factor that ranges between 0 and 1 and determines how much the agent optimizes for future relative to immediate rewards. Measures how good is the policy ultimately found by a given algorithm considering uncertainty over the future.",id:"Discounted Total Reward"},{description:"Average return obtained after running the policy for a certain number of evaluation episodes. As opposed to total reward, mean reward considers how much reward a given algorithm receives while learning.",id:"Mean Reward"},{description:"Measures how good a given algorithm is after a predefined time. Some algorithms may be guaranteed to converge to optimal behavior across many time steps. However, an agent that reaches an acceptable level of optimality after a given time horizon may be preferable to one that ultimately reaches optimality but takes a long time.",id:"Level of Performance After Some Time"}],models:[{description:"A Reinforcement Learning model trained on expert data from the Gym Hopper environment",id:"edbeeching/decision-transformer-gym-hopper-expert"},{description:"A PPO agent playing seals/CartPole-v0 using the stable-baselines3 library and the RL Zoo.",id:"HumanCompatibleAI/ppo-seals-CartPole-v0"}],spaces:[{description:"An application for a cute puppy agent learning to catch a stick.",id:"ThomasSimonini/Huggy"},{description:"An application to play Snowball Fight with a reinforcement learning agent.",id:"ThomasSimonini/SnowballFight"}],summary:"Reinforcement learning is the computational approach of learning from action by interacting with an environment through trial and error and receiving rewards (negative or positive) as feedback",widgetModels:[],youtubeId:"q0BiUn5LiBc"},roe={datasets:[{description:"A famous question answering dataset based on English articles from Wikipedia.",id:"squad_v2"},{description:"A dataset of aggregated anonymized actual queries issued to the Google search engine.",id:"natural_questions"}],demo:{inputs:[{label:"Question",content:"Which name is also used to describe the Amazon rainforest in English?",type:"text"},{label:"Context",content:"The Amazon rainforest, also known in English as Amazonia or the Amazon Jungle",type:"text"}],outputs:[{label:"Answer",content:"Amazonia",type:"text"}]},metrics:[{description:"Exact Match is a metric based on the strict character match of the predicted answer and the right answer. For answers predicted correctly, the Exact Match will be 1. Even if only one character is different, Exact Match will be 0",id:"exact-match"},{description:" The F1-Score metric is useful if we value both false positives and false negatives equally. The F1-Score is calculated on each word in the predicted sequence against the correct answer",id:"f1"}],models:[{description:"A robust baseline model for most question answering domains.",id:"deepset/roberta-base-squad2"},{description:"Small yet robust model that can answer questions.",id:"distilbert/distilbert-base-cased-distilled-squad"},{description:"A special model that can answer questions from tables.",id:"google/tapas-base-finetuned-wtq"}],spaces:[{description:"An application that can answer a long question from Wikipedia.",id:"deepset/wikipedia-assistant"}],summary:"Question Answering models can retrieve the answer to a question from a given text, which is useful for searching for an answer in a document. Some question answering models can generate answers without context!",widgetModels:["deepset/roberta-base-squad2"],youtubeId:"ajPx5LwJD-I"},soe={datasets:[{description:"Bing queries with relevant passages from various web sources.",id:"microsoft/ms_marco"}],demo:{inputs:[{label:"Source sentence",content:"Machine learning is so easy.",type:"text"},{label:"Sentences to compare to",content:"Deep learning is so straightforward.",type:"text"},{label:"",content:"This is so difficult, like rocket science.",type:"text"},{label:"",content:"I can't believe how much I struggled with this.",type:"text"}],outputs:[{type:"chart",data:[{label:"Deep learning is so straightforward.",score:.623},{label:"This is so difficult, like rocket science.",score:.413},{label:"I can't believe how much I struggled with this.",score:.256}]}]},metrics:[{description:"Reciprocal Rank is a measure used to rank the relevancy of documents given a set of documents. Reciprocal Rank is the reciprocal of the rank of the document retrieved, meaning, if the rank is 3, the Reciprocal Rank is 0.33. If the rank is 1, the Reciprocal Rank is 1",id:"Mean Reciprocal Rank"},{description:"The similarity of the embeddings is evaluated mainly on cosine similarity. It is calculated as the cosine of the angle between two vectors. It is particularly useful when your texts are not the same length",id:"Cosine Similarity"}],models:[{description:"This model works well for sentences and paragraphs and can be used for clustering/grouping and semantic searches.",id:"sentence-transformers/all-mpnet-base-v2"},{description:"A multilingual robust sentence similarity model.",id:"BAAI/bge-m3"},{description:"A robust sentence similarity model.",id:"HIT-TMG/KaLM-embedding-multilingual-mini-instruct-v1.5"}],spaces:[{description:"An application that leverages sentence similarity to answer questions from YouTube videos.",id:"Gradio-Blocks/Ask_Questions_To_YouTube_Videos"},{description:"An application that retrieves relevant PubMed abstracts for a given online article which can be used as further references.",id:"Gradio-Blocks/pubmed-abstract-retriever"},{description:"An application that leverages sentence similarity to summarize text.",id:"nickmuchi/article-text-summarizer"},{description:"A guide that explains how Sentence Transformers can be used for semantic search.",id:"sentence-transformers/Sentence_Transformers_for_semantic_search"}],summary:"Sentence Similarity is the task of determining how similar two texts are. Sentence similarity models convert input texts into vectors (embeddings) that capture semantic information and calculate how close (similar) they are between them. This task is particularly useful for information retrieval and clustering/grouping.",widgetModels:["BAAI/bge-small-en-v1.5"],youtubeId:"VCZq5AkbNEU"},ioe={canonicalId:"text2text-generation",datasets:[{description:"News articles in five different languages along with their summaries. Widely used for benchmarking multilingual summarization models.",id:"mlsum"},{description:"English conversations and their summaries. Useful for benchmarking conversational agents.",id:"samsum"}],demo:{inputs:[{label:"Input",content:"The tower is 324 metres (1,063 ft) tall, about the same height as an 81-storey building, and the tallest structure in Paris. Its base is square, measuring 125 metres (410 ft) on each side. It was the first structure to reach a height of 300 metres. Excluding transmitters, the Eiffel Tower is the second tallest free-standing structure in France after the Millau Viaduct.",type:"text"}],outputs:[{label:"Output",content:"The tower is 324 metres (1,063 ft) tall, about the same height as an 81-storey building. It was the first structure to reach a height of 300 metres.",type:"text"}]},metrics:[{description:"The generated sequence is compared against its summary, and the overlap of tokens are counted. ROUGE-N refers to overlap of N subsequent tokens, ROUGE-1 refers to overlap of single tokens and ROUGE-2 is the overlap of two subsequent tokens.",id:"rouge"}],models:[{description:"A strong summarization model trained on English news articles. Excels at generating factual summaries.",id:"facebook/bart-large-cnn"},{description:"A summarization model trained on medical articles.",id:"Falconsai/medical_summarization"}],spaces:[{description:"An application that can summarize long paragraphs.",id:"pszemraj/summarize-long-text"},{description:"A much needed summarization application for terms and conditions.",id:"ml6team/distilbart-tos-summarizer-tosdr"},{description:"An application that summarizes long documents.",id:"pszemraj/document-summarization"},{description:"An application that can detect errors in abstractive summarization.",id:"ml6team/post-processing-summarization"}],summary:"Summarization is the task of producing a shorter version of a document while preserving its important information. Some models can extract text from the original input, while other models can generate entirely new text.",widgetModels:["facebook/bart-large-cnn"],youtubeId:"yHnr5Dk2zCI"},ooe={datasets:[{description:"The WikiTableQuestions dataset is a large-scale dataset for the task of question answering on semi-structured tables.",id:"wikitablequestions"},{description:"WikiSQL is a dataset of 80654 hand-annotated examples of questions and SQL queries distributed across 24241 tables from Wikipedia.",id:"wikisql"}],demo:{inputs:[{table:[["Rank","Name","No.of reigns","Combined days"],["1","lou Thesz","3","3749"],["2","Ric Flair","8","3103"],["3","Harley Race","7","1799"]],type:"tabular"},{label:"Question",content:"What is the number of reigns for Harley Race?",type:"text"}],outputs:[{label:"Result",content:"7",type:"text"}]},metrics:[{description:"Checks whether the predicted answer(s) is the same as the ground-truth answer(s).",id:"Denotation Accuracy"}],models:[{description:"A table question answering model that is capable of neural SQL execution, i.e., employ TAPEX to execute a SQL query on a given table.",id:"microsoft/tapex-base"},{description:"A robust table question answering model.",id:"google/tapas-base-finetuned-wtq"}],spaces:[{description:"An application that answers questions based on table CSV files.",id:"katanaml/table-query"}],summary:"Table Question Answering (Table QA) is the answering a question about an information on a given table.",widgetModels:["google/tapas-base-finetuned-wtq"]},aoe={datasets:[{description:"A comprehensive curation of datasets covering all benchmarks.",id:"inria-soda/tabular-benchmark"}],demo:{inputs:[{table:[["Glucose","Blood Pressure ","Skin Thickness","Insulin","BMI"],["148","72","35","0","33.6"],["150","50","30","0","35.1"],["141","60","29","1","39.2"]],type:"tabular"}],outputs:[{table:[["Diabetes"],["1"],["1"],["0"]],type:"tabular"}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"",id:"f1"}],models:[{description:"Breast cancer prediction model based on decision trees.",id:"scikit-learn/cancer-prediction-trees"}],spaces:[{description:"An application that can predict defective products on a production line.",id:"scikit-learn/tabular-playground"},{description:"An application that compares various tabular classification techniques on different datasets.",id:"scikit-learn/classification"}],summary:"Tabular classification is the task of classifying a target category (a group) based on set of attributes.",widgetModels:["scikit-learn/tabular-playground"],youtubeId:""},loe={datasets:[{description:"A comprehensive curation of datasets covering all benchmarks.",id:"inria-soda/tabular-benchmark"}],demo:{inputs:[{table:[["Car Name","Horsepower","Weight"],["ford torino","140","3,449"],["amc hornet","97","2,774"],["toyota corolla","65","1,773"]],type:"tabular"}],outputs:[{table:[["MPG (miles per gallon)"],["17"],["18"],["31"]],type:"tabular"}]},metrics:[{description:"",id:"mse"},{description:"Coefficient of determination (or R-squared) is a measure of how well the model fits the data. Higher R-squared is considered a better fit.",id:"r-squared"}],models:[{description:"Fish weight prediction based on length measurements and species.",id:"scikit-learn/Fish-Weight"}],spaces:[{description:"An application that can predict weight of a fish based on set of attributes.",id:"scikit-learn/fish-weight-prediction"}],summary:"Tabular regression is the task of predicting a numerical value given a set of attributes.",widgetModels:["scikit-learn/Fish-Weight"],youtubeId:""},uoe={datasets:[{description:"RedCaps is a large-scale dataset of 12M image-text pairs collected from Reddit.",id:"red_caps"},{description:"Conceptual Captions is a dataset consisting of ~3.3M images annotated with captions.",id:"conceptual_captions"},{description:"12M image-caption pairs.",id:"Spawning/PD12M"}],demo:{inputs:[{label:"Input",content:"A city above clouds, pastel colors, Victorian style",type:"text"}],outputs:[{filename:"image.jpeg",type:"img"}]},metrics:[{description:"The Inception Score (IS) measure assesses diversity and meaningfulness. It uses a generated image sample to predict its label. A higher score signifies more diverse and meaningful images.",id:"IS"},{description:"The Fréchet Inception Distance (FID) calculates the distance between distributions between synthetic and real samples. A lower FID score indicates better similarity between the distributions of real and generated images.",id:"FID"},{description:"R-precision assesses how the generated image aligns with the provided text description. It uses the generated images as queries to retrieve relevant text descriptions. The top 'r' relevant descriptions are selected and used to calculate R-precision as r/R, where 'R' is the number of ground truth descriptions associated with the generated images. A higher R-precision value indicates a better model.",id:"R-Precision"}],models:[{description:"One of the most powerful image generation models that can generate realistic outputs.",id:"black-forest-labs/FLUX.1-dev"},{description:"A powerful yet fast image generation model.",id:"latent-consistency/lcm-lora-sdxl"},{description:"Text-to-image model for photorealistic generation.",id:"Kwai-Kolors/Kolors"},{description:"A powerful text-to-image model.",id:"stabilityai/stable-diffusion-3-medium-diffusers"}],spaces:[{description:"A powerful text-to-image application.",id:"stabilityai/stable-diffusion-3-medium"},{description:"A text-to-image application to generate comics.",id:"jbilcke-hf/ai-comic-factory"},{description:"An application to match multiple custom image generation models.",id:"multimodalart/flux-lora-lab"},{description:"A powerful yet very fast image generation application.",id:"latent-consistency/lcm-lora-for-sdxl"},{description:"A gallery to explore various text-to-image models.",id:"multimodalart/LoraTheExplorer"},{description:"An application for `text-to-image`, `image-to-image` and image inpainting.",id:"ArtGAN/Stable-Diffusion-ControlNet-WebUI"},{description:"An application to generate realistic images given photos of a person and a prompt.",id:"InstantX/InstantID"}],summary:"Text-to-image is the task of generating images from input text. These pipelines can also be used to modify and edit images based on text prompts.",widgetModels:["black-forest-labs/FLUX.1-dev"],youtubeId:""},coe={canonicalId:"text-to-audio",datasets:[{description:"10K hours of multi-speaker English dataset.",id:"parler-tts/mls_eng_10k"},{description:"Multi-speaker English dataset.",id:"mythicinfinity/libritts_r"},{description:"Multi-lingual dataset.",id:"facebook/multilingual_librispeech"}],demo:{inputs:[{label:"Input",content:"I love audio models on the Hub!",type:"text"}],outputs:[{filename:"audio.wav",type:"audio"}]},metrics:[{description:"The Mel Cepstral Distortion (MCD) metric is used to calculate the quality of generated speech.",id:"mel cepstral distortion"}],models:[{description:"A prompt based, powerful TTS model.",id:"parler-tts/parler-tts-large-v1"},{description:"A powerful TTS model that supports English and Chinese.",id:"SWivid/F5-TTS"},{description:"A massively multi-lingual TTS model.",id:"fishaudio/fish-speech-1.5"},{description:"A powerful TTS model.",id:"OuteAI/OuteTTS-0.1-350M"},{description:"Small yet powerful TTS model.",id:"hexgrad/Kokoro-82M"}],spaces:[{description:"An application for generate high quality speech in different languages.",id:"hexgrad/Kokoro-TTS"},{description:"A multilingual text-to-speech application.",id:"fishaudio/fish-speech-1"},{description:"An application that generates speech in different styles in English and Chinese.",id:"mrfakename/E2-F5-TTS"},{description:"An application that synthesizes emotional speech for diverse speaker prompts.",id:"parler-tts/parler-tts-expresso"},{description:"An application that generates podcast episodes.",id:"ngxson/kokoro-podcast-generator"}],summary:"Text-to-Speech (TTS) is the task of generating natural sounding speech given text input. TTS models can be extended to have a single model that generates speech for multiple speakers and multiple languages.",widgetModels:["suno/bark"],youtubeId:"NW62DpzJ274"},hoe={datasets:[{description:"A widely used dataset useful to benchmark named entity recognition models.",id:"eriktks/conll2003"},{description:"A multilingual dataset of Wikipedia articles annotated for named entity recognition in over 150 different languages.",id:"unimelb-nlp/wikiann"}],demo:{inputs:[{label:"Input",content:"My name is Omar and I live in Zürich.",type:"text"}],outputs:[{text:"My name is Omar and I live in Zürich.",tokens:[{type:"PERSON",start:11,end:15},{type:"GPE",start:30,end:36}],type:"text-with-tokens"}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"",id:"f1"}],models:[{description:"A robust performance model to identify people, locations, organizations and names of miscellaneous entities.",id:"dslim/bert-base-NER"},{description:"A strong model to identify people, locations, organizations and names in multiple languages.",id:"FacebookAI/xlm-roberta-large-finetuned-conll03-english"},{description:"A token classification model specialized on medical entity recognition.",id:"blaze999/Medical-NER"},{description:"Flair models are typically the state of the art in named entity recognition tasks.",id:"flair/ner-english"}],spaces:[{description:"An application that can recognizes entities, extracts noun chunks and recognizes various linguistic features of each token.",id:"spacy/gradio_pipeline_visualizer"}],summary:"Token classification is a natural language understanding task in which a label is assigned to some tokens in a text. Some popular token classification subtasks are Named Entity Recognition (NER) and Part-of-Speech (PoS) tagging. NER models could be trained to identify specific entities in a text, such as dates, individuals and places; and PoS tagging would identify, for example, which words in a text are verbs, nouns, and punctuation marks.",widgetModels:["FacebookAI/xlm-roberta-large-finetuned-conll03-english"],youtubeId:"wVHdVlPScxA"},doe={canonicalId:"text2text-generation",datasets:[{description:"A dataset of copyright-free books translated into 16 different languages.",id:"Helsinki-NLP/opus_books"},{description:"An example of translation between programming languages. This dataset consists of functions in Java and C#.",id:"google/code_x_glue_cc_code_to_code_trans"}],demo:{inputs:[{label:"Input",content:"My name is Omar and I live in Zürich.",type:"text"}],outputs:[{label:"Output",content:"Mein Name ist Omar und ich wohne in Zürich.",type:"text"}]},metrics:[{description:"BLEU score is calculated by counting the number of shared single or subsequent tokens between the generated sequence and the reference. Subsequent n tokens are called “n-grams”. Unigram refers to a single token while bi-gram refers to token pairs and n-grams refer to n subsequent tokens. The score ranges from 0 to 1, where 1 means the translation perfectly matched and 0 did not match at all",id:"bleu"},{description:"",id:"sacrebleu"}],models:[{description:"Very powerful model that can translate many languages between each other, especially low-resource languages.",id:"facebook/nllb-200-1.3B"},{description:"A general-purpose Transformer that can be used to translate from English to German, French, or Romanian.",id:"google-t5/t5-base"}],spaces:[{description:"An application that can translate between 100 languages.",id:"Iker/Translate-100-languages"},{description:"An application that can translate between many languages.",id:"Geonmo/nllb-translation-demo"}],summary:"Translation is the task of converting text from one language to another.",widgetModels:["facebook/mbart-large-50-many-to-many-mmt"],youtubeId:"1JvfrvZgi6c"},foe={datasets:[{description:"A widely used dataset used to benchmark multiple variants of text classification.",id:"nyu-mll/glue"},{description:"A text classification dataset used to benchmark natural language inference models",id:"stanfordnlp/snli"}],demo:{inputs:[{label:"Input",content:"I love Hugging Face!",type:"text"}],outputs:[{type:"chart",data:[{label:"POSITIVE",score:.9},{label:"NEUTRAL",score:.1},{label:"NEGATIVE",score:0}]}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"The F1 metric is the harmonic mean of the precision and recall. It can be calculated as: F1 = 2 * (precision * recall) / (precision + recall)",id:"f1"}],models:[{description:"A robust model trained for sentiment analysis.",id:"distilbert/distilbert-base-uncased-finetuned-sst-2-english"},{description:"A sentiment analysis model specialized in financial sentiment.",id:"ProsusAI/finbert"},{description:"A sentiment analysis model specialized in analyzing tweets.",id:"cardiffnlp/twitter-roberta-base-sentiment-latest"},{description:"A model that can classify languages.",id:"papluca/xlm-roberta-base-language-detection"},{description:"A model that can classify text generation attacks.",id:"meta-llama/Prompt-Guard-86M"}],spaces:[{description:"An application that can classify financial sentiment.",id:"IoannisTr/Tech_Stocks_Trading_Assistant"},{description:"A dashboard that contains various text classification tasks.",id:"miesnerjacob/Multi-task-NLP"},{description:"An application that analyzes user reviews in healthcare.",id:"spacy/healthsea-demo"}],summary:"Text Classification is the task of assigning a label or class to a given text. Some use cases are sentiment analysis, natural language inference, and assessing grammatical correctness.",widgetModels:["distilbert/distilbert-base-uncased-finetuned-sst-2-english"],youtubeId:"leNG9fN9FQU"},poe={datasets:[{description:"Multilingual dataset used to evaluate text generation models.",id:"CohereForAI/Global-MMLU"},{description:"High quality multilingual data used to train text-generation models.",id:"HuggingFaceFW/fineweb-2"},{description:"Truly open-source, curated and cleaned dialogue dataset.",id:"HuggingFaceH4/ultrachat_200k"},{description:"A reasoning dataset.",id:"open-r1/OpenThoughts-114k-math"},{description:"A multilingual instruction dataset with preference ratings on responses.",id:"allenai/tulu-3-sft-mixture"},{description:"A large synthetic dataset for alignment of text generation models.",id:"HuggingFaceTB/smoltalk"},{description:"A dataset made for training text generation models solving math questions.",id:"HuggingFaceTB/finemath"}],demo:{inputs:[{label:"Input",content:"Once upon a time,",type:"text"}],outputs:[{label:"Output",content:"Once upon a time, we knew that our ancestors were on the verge of extinction. The great explorers and poets of the Old World, from Alexander the Great to Chaucer, are dead and gone. A good many of our ancient explorers and poets have",type:"text"}]},metrics:[{description:"Cross Entropy is a metric that calculates the difference between two probability distributions. Each probability distribution is the distribution of predicted words",id:"Cross Entropy"},{description:"The Perplexity metric is the exponential of the cross-entropy loss. It evaluates the probabilities assigned to the next word by the model. Lower perplexity indicates better performance",id:"Perplexity"}],models:[{description:"A text-generation model trained to follow instructions.",id:"google/gemma-2-2b-it"},{description:"Smaller variant of one of the most powerful models.",id:"deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"},{description:"Very powerful text generation model trained to follow instructions.",id:"meta-llama/Meta-Llama-3.1-8B-Instruct"},{description:"Powerful text generation model by Microsoft.",id:"microsoft/phi-4"},{description:"A very powerful model with reasoning capabilities.",id:"simplescaling/s1.1-32B"},{description:"Strong conversational model that supports very long instructions.",id:"Qwen/Qwen2.5-7B-Instruct-1M"},{description:"Text generation model used to write code.",id:"Qwen/Qwen2.5-Coder-32B-Instruct"},{description:"Powerful reasoning based open large language model.",id:"deepseek-ai/DeepSeek-R1"}],spaces:[{description:"A leaderboard to compare different open-source text generation models based on various benchmarks.",id:"open-llm-leaderboard/open_llm_leaderboard"},{description:"A leaderboard for comparing chain-of-thought performance of models.",id:"logikon/open_cot_leaderboard"},{description:"An text generation based application based on a very powerful LLaMA2 model.",id:"ysharma/Explore_llamav2_with_TGI"},{description:"An text generation based application to converse with Zephyr model.",id:"HuggingFaceH4/zephyr-chat"},{description:"A leaderboard that ranks text generation models based on blind votes from people.",id:"lmsys/chatbot-arena-leaderboard"},{description:"An chatbot to converse with a very powerful text generation model.",id:"mlabonne/phixtral-chat"}],summary:"Generating text is the task of generating new text given another text. These models can, for example, fill in incomplete text or paraphrase.",widgetModels:["mistralai/Mistral-Nemo-Instruct-2407"],youtubeId:"e9gNEAlsOvU"},moe={datasets:[{description:"Bing queries with relevant passages from various web sources.",id:"microsoft/ms_marco"}],demo:{inputs:[{label:"Source sentence",content:"Machine learning is so easy.",type:"text"},{label:"Sentences to compare to",content:"Deep learning is so straightforward.",type:"text"},{label:"",content:"This is so difficult, like rocket science.",type:"text"},{label:"",content:"I can't believe how much I struggled with this.",type:"text"}],outputs:[{type:"chart",data:[{label:"Deep learning is so straightforward.",score:2.2006407},{label:"This is so difficult, like rocket science.",score:-6.2634873},{label:"I can't believe how much I struggled with this.",score:-10.251488}]}]},metrics:[{description:"Discounted Cumulative Gain (DCG) measures the gain, or usefulness, of search results discounted by their position. The normalization is done by dividing the DCG by the ideal DCG, which is the DCG of the perfect ranking.",id:"Normalized Discounted Cumulative Gain"},{description:"Reciprocal Rank is a measure used to rank the relevancy of documents given a set of documents. Reciprocal Rank is the reciprocal of the rank of the document retrieved, meaning, if the rank is 3, the Reciprocal Rank is 0.33. If the rank is 1, the Reciprocal Rank is 1",id:"Mean Reciprocal Rank"},{description:"Mean Average Precision (mAP) is the overall average of the Average Precision (AP) values, where AP is the Area Under the PR Curve (AUC-PR)",id:"Mean Average Precision"}],models:[{description:"An extremely efficient text ranking model trained on a web search dataset.",id:"cross-encoder/ms-marco-MiniLM-L6-v2"},{description:"A strong multilingual text reranker model.",id:"Alibaba-NLP/gte-multilingual-reranker-base"},{description:"An efficient text ranking model that punches above its weight.",id:"Alibaba-NLP/gte-reranker-modernbert-base"}],spaces:[],summary:"Text Ranking is the task of ranking a set of texts based on their relevance to a query. Text ranking models are trained on large datasets of queries and relevant documents to learn how to rank documents based on their relevance to the query. This task is particularly useful for search engines and information retrieval systems.",widgetModels:["cross-encoder/ms-marco-MiniLM-L6-v2"],youtubeId:""},goe={datasets:[{description:"Microsoft Research Video to Text is a large-scale dataset for open domain video captioning",id:"iejMac/CLIP-MSR-VTT"},{description:"UCF101 Human Actions dataset consists of 13,320 video clips from YouTube, with 101 classes.",id:"quchenyuan/UCF101-ZIP"},{description:"A high-quality dataset for human action recognition in YouTube videos.",id:"nateraw/kinetics"},{description:"A dataset of video clips of humans performing pre-defined basic actions with everyday objects.",id:"HuggingFaceM4/something_something_v2"},{description:"This dataset consists of text-video pairs and contains noisy samples with irrelevant video descriptions",id:"HuggingFaceM4/webvid"},{description:"A dataset of short Flickr videos for the temporal localization of events with descriptions.",id:"iejMac/CLIP-DiDeMo"}],demo:{inputs:[{label:"Input",content:"Darth Vader is surfing on the waves.",type:"text"}],outputs:[{filename:"text-to-video-output.gif",type:"img"}]},metrics:[{description:"Inception Score uses an image classification model that predicts class labels and evaluates how distinct and diverse the images are. A higher score indicates better video generation.",id:"is"},{description:"Frechet Inception Distance uses an image classification model to obtain image embeddings. The metric compares mean and standard deviation of the embeddings of real and generated images. A smaller score indicates better video generation.",id:"fid"},{description:"Frechet Video Distance uses a model that captures coherence for changes in frames and the quality of each frame. A smaller score indicates better video generation.",id:"fvd"},{description:"CLIPSIM measures similarity between video frames and text using an image-text similarity model. A higher score indicates better video generation.",id:"clipsim"}],models:[{description:"A strong model for consistent video generation.",id:"tencent/HunyuanVideo"},{description:"A text-to-video model with high fidelity motion and strong prompt adherence.",id:"Lightricks/LTX-Video"},{description:"A text-to-video model focusing on physics-aware applications like robotics.",id:"nvidia/Cosmos-1.0-Diffusion-7B-Text2World"},{description:"A robust model for video generation.",id:"Wan-AI/Wan2.1-T2V-1.3B"}],spaces:[{description:"An application that generates video from text.",id:"VideoCrafter/VideoCrafter"},{description:"Consistent video generation application.",id:"Wan-AI/Wan2.1"},{description:"A cutting edge video generation application.",id:"Pyramid-Flow/pyramid-flow"}],summary:"Text-to-video models can be used in any application that requires generating consistent sequence of images from text. ",widgetModels:["Wan-AI/Wan2.1-T2V-14B"],youtubeId:void 0},voe={datasets:[{description:"The CIFAR-100 dataset consists of 60000 32x32 colour images in 100 classes, with 600 images per class.",id:"cifar100"},{description:"Multiple images of celebrities, used for facial expression translation.",id:"CelebA"}],demo:{inputs:[{label:"Seed",content:"42",type:"text"},{label:"Number of images to generate:",content:"4",type:"text"}],outputs:[{filename:"unconditional-image-generation-output.jpeg",type:"img"}]},metrics:[{description:"The inception score (IS) evaluates the quality of generated images. It measures the diversity of the generated images (the model predictions are evenly distributed across all possible labels) and their 'distinction' or 'sharpness' (the model confidently predicts a single label for each image).",id:"Inception score (IS)"},{description:"The Fréchet Inception Distance (FID) evaluates the quality of images created by a generative model by calculating the distance between feature vectors for real and generated images.",id:"Frećhet Inception Distance (FID)"}],models:[{description:"High-quality image generation model trained on the CIFAR-10 dataset. It synthesizes images of the ten classes presented in the dataset using diffusion probabilistic models, a class of latent variable models inspired by considerations from nonequilibrium thermodynamics.",id:"google/ddpm-cifar10-32"},{description:"High-quality image generation model trained on the 256x256 CelebA-HQ dataset. It synthesizes images of faces using diffusion probabilistic models, a class of latent variable models inspired by considerations from nonequilibrium thermodynamics.",id:"google/ddpm-celebahq-256"}],spaces:[{description:"An application that can generate realistic faces.",id:"CompVis/celeba-latent-diffusion"}],summary:"Unconditional image generation is the task of generating images with no condition in any context (like a prompt text or another image). Once trained, the model will create images that resemble its training data distribution.",widgetModels:[""],youtubeId:""},yoe={datasets:[{description:"Benchmark dataset used for video classification with videos that belong to 400 classes.",id:"kinetics400"}],demo:{inputs:[{filename:"video-classification-input.gif",type:"img"}],outputs:[{type:"chart",data:[{label:"Playing Guitar",score:.514},{label:"Playing Tennis",score:.193},{label:"Cooking",score:.068}]}]},metrics:[{description:"",id:"accuracy"},{description:"",id:"recall"},{description:"",id:"precision"},{description:"",id:"f1"}],models:[{description:"Strong Video Classification model trained on the Kinetics 400 dataset.",id:"google/vivit-b-16x2-kinetics400"},{description:"Strong Video Classification model trained on the Kinetics 400 dataset.",id:"microsoft/xclip-base-patch32"}],spaces:[{description:"An application that classifies video at different timestamps.",id:"nateraw/lavila"},{description:"An application that classifies video.",id:"fcakyon/video-classification"}],summary:"Video classification is the task of assigning a label or class to an entire video. Videos are expected to have only one class for each video. Video classification models take a video as input and return a prediction about which class the video belongs to.",widgetModels:[],youtubeId:""},xoe={datasets:[{description:"A widely used dataset containing questions (with answers) about images.",id:"Graphcore/vqa"},{description:"A dataset to benchmark visual reasoning based on text in images.",id:"facebook/textvqa"}],demo:{inputs:[{filename:"elephant.jpeg",type:"img"},{label:"Question",content:"What is in this image?",type:"text"}],outputs:[{type:"chart",data:[{label:"elephant",score:.97},{label:"elephants",score:.06},{label:"animal",score:.003}]}]},isPlaceholder:!1,metrics:[{description:"",id:"accuracy"},{description:"Measures how much a predicted answer differs from the ground truth based on the difference in their semantic meaning.",id:"wu-palmer similarity"}],models:[{description:"A visual question answering model trained to convert charts and plots to text.",id:"google/deplot"},{description:"A visual question answering model trained for mathematical reasoning and chart derendering from images.",id:"google/matcha-base"},{description:"A strong visual question answering that answers questions from book covers.",id:"google/pix2struct-ocrvqa-large"}],spaces:[{description:"An application that compares visual question answering models across different tasks.",id:"merve/pix2struct"},{description:"An application that can answer questions based on images.",id:"nielsr/vilt-vqa"},{description:"An application that can caption images and answer questions about a given image. ",id:"Salesforce/BLIP"},{description:"An application that can caption images and answer questions about a given image. ",id:"vumichien/Img2Prompt"}],summary:"Visual Question Answering is the task of answering open-ended questions based on an image. They output natural language responses to natural language questions.",widgetModels:["dandelin/vilt-b32-finetuned-vqa"],youtubeId:""},boe={datasets:[{description:"A widely used dataset used to benchmark multiple variants of text classification.",id:"nyu-mll/glue"},{description:"The Multi-Genre Natural Language Inference (MultiNLI) corpus is a crowd-sourced collection of 433k sentence pairs annotated with textual entailment information.",id:"nyu-mll/multi_nli"},{description:"FEVER is a publicly available dataset for fact extraction and verification against textual sources.",id:"fever/fever"}],demo:{inputs:[{label:"Text Input",content:"Dune is the best movie ever.",type:"text"},{label:"Candidate Labels",content:"CINEMA, ART, MUSIC",type:"text"}],outputs:[{type:"chart",data:[{label:"CINEMA",score:.9},{label:"ART",score:.1},{label:"MUSIC",score:0}]}]},metrics:[],models:[{description:"Powerful zero-shot text classification model.",id:"facebook/bart-large-mnli"},{description:"Cutting-edge zero-shot multilingual text classification model.",id:"MoritzLaurer/ModernBERT-large-zeroshot-v2.0"},{description:"Zero-shot text classification model that can be used for topic and sentiment classification.",id:"knowledgator/gliclass-modern-base-v2.0-init"}],spaces:[],summary:"Zero-shot text classification is a task in natural language processing where a model is trained on a set of labeled examples but is then able to classify new examples from previously unseen classes.",widgetModels:["facebook/bart-large-mnli"]},woe={datasets:[{description:"",id:""}],demo:{inputs:[{filename:"image-classification-input.jpeg",type:"img"},{label:"Classes",content:"cat, dog, bird",type:"text"}],outputs:[{type:"chart",data:[{label:"Cat",score:.664},{label:"Dog",score:.329},{label:"Bird",score:.008}]}]},metrics:[{description:"Computes the number of times the correct label appears in top K labels predicted",id:"top-K accuracy"}],models:[{description:"Multilingual image classification model for 80 languages.",id:"visheratin/mexma-siglip"},{description:"Strong zero-shot image classification model.",id:"google/siglip2-base-patch16-224"},{description:"Robust zero-shot image classification model.",id:"intfloat/mmE5-mllama-11b-instruct"},{description:"Powerful zero-shot image classification model supporting 94 languages.",id:"jinaai/jina-clip-v2"},{description:"Strong image classification model for biomedical domain.",id:"microsoft/BiomedCLIP-PubMedBERT_256-vit_base_patch16_224"}],spaces:[{description:"An application that leverages zero-shot image classification to find best captions to generate an image. ",id:"pharma/CLIP-Interrogator"},{description:"An application to compare different zero-shot image classification models. ",id:"merve/compare_clip_siglip"}],summary:"Zero-shot image classification is the task of classifying previously unseen classes during training of a model.",widgetModels:["google/siglip-so400m-patch14-224"],youtubeId:""},_oe={datasets:[],demo:{inputs:[{filename:"zero-shot-object-detection-input.jpg",type:"img"},{label:"Classes",content:"cat, dog, bird",type:"text"}],outputs:[{filename:"zero-shot-object-detection-output.jpg",type:"img"}]},metrics:[{description:"The Average Precision (AP) metric is the Area Under the PR Curve (AUC-PR). It is calculated for each class separately",id:"Average Precision"},{description:"The Mean Average Precision (mAP) metric is the overall average of the AP values",id:"Mean Average Precision"},{description:"The APα metric is the Average Precision at the IoU threshold of a α value, for example, AP50 and AP75",id:"APα"}],models:[{description:"Solid zero-shot object detection model.",id:"IDEA-Research/grounding-dino-base"},{description:"Cutting-edge zero-shot object detection model.",id:"google/owlv2-base-patch16-ensemble"}],spaces:[{description:"A demo to try the state-of-the-art zero-shot object detection model, OWLv2.",id:"merve/owlv2"},{description:"A demo that combines a zero-shot object detection and mask generation model for zero-shot segmentation.",id:"merve/OWLSAM"}],summary:"Zero-shot object detection is a computer vision task to detect objects and their classes in images, without any prior training or knowledge of the classes. Zero-shot object detection models receive an image as input, as well as a list of candidate classes, and output the bounding boxes and labels where the objects have been detected.",widgetModels:[],youtubeId:""},koe={datasets:[{description:"A large dataset of over 10 million 3D objects.",id:"allenai/objaverse-xl"},{description:"A dataset of isolated object images for evaluating image-to-3D models.",id:"dylanebert/iso3d"}],demo:{inputs:[{filename:"image-to-3d-image-input.png",type:"img"}],outputs:[{label:"Result",content:"image-to-3d-3d-output-filename.glb",type:"text"}]},metrics:[],models:[{description:"Fast image-to-3D mesh model by Tencent.",id:"TencentARC/InstantMesh"},{description:"Fast image-to-3D mesh model by StabilityAI",id:"stabilityai/TripoSR"},{description:"A scaled up image-to-3D mesh model derived from TripoSR.",id:"hwjiang/Real3D"},{description:"Consistent image-to-3d generation model.",id:"stabilityai/stable-point-aware-3d"}],spaces:[{description:"Leaderboard to evaluate image-to-3D models.",id:"dylanebert/3d-arena"},{description:"Image-to-3D demo with mesh outputs.",id:"TencentARC/InstantMesh"},{description:"Image-to-3D demo.",id:"stabilityai/stable-point-aware-3d"},{description:"Image-to-3D demo with mesh outputs.",id:"hwjiang/Real3D"},{description:"Image-to-3D demo with splat outputs.",id:"dylanebert/LGM-mini"}],summary:"Image-to-3D models take in image input and produce 3D output.",widgetModels:[],youtubeId:""},Coe={datasets:[{description:"A large dataset of over 10 million 3D objects.",id:"allenai/objaverse-xl"},{description:"Descriptive captions for 3D objects in Objaverse.",id:"tiange/Cap3D"}],demo:{inputs:[{label:"Prompt",content:"a cat statue",type:"text"}],outputs:[{label:"Result",content:"text-to-3d-3d-output-filename.glb",type:"text"}]},metrics:[],models:[{description:"Text-to-3D mesh model by OpenAI",id:"openai/shap-e"},{description:"Generative 3D gaussian splatting model.",id:"ashawkey/LGM"}],spaces:[{description:"Text-to-3D demo with mesh outputs.",id:"hysts/Shap-E"},{description:"Text/image-to-3D demo with splat outputs.",id:"ashawkey/LGM"}],summary:"Text-to-3D models take in text input and produce 3D output.",widgetModels:[],youtubeId:""},Ioe={datasets:[{description:"A dataset of hand keypoints of over 500k examples.",id:"Vincent-luo/hagrid-mediapipe-hands"}],demo:{inputs:[{filename:"keypoint-detection-input.png",type:"img"}],outputs:[{filename:"keypoint-detection-output.png",type:"img"}]},metrics:[],models:[{description:"A robust keypoint detection model.",id:"magic-leap-community/superpoint"},{description:"A robust keypoint matching model.",id:"magic-leap-community/superglue_outdoor"},{description:"Strong keypoint detection model used to detect human pose.",id:"facebook/sapiens-pose-1b"},{description:"Powerful keypoint detection model used to detect human pose.",id:"usyd-community/vitpose-plus-base"}],spaces:[{description:"An application that detects hand keypoints in real-time.",id:"datasciencedojo/Hand-Keypoint-Detection-Realtime"},{description:"An application to try a universal keypoint detection model.",id:"merve/SuperPoint"}],summary:"Keypoint detection is the task of identifying meaningful distinctive points or features in an image.",widgetModels:[],youtubeId:""},Soe={datasets:[{description:"Multiple-choice questions and answers about videos.",id:"lmms-lab/Video-MME"},{description:"A dataset of instructions and question-answer pairs about videos.",id:"lmms-lab/VideoChatGPT"},{description:"Large video understanding dataset.",id:"HuggingFaceFV/finevideo"}],demo:{inputs:[{filename:"video-text-to-text-input.gif",type:"img"},{label:"Text Prompt",content:"What is happening in this video?",type:"text"}],outputs:[{label:"Answer",content:"The video shows a series of images showing a fountain with water jets and a variety of colorful flowers and butterflies in the background.",type:"text"}]},metrics:[],models:[{description:"A robust video-text-to-text model.",id:"Vision-CAIR/LongVU_Qwen2_7B"},{description:"Strong video-text-to-text model with reasoning capabilities.",id:"GoodiesHere/Apollo-LMMs-Apollo-7B-t32"},{description:"Strong video-text-to-text model.",id:"HuggingFaceTB/SmolVLM2-2.2B-Instruct"}],spaces:[{description:"An application to chat with a video-text-to-text model.",id:"llava-hf/video-llava"},{description:"A leaderboard for various video-text-to-text models.",id:"opencompass/openvlm_video_leaderboard"},{description:"An application to generate highlights from a video.",id:"HuggingFaceTB/SmolVLM2-HighlightGenerator"}],summary:"Video-text-to-text models take in a video and a text prompt and output text. These models are also called video-language models.",widgetModels:[""],youtubeId:""},Eoe={"audio-classification":["speechbrain","transformers","transformers.js"],"audio-to-audio":["asteroid","fairseq","speechbrain"],"automatic-speech-recognition":["espnet","nemo","speechbrain","transformers","transformers.js"],"audio-text-to-text":[],"depth-estimation":["transformers","transformers.js"],"document-question-answering":["transformers","transformers.js"],"feature-extraction":["sentence-transformers","transformers","transformers.js"],"fill-mask":["transformers","transformers.js"],"graph-ml":["transformers"],"image-classification":["keras","timm","transformers","transformers.js"],"image-feature-extraction":["timm","transformers"],"image-segmentation":["transformers","transformers.js"],"image-text-to-text":["transformers"],"image-to-image":["diffusers","transformers","transformers.js"],"image-to-text":["transformers","transformers.js"],"image-to-video":["diffusers"],"keypoint-detection":["transformers"],"video-classification":["transformers"],"mask-generation":["transformers"],"multiple-choice":["transformers"],"object-detection":["transformers","transformers.js","ultralytics"],other:[],"question-answering":["adapter-transformers","allennlp","transformers","transformers.js"],robotics:[],"reinforcement-learning":["transformers","stable-baselines3","ml-agents","sample-factory"],"sentence-similarity":["sentence-transformers","spacy","transformers.js"],summarization:["transformers","transformers.js"],"table-question-answering":["transformers"],"table-to-text":["transformers"],"tabular-classification":["sklearn"],"tabular-regression":["sklearn"],"tabular-to-text":["transformers"],"text-classification":["adapter-transformers","setfit","spacy","transformers","transformers.js"],"text-generation":["transformers","transformers.js"],"text-ranking":["sentence-transformers","transformers"],"text-retrieval":[],"text-to-image":["diffusers"],"text-to-speech":["espnet","tensorflowtts","transformers","transformers.js"],"text-to-audio":["transformers","transformers.js"],"text-to-video":["diffusers"],"text2text-generation":["transformers","transformers.js"],"time-series-forecasting":[],"token-classification":["adapter-transformers","flair","spacy","span-marker","stanza","transformers","transformers.js"],translation:["transformers","transformers.js"],"unconditional-image-generation":["diffusers"],"video-text-to-text":["transformers"],"visual-question-answering":["transformers","transformers.js"],"voice-activity-detection":[],"zero-shot-classification":["transformers","transformers.js"],"zero-shot-image-classification":["transformers","transformers.js"],"zero-shot-object-detection":["transformers","transformers.js"],"text-to-3d":["diffusers"],"image-to-3d":["diffusers"],"any-to-any":["transformers"],"visual-document-retrieval":["transformers"]};function dt(n,e=ib){return{...e,id:n,label:uN[n].name,libraries:Eoe[n]}}dt("any-to-any",ib),dt("audio-classification",zie),dt("audio-to-audio",Uie),dt("audio-text-to-text",ib),dt("automatic-speech-recognition",jie),dt("depth-estimation",toe),dt("document-question-answering",Wie),dt("visual-document-retrieval",ib),dt("feature-extraction",Hie),dt("fill-mask",Gie),dt("image-classification",qie),dt("image-feature-extraction",Kie),dt("image-segmentation",Jie),dt("image-to-image",Xie),dt("image-text-to-text",Qie),dt("image-to-text",Yie),dt("keypoint-detection",Ioe),dt("mask-generation",Zie),dt("object-detection",eoe),dt("video-classification",yoe),dt("question-answering",roe),dt("reinforcement-learning",noe),dt("sentence-similarity",soe),dt("summarization",ioe),dt("table-question-answering",ooe),dt("tabular-classification",aoe),dt("tabular-regression",loe),dt("text-classification",foe),dt("text-generation",poe),dt("text-ranking",moe),dt("text-to-image",uoe),dt("text-to-speech",coe),dt("text-to-video",goe),dt("token-classification",hoe),dt("translation",doe),dt("unconditional-image-generation",voe),dt("video-text-to-text",Soe),dt("visual-question-answering",xoe),dt("zero-shot-classification",boe),dt("zero-shot-image-classification",woe),dt("zero-shot-object-detection",_oe),dt("text-to-3d",Coe),dt("image-to-3d",koe);const Toe=()=>'"Hi, I recently bought a device from your company but it is not working as advertised and I would like to get reimbursed!"',Noe=()=>'"Меня зовут Вольфганг и я живу в Берлине"',Aoe=()=>'"The tower is 324 metres (1,063 ft) tall, about the same height as an 81-storey building, and the tallest structure in Paris. Its base is square, measuring 125 metres (410 ft) on each side. During its construction, the Eiffel Tower surpassed the Washington Monument to become the tallest man-made structure in the world, a title it held for 41 years until the Chrysler Building in New York City was finished in 1930. It was the first structure to reach a height of 300 metres. Due to the addition of a broadcasting aerial at the top of the tower in 1957, it is now taller than the Chrysler Building by 5.2 metres (17 ft). Excluding transmitters, the Eiffel Tower is the second tallest free-standing structure in France after the Millau Viaduct."',Roe=()=>`{
    "query": "How many stars does the transformers repository have?",
    "table": {
        "Repository": ["Transformers", "Datasets", "Tokenizers"],
        "Stars": ["36542", "4512", "3934"],
        "Contributors": ["651", "77", "34"],
        "Programming language": [
            "Python",
            "Python",
            "Rust, Python and NodeJS"
        ]
    }
}`,Doe=()=>`{
        "image": "cat.png",
        "question": "What is in this image?"
    }`,$oe=()=>`{
    "question": "What is my name?",
    "context": "My name is Clara and I live in Berkeley."
}`,Poe=()=>'"I like you. I love you"',Ooe=()=>'"My name is Sarah Jessica Parker but you can call me Jessica"',RM=n=>n.tags.includes("conversational")?n.pipeline_tag==="text-generation"?[{role:"user",content:"What is the capital of France?"}]:[{role:"user",content:[{type:"text",text:"Describe this image in one sentence."},{type:"image_url",image_url:{url:"https://cdn.britannica.com/61/93061-050-99147DCE/Statue-of-Liberty-Island-New-York-Bay.jpg"}}]}]:'"Can you please let us know more details about your "',Foe=()=>'"The answer to the universe is"',Moe=n=>`"The answer to the universe is ${n.mask_token}."`,Loe=()=>`{
    "source_sentence": "That is a happy person",
    "sentences": [
        "That is a happy dog",
        "That is a very happy person",
        "Today is a sunny day"
    ]
}`,Boe=()=>'"Today is a sunny day and I will get some ice cream."',Voe=()=>'"cats.jpg"',zoe=()=>'"cats.jpg"',Uoe=()=>`{
    "image": "cat.png",
    "prompt": "Turn the cat into a tiger."
}`,joe=()=>'"cats.jpg"',Woe=()=>'"cats.jpg"',Hoe=()=>'"sample1.flac"',Goe=()=>'"sample1.flac"',qoe=()=>'"Astronaut riding a horse"',Koe=()=>'"A young man walking on the street"',Xoe=()=>'"The answer to the universe is 42"',Yoe=()=>'"liquid drum and bass, atmospheric synths, airy sounds"',Qoe=()=>'"sample1.flac"',DM=()=>`'{"Height":[11.52,12.48],"Length1":[23.2,24.0],"Length2":[25.4,26.3],"Species": ["Bream","Bream"]}'`,Joe=()=>'"cats.jpg"',Zoe={"audio-to-audio":Hoe,"audio-classification":Goe,"automatic-speech-recognition":Qoe,"document-question-answering":Doe,"feature-extraction":Boe,"fill-mask":Moe,"image-classification":Voe,"image-to-text":zoe,"image-to-image":Uoe,"image-segmentation":joe,"object-detection":Woe,"question-answering":$oe,"sentence-similarity":Loe,summarization:Aoe,"table-question-answering":Roe,"tabular-regression":DM,"tabular-classification":DM,"text-classification":Poe,"text-generation":RM,"image-text-to-text":RM,"text-to-image":qoe,"text-to-video":Koe,"text-to-speech":Xoe,"text-to-audio":Yoe,"text2text-generation":Foe,"token-classification":Ooe,translation:Noe,"zero-shot-classification":Toe,"zero-shot-image-classification":Joe};function Tv(n,e=!1,t=!1){if(n.pipeline_tag){const r=Zoe[n.pipeline_tag];if(r){let s=r(n);if(typeof s=="string"&&(e&&(s=s.replace(/(?:(?:\r?\n|\r)\t*)|\t+/g," ")),t)){const i=/^"(.+)"$/s,o=s.match(i);s=o?o[1]:s}return s}}return"No input example has been defined for this model task."}function eae(n,e){let t=JSON.stringify(n,null,"	");return e!=null&&e.indent&&(t=t.replaceAll(`
`,`
${e.indent}`)),e!=null&&e.attributeKeyQuotes||(t=t.replace(/"([^"]+)":/g,"$1:")),e!=null&&e.customContentEscaper&&(t=e.customContentEscaper(t)),t}const $j="custom_code";function mu(n){const e=n.split("/");return e.length===1?e[0]:e[1]}const tae=n=>JSON.stringify(n).slice(1,-1),nae=n=>{var e,t;return[`from adapters import AutoAdapterModel

model = AutoAdapterModel.from_pretrained("${(t=(e=n.config)==null?void 0:e.adapter_transformers)==null?void 0:t.model_name}")
model.load_adapter("${n.id}", set_active=True)`]},rae=n=>[`import allennlp_models
from allennlp.predictors.predictor import Predictor

predictor = Predictor.from_path("hf://${n.id}")`],sae=n=>[`import allennlp_models
from allennlp.predictors.predictor import Predictor

predictor = Predictor.from_path("hf://${n.id}")
predictor_input = {"passage": "My name is Wolfgang and I live in Berlin", "question": "Where do I live?"}
predictions = predictor.predict_json(predictor_input)`],iae=n=>n.tags.includes("question-answering")?sae(n):rae(n),oae=n=>[`from araclip import AraClip

model = AraClip.from_pretrained("${n.id}")`],aae=n=>[`from asteroid.models import BaseModel

model = BaseModel.from_pretrained("${n.id}")`],lae=n=>{const e=`# Watermark Generator
from audioseal import AudioSeal

model = AudioSeal.load_generator("${n.id}")
# pass a tensor (tensor_wav) of shape (batch, channels, samples) and a sample rate
wav, sr = tensor_wav, 16000
	
watermark = model.get_watermark(wav, sr)
watermarked_audio = wav + watermark`,t=`# Watermark Detector
from audioseal import AudioSeal

detector = AudioSeal.load_detector("${n.id}")
	
result, message = detector.detect_watermark(watermarked_audio, sr)`;return[e,t]};function cN(n){var e,t;return((t=(e=n.cardData)==null?void 0:e.base_model)==null?void 0:t.toString())??"fill-in-base-model"}function Pj(n){var t,r,s;const e=((r=(t=n.widgetData)==null?void 0:t[0])==null?void 0:r.text)??((s=n.cardData)==null?void 0:s.instance_prompt);if(e)return tae(e)}const uae=n=>[`import requests
from PIL import Image
from ben2 import AutoModel

url = "https://huggingface.co/datasets/mishig/sample_images/resolve/main/teapot.jpg"
image = Image.open(requests.get(url, stream=True).raw)

model = AutoModel.from_pretrained("${n.id}")
model.to("cuda").eval()
foreground = model.inference(image)
`],cae=n=>[`from bertopic import BERTopic

model = BERTopic.load("${n.id}")`],hae=n=>[`from bm25s.hf import BM25HF

retriever = BM25HF.load_from_hub("${n.id}")`],dae=()=>[`# pip install git+https://github.com/Google-Health/cxr-foundation.git#subdirectory=python

# Load image as grayscale (Stillwaterising, CC0, via Wikimedia Commons)
import requests
from PIL import Image
from io import BytesIO
image_url = "https://upload.wikimedia.org/wikipedia/commons/c/c8/Chest_Xray_PA_3-8-2010.png"
img = Image.open(requests.get(image_url, headers={'User-Agent': 'Demo'}, stream=True).raw).convert('L')

# Run inference
from clientside.clients import make_hugging_face_client
cxr_client = make_hugging_face_client('cxr_model')
print(cxr_client.get_image_embeddings_from_images([img]))`],fae=n=>{let e,t,r;return e="<ENCODER>",t="<NUMBER_OF_FEATURES>",r="<OUT_CHANNELS>",n.id==="depth-anything/Depth-Anything-V2-Small"?(e="vits",t="64",r="[48, 96, 192, 384]"):n.id==="depth-anything/Depth-Anything-V2-Base"?(e="vitb",t="128",r="[96, 192, 384, 768]"):n.id==="depth-anything/Depth-Anything-V2-Large"&&(e="vitl",t="256",r="[256, 512, 1024, 1024"),[`
# Install from https://github.com/DepthAnything/Depth-Anything-V2

# Load the model and infer depth from an image
import cv2
import torch

from depth_anything_v2.dpt import DepthAnythingV2

# instantiate the model
model = DepthAnythingV2(encoder="${e}", features=${t}, out_channels=${r})

# load the weights
filepath = hf_hub_download(repo_id="${n.id}", filename="depth_anything_v2_${e}.pth", repo_type="model")
state_dict = torch.load(filepath, map_location="cpu")
model.load_state_dict(state_dict).eval()

raw_img = cv2.imread("your/image/path")
depth = model.infer_image(raw_img) # HxW raw depth map in numpy
    `]},pae=n=>[`# Download checkpoint
pip install huggingface-hub
huggingface-cli download --local-dir checkpoints ${n.id}`,`import depth_pro

# Load model and preprocessing transform
model, transform = depth_pro.create_model_and_transforms()
model.eval()

# Load and preprocess an image.
image, _, f_px = depth_pro.load_rgb("example.png")
image = transform(image)

# Run inference.
prediction = model.infer(image, f_px=f_px)

# Results: 1. Depth in meters
depth = prediction["depth"]
# Results: 2. Focal length in pixels
focallength_px = prediction["focallength_px"]`],mae=()=>[`from huggingface_hub import from_pretrained_keras
import tensorflow as tf, requests

# Load and format input
IMAGE_URL = "https://storage.googleapis.com/dx-scin-public-data/dataset/images/3445096909671059178.png"
input_tensor = tf.train.Example(
    features=tf.train.Features(
        feature={
            "image/encoded": tf.train.Feature(
                bytes_list=tf.train.BytesList(value=[requests.get(IMAGE_URL, stream=True).content])
            )
        }
    )
).SerializeToString()

# Load model and run inference
loaded_model = from_pretrained_keras("google/derm-foundation")
infer = loaded_model.signatures["serving_default"]
print(infer(inputs=tf.constant([input_tensor])))`],Oj="Astronaut in a jungle, cold color palette, muted colors, detailed, 8k",gae=n=>[`from diffusers import DiffusionPipeline

pipe = DiffusionPipeline.from_pretrained("${n.id}")

prompt = "${Pj(n)??Oj}"
image = pipe(prompt).images[0]`],vae=n=>[`from diffusers import ControlNetModel, StableDiffusionControlNetPipeline

controlnet = ControlNetModel.from_pretrained("${n.id}")
pipe = StableDiffusionControlNetPipeline.from_pretrained(
	"${cN(n)}", controlnet=controlnet
)`],yae=n=>[`from diffusers import DiffusionPipeline

pipe = DiffusionPipeline.from_pretrained("${cN(n)}")
pipe.load_lora_weights("${n.id}")

prompt = "${Pj(n)??Oj}"
image = pipe(prompt).images[0]`],xae=n=>[`from diffusers import DiffusionPipeline

pipe = DiffusionPipeline.from_pretrained("${cN(n)}")
pipe.load_textual_inversion("${n.id}")`],bae=n=>n.tags.includes("controlnet")?vae(n):n.tags.includes("lora")?yae(n):n.tags.includes("textual_inversion")?xae(n):gae(n),wae=n=>{const e=`# Pipeline for Stable Diffusion 3
from diffusionkit.mlx import DiffusionPipeline

pipeline = DiffusionPipeline(
	shift=3.0,
	use_t5=False,
	model_version=${n.id},
	low_memory_mode=True,
	a16=True,
	w16=True,
)`,t=`# Pipeline for Flux
from diffusionkit.mlx import FluxPipeline

pipeline = FluxPipeline(
  shift=1.0,
  model_version=${n.id},
  low_memory_mode=True,
  a16=True,
  w16=True,
)`,r=`# Image Generation
HEIGHT = 512
WIDTH = 512
NUM_STEPS = ${n.tags.includes("flux")?4:50}
CFG_WEIGHT = ${n.tags.includes("flux")?0:5}

image, _ = pipeline.generate_image(
  "a photo of a cat",
  cfg_weight=CFG_WEIGHT,
  num_steps=NUM_STEPS,
  latent_size=(HEIGHT // 8, WIDTH // 8),
)`;return[n.tags.includes("flux")?t:e,r]},_ae=n=>[`# pip install --no-binary :all: cartesia-pytorch
from cartesia_pytorch import ReneLMHeadModel
from transformers import AutoTokenizer

model = ReneLMHeadModel.from_pretrained("${n.id}")
tokenizer = AutoTokenizer.from_pretrained("allenai/OLMo-1B-hf")

in_message = ["Rene Descartes was"]
inputs = tokenizer(in_message, return_tensors="pt")

outputs = model.generate(inputs.input_ids, max_length=50, top_k=100, top_p=0.99)
out_message = tokenizer.batch_decode(outputs, skip_special_tokens=True)[0]

print(out_message)
)`],kae=n=>[`import mlx.core as mx
import cartesia_mlx as cmx

model = cmx.from_pretrained("${n.id}")
model.set_dtype(mx.float32)   

prompt = "Rene Descartes was"

for text in model.generate(
    prompt,
    max_tokens=500,
    eval_every_n=5,
    verbose=True,
    top_p=0.99,
    temperature=0.85,
):
    print(text, end="", flush=True)
`],Cae=n=>{const e=mu(n.id).replaceAll("-","_");return[`# Load it from the Hub directly
import edsnlp
nlp = edsnlp.load("${n.id}")
`,`# Or install it as a package
!pip install git+https://huggingface.co/${n.id}

# and import it as a module
import ${e}

nlp = ${e}.load()  # or edsnlp.load("${e}")
`]},Iae=n=>[`from espnet2.bin.tts_inference import Text2Speech

model = Text2Speech.from_pretrained("${n.id}")

speech, *_ = model("text to generate speech from")`],Sae=n=>[`from espnet2.bin.asr_inference import Speech2Text

model = Speech2Text.from_pretrained(
  "${n.id}"
)

speech, rate = soundfile.read("speech.wav")
text, *_ = model(speech)[0]`],Eae=()=>["unknown model type (must be text-to-speech or automatic-speech-recognition)"],Tae=n=>n.tags.includes("text-to-speech")?Iae(n):n.tags.includes("automatic-speech-recognition")?Sae(n):Eae(),Nae=n=>[`from fairseq.checkpoint_utils import load_model_ensemble_and_task_from_hf_hub

models, cfg, task = load_model_ensemble_and_task_from_hf_hub(
    "${n.id}"
)`],Aae=n=>[`from flair.models import SequenceTagger

tagger = SequenceTagger.load("${n.id}")`],Rae=n=>[`from gliner import GLiNER

model = GLiNER.from_pretrained("${n.id}")`],Dae=n=>[`# CLI usage
# see docs: https://ai-riksarkivet.github.io/htrflow/latest/getting_started/quick_start.html
htrflow pipeline <path/to/pipeline.yaml> <path/to/image>`,`# Python usage
from htrflow.pipeline.pipeline import Pipeline
from htrflow.pipeline.steps import Task
from htrflow.models.framework.model import ModelClass

pipeline = Pipeline(
    [
        Task(
            ModelClass, {"model": "${n.id}"}, {}
        ),
    ])`],$ae=n=>[`# Available backend options are: "jax", "torch", "tensorflow".
import os
os.environ["KERAS_BACKEND"] = "jax"
	
import keras

model = keras.saving.load_model("hf://${n.id}")
`],Pae=n=>`
import keras_hub

# Load CausalLM model (optional: use half precision for inference)
causal_lm = keras_hub.models.CausalLM.from_preset("hf://${n}", dtype="bfloat16")
causal_lm.compile(sampler="greedy")  # (optional) specify a sampler

# Generate text
causal_lm.generate("Keras: deep learning for", max_length=64)
`,Oae=n=>`
import keras_hub

# Load TextToImage model (optional: use half precision for inference)
text_to_image = keras_hub.models.TextToImage.from_preset("hf://${n}", dtype="bfloat16")

# Generate images with a TextToImage model.
text_to_image.generate("Astronaut in a jungle")
`,Fae=n=>`
import keras_hub

# Load TextClassifier model
text_classifier = keras_hub.models.TextClassifier.from_preset(
    "hf://${n}",
    num_classes=2,
)
# Fine-tune
text_classifier.fit(x=["Thilling adventure!", "Total snoozefest."], y=[1, 0])
# Classify text
text_classifier.predict(["Not my cup of tea."])
`,Mae=n=>`
import keras_hub
import keras

# Load ImageClassifier model
image_classifier = keras_hub.models.ImageClassifier.from_preset(
    "hf://${n}",
    num_classes=2,
)
# Fine-tune
image_classifier.fit(
    x=keras.random.randint((32, 64, 64, 3), 0, 256),
    y=keras.random.randint((32, 1), 0, 2),
)
# Classify image
image_classifier.predict(keras.random.randint((1, 64, 64, 3), 0, 256))
`,$M={CausalLM:Pae,TextToImage:Oae,TextClassifier:Fae,ImageClassifier:Mae},Lae=(n,e)=>`
import keras_hub

# Create a ${n} model
task = keras_hub.models.${n}.from_preset("hf://${e}")
`,Bae=n=>`
import keras_hub

# Create a Backbone model unspecialized for any task
backbone = keras_hub.models.Backbone.from_preset("hf://${n}")
`,Vae=n=>{var s,i;const e=n.id,t=((i=(s=n.config)==null?void 0:s.keras_hub)==null?void 0:i.tasks)??[],r=[];for(const[o,a]of Object.entries($M))t.includes(o)&&r.push(a(e));for(const o of t)Object.keys($M).includes(o)||r.push(Lae(o,e));return r.push(Bae(e)),r},zae=n=>n.tags.includes("bi-encoder")?[`#install from https://github.com/webis-de/lightning-ir

from lightning_ir import BiEncoderModule
model = BiEncoderModule("${n.id}")

model.score("query", ["doc1", "doc2", "doc3"])`]:n.tags.includes("cross-encoder")?[`#install from https://github.com/webis-de/lightning-ir

from lightning_ir import CrossEncoderModule
model = CrossEncoderModule("${n.id}")

model.score("query", ["doc1", "doc2", "doc3"])`]:[`#install from https://github.com/webis-de/lightning-ir

from lightning_ir import BiEncoderModule, CrossEncoderModule

# depending on the model type, use either BiEncoderModule or CrossEncoderModule
model = BiEncoderModule("${n.id}") 
# model = CrossEncoderModule("${n.id}")

model.score("query", ["doc1", "doc2", "doc3"])`],Uae=n=>{const e=[`from llama_cpp import Llama

llm = Llama.from_pretrained(
	repo_id="${n.id}",
	filename="{{GGUF_FILE}}",
)
`];if(n.tags.includes("conversational")){const t=Tv(n);e.push(`llm.create_chat_completion(
	messages = ${eae(t,{attributeKeyQuotes:!0,indent:"	"})}
)`)}else e.push(`output = llm(
	"Once upon a time,",
	max_tokens=512,
	echo=True
)
print(output)`);return e},jae=n=>[`# Note: 'keras<3.x' or 'tf_keras' must be installed (legacy)
# See https://github.com/keras-team/tf-keras for more details.
from huggingface_hub import from_pretrained_keras

model = from_pretrained_keras("${n.id}")
`],Wae=n=>[`from mamba_ssm import MambaLMHeadModel

model = MambaLMHeadModel.from_pretrained("${n.id}")`],Hae=n=>[`# Install from https://github.com/Camb-ai/MARS5-TTS

from inference import Mars5TTS
mars5 = Mars5TTS.from_pretrained("${n.id}")`],Gae=n=>[`# Install from https://github.com/pq-yang/MatAnyone.git

from matanyone.model.matanyone import MatAnyone
model = MatAnyone.from_pretrained("${n.id}")`],qae=()=>[`# Install from https://github.com/buaacyw/MeshAnything.git

from MeshAnything.models.meshanything import MeshAnything

# refer to https://github.com/buaacyw/MeshAnything/blob/main/main.py#L91 on how to define args
# and https://github.com/buaacyw/MeshAnything/blob/main/app.py regarding usage
model = MeshAnything(args)`],Kae=n=>[`import open_clip

model, preprocess_train, preprocess_val = open_clip.create_model_and_transforms('hf-hub:${n.id}')
tokenizer = open_clip.get_tokenizer('hf-hub:${n.id}')`],Xae=n=>{var e,t;if((t=(e=n.config)==null?void 0:e.architectures)!=null&&t[0]){const r=n.config.architectures[0];return[[`from paddlenlp.transformers import AutoTokenizer, ${r}`,"",`tokenizer = AutoTokenizer.from_pretrained("${n.id}", from_hf_hub=True)`,`model = ${r}.from_pretrained("${n.id}", from_hf_hub=True)`].join(`
`)]}else return[["# ⚠️ Type of model unknown","from paddlenlp.transformers import AutoTokenizer, AutoModel","",`tokenizer = AutoTokenizer.from_pretrained("${n.id}", from_hf_hub=True)`,`model = AutoModel.from_pretrained("${n.id}", from_hf_hub=True)`].join(`
`)]},Yae=n=>[`from pyannote.audio import Pipeline
  
pipeline = Pipeline.from_pretrained("${n.id}")

# inference on the whole file
pipeline("file.wav")

# inference on an excerpt
from pyannote.core import Segment
excerpt = Segment(start=2.0, end=5.0)

from pyannote.audio import Audio
waveform, sample_rate = Audio().crop("file.wav", excerpt)
pipeline({"waveform": waveform, "sample_rate": sample_rate})`],Qae=n=>[`from pyannote.audio import Model, Inference

model = Model.from_pretrained("${n.id}")
inference = Inference(model)

# inference on the whole file
inference("file.wav")

# inference on an excerpt
from pyannote.core import Segment
excerpt = Segment(start=2.0, end=5.0)
inference.crop("file.wav", excerpt)`],Jae=n=>n.tags.includes("pyannote-audio-pipeline")?Yae(n):Qae(n),Zae=n=>[`from relik import Relik
 
relik = Relik.from_pretrained("${n.id}")`],ele=n=>[`from tensorflow_tts.inference import AutoProcessor, TFAutoModel

processor = AutoProcessor.from_pretrained("${n.id}")
model = TFAutoModel.from_pretrained("${n.id}")
`],tle=n=>[`from tensorflow_tts.inference import TFAutoModel

model = TFAutoModel.from_pretrained("${n.id}")
audios = model.inference(mels)
`],nle=n=>[`from tensorflow_tts.inference import TFAutoModel

model = TFAutoModel.from_pretrained("${n.id}")
`],rle=n=>n.tags.includes("text-to-mel")?ele(n):n.tags.includes("mel-to-wav")?tle(n):nle(n),sle=n=>[`import timm

model = timm.create_model("hf_hub:${n.id}", pretrained=True)`],ile=()=>[`# pip install sae-lens
from sae_lens import SAE

sae, cfg_dict, sparsity = SAE.from_pretrained(
    release = "RELEASE_ID", # e.g., "gpt2-small-res-jb". See other options in https://github.com/jbloomAus/SAELens/blob/main/sae_lens/pretrained_saes.yaml
    sae_id = "SAE_ID", # e.g., "blocks.8.hook_resid_pre". Won't always be a hook point
)`],ole=()=>[`# seed_story_cfg_path refers to 'https://github.com/TencentARC/SEED-Story/blob/master/configs/clm_models/agent_7b_sft.yaml'
# llm_cfg_path refers to 'https://github.com/TencentARC/SEED-Story/blob/master/configs/clm_models/llama2chat7b_lora.yaml'
from omegaconf import OmegaConf
import hydra

# load Llama2
llm_cfg = OmegaConf.load(llm_cfg_path)
llm = hydra.utils.instantiate(llm_cfg, torch_dtype="fp16")

# initialize seed_story
seed_story_cfg = OmegaConf.load(seed_story_cfg_path)
seed_story = hydra.utils.instantiate(seed_story_cfg, llm=llm) `],ale=(n,e)=>[`import joblib
from skops.hub_utils import download
download("${n.id}", "path_to_folder")
model = joblib.load(
	"${e}"
)
# only load pickle files from sources you trust
# read more about it here https://skops.readthedocs.io/en/stable/persistence.html`],lle=(n,e)=>[`from skops.hub_utils import download
from skops.io import load
download("${n.id}", "path_to_folder")
# make sure model file is in skops format
# if model is a pickle file, make sure it's from a source you trust
model = load("path_to_folder/${e}")`],ule=n=>[`from huggingface_hub import hf_hub_download
import joblib
model = joblib.load(
	hf_hub_download("${n.id}", "sklearn_model.joblib")
)
# only load pickle files from sources you trust
# read more about it here https://skops.readthedocs.io/en/stable/persistence.html`],cle=n=>{var e,t,r,s,i;if(n.tags.includes("skops")){const o=(r=(t=(e=n.config)==null?void 0:e.sklearn)==null?void 0:t.model)==null?void 0:r.file,a=(i=(s=n.config)==null?void 0:s.sklearn)==null?void 0:i.model_format;return o?a==="pickle"?ale(n,o):lle(n,o):["# ⚠️ Model filename not specified in config.json"]}else return ule(n)},hle=n=>[`import torch
import torchaudio
from einops import rearrange
from stable_audio_tools import get_pretrained_model
from stable_audio_tools.inference.generation import generate_diffusion_cond

device = "cuda" if torch.cuda.is_available() else "cpu"

# Download model
model, model_config = get_pretrained_model("${n.id}")
sample_rate = model_config["sample_rate"]
sample_size = model_config["sample_size"]

model = model.to(device)

# Set up text and timing conditioning
conditioning = [{
	"prompt": "128 BPM tech house drum loop",
}]

# Generate stereo audio
output = generate_diffusion_cond(
	model,
	conditioning=conditioning,
	sample_size=sample_size,
	device=device
)

# Rearrange audio batch to a single sequence
output = rearrange(output, "b d n -> d (b n)")

# Peak normalize, clip, convert to int16, and save to file
output = output.to(torch.float32).div(torch.max(torch.abs(output))).clamp(-1, 1).mul(32767).to(torch.int16).cpu()
torchaudio.save("output.wav", output, sample_rate)`],dle=n=>[`from huggingface_hub import from_pretrained_fastai

learn = from_pretrained_fastai("${n.id}")`],fle=n=>{const e=`# Use SAM2 with images
import torch
from sam2.sam2_image_predictor import SAM2ImagePredictor

predictor = SAM2ImagePredictor.from_pretrained(${n.id})

with torch.inference_mode(), torch.autocast("cuda", dtype=torch.bfloat16):
    predictor.set_image(<your_image>)
    masks, _, _ = predictor.predict(<input_prompts>)`,t=`# Use SAM2 with videos
import torch
from sam2.sam2_video_predictor import SAM2VideoPredictor
	
predictor = SAM2VideoPredictor.from_pretrained(${n.id})

with torch.inference_mode(), torch.autocast("cuda", dtype=torch.bfloat16):
    state = predictor.init_state(<your_video>)

    # add new prompts and instantly get the output on the same frame
    frame_idx, object_ids, masks = predictor.add_new_points(state, <your_prompts>):

    # propagate the prompts to get masklets throughout the video
    for frame_idx, object_ids, masks in predictor.propagate_in_video(state):
        ...`;return[e,t]},ple=n=>[`python -m sample_factory.huggingface.load_from_hub -r ${n.id} -d ./train_dir`];function mle(n){var t;const e=(t=n.widgetData)==null?void 0:t[0];if(e)return[e.source_sentence,...e.sentences]}const gle=n=>{const e=n.tags.includes($j)?", trust_remote_code=True":"",t=mle(n)??["The weather is lovely today.","It's so sunny outside!","He drove to the stadium."];return[`from sentence_transformers import SentenceTransformer

model = SentenceTransformer("${n.id}"${e})

sentences = ${JSON.stringify(t,null,4)}
embeddings = model.encode(sentences)

similarities = model.similarity(embeddings, embeddings)
print(similarities.shape)
# [${t.length}, ${t.length}]`]},vle=n=>[`from setfit import SetFitModel

model = SetFitModel.from_pretrained("${n.id}")`],yle=n=>[`!pip install https://huggingface.co/${n.id}/resolve/main/${mu(n.id)}-any-py3-none-any.whl

# Using spacy.load().
import spacy
nlp = spacy.load("${mu(n.id)}")

# Importing as module.
import ${mu(n.id)}
nlp = ${mu(n.id)}.load()`],xle=n=>[`from span_marker import SpanMarkerModel

model = SpanMarkerModel.from_pretrained("${n.id}")`],ble=n=>[`import stanza

stanza.download("${mu(n.id).replace("stanza-","")}")
nlp = stanza.Pipeline("${mu(n.id).replace("stanza-","")}")`],wle=n=>{switch(n){case"EncoderClassifier":return"classify_file";case"EncoderDecoderASR":case"EncoderASR":return"transcribe_file";case"SpectralMaskEnhancement":return"enhance_file";case"SepformerSeparation":return"separate_file";default:return}},_le=n=>{var r,s;const e=(s=(r=n.config)==null?void 0:r.speechbrain)==null?void 0:s.speechbrain_interface;if(e===void 0)return["# interface not specified in config.json"];const t=wle(e);return t===void 0?["# interface in config.json invalid"]:[`from speechbrain.pretrained import ${e}
model = ${e}.from_hparams(
  "${n.id}"
)
model.${t}("file.wav")`]},kle=n=>[`from terratorch.registry import BACKBONE_REGISTRY

model = BACKBONE_REGISTRY.build("${n.id}")`],Cle=n=>{var s,i,o,a,l;const e=n.transformersInfo;if(!e)return["# ⚠️ Type of model unknown"];const t=n.tags.includes($j)?", trust_remote_code=True":"";let r;if(e.processor){const u=e.processor==="AutoTokenizer"?"tokenizer":e.processor==="AutoFeatureExtractor"?"extractor":"processor";r=["# Load model directly",`from transformers import ${e.processor}, ${e.auto_model}`,"",`${u} = ${e.processor}.from_pretrained("${n.id}"`+t+")",`model = ${e.auto_model}.from_pretrained("${n.id}"`+t+")"].join(`
`)}else r=["# Load model directly",`from transformers import ${e.auto_model}`,`model = ${e.auto_model}.from_pretrained("${n.id}"`+t+")"].join(`
`);if(n.pipeline_tag&&((s=Bie.transformers)!=null&&s.includes(n.pipeline_tag))){const u=["# Use a pipeline as a high-level helper","from transformers import pipeline",""];return n.tags.includes("conversational")&&((o=(i=n.config)==null?void 0:i.tokenizer_config)!=null&&o.chat_template)&&u.push("messages = [",'    {"role": "user", "content": "Who are you?"},',"]"),u.push(`pipe = pipeline("${n.pipeline_tag}", model="${n.id}"`+t+")"),n.tags.includes("conversational")&&((l=(a=n.config)==null?void 0:a.tokenizer_config)!=null&&l.chat_template)&&u.push("pipe(messages)"),[u.join(`
`),r]}return[r]},Ile=n=>{if(!n.pipeline_tag)return["// ⚠️ Unknown pipeline tag"];const e="@huggingface/transformers";return[`// npm i ${e}
import { pipeline } from '${e}';

// Allocate pipeline
const pipe = await pipeline('${n.pipeline_tag}', '${n.id}');`]},Sle=n=>{switch(n){case"CAUSAL_LM":return"CausalLM";case"SEQ_2_SEQ_LM":return"Seq2SeqLM";case"TOKEN_CLS":return"TokenClassification";case"SEQ_CLS":return"SequenceClassification";default:return}},Ele=n=>{var s;const{base_model_name_or_path:e,task_type:t}=((s=n.config)==null?void 0:s.peft)??{},r=Sle(t);return r?e?[`from peft import PeftModel
from transformers import AutoModelFor${r}

base_model = AutoModelFor${r}.from_pretrained("${e}")
model = PeftModel.from_pretrained(base_model, "${n.id}")`]:["Base model is not found."]:["Task type is invalid."]},Tle=n=>[`from huggingface_hub import hf_hub_download
import fasttext

model = fasttext.load_model(hf_hub_download("${n.id}", "model.bin"))`],Nle=n=>[`from huggingface_sb3 import load_from_hub
checkpoint = load_from_hub(
	repo_id="${n.id}",
	filename="{MODEL FILENAME}.zip",
)`],Ale=(n,e)=>{switch(n){case"ASR":return[`import nemo.collections.asr as nemo_asr
asr_model = nemo_asr.models.ASRModel.from_pretrained("${e.id}")

transcriptions = asr_model.transcribe(["file.wav"])`];default:return}},Rle=n=>[`mlagents-load-from-hf --repo-id="${n.id}" --local-dir="./download: string[]s"`],Dle=()=>[`string modelName = "[Your model name here].sentis";
Model model = ModelLoader.Load(Application.streamingAssetsPath + "/" + modelName);
IWorker engine = WorkerFactory.CreateWorker(BackendType.GPUCompute, model);
// Please see provided C# file for more details
`],$le=n=>[`
# Load the model and infer image from text
import torch
from app.sana_pipeline import SanaPipeline
from torchvision.utils import save_image

sana = SanaPipeline("configs/sana_config/1024ms/Sana_1600M_img1024.yaml")
sana.from_pretrained("hf://${n.id}")

image = sana(
    prompt='a cyberpunk cat with a neon sign that says "Sana"',
    height=1024,
    width=1024,
    guidance_scale=5.0,
    pag_guidance_scale=2.0,
    num_inference_steps=18,
) `],Ple=n=>[`from Trainer_finetune import Model

model = Model.from_pretrained("${n.id}")`],Ole=n=>[`from voicecraft import VoiceCraft

model = VoiceCraft.from_pretrained("${n.id}")`],Fle=()=>[`import ChatTTS
import torchaudio

chat = ChatTTS.Chat()
chat.load_models(compile=False) # Set to True for better performance

texts = ["PUT YOUR TEXT HERE",]

wavs = chat.infer(texts, )

torchaudio.save("output1.wav", torch.from_numpy(wavs[0]), 24000)`],PM=n=>{const e=n.tags.find(s=>s.match(/^yolov\d+$/)),t=e?`YOLOv${e.slice(4)}`:"YOLOvXX";return[(e?"":`# Couldn't find a valid YOLO version tag.
# Replace XX with the correct version.
`)+`from ultralytics import ${t}

model = ${t}.from_pretrained("${n.id}")
source = 'http://images.cocodataset.org/val2017/000000039769.jpg'
model.predict(source=source, save=True)`]},Mle=n=>[`# Option 1: use with transformers

from transformers import AutoModelForImageSegmentation
birefnet = AutoModelForImageSegmentation.from_pretrained("${n.id}", trust_remote_code=True)
`,`# Option 2: use with BiRefNet

# Install from https://github.com/ZhengPeng7/BiRefNet

from models.birefnet import BiRefNet
model = BiRefNet.from_pretrained("${n.id}")`],Lle=n=>[`from swarmformer import SwarmFormerModel

model = SwarmFormerModel.from_pretrained("${n.id}")
`],Ble=n=>[`pip install huggingface_hub hf_transfer

export HF_HUB_ENABLE_HF_TRANSFER=1
huggingface-cli download --local-dir ${mu(n.id)} ${n.id}`],Vle=n=>[`from mlxim.model import create_model

model = create_model(${n.id})`],zle=n=>[`from model2vec import StaticModel

model = StaticModel.from_pretrained("${n.id}")`],Ule=n=>{let e;return n.tags.includes("automatic-speech-recognition")&&(e=Ale("ASR",n)),e??["# tag did not correspond to a valid NeMo domain."]},jle=n=>[`from pxia import AutoModel

model = AutoModel.from_pretrained("${n.id}")`],Wle=n=>[`from pythae.models import AutoModel

model = AutoModel.load_from_hf_hub("${n.id}")`],Hle=n=>[`from audiocraft.models import MusicGen

model = MusicGen.get_pretrained("${n.id}")

descriptions = ['happy rock', 'energetic EDM', 'sad jazz']
wav = model.generate(descriptions)  # generates 3 samples.`],Gle=n=>[`from audiocraft.models import MAGNeT
	
model = MAGNeT.get_pretrained("${n.id}")

descriptions = ['disco beat', 'energetic EDM', 'funky groove']
wav = model.generate(descriptions)  # generates 3 samples.`],qle=n=>[`from audiocraft.models import AudioGen
	
model = AudioGen.get_pretrained("${n.id}")
model.set_generation_params(duration=5)  # generate 5 seconds.
descriptions = ['dog barking', 'sirene of an emergency vehicle', 'footsteps in a corridor']
wav = model.generate(descriptions)  # generates 3 samples.`],Kle=n=>[`from anemoi.inference.runners.default import DefaultRunner
from anemoi.inference.config import Configuration
# Create Configuration
config = Configuration(checkpoint = {"huggingface":{"repo_id":"${n.id}"}})
# Load Runner
runner = DefaultRunner(config)`],Xle=n=>n.tags.includes("musicgen")?Hle(n):n.tags.includes("audiogen")?qle(n):n.tags.includes("magnet")?Gle(n):["# Type of model unknown."],Yle=()=>[`# Install CLI with Homebrew on macOS device
brew install whisperkit-cli

# View all available inference options
whisperkit-cli transcribe --help
	
# Download and run inference using whisper base model
whisperkit-cli transcribe --audio-path /path/to/audio.mp3

# Or use your preferred model variant
whisperkit-cli transcribe --model "large-v3" --model-prefix "distil" --audio-path /path/to/audio.mp3 --verbose`],Qle=n=>[`from threedtopia_xl.models import threedtopia_xl

model = threedtopia_xl.from_pretrained("${n.id}")
model.generate(cond="path/to/image.png")`],Jle={"adapter-transformers":{prettyLabel:"Adapters",repoName:"adapters",repoUrl:"https://github.com/Adapter-Hub/adapters",docsUrl:"https://huggingface.co/docs/hub/adapters",snippets:nae,filter:!0,countDownloads:'path:"adapter_config.json"'},allennlp:{prettyLabel:"AllenNLP",repoName:"AllenNLP",repoUrl:"https://github.com/allenai/allennlp",docsUrl:"https://huggingface.co/docs/hub/allennlp",snippets:iae,filter:!0},anemoi:{prettyLabel:"AnemoI",repoName:"AnemoI",repoUrl:"https://github.com/ecmwf/anemoi-inference",docsUrl:"https://anemoi-docs.readthedocs.io/en/latest/",filter:!1,countDownloads:'path_extension:"ckpt"',snippets:Kle},araclip:{prettyLabel:"AraClip",repoName:"AraClip",repoUrl:"https://huggingface.co/Arabic-Clip/araclip",filter:!1,snippets:oae},asteroid:{prettyLabel:"Asteroid",repoName:"Asteroid",repoUrl:"https://github.com/asteroid-team/asteroid",docsUrl:"https://huggingface.co/docs/hub/asteroid",snippets:aae,filter:!0,countDownloads:'path:"pytorch_model.bin"'},audiocraft:{prettyLabel:"Audiocraft",repoName:"audiocraft",repoUrl:"https://github.com/facebookresearch/audiocraft",snippets:Xle,filter:!1,countDownloads:'path:"state_dict.bin"'},audioseal:{prettyLabel:"AudioSeal",repoName:"audioseal",repoUrl:"https://github.com/facebookresearch/audioseal",filter:!1,countDownloads:'path_extension:"pth"',snippets:lae},ben2:{prettyLabel:"BEN2",repoName:"BEN2",repoUrl:"https://github.com/PramaLLC/BEN2",snippets:uae,filter:!1},bertopic:{prettyLabel:"BERTopic",repoName:"BERTopic",repoUrl:"https://github.com/MaartenGr/BERTopic",snippets:cae,filter:!0},big_vision:{prettyLabel:"Big Vision",repoName:"big_vision",repoUrl:"https://github.com/google-research/big_vision",filter:!1,countDownloads:'path_extension:"npz"'},birder:{prettyLabel:"Birder",repoName:"Birder",repoUrl:"https://gitlab.com/birder/birder",filter:!1,countDownloads:'path_extension:"pt"'},birefnet:{prettyLabel:"BiRefNet",repoName:"BiRefNet",repoUrl:"https://github.com/ZhengPeng7/BiRefNet",snippets:Mle,filter:!1},bm25s:{prettyLabel:"BM25S",repoName:"bm25s",repoUrl:"https://github.com/xhluca/bm25s",snippets:hae,filter:!1,countDownloads:'path:"params.index.json"'},champ:{prettyLabel:"Champ",repoName:"Champ",repoUrl:"https://github.com/fudan-generative-vision/champ",countDownloads:'path:"champ/motion_module.pth"'},chat_tts:{prettyLabel:"ChatTTS",repoName:"ChatTTS",repoUrl:"https://github.com/2noise/ChatTTS.git",snippets:Fle,filter:!1,countDownloads:'path:"asset/GPT.pt"'},colpali:{prettyLabel:"ColPali",repoName:"ColPali",repoUrl:"https://github.com/ManuelFay/colpali",filter:!1,countDownloads:'path:"adapter_config.json"'},comet:{prettyLabel:"COMET",repoName:"COMET",repoUrl:"https://github.com/Unbabel/COMET/",countDownloads:'path:"hparams.yaml"'},cosmos:{prettyLabel:"Cosmos",repoName:"Cosmos",repoUrl:"https://github.com/NVIDIA/Cosmos",countDownloads:'path:"config.json" OR path_extension:"pt"'},"cxr-foundation":{prettyLabel:"CXR Foundation",repoName:"cxr-foundation",repoUrl:"https://github.com/google-health/cxr-foundation",snippets:dae,filter:!1,countDownloads:'path:"precomputed_embeddings/embeddings.npz" OR path:"pax-elixr-b-text/saved_model.pb"'},deepforest:{prettyLabel:"DeepForest",repoName:"deepforest",docsUrl:"https://deepforest.readthedocs.io/en/latest/",repoUrl:"https://github.com/weecology/DeepForest"},"depth-anything-v2":{prettyLabel:"DepthAnythingV2",repoName:"Depth Anything V2",repoUrl:"https://github.com/DepthAnything/Depth-Anything-V2",snippets:fae,filter:!1,countDownloads:'path_extension:"pth"'},"depth-pro":{prettyLabel:"Depth Pro",repoName:"Depth Pro",repoUrl:"https://github.com/apple/ml-depth-pro",countDownloads:'path_extension:"pt"',snippets:pae,filter:!1},"derm-foundation":{prettyLabel:"Derm Foundation",repoName:"derm-foundation",repoUrl:"https://github.com/google-health/derm-foundation",snippets:mae,filter:!1,countDownloads:'path:"scin_dataset_precomputed_embeddings.npz" OR path:"saved_model.pb"'},diffree:{prettyLabel:"Diffree",repoName:"Diffree",repoUrl:"https://github.com/OpenGVLab/Diffree",filter:!1,countDownloads:'path:"diffree-step=000010999.ckpt"'},diffusers:{prettyLabel:"Diffusers",repoName:"🤗/diffusers",repoUrl:"https://github.com/huggingface/diffusers",docsUrl:"https://huggingface.co/docs/hub/diffusers",snippets:bae,filter:!0},diffusionkit:{prettyLabel:"DiffusionKit",repoName:"DiffusionKit",repoUrl:"https://github.com/argmaxinc/DiffusionKit",snippets:wae},doctr:{prettyLabel:"docTR",repoName:"doctr",repoUrl:"https://github.com/mindee/doctr"},cartesia_pytorch:{prettyLabel:"Cartesia Pytorch",repoName:"Cartesia Pytorch",repoUrl:"https://github.com/cartesia-ai/cartesia_pytorch",snippets:_ae},cartesia_mlx:{prettyLabel:"Cartesia MLX",repoName:"Cartesia MLX",repoUrl:"https://github.com/cartesia-ai/cartesia_mlx",snippets:kae},clipscope:{prettyLabel:"clipscope",repoName:"clipscope",repoUrl:"https://github.com/Lewington-pitsos/clipscope",filter:!1,countDownloads:'path_extension:"pt"'},cosyvoice:{prettyLabel:"CosyVoice",repoName:"CosyVoice",repoUrl:"https://github.com/FunAudioLLM/CosyVoice",filter:!1,countDownloads:'path_extension:"onnx" OR path_extension:"pt"'},cotracker:{prettyLabel:"CoTracker",repoName:"CoTracker",repoUrl:"https://github.com/facebookresearch/co-tracker",filter:!1,countDownloads:'path_extension:"pth"'},edsnlp:{prettyLabel:"EDS-NLP",repoName:"edsnlp",repoUrl:"https://github.com/aphp/edsnlp",docsUrl:"https://aphp.github.io/edsnlp/latest/",filter:!1,snippets:Cae,countDownloads:'path_filename:"config" AND path_extension:"cfg"'},elm:{prettyLabel:"ELM",repoName:"elm",repoUrl:"https://github.com/slicex-ai/elm",filter:!1,countDownloads:'path_filename:"slicex_elm_config" AND path_extension:"json"'},espnet:{prettyLabel:"ESPnet",repoName:"ESPnet",repoUrl:"https://github.com/espnet/espnet",docsUrl:"https://huggingface.co/docs/hub/espnet",snippets:Tae,filter:!0},fairseq:{prettyLabel:"Fairseq",repoName:"fairseq",repoUrl:"https://github.com/pytorch/fairseq",snippets:Nae,filter:!0},fastai:{prettyLabel:"fastai",repoName:"fastai",repoUrl:"https://github.com/fastai/fastai",docsUrl:"https://huggingface.co/docs/hub/fastai",snippets:dle,filter:!0},fasttext:{prettyLabel:"fastText",repoName:"fastText",repoUrl:"https://fasttext.cc/",snippets:Tle,filter:!0,countDownloads:'path_extension:"bin"'},flair:{prettyLabel:"Flair",repoName:"Flair",repoUrl:"https://github.com/flairNLP/flair",docsUrl:"https://huggingface.co/docs/hub/flair",snippets:Aae,filter:!0,countDownloads:'path:"pytorch_model.bin"'},"gemma.cpp":{prettyLabel:"gemma.cpp",repoName:"gemma.cpp",repoUrl:"https://github.com/google/gemma.cpp",filter:!1,countDownloads:'path_extension:"sbs"'},gliner:{prettyLabel:"GLiNER",repoName:"GLiNER",repoUrl:"https://github.com/urchade/GLiNER",snippets:Rae,filter:!1,countDownloads:'path:"gliner_config.json"'},"glyph-byt5":{prettyLabel:"Glyph-ByT5",repoName:"Glyph-ByT5",repoUrl:"https://github.com/AIGText/Glyph-ByT5",filter:!1,countDownloads:'path:"checkpoints/byt5_model.pt"'},grok:{prettyLabel:"Grok",repoName:"Grok",repoUrl:"https://github.com/xai-org/grok-1",filter:!1,countDownloads:'path:"ckpt/tensor00000_000" OR path:"ckpt-0/tensor00000_000"'},hallo:{prettyLabel:"Hallo",repoName:"Hallo",repoUrl:"https://github.com/fudan-generative-vision/hallo",countDownloads:'path:"hallo/net.pth"'},hezar:{prettyLabel:"Hezar",repoName:"Hezar",repoUrl:"https://github.com/hezarai/hezar",docsUrl:"https://hezarai.github.io/hezar",countDownloads:'path:"model_config.yaml" OR path:"embedding/embedding_config.yaml"'},htrflow:{prettyLabel:"HTRflow",repoName:"HTRflow",repoUrl:"https://github.com/AI-Riksarkivet/htrflow",docsUrl:"https://ai-riksarkivet.github.io/htrflow",snippets:Dae},"hunyuan-dit":{prettyLabel:"HunyuanDiT",repoName:"HunyuanDiT",repoUrl:"https://github.com/Tencent/HunyuanDiT",countDownloads:'path:"pytorch_model_ema.pt" OR path:"pytorch_model_distill.pt"'},"hunyuan3d-2":{prettyLabel:"Hunyuan3D-2",repoName:"Hunyuan3D-2",repoUrl:"https://github.com/Tencent/Hunyuan3D-2",countDownloads:'path_filename:"model_index" OR path_filename:"config"'},imstoucan:{prettyLabel:"IMS Toucan",repoName:"IMS-Toucan",repoUrl:"https://github.com/DigitalPhonetics/IMS-Toucan",countDownloads:'path:"embedding_gan.pt" OR path:"Vocoder.pt" OR path:"ToucanTTS.pt"'},keras:{prettyLabel:"Keras",repoName:"Keras",repoUrl:"https://github.com/keras-team/keras",docsUrl:"https://huggingface.co/docs/hub/keras",snippets:$ae,filter:!0,countDownloads:'path:"config.json" OR path_extension:"keras"'},"tf-keras":{prettyLabel:"TF-Keras",repoName:"TF-Keras",repoUrl:"https://github.com/keras-team/tf-keras",docsUrl:"https://huggingface.co/docs/hub/tf-keras",snippets:jae,countDownloads:'path:"saved_model.pb"'},"keras-hub":{prettyLabel:"KerasHub",repoName:"KerasHub",repoUrl:"https://github.com/keras-team/keras-hub",docsUrl:"https://keras.io/keras_hub/",snippets:Vae,filter:!0},k2:{prettyLabel:"K2",repoName:"k2",repoUrl:"https://github.com/k2-fsa/k2"},"lightning-ir":{prettyLabel:"Lightning IR",repoName:"Lightning IR",repoUrl:"https://github.com/webis-de/lightning-ir",snippets:zae},liveportrait:{prettyLabel:"LivePortrait",repoName:"LivePortrait",repoUrl:"https://github.com/KwaiVGI/LivePortrait",filter:!1,countDownloads:'path:"liveportrait/landmark.onnx"'},"llama-cpp-python":{prettyLabel:"llama-cpp-python",repoName:"llama-cpp-python",repoUrl:"https://github.com/abetlen/llama-cpp-python",snippets:Uae},"mini-omni2":{prettyLabel:"Mini-Omni2",repoName:"Mini-Omni2",repoUrl:"https://github.com/gpt-omni/mini-omni2",countDownloads:'path:"model_config.yaml"'},mindspore:{prettyLabel:"MindSpore",repoName:"mindspore",repoUrl:"https://github.com/mindspore-ai/mindspore"},"mamba-ssm":{prettyLabel:"MambaSSM",repoName:"MambaSSM",repoUrl:"https://github.com/state-spaces/mamba",filter:!1,snippets:Wae},"mars5-tts":{prettyLabel:"MARS5-TTS",repoName:"MARS5-TTS",repoUrl:"https://github.com/Camb-ai/MARS5-TTS",filter:!1,countDownloads:'path:"mars5_ar.safetensors"',snippets:Hae},matanyone:{prettyLabel:"MatAnyone",repoName:"MatAnyone",repoUrl:"https://github.com/pq-yang/MatAnyone",snippets:Gae,filter:!1},"mesh-anything":{prettyLabel:"MeshAnything",repoName:"MeshAnything",repoUrl:"https://github.com/buaacyw/MeshAnything",filter:!1,countDownloads:'path:"MeshAnything_350m.pth"',snippets:qae},merlin:{prettyLabel:"Merlin",repoName:"Merlin",repoUrl:"https://github.com/StanfordMIMI/Merlin",filter:!1,countDownloads:'path_extension:"pt"'},medvae:{prettyLabel:"MedVAE",repoName:"MedVAE",repoUrl:"https://github.com/StanfordMIMI/MedVAE",filter:!1,countDownloads:'path_extension:"ckpt"'},mitie:{prettyLabel:"MITIE",repoName:"MITIE",repoUrl:"https://github.com/mit-nlp/MITIE",countDownloads:'path_filename:"total_word_feature_extractor"'},"ml-agents":{prettyLabel:"ml-agents",repoName:"ml-agents",repoUrl:"https://github.com/Unity-Technologies/ml-agents",docsUrl:"https://huggingface.co/docs/hub/ml-agents",snippets:Rle,filter:!0,countDownloads:'path_extension:"onnx"'},mlx:{prettyLabel:"MLX",repoName:"MLX",repoUrl:"https://github.com/ml-explore/mlx-examples/tree/main",snippets:Ble,filter:!0},"mlx-image":{prettyLabel:"mlx-image",repoName:"mlx-image",repoUrl:"https://github.com/riccardomusmeci/mlx-image",docsUrl:"https://huggingface.co/docs/hub/mlx-image",snippets:Vle,filter:!1,countDownloads:'path:"model.safetensors"'},"mlc-llm":{prettyLabel:"MLC-LLM",repoName:"MLC-LLM",repoUrl:"https://github.com/mlc-ai/mlc-llm",docsUrl:"https://llm.mlc.ai/docs/",filter:!1,countDownloads:'path:"mlc-chat-config.json"'},model2vec:{prettyLabel:"Model2Vec",repoName:"model2vec",repoUrl:"https://github.com/MinishLab/model2vec",snippets:zle,filter:!1},moshi:{prettyLabel:"Moshi",repoName:"Moshi",repoUrl:"https://github.com/kyutai-labs/moshi",filter:!1,countDownloads:'path:"tokenizer-e351c8d8-checkpoint125.safetensors"'},nemo:{prettyLabel:"NeMo",repoName:"NeMo",repoUrl:"https://github.com/NVIDIA/NeMo",snippets:Ule,filter:!0,countDownloads:'path_extension:"nemo" OR path:"model_config.yaml"'},"open-oasis":{prettyLabel:"open-oasis",repoName:"open-oasis",repoUrl:"https://github.com/etched-ai/open-oasis",countDownloads:'path:"oasis500m.safetensors"'},open_clip:{prettyLabel:"OpenCLIP",repoName:"OpenCLIP",repoUrl:"https://github.com/mlfoundations/open_clip",snippets:Kae,filter:!0,countDownloads:`path:"open_clip_model.safetensors"
			OR path:"model.safetensors"
			OR path:"open_clip_pytorch_model.bin"
			OR path:"pytorch_model.bin"`},"open-sora":{prettyLabel:"Open-Sora",repoName:"Open-Sora",repoUrl:"https://github.com/hpcaitech/Open-Sora",filter:!1,countDownloads:'path:"Open_Sora_v2.safetensors"'},paddlenlp:{prettyLabel:"paddlenlp",repoName:"PaddleNLP",repoUrl:"https://github.com/PaddlePaddle/PaddleNLP",docsUrl:"https://huggingface.co/docs/hub/paddlenlp",snippets:Xae,filter:!0,countDownloads:'path:"model_config.json"'},peft:{prettyLabel:"PEFT",repoName:"PEFT",repoUrl:"https://github.com/huggingface/peft",snippets:Ele,filter:!0,countDownloads:'path:"adapter_config.json"'},pxia:{prettyLabel:"pxia",repoName:"pxia",repoUrl:"https://github.com/not-lain/pxia",snippets:jle,filter:!1},"pyannote-audio":{prettyLabel:"pyannote.audio",repoName:"pyannote-audio",repoUrl:"https://github.com/pyannote/pyannote-audio",snippets:Jae,filter:!0},"py-feat":{prettyLabel:"Py-Feat",repoName:"Py-Feat",repoUrl:"https://github.com/cosanlab/py-feat",docsUrl:"https://py-feat.org/",filter:!1},pythae:{prettyLabel:"pythae",repoName:"pythae",repoUrl:"https://github.com/clementchadebec/benchmark_VAE",snippets:Wle,filter:!1},recurrentgemma:{prettyLabel:"RecurrentGemma",repoName:"recurrentgemma",repoUrl:"https://github.com/google-deepmind/recurrentgemma",filter:!1,countDownloads:'path:"tokenizer.model"'},relik:{prettyLabel:"Relik",repoName:"Relik",repoUrl:"https://github.com/SapienzaNLP/relik",snippets:Zae,filter:!1},refiners:{prettyLabel:"Refiners",repoName:"Refiners",repoUrl:"https://github.com/finegrain-ai/refiners",docsUrl:"https://refine.rs/",filter:!1,countDownloads:'path:"model.safetensors"'},reverb:{prettyLabel:"Reverb",repoName:"Reverb",repoUrl:"https://github.com/revdotcom/reverb",filter:!1},saelens:{prettyLabel:"SAELens",repoName:"SAELens",repoUrl:"https://github.com/jbloomAus/SAELens",snippets:ile,filter:!1},sam2:{prettyLabel:"sam2",repoName:"sam2",repoUrl:"https://github.com/facebookresearch/segment-anything-2",filter:!1,snippets:fle,countDownloads:'path_extension:"pt"'},"sample-factory":{prettyLabel:"sample-factory",repoName:"sample-factory",repoUrl:"https://github.com/alex-petrenko/sample-factory",docsUrl:"https://huggingface.co/docs/hub/sample-factory",snippets:ple,filter:!0,countDownloads:'path:"cfg.json"'},sapiens:{prettyLabel:"sapiens",repoName:"sapiens",repoUrl:"https://github.com/facebookresearch/sapiens",filter:!1,countDownloads:'path_extension:"pt2" OR path_extension:"pth" OR path_extension:"onnx"'},"sentence-transformers":{prettyLabel:"sentence-transformers",repoName:"sentence-transformers",repoUrl:"https://github.com/UKPLab/sentence-transformers",docsUrl:"https://huggingface.co/docs/hub/sentence-transformers",snippets:gle,filter:!0},setfit:{prettyLabel:"setfit",repoName:"setfit",repoUrl:"https://github.com/huggingface/setfit",docsUrl:"https://huggingface.co/docs/hub/setfit",snippets:vle,filter:!0},sklearn:{prettyLabel:"Scikit-learn",repoName:"Scikit-learn",repoUrl:"https://github.com/scikit-learn/scikit-learn",snippets:cle,filter:!0,countDownloads:'path:"sklearn_model.joblib"'},spacy:{prettyLabel:"spaCy",repoName:"spaCy",repoUrl:"https://github.com/explosion/spaCy",docsUrl:"https://huggingface.co/docs/hub/spacy",snippets:yle,filter:!0,countDownloads:'path_extension:"whl"'},"span-marker":{prettyLabel:"SpanMarker",repoName:"SpanMarkerNER",repoUrl:"https://github.com/tomaarsen/SpanMarkerNER",docsUrl:"https://huggingface.co/docs/hub/span_marker",snippets:xle,filter:!0},speechbrain:{prettyLabel:"speechbrain",repoName:"speechbrain",repoUrl:"https://github.com/speechbrain/speechbrain",docsUrl:"https://huggingface.co/docs/hub/speechbrain",snippets:_le,filter:!0,countDownloads:'path:"hyperparams.yaml"'},"ssr-speech":{prettyLabel:"SSR-Speech",repoName:"SSR-Speech",repoUrl:"https://github.com/WangHelin1997/SSR-Speech",filter:!1,countDownloads:'path_extension:".pth"'},"stable-audio-tools":{prettyLabel:"Stable Audio Tools",repoName:"stable-audio-tools",repoUrl:"https://github.com/Stability-AI/stable-audio-tools.git",filter:!1,countDownloads:'path:"model.safetensors"',snippets:hle},"diffusion-single-file":{prettyLabel:"Diffusion Single File",repoName:"diffusion-single-file",repoUrl:"https://github.com/comfyanonymous/ComfyUI",filter:!1,countDownloads:'path_extension:"safetensors"'},"seed-story":{prettyLabel:"SEED-Story",repoName:"SEED-Story",repoUrl:"https://github.com/TencentARC/SEED-Story",filter:!1,countDownloads:'path:"cvlm_llama2_tokenizer/tokenizer.model"',snippets:ole},soloaudio:{prettyLabel:"SoloAudio",repoName:"SoloAudio",repoUrl:"https://github.com/WangHelin1997/SoloAudio",filter:!1,countDownloads:'path:"soloaudio_v2.pt"'},"stable-baselines3":{prettyLabel:"stable-baselines3",repoName:"stable-baselines3",repoUrl:"https://github.com/huggingface/huggingface_sb3",docsUrl:"https://huggingface.co/docs/hub/stable-baselines3",snippets:Nle,filter:!0,countDownloads:'path_extension:"zip"'},stanza:{prettyLabel:"Stanza",repoName:"stanza",repoUrl:"https://github.com/stanfordnlp/stanza",docsUrl:"https://huggingface.co/docs/hub/stanza",snippets:ble,filter:!0,countDownloads:'path:"models/default.zip"'},swarmformer:{prettyLabel:"SwarmFormer",repoName:"SwarmFormer",repoUrl:"https://github.com/takara-ai/SwarmFormer",snippets:Lle,filter:!1},"f5-tts":{prettyLabel:"F5-TTS",repoName:"F5-TTS",repoUrl:"https://github.com/SWivid/F5-TTS",filter:!1,countDownloads:'path_extension:"safetensors" OR path_extension:"pt"'},genmo:{prettyLabel:"Genmo",repoName:"Genmo",repoUrl:"https://github.com/genmoai/models",filter:!1,countDownloads:'path:"vae_stats.json"'},tensorflowtts:{prettyLabel:"TensorFlowTTS",repoName:"TensorFlowTTS",repoUrl:"https://github.com/TensorSpeech/TensorFlowTTS",snippets:rle},tabpfn:{prettyLabel:"TabPFN",repoName:"TabPFN",repoUrl:"https://github.com/PriorLabs/TabPFN"},terratorch:{prettyLabel:"TerraTorch",repoName:"TerraTorch",repoUrl:"https://github.com/IBM/terratorch",docsUrl:"https://ibm.github.io/terratorch/",filter:!1,countDownloads:'path_extension:"pt"',snippets:kle},"tic-clip":{prettyLabel:"TiC-CLIP",repoName:"TiC-CLIP",repoUrl:"https://github.com/apple/ml-tic-clip",filter:!1,countDownloads:'path_extension:"pt" AND path_prefix:"checkpoints/"'},timesfm:{prettyLabel:"TimesFM",repoName:"timesfm",repoUrl:"https://github.com/google-research/timesfm",filter:!1,countDownloads:'path:"checkpoints/checkpoint_1100000/state/checkpoint"'},timm:{prettyLabel:"timm",repoName:"pytorch-image-models",repoUrl:"https://github.com/rwightman/pytorch-image-models",docsUrl:"https://huggingface.co/docs/hub/timm",snippets:sle,filter:!0,countDownloads:'path:"pytorch_model.bin" OR path:"model.safetensors"'},transformers:{prettyLabel:"Transformers",repoName:"🤗/transformers",repoUrl:"https://github.com/huggingface/transformers",docsUrl:"https://huggingface.co/docs/hub/transformers",snippets:Cle,filter:!0},"transformers.js":{prettyLabel:"Transformers.js",repoName:"transformers.js",repoUrl:"https://github.com/huggingface/transformers.js",docsUrl:"https://huggingface.co/docs/hub/transformers-js",snippets:Ile,filter:!0},trellis:{prettyLabel:"Trellis",repoName:"Trellis",repoUrl:"https://github.com/microsoft/TRELLIS",countDownloads:'path_extension:"safetensors"'},ultralytics:{prettyLabel:"ultralytics",repoName:"ultralytics",repoUrl:"https://github.com/ultralytics/ultralytics",docsUrl:"https://github.com/ultralytics/ultralytics",filter:!1,countDownloads:'path_extension:"pt"',snippets:PM},"uni-3dar":{prettyLabel:"Uni-3DAR",repoName:"Uni-3DAR",repoUrl:"https://github.com/dptech-corp/Uni-3DAR",docsUrl:"https://github.com/dptech-corp/Uni-3DAR",countDownloads:'path_extension:"pt"'},"unity-sentis":{prettyLabel:"unity-sentis",repoName:"unity-sentis",repoUrl:"https://github.com/Unity-Technologies/sentis-samples",snippets:Dle,filter:!0,countDownloads:'path_extension:"sentis"'},sana:{prettyLabel:"Sana",repoName:"Sana",repoUrl:"https://github.com/NVlabs/Sana",countDownloads:'path_extension:"pth"',snippets:$le},"vfi-mamba":{prettyLabel:"VFIMamba",repoName:"VFIMamba",repoUrl:"https://github.com/MCG-NJU/VFIMamba",countDownloads:'path_extension:"pkl"',snippets:Ple},voicecraft:{prettyLabel:"VoiceCraft",repoName:"VoiceCraft",repoUrl:"https://github.com/jasonppy/VoiceCraft",docsUrl:"https://github.com/jasonppy/VoiceCraft",snippets:Ole},wham:{prettyLabel:"WHAM",repoName:"wham",repoUrl:"https://huggingface.co/microsoft/wham",docsUrl:"https://huggingface.co/microsoft/wham/blob/main/README.md",countDownloads:'path_extension:"ckpt"'},whisperkit:{prettyLabel:"WhisperKit",repoName:"WhisperKit",repoUrl:"https://github.com/argmaxinc/WhisperKit",docsUrl:"https://github.com/argmaxinc/WhisperKit?tab=readme-ov-file#homebrew",snippets:Yle,countDownloads:'path_filename:"model" AND path_extension:"mil" AND _exists_:"path_prefix"'},yolov10:{prettyLabel:"YOLOv10",repoName:"YOLOv10",repoUrl:"https://github.com/THU-MIG/yolov10",docsUrl:"https://github.com/THU-MIG/yolov10",countDownloads:'path_extension:"pt" OR path_extension:"safetensors"',snippets:PM},"3dtopia-xl":{prettyLabel:"3DTopia-XL",repoName:"3DTopia-XL",repoUrl:"https://github.com/3DTopia/3DTopia-XL",filter:!1,countDownloads:'path:"model_vae_fp16.pt"',snippets:Qle}};Object.entries(Jle).filter(([n,e])=>e.filter).map(([n])=>n);var cS;(function(n){n[n.F32=0]="F32",n[n.F16=1]="F16",n[n.Q4_0=2]="Q4_0",n[n.Q4_1=3]="Q4_1",n[n.Q5_0=6]="Q5_0",n[n.Q5_1=7]="Q5_1",n[n.Q8_0=8]="Q8_0",n[n.Q8_1=9]="Q8_1",n[n.Q2_K=10]="Q2_K",n[n.Q3_K=11]="Q3_K",n[n.Q4_K=12]="Q4_K",n[n.Q5_K=13]="Q5_K",n[n.Q6_K=14]="Q6_K",n[n.Q8_K=15]="Q8_K",n[n.IQ2_XXS=16]="IQ2_XXS",n[n.IQ2_XS=17]="IQ2_XS",n[n.IQ3_XXS=18]="IQ3_XXS",n[n.IQ1_S=19]="IQ1_S",n[n.IQ4_NL=20]="IQ4_NL",n[n.IQ3_S=21]="IQ3_S",n[n.IQ2_S=22]="IQ2_S",n[n.IQ4_XS=23]="IQ4_XS",n[n.I8=24]="I8",n[n.I16=25]="I16",n[n.I32=26]="I32",n[n.I64=27]="I64",n[n.F64=28]="F64",n[n.IQ1_M=29]="IQ1_M",n[n.BF16=30]="BF16"})(cS||(cS={}));const Zle=Object.values(cS).filter(n=>typeof n=="string");new RegExp(`(?<quant>${Zle.join("|")})(_(?<sizeVariation>[A-Z]+))?`);const eue=["python","js","sh"];var ie=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",NullLiteral:"NullLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator",Macro:"Macro",EndMacro:"EndMacro"}),OM=Object.freeze({set:ie.Set,for:ie.For,in:ie.In,is:ie.Is,if:ie.If,else:ie.Else,endif:ie.EndIf,elif:ie.ElseIf,endfor:ie.EndFor,and:ie.And,or:ie.Or,not:ie.Not,"not in":ie.NotIn,macro:ie.Macro,endmacro:ie.EndMacro,true:ie.BooleanLiteral,false:ie.BooleanLiteral,none:ie.NullLiteral,True:ie.BooleanLiteral,False:ie.BooleanLiteral,None:ie.NullLiteral}),Rc=class{constructor(n,e){this.value=n,this.type=e}};function FM(n){return/\w/.test(n)}function JC(n){return/[0-9]/.test(n)}var tue=[["{%",ie.OpenStatement],["%}",ie.CloseStatement],["{{",ie.OpenExpression],["}}",ie.CloseExpression],["(",ie.OpenParen],[")",ie.CloseParen],["{",ie.OpenCurlyBracket],["}",ie.CloseCurlyBracket],["[",ie.OpenSquareBracket],["]",ie.CloseSquareBracket],[",",ie.Comma],[".",ie.Dot],[":",ie.Colon],["|",ie.Pipe],["<=",ie.ComparisonBinaryOperator],[">=",ie.ComparisonBinaryOperator],["==",ie.ComparisonBinaryOperator],["!=",ie.ComparisonBinaryOperator],["<",ie.ComparisonBinaryOperator],[">",ie.ComparisonBinaryOperator],["+",ie.AdditiveBinaryOperator],["-",ie.AdditiveBinaryOperator],["*",ie.MultiplicativeBinaryOperator],["/",ie.MultiplicativeBinaryOperator],["%",ie.MultiplicativeBinaryOperator],["=",ie.Equals]],nue=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function rue(n,e={}){return n.endsWith(`
`)&&(n=n.slice(0,-1)),n=n.replace(/{#.*?#}/gs,"{##}"),e.lstrip_blocks&&(n=n.replace(/^[ \t]*({[#%])/gm,"$1")),e.trim_blocks&&(n=n.replace(/([#%]})\n/g,"$1")),n.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function sue(n,e={}){var o,a,l;const t=[],r=rue(n,e);let s=0;const i=u=>{let c="";for(;u(r[s]);){if(r[s]==="\\"){if(++s,s>=r.length)throw new SyntaxError("Unexpected end of input");const h=r[s++],d=nue.get(h);if(d===void 0)throw new SyntaxError(`Unexpected escaped character: ${h}`);c+=d;continue}if(c+=r[s++],s>=r.length)throw new SyntaxError("Unexpected end of input")}return c};e:for(;s<r.length;){const u=(o=t.at(-1))==null?void 0:o.type;if(u===void 0||u===ie.CloseStatement||u===ie.CloseExpression){let h="";for(;s<r.length&&!(r[s]==="{"&&(r[s+1]==="%"||r[s+1]==="{"));)h+=r[s++];if(h.length>0){t.push(new Rc(h,ie.Text));continue}}i(h=>/\s/.test(h));const c=r[s];if(c==="-"||c==="+"){const h=(a=t.at(-1))==null?void 0:a.type;if(h===ie.Text||h===void 0)throw new SyntaxError(`Unexpected character: ${c}`);switch(h){case ie.Identifier:case ie.NumericLiteral:case ie.BooleanLiteral:case ie.NullLiteral:case ie.StringLiteral:case ie.CloseParen:case ie.CloseSquareBracket:break;default:{++s;const d=i(JC);t.push(new Rc(`${c}${d}`,d.length>0?ie.NumericLiteral:ie.UnaryOperator));continue}}}for(const[h,d]of tue)if(r.slice(s,s+h.length)===h){t.push(new Rc(h,d)),s+=h.length;continue e}if(c==="'"||c==='"'){++s;const h=i(d=>d!==c);t.push(new Rc(h,ie.StringLiteral)),++s;continue}if(JC(c)){const h=i(JC);t.push(new Rc(h,ie.NumericLiteral));continue}if(FM(c)){const h=i(FM),d=Object.hasOwn(OM,h)?OM[h]:ie.Identifier;d===ie.In&&((l=t.at(-1))==null?void 0:l.type)===ie.Not?(t.pop(),t.push(new Rc("not in",ie.NotIn))):t.push(new Rc(h,d));continue}throw new SyntaxError(`Unexpected character: ${c}`)}return t}var pp=class{constructor(){Ie(this,"type","Statement")}},iue=class extends pp{constructor(e){super();Ie(this,"type","Program");this.body=e}},MM=class extends pp{constructor(t,r,s){super();Ie(this,"type","If");this.test=t,this.body=r,this.alternate=s}},oue=class extends pp{constructor(e,t,r,s){super();Ie(this,"type","For");this.loopvar=e,this.iterable=t,this.body=r,this.defaultBlock=s}},aue=class extends pp{constructor(e,t){super();Ie(this,"type","Set");this.assignee=e,this.value=t}},lue=class extends pp{constructor(e,t,r){super();Ie(this,"type","Macro");this.name=e,this.args=t,this.body=r}},zo=class extends pp{constructor(){super(...arguments);Ie(this,"type","Expression")}},uue=class extends zo{constructor(e,t,r){super();Ie(this,"type","MemberExpression");this.object=e,this.property=t,this.computed=r}},cue=class extends zo{constructor(e,t){super();Ie(this,"type","CallExpression");this.callee=e,this.args=t}},Dc=class extends zo{constructor(e){super();Ie(this,"type","Identifier");this.value=e}},qh=class extends zo{constructor(e){super();Ie(this,"type","Literal");this.value=e}},hue=class extends qh{constructor(){super(...arguments);Ie(this,"type","NumericLiteral")}},LM=class extends qh{constructor(){super(...arguments);Ie(this,"type","StringLiteral")}},BM=class extends qh{constructor(){super(...arguments);Ie(this,"type","BooleanLiteral")}},VM=class extends qh{constructor(){super(...arguments);Ie(this,"type","NullLiteral")}},due=class extends qh{constructor(){super(...arguments);Ie(this,"type","ArrayLiteral")}},zM=class extends qh{constructor(){super(...arguments);Ie(this,"type","TupleLiteral")}},fue=class extends qh{constructor(){super(...arguments);Ie(this,"type","ObjectLiteral")}},fm=class extends zo{constructor(e,t,r){super();Ie(this,"type","BinaryExpression");this.operator=e,this.left=t,this.right=r}},pue=class extends zo{constructor(e,t){super();Ie(this,"type","FilterExpression");this.operand=e,this.filter=t}},mue=class extends zo{constructor(e,t){super();Ie(this,"type","SelectExpression");this.iterable=e,this.test=t}},gue=class extends zo{constructor(e,t,r){super();Ie(this,"type","TestExpression");this.operand=e,this.negate=t,this.test=r}},vue=class extends zo{constructor(e,t){super();Ie(this,"type","UnaryExpression");this.operator=e,this.argument=t}},yue=class extends zo{constructor(e=void 0,t=void 0,r=void 0){super();Ie(this,"type","SliceExpression");this.start=e,this.stop=t,this.step=r}},xue=class extends zo{constructor(e,t){super();Ie(this,"type","KeywordArgumentExpression");this.key=e,this.value=t}};function bue(n){const e=new iue([]);let t=0;function r(O,F){const P=n[t++];if(!P||P.type!==O)throw new Error(`Parser Error: ${F}. ${P.type} !== ${O}.`);return P}function s(){switch(n[t].type){case ie.Text:return a();case ie.OpenStatement:return l();case ie.OpenExpression:return u();default:throw new SyntaxError(`Unexpected token type: ${n[t].type}`)}}function i(...O){return t+O.length<=n.length&&O.some((F,P)=>F!==n[t+P].type)}function o(...O){return t+O.length<=n.length&&O.every((F,P)=>F===n[t+P].type)}function a(){return new LM(r(ie.Text,"Expected text token").value)}function l(){r(ie.OpenStatement,"Expected opening statement token");let O;switch(n[t].type){case ie.Set:++t,O=c(),r(ie.CloseStatement,"Expected closing statement token");break;case ie.If:++t,O=h(),r(ie.OpenStatement,"Expected {% token"),r(ie.EndIf,"Expected endif token"),r(ie.CloseStatement,"Expected %} token");break;case ie.Macro:++t,O=d(),r(ie.OpenStatement,"Expected {% token"),r(ie.EndMacro,"Expected endmacro token"),r(ie.CloseStatement,"Expected %} token");break;case ie.For:++t,O=p(),r(ie.OpenStatement,"Expected {% token"),r(ie.EndFor,"Expected endfor token"),r(ie.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${n[t].type}`)}return O}function u(){r(ie.OpenExpression,"Expected opening expression token");const O=m();return r(ie.CloseExpression,"Expected closing expression token"),O}function c(){const O=m();if(o(ie.Equals)){++t;const F=c();return new aue(O,F)}return O}function h(){var U,W,X,Z,ne,he,le,pe;const O=m();r(ie.CloseStatement,"Expected closing statement token");const F=[],P=[];for(;!(((U=n[t])==null?void 0:U.type)===ie.OpenStatement&&(((W=n[t+1])==null?void 0:W.type)===ie.ElseIf||((X=n[t+1])==null?void 0:X.type)===ie.Else||((Z=n[t+1])==null?void 0:Z.type)===ie.EndIf));)F.push(s());if(((ne=n[t])==null?void 0:ne.type)===ie.OpenStatement&&((he=n[t+1])==null?void 0:he.type)!==ie.EndIf)if(++t,o(ie.ElseIf))r(ie.ElseIf,"Expected elseif token"),P.push(h());else for(r(ie.Else,"Expected else token"),r(ie.CloseStatement,"Expected closing statement token");!(((le=n[t])==null?void 0:le.type)===ie.OpenStatement&&((pe=n[t+1])==null?void 0:pe.type)===ie.EndIf);)P.push(s());return new MM(O,F,P)}function d(){const O=L();if(O.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const F=C();r(ie.CloseStatement,"Expected closing statement token");const P=[];for(;i(ie.OpenStatement,ie.EndMacro);)P.push(s());return new lue(O,F,P)}function f(O=!1){const F=O?L:m,P=[F()],U=o(ie.Comma);for(;U&&(++t,P.push(F()),!!o(ie.Comma)););return U?new zM(P):P[0]}function p(){const O=f(!0);if(!(O instanceof Dc||O instanceof zM))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${O.type} instead`);r(ie.In,"Expected `in` keyword following loop variable");const F=m();r(ie.CloseStatement,"Expected closing statement token");const P=[];for(;i(ie.OpenStatement,ie.EndFor)&&i(ie.OpenStatement,ie.Else);)P.push(s());const U=[];if(o(ie.OpenStatement,ie.Else))for(++t,++t,r(ie.CloseStatement,"Expected closing statement token");i(ie.OpenStatement,ie.EndFor);)U.push(s());return new oue(O,F,P,U)}function m(){return g()}function g(){const O=v();if(o(ie.If)){++t;const F=v();if(o(ie.Else)){++t;const P=v();return new MM(F,[O],[P])}else return new mue(O,F)}return O}function v(){let O=y();for(;o(ie.Or);){const F=n[t];++t;const P=y();O=new fm(F,O,P)}return O}function y(){let O=x();for(;o(ie.And);){const F=n[t];++t;const P=x();O=new fm(F,O,P)}return O}function x(){let O;for(;o(ie.Not);){const F=n[t];++t;const P=x();O=new vue(F,P)}return O??b()}function b(){let O=_();for(;o(ie.ComparisonBinaryOperator)||o(ie.In)||o(ie.NotIn);){const F=n[t];++t;const P=_();O=new fm(F,O,P)}return O}function _(){let O=R();for(;o(ie.AdditiveBinaryOperator);){const F=n[t];++t;const P=R();O=new fm(F,O,P)}return O}function E(){const O=N(L());return o(ie.OpenParen)?I(O):O}function I(O){let F=new cue(O,C());return F=N(F),o(ie.OpenParen)&&(F=I(F)),F}function C(){r(ie.OpenParen,"Expected opening parenthesis for arguments list");const O=S();return r(ie.CloseParen,"Expected closing parenthesis for arguments list"),O}function S(){const O=[];for(;!o(ie.CloseParen);){let F=m();if(o(ie.Equals)){if(++t,!(F instanceof Dc))throw new SyntaxError("Expected identifier for keyword argument");const P=m();F=new xue(F,P)}O.push(F),o(ie.Comma)&&++t}return O}function T(){const O=[];let F=!1;for(;!o(ie.CloseSquareBracket);)o(ie.Colon)?(O.push(void 0),++t,F=!0):(O.push(m()),o(ie.Colon)&&(++t,F=!0));if(O.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(F){if(O.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new yue(...O)}return O[0]}function N(O){for(;o(ie.Dot)||o(ie.OpenSquareBracket);){const F=n[t];++t;let P;const U=F.type!==ie.Dot;if(U)P=T(),r(ie.CloseSquareBracket,"Expected closing square bracket");else if(P=L(),P.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");O=new uue(O,P,U)}return O}function R(){let O=D();for(;o(ie.MultiplicativeBinaryOperator);){const F=n[t];++t;const P=D();O=new fm(F,O,P)}return O}function D(){let O=z();for(;o(ie.Is);){++t;const F=o(ie.Not);F&&++t;let P=L();if(P instanceof BM?P=new Dc(P.value.toString()):P instanceof VM&&(P=new Dc("none")),!(P instanceof Dc))throw new SyntaxError("Expected identifier for the test");O=new gue(O,F,P)}return O}function z(){let O=E();for(;o(ie.Pipe);){++t;let F=L();if(!(F instanceof Dc))throw new SyntaxError("Expected identifier for the filter");o(ie.OpenParen)&&(F=I(F)),O=new pue(O,F)}return O}function L(){const O=n[t];switch(O.type){case ie.NumericLiteral:return++t,new hue(Number(O.value));case ie.StringLiteral:return++t,new LM(O.value);case ie.BooleanLiteral:return++t,new BM(O.value.toLowerCase()==="true");case ie.NullLiteral:return++t,new VM(null);case ie.Identifier:return++t,new Dc(O.value);case ie.OpenParen:{++t;const F=f();if(n[t].type!==ie.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${n[t].type} instead`);return++t,F}case ie.OpenSquareBracket:{++t;const F=[];for(;!o(ie.CloseSquareBracket);)F.push(m()),o(ie.Comma)&&++t;return++t,new due(F)}case ie.OpenCurlyBracket:{++t;const F=new Map;for(;!o(ie.CloseCurlyBracket);){const P=m();r(ie.Colon,"Expected colon between key and value in object literal");const U=m();F.set(P,U),o(ie.Comma)&&++t}return++t,new fue(F)}default:throw new SyntaxError(`Unexpected token: ${O.type}`)}}for(;t<n.length;)e.body.push(s());return e}function wue(n,e,t=1){e===void 0&&(e=n,n=0);const r=[];for(let s=n;s<e;s+=t)r.push(s);return r}function UM(n,e,t,r=1){const s=Math.sign(r);s>=0?(e=(e??(e=0))<0?Math.max(n.length+e,0):Math.min(e,n.length),t=(t??(t=n.length))<0?Math.max(n.length+t,0):Math.min(t,n.length)):(e=(e??(e=n.length-1))<0?Math.max(n.length+e,-1):Math.min(e,n.length-1),t=(t??(t=-1))<-1?Math.max(n.length+t,-1):Math.min(t,n.length-1));const i=[];for(let o=e;s*o<s*t;o+=r)i.push(n[o]);return i}function Fj(n){return n.replace(/\b\w/g,e=>e.toUpperCase())}var $l=class{constructor(n=void 0){Ie(this,"type","RuntimeValue");Ie(this,"value");Ie(this,"builtins",new Map);this.value=n}__bool__(){return new Nn(!!this.value)}},Ht=class extends $l{constructor(){super(...arguments);Ie(this,"type","NumericValue")}},rt=class extends $l{constructor(){super(...arguments);Ie(this,"type","StringValue");Ie(this,"builtins",new Map([["upper",new di(()=>new rt(this.value.toUpperCase()))],["lower",new di(()=>new rt(this.value.toLowerCase()))],["strip",new di(()=>new rt(this.value.trim()))],["title",new di(()=>new rt(Fj(this.value)))],["length",new Ht(this.value.length)],["rstrip",new di(()=>new rt(this.value.trimEnd()))],["lstrip",new di(()=>new rt(this.value.trimStart()))],["split",new di(e=>{const t=e[0]??new Bi;if(!(t instanceof rt||t instanceof Bi))throw new Error("sep argument must be a string or null");const r=e[1]??new Ht(-1);if(!(r instanceof Ht))throw new Error("maxsplit argument must be a number");let s=[];if(t instanceof Bi){const i=this.value.trimStart();for(const{0:o,index:a}of i.matchAll(/\S+/g)){if(r.value!==-1&&s.length>=r.value&&a!==void 0){s.push(o+i.slice(a+o.length));break}s.push(o)}}else{if(t.value==="")throw new Error("empty separator");s=this.value.split(t.value),r.value!==-1&&s.length>r.value&&s.push(s.splice(r.value).join(t.value))}return new In(s.map(i=>new rt(i)))})]]))}},Nn=class extends $l{constructor(){super(...arguments);Ie(this,"type","BooleanValue")}},Li=class extends $l{constructor(){super(...arguments);Ie(this,"type","ObjectValue");Ie(this,"builtins",new Map([["get",new di(([t,r])=>{if(!(t instanceof rt))throw new Error(`Object key must be a string: got ${t.type}`);return this.value.get(t.value)??r??new Bi})],["items",new di(()=>new In(Array.from(this.value.entries()).map(([t,r])=>new In([new rt(t),r]))))]]))}__bool__(){return new Nn(this.value.size>0)}},_ue=class extends Li{constructor(){super(...arguments);Ie(this,"type","KeywordArgumentsValue")}},In=class extends $l{constructor(){super(...arguments);Ie(this,"type","ArrayValue");Ie(this,"builtins",new Map([["length",new Ht(this.value.length)]]))}__bool__(){return new Nn(this.value.length>0)}},kue=class extends In{constructor(){super(...arguments);Ie(this,"type","TupleValue")}},di=class extends $l{constructor(){super(...arguments);Ie(this,"type","FunctionValue")}},Bi=class extends $l{constructor(){super(...arguments);Ie(this,"type","NullValue")}},ci=class extends $l{constructor(){super(...arguments);Ie(this,"type","UndefinedValue")}},Rm=class{constructor(e){Ie(this,"variables",new Map([["namespace",new di(e=>{if(e.length===0)return new Li(new Map);if(e.length!==1||!(e[0]instanceof Li))throw new Error("`namespace` expects either zero arguments or a single object argument");return e[0]})]]));Ie(this,"tests",new Map([["boolean",e=>e.type==="BooleanValue"],["callable",e=>e instanceof di],["odd",e=>{if(e.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${e.type}`);return e.value%2!==0}],["even",e=>{if(e.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${e.type}`);return e.value%2===0}],["false",e=>e.type==="BooleanValue"&&!e.value],["true",e=>e.type==="BooleanValue"&&e.value],["none",e=>e.type==="NullValue"],["string",e=>e.type==="StringValue"],["number",e=>e.type==="NumericValue"],["integer",e=>e.type==="NumericValue"&&Number.isInteger(e.value)],["iterable",e=>e.type==="ArrayValue"||e.type==="StringValue"],["mapping",e=>e.type==="ObjectValue"],["lower",e=>{const t=e.value;return e.type==="StringValue"&&t===t.toLowerCase()}],["upper",e=>{const t=e.value;return e.type==="StringValue"&&t===t.toUpperCase()}],["none",e=>e.type==="NullValue"],["defined",e=>e.type!=="UndefinedValue"],["undefined",e=>e.type==="UndefinedValue"],["equalto",(e,t)=>e.value===t.value],["eq",(e,t)=>e.value===t.value]]));this.parent=e}set(e,t){return this.declareVariable(e,ob(t))}declareVariable(e,t){if(this.variables.has(e))throw new SyntaxError(`Variable already declared: ${e}`);return this.variables.set(e,t),t}setVariable(e,t){return this.variables.set(e,t),t}resolve(e){if(this.variables.has(e))return this;if(this.parent)return this.parent.resolve(e);throw new Error(`Unknown variable: ${e}`)}lookupVariable(e){try{return this.resolve(e).variables.get(e)??new ci}catch{return new ci}}},Cue=class{constructor(n){Ie(this,"global");this.global=n??new Rm}run(n){return this.evaluate(n,this.global)}evaluateBinaryExpression(n,e){const t=this.evaluate(n.left,e);switch(n.operator.value){case"and":return t.__bool__().value?this.evaluate(n.right,e):t;case"or":return t.__bool__().value?t:this.evaluate(n.right,e)}const r=this.evaluate(n.right,e);switch(n.operator.value){case"==":return new Nn(t.value==r.value);case"!=":return new Nn(t.value!=r.value)}if(t instanceof ci||r instanceof ci)throw new Error("Cannot perform operation on undefined values");if(t instanceof Bi||r instanceof Bi)throw new Error("Cannot perform operation on null values");if(t instanceof Ht&&r instanceof Ht)switch(n.operator.value){case"+":return new Ht(t.value+r.value);case"-":return new Ht(t.value-r.value);case"*":return new Ht(t.value*r.value);case"/":return new Ht(t.value/r.value);case"%":return new Ht(t.value%r.value);case"<":return new Nn(t.value<r.value);case">":return new Nn(t.value>r.value);case">=":return new Nn(t.value>=r.value);case"<=":return new Nn(t.value<=r.value)}else if(t instanceof In&&r instanceof In)switch(n.operator.value){case"+":return new In(t.value.concat(r.value))}else if(r instanceof In){const s=r.value.find(i=>i.value===t.value)!==void 0;switch(n.operator.value){case"in":return new Nn(s);case"not in":return new Nn(!s)}}if(t instanceof rt||r instanceof rt)switch(n.operator.value){case"+":return new rt(t.value.toString()+r.value.toString())}if(t instanceof rt&&r instanceof rt)switch(n.operator.value){case"in":return new Nn(r.value.includes(t.value));case"not in":return new Nn(!r.value.includes(t.value))}if(t instanceof rt&&r instanceof Li)switch(n.operator.value){case"in":return new Nn(r.value.has(t.value));case"not in":return new Nn(!r.value.has(t.value))}throw new SyntaxError(`Unknown operator "${n.operator.value}" between ${t.type} and ${r.type}`)}evaluateArguments(n,e){const t=[],r=new Map;for(const s of n)if(s.type==="KeywordArgumentExpression"){const i=s;r.set(i.key.value,this.evaluate(i.value,e))}else{if(r.size>0)throw new Error("Positional arguments must come before keyword arguments");t.push(this.evaluate(s,e))}return[t,r]}evaluateFilterExpression(n,e){const t=this.evaluate(n.operand,e);if(n.filter.type==="Identifier"){const r=n.filter;if(r.value==="tojson")return new rt(Zb(t));if(t instanceof In)switch(r.value){case"list":return t;case"first":return t.value[0];case"last":return t.value[t.value.length-1];case"length":return new Ht(t.value.length);case"reverse":return new In(t.value.reverse());case"sort":return new In(t.value.sort((s,i)=>{if(s.type!==i.type)throw new Error(`Cannot compare different types: ${s.type} and ${i.type}`);switch(s.type){case"NumericValue":return s.value-i.value;case"StringValue":return s.value.localeCompare(i.value);default:throw new Error(`Cannot compare type: ${s.type}`)}}));case"join":return new rt(t.value.map(s=>s.value).join(""));default:throw new Error(`Unknown ArrayValue filter: ${r.value}`)}else if(t instanceof rt)switch(r.value){case"length":return new Ht(t.value.length);case"upper":return new rt(t.value.toUpperCase());case"lower":return new rt(t.value.toLowerCase());case"title":return new rt(Fj(t.value));case"capitalize":return new rt(t.value.charAt(0).toUpperCase()+t.value.slice(1));case"trim":return new rt(t.value.trim());case"indent":return new rt(t.value.split(`
`).map((s,i)=>i===0||s.length===0?s:"    "+s).join(`
`));case"join":case"string":return t;default:throw new Error(`Unknown StringValue filter: ${r.value}`)}else if(t instanceof Ht)switch(r.value){case"abs":return new Ht(Math.abs(t.value));default:throw new Error(`Unknown NumericValue filter: ${r.value}`)}else if(t instanceof Li)switch(r.value){case"items":return new In(Array.from(t.value.entries()).map(([s,i])=>new In([new rt(s),i])));case"length":return new Ht(t.value.size);default:throw new Error(`Unknown ObjectValue filter: ${r.value}`)}throw new Error(`Cannot apply filter "${r.value}" to type: ${t.type}`)}else if(n.filter.type==="CallExpression"){const r=n.filter;if(r.callee.type!=="Identifier")throw new Error(`Unknown filter: ${r.callee.type}`);const s=r.callee.value;if(s==="tojson"){const[,i]=this.evaluateArguments(r.args,e),o=i.get("indent")??new Bi;if(!(o instanceof Ht||o instanceof Bi))throw new Error("If set, indent must be a number");return new rt(Zb(t,o.value))}else if(s==="join"){let i;if(t instanceof rt)i=Array.from(t.value);else if(t instanceof In)i=t.value.map(u=>u.value);else throw new Error(`Cannot apply filter "${s}" to type: ${t.type}`);const[o,a]=this.evaluateArguments(r.args,e),l=o.at(0)??a.get("separator")??new rt("");if(!(l instanceof rt))throw new Error("separator must be a string");return new rt(i.join(l.value))}if(t instanceof In){switch(s){case"selectattr":case"rejectattr":{const i=s==="selectattr";if(t.value.some(h=>!(h instanceof Li)))throw new Error(`\`${s}\` can only be applied to array of objects`);if(r.args.some(h=>h.type!=="StringLiteral"))throw new Error(`arguments of \`${s}\` must be strings`);const[o,a,l]=r.args.map(h=>this.evaluate(h,e));let u;if(a){const h=e.tests.get(a.value);if(!h)throw new Error(`Unknown test: ${a.value}`);u=h}else u=(...h)=>h[0].__bool__().value;const c=t.value.filter(h=>{const d=h.value.get(o.value),f=d?u(d,l):!1;return i?f:!f});return new In(c)}case"map":{const[,i]=this.evaluateArguments(r.args,e);if(i.has("attribute")){const o=i.get("attribute");if(!(o instanceof rt))throw new Error("attribute must be a string");const a=i.get("default"),l=t.value.map(u=>{if(!(u instanceof Li))throw new Error("items in map must be an object");return u.value.get(o.value)??a??new ci});return new In(l)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${s}`)}else if(t instanceof rt){switch(s){case"indent":{const[i,o]=this.evaluateArguments(r.args,e),a=i.at(0)??o.get("width")??new Ht(4);if(!(a instanceof Ht))throw new Error("width must be a number");const l=i.at(1)??o.get("first")??new Nn(!1),u=i.at(2)??o.get("blank")??new Nn(!1),c=t.value.split(`
`),h=" ".repeat(a.value),d=c.map((f,p)=>!l.value&&p===0||!u.value&&f.length===0?f:h+f);return new rt(d.join(`
`))}}throw new Error(`Unknown StringValue filter: ${s}`)}else throw new Error(`Cannot apply filter "${s}" to type: ${t.type}`)}throw new Error(`Unknown filter: ${n.filter.type}`)}evaluateTestExpression(n,e){const t=this.evaluate(n.operand,e),r=e.tests.get(n.test.value);if(!r)throw new Error(`Unknown test: ${n.test.value}`);const s=r(t);return new Nn(n.negate?!s:s)}evaluateUnaryExpression(n,e){const t=this.evaluate(n.argument,e);switch(n.operator.value){case"not":return new Nn(!t.value);default:throw new SyntaxError(`Unknown operator: ${n.operator.value}`)}}evalProgram(n,e){return this.evaluateBlock(n.body,e)}evaluateBlock(n,e){let t="";for(const r of n){const s=this.evaluate(r,e);s.type!=="NullValue"&&s.type!=="UndefinedValue"&&(t+=s.value)}return new rt(t)}evaluateIdentifier(n,e){return e.lookupVariable(n.value)}evaluateCallExpression(n,e){const[t,r]=this.evaluateArguments(n.args,e);r.size>0&&t.push(new _ue(r));const s=this.evaluate(n.callee,e);if(s.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${s.type}`);return s.value(t,e)}evaluateSliceExpression(n,e,t){if(!(n instanceof In||n instanceof rt))throw new Error("Slice object must be an array or string");const r=this.evaluate(e.start,t),s=this.evaluate(e.stop,t),i=this.evaluate(e.step,t);if(!(r instanceof Ht||r instanceof ci))throw new Error("Slice start must be numeric or undefined");if(!(s instanceof Ht||s instanceof ci))throw new Error("Slice stop must be numeric or undefined");if(!(i instanceof Ht||i instanceof ci))throw new Error("Slice step must be numeric or undefined");return n instanceof In?new In(UM(n.value,r.value,s.value,i.value)):new rt(UM(Array.from(n.value),r.value,s.value,i.value).join(""))}evaluateMemberExpression(n,e){const t=this.evaluate(n.object,e);let r;if(n.computed){if(n.property.type==="SliceExpression")return this.evaluateSliceExpression(t,n.property,e);r=this.evaluate(n.property,e)}else r=new rt(n.property.value);let s;if(t instanceof Li){if(!(r instanceof rt))throw new Error(`Cannot access property with non-string: got ${r.type}`);s=t.value.get(r.value)??t.builtins.get(r.value)}else if(t instanceof In||t instanceof rt)if(r instanceof Ht)s=t.value.at(r.value),t instanceof rt&&(s=new rt(t.value.at(r.value)));else if(r instanceof rt)s=t.builtins.get(r.value);else throw new Error(`Cannot access property with non-string/non-number: got ${r.type}`);else{if(!(r instanceof rt))throw new Error(`Cannot access property with non-string: got ${r.type}`);s=t.builtins.get(r.value)}return s instanceof $l?s:new ci}evaluateSet(n,e){const t=this.evaluate(n.value,e);if(n.assignee.type==="Identifier"){const r=n.assignee.value;e.setVariable(r,t)}else if(n.assignee.type==="MemberExpression"){const r=n.assignee,s=this.evaluate(r.object,e);if(!(s instanceof Li))throw new Error("Cannot assign to member of non-object");if(r.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");s.value.set(r.property.value,t)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(n.assignee)}`);return new Bi}evaluateIf(n,e){const t=this.evaluate(n.test,e);return this.evaluateBlock(t.__bool__().value?n.body:n.alternate,e)}evaluateFor(n,e){const t=new Rm(e);let r,s;if(n.iterable.type==="SelectExpression"){const u=n.iterable;s=this.evaluate(u.iterable,t),r=u.test}else s=this.evaluate(n.iterable,t);if(!(s instanceof In))throw new Error(`Expected iterable type in for loop: got ${s.type}`);const i=[],o=[];for(let u=0;u<s.value.length;++u){const c=new Rm(t),h=s.value[u];let d;if(n.loopvar.type==="Identifier")d=f=>f.setVariable(n.loopvar.value,h);else if(n.loopvar.type==="TupleLiteral"){const f=n.loopvar;if(h.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${h.type}`);const p=h;if(f.value.length!==p.value.length)throw new Error(`Too ${f.value.length>p.value.length?"few":"many"} items to unpack`);d=m=>{for(let g=0;g<f.value.length;++g){if(f.value[g].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${f.value[g].type}`);m.setVariable(f.value[g].value,p.value[g])}}}else throw new Error(`Invalid loop variable(s): ${n.loopvar.type}`);r&&(d(c),!this.evaluate(r,c).__bool__().value)||(i.push(h),o.push(d))}let a="",l=!0;for(let u=0;u<i.length;++u){const c=new Map([["index",new Ht(u+1)],["index0",new Ht(u)],["revindex",new Ht(i.length-u)],["revindex0",new Ht(i.length-u-1)],["first",new Nn(u===0)],["last",new Nn(u===i.length-1)],["length",new Ht(i.length)],["previtem",u>0?i[u-1]:new ci],["nextitem",u<i.length-1?i[u+1]:new ci]]);t.setVariable("loop",new Li(c)),o[u](t);const h=this.evaluateBlock(n.body,t);a+=h.value,l=!1}if(l){const u=this.evaluateBlock(n.defaultBlock,t);a+=u.value}return new rt(a)}evaluateMacro(n,e){return e.setVariable(n.name.value,new di((t,r)=>{var o;const s=new Rm(r);t=t.slice();let i;((o=t.at(-1))==null?void 0:o.type)==="KeywordArgumentsValue"&&(i=t.pop());for(let a=0;a<n.args.length;++a){const l=n.args[a],u=t[a];if(l.type==="Identifier"){const c=l;if(!u)throw new Error(`Missing positional argument: ${c.value}`);s.setVariable(c.value,u)}else if(l.type==="KeywordArgumentExpression"){const c=l,h=u??(i==null?void 0:i.value.get(c.key.value))??this.evaluate(c.value,s);s.setVariable(c.key.value,h)}else throw new Error(`Unknown argument type: ${l.type}`)}return this.evaluateBlock(n.body,s)})),new Bi}evaluate(n,e){if(n===void 0)return new ci;switch(n.type){case"Program":return this.evalProgram(n,e);case"Set":return this.evaluateSet(n,e);case"If":return this.evaluateIf(n,e);case"For":return this.evaluateFor(n,e);case"Macro":return this.evaluateMacro(n,e);case"NumericLiteral":return new Ht(Number(n.value));case"StringLiteral":return new rt(n.value);case"BooleanLiteral":return new Nn(n.value);case"NullLiteral":return new Bi(n.value);case"ArrayLiteral":return new In(n.value.map(t=>this.evaluate(t,e)));case"TupleLiteral":return new kue(n.value.map(t=>this.evaluate(t,e)));case"ObjectLiteral":{const t=new Map;for(const[r,s]of n.value){const i=this.evaluate(r,e);if(!(i instanceof rt))throw new Error(`Object keys must be strings: got ${i.type}`);t.set(i.value,this.evaluate(s,e))}return new Li(t)}case"Identifier":return this.evaluateIdentifier(n,e);case"CallExpression":return this.evaluateCallExpression(n,e);case"MemberExpression":return this.evaluateMemberExpression(n,e);case"UnaryExpression":return this.evaluateUnaryExpression(n,e);case"BinaryExpression":return this.evaluateBinaryExpression(n,e);case"FilterExpression":return this.evaluateFilterExpression(n,e);case"TestExpression":return this.evaluateTestExpression(n,e);default:throw new SyntaxError(`Unknown node type: ${n.type}`)}}};function ob(n){switch(typeof n){case"number":return new Ht(n);case"string":return new rt(n);case"boolean":return new Nn(n);case"undefined":return new ci;case"object":return n===null?new Bi:Array.isArray(n)?new In(n.map(ob)):new Li(new Map(Object.entries(n).map(([e,t])=>[e,ob(t)])));case"function":return new di((e,t)=>{const r=n(...e.map(s=>s.value))??null;return ob(r)});default:throw new Error(`Cannot convert to runtime value: ${n}`)}}function Zb(n,e,t){const r=t??0;switch(n.type){case"NullValue":case"UndefinedValue":return"null";case"NumericValue":case"StringValue":case"BooleanValue":return JSON.stringify(n.value);case"ArrayValue":case"ObjectValue":{const s=e?" ".repeat(e):"",i=`
`+s.repeat(r),o=i+s;if(n.type==="ArrayValue"){const a=n.value.map(l=>Zb(l,e,r+1));return e?`[${o}${a.join(`,${o}`)}${i}]`:`[${a.join(", ")}]`}else{const a=Array.from(n.value.entries()).map(([l,u])=>{const c=`"${l}": ${Zb(u,e,r+1)}`;return e?`${o}${c}`:c});return e?`{${a.join(",")}${i}}`:`{${a.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${n.type}`)}}var Iue=class{constructor(n){Ie(this,"parsed");const e=sue(n,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=bue(e)}render(n){const e=new Rm;if(e.set("false",!1),e.set("true",!0),e.set("raise_exception",s=>{throw new Error(s)}),e.set("range",wue),n)for(const[s,i]of Object.entries(n))e.set(s,i);return new Cue(e).run(this.parsed).value}},Sue=Object.defineProperty,Mj=(n,e)=>{for(var t in e)Sue(n,t,{get:e[t],enumerable:!0})},hN={};Mj(hN,{audioClassification:()=>uhe,audioToAudio:()=>fhe,automaticSpeechRecognition:()=>che,chatCompletion:()=>Bhe,chatCompletionStream:()=>Vhe,documentQuestionAnswering:()=>zhe,featureExtraction:()=>She,fillMask:()=>Ehe,imageClassification:()=>mhe,imageSegmentation:()=>ghe,imageToImage:()=>_he,imageToText:()=>vhe,objectDetection:()=>yhe,questionAnswering:()=>The,request:()=>zt,sentenceSimilarity:()=>Nhe,streamingRequest:()=>L1,summarization:()=>Rhe,tableQuestionAnswering:()=>Dhe,tabularClassification:()=>Whe,tabularRegression:()=>jhe,textClassification:()=>$he,textGeneration:()=>Phe,textGenerationStream:()=>Ohe,textToImage:()=>bhe,textToSpeech:()=>dhe,textToVideo:()=>Ihe,tokenClassification:()=>Fhe,translation:()=>Mhe,visualQuestionAnswering:()=>Uhe,zeroShotClassification:()=>Lhe,zeroShotImageClassification:()=>Che});var Lj="https://huggingface.co",Bj="https://router.huggingface.co",Eue="https://api.us1.bfl.ai",Tue=()=>Eue,Nue=n=>n.args,Aue=n=>n.authMethod==="provider-key"?{"X-Key":`${n.accessToken}`}:{Authorization:`Bearer ${n.accessToken}`},Rue=n=>`${n.baseUrl}/v1/${n.model}`,Due={makeBaseUrl:Tue,makeBody:Nue,makeHeaders:Aue,makeUrl:Rue},$ue="https://api.cerebras.ai",Pue=()=>$ue,Oue=n=>({...n.args,model:n.model}),Fue=n=>({Authorization:`Bearer ${n.accessToken}`}),Mue=n=>`${n.baseUrl}/v1/chat/completions`,Lue={makeBaseUrl:Pue,makeBody:Oue,makeHeaders:Fue,makeUrl:Mue},Bue="https://api.cohere.com",Vue=()=>Bue,zue=n=>({...n.args,model:n.model}),Uue=n=>({Authorization:`Bearer ${n.accessToken}`}),jue=n=>`${n.baseUrl}/compatibility/v1/chat/completions`,Wue={makeBaseUrl:Vue,makeBody:zue,makeHeaders:Uue,makeUrl:jue},bt=class extends TypeError{constructor(n){super(`Invalid inference output: ${n}. Use the 'request' method with the same parameters to do a custom call with no type checking.`),this.name="InferenceOutputError"}};function ew(n){return/^http(s?):/.test(n)||n.startsWith("/")}function Vj(n){return new Promise(e=>{setTimeout(()=>e(),n)})}var Hue="https://fal.run",Gue="https://queue.fal.run",que=n=>n==="text-to-video"?Gue:Hue,Kue=n=>n.args,Xue=n=>({Authorization:n.authMethod==="provider-key"?`Key ${n.accessToken}`:`Bearer ${n.accessToken}`}),Yue=n=>{const e=`${n.baseUrl}/${n.model}`;return n.authMethod!=="provider-key"&&n.task==="text-to-video"?`${e}?_subdomain=queue`:e},Que={makeBaseUrl:que,makeBody:Kue,makeHeaders:Xue,makeUrl:Yue};async function Jue(n,e,t){if(!n.request_id)throw new bt("No request ID found in the response");let s=n.status;const i=new URL(e),o=`${i.protocol}//${i.host}${i.host==="router.huggingface.co"?"/fal-ai":""}`,a=new URL(n.response_url).pathname,l=i.search,u=`${o}${a}/status${l}`,c=`${o}${a}${l}`;for(;s!=="COMPLETED";){await Vj(500);const f=await fetch(u,{headers:t});if(!f.ok)throw new bt("Failed to fetch response status from fal-ai API");try{s=(await f.json()).status}catch{throw new bt("Failed to parse status response from fal-ai API")}}const h=await fetch(c,{headers:t});let d;try{d=await h.json()}catch{throw new bt("Failed to parse result response from fal-ai API")}if(typeof d=="object"&&d&&"video"in d&&typeof d.video=="object"&&d.video&&"url"in d.video&&typeof d.video.url=="string"&&ew(d.video.url))return await(await fetch(d.video.url)).blob();throw new bt("Expected { video: { url: string } } result format, got instead: "+JSON.stringify(d))}var Zue="https://api.fireworks.ai",ece=()=>Zue,tce=n=>({...n.args,...n.chatCompletion?{model:n.model}:void 0}),nce=n=>({Authorization:`Bearer ${n.accessToken}`}),rce=n=>n.chatCompletion?`${n.baseUrl}/inference/v1/chat/completions`:`${n.baseUrl}/inference`,sce={makeBaseUrl:ece,makeBody:tce,makeHeaders:nce,makeUrl:rce},ice=()=>`${Bj}/hf-inference`,oce=n=>({...n.args,...n.chatCompletion?{model:n.model}:void 0}),ace=n=>({Authorization:`Bearer ${n.accessToken}`}),lce=n=>n.task&&["feature-extraction","sentence-similarity"].includes(n.task)?`${n.baseUrl}/pipeline/${n.task}/${n.model}`:n.chatCompletion?`${n.baseUrl}/models/${n.model}/v1/chat/completions`:`${n.baseUrl}/models/${n.model}`,uce={makeBaseUrl:ice,makeBody:oce,makeHeaders:ace,makeUrl:lce},cce="https://api.hyperbolic.xyz",hce=()=>cce,dce=n=>({...n.args,...n.task==="text-to-image"?{model_name:n.model}:{model:n.model}}),fce=n=>({Authorization:`Bearer ${n.accessToken}`}),pce=n=>n.task==="text-to-image"?`${n.baseUrl}/v1/images/generations`:`${n.baseUrl}/v1/chat/completions`,mce={makeBaseUrl:hce,makeBody:dce,makeHeaders:fce,makeUrl:pce},gce="https://api.studio.nebius.ai",vce=()=>gce,yce=n=>({...n.args,model:n.model}),xce=n=>({Authorization:`Bearer ${n.accessToken}`}),bce=n=>n.task==="text-to-image"?`${n.baseUrl}/v1/images/generations`:n.chatCompletion?`${n.baseUrl}/v1/chat/completions`:n.task==="text-generation"?`${n.baseUrl}/v1/completions`:n.baseUrl,wce={makeBaseUrl:vce,makeBody:yce,makeHeaders:xce,makeUrl:bce},_ce="https://api.novita.ai",kce=()=>_ce,Cce=n=>({...n.args,...n.chatCompletion?{model:n.model}:void 0}),Ice=n=>({Authorization:`Bearer ${n.accessToken}`}),Sce=n=>n.chatCompletion?`${n.baseUrl}/v3/openai/chat/completions`:n.task==="text-generation"?`${n.baseUrl}/v3/openai/completions`:n.task==="text-to-video"?`${n.baseUrl}/v3/hf/${n.model}`:n.baseUrl,Ece={makeBaseUrl:kce,makeBody:Cce,makeHeaders:Ice,makeUrl:Sce},Tce="https://api.replicate.com",Nce=()=>Tce,Ace=n=>({input:n.args,version:n.model.includes(":")?n.model.split(":")[1]:void 0}),Rce=n=>({Authorization:`Bearer ${n.accessToken}`,Prefer:"wait"}),Dce=n=>n.model.includes(":")?`${n.baseUrl}/v1/predictions`:`${n.baseUrl}/v1/models/${n.model}/predictions`,$ce={makeBaseUrl:Nce,makeBody:Ace,makeHeaders:Rce,makeUrl:Dce},Pce="https://api.sambanova.ai",Oce=()=>Pce,Fce=n=>({...n.args,...n.chatCompletion?{model:n.model}:void 0}),Mce=n=>({Authorization:`Bearer ${n.accessToken}`}),Lce=n=>n.chatCompletion?`${n.baseUrl}/v1/chat/completions`:n.baseUrl,Bce={makeBaseUrl:Oce,makeBody:Fce,makeHeaders:Mce,makeUrl:Lce},Vce="https://api.together.xyz",zce=()=>Vce,Uce=n=>({...n.args,model:n.model}),jce=n=>({Authorization:`Bearer ${n.accessToken}`}),Wce=n=>n.task==="text-to-image"?`${n.baseUrl}/v1/images/generations`:n.chatCompletion?`${n.baseUrl}/v1/chat/completions`:n.task==="text-generation"?`${n.baseUrl}/v1/completions`:n.baseUrl,Hce={makeBaseUrl:zce,makeBody:Uce,makeHeaders:jce,makeUrl:Wce},Gce="https://api.openai.com",qce=()=>Gce,Kce=n=>{if(!n.chatCompletion)throw new Error("OpenAI only supports chat completions.");return{...n.args,model:n.model}},Xce=n=>({Authorization:`Bearer ${n.accessToken}`}),Yce=n=>{if(!n.chatCompletion)throw new Error("OpenAI only supports chat completions.");return`${n.baseUrl}/v1/chat/completions`},Qce={makeBaseUrl:qce,makeBody:Kce,makeHeaders:Xce,makeUrl:Yce,clientSideRoutingOnly:!0},Jce="@huggingface/inference",Zce="3.6.2",jM={"black-forest-labs":{},cerebras:{},cohere:{},"fal-ai":{},"fireworks-ai":{},"hf-inference":{},hyperbolic:{},nebius:{},novita:{},openai:{},replicate:{},sambanova:{},together:{}},WM=new Map;async function ehe(n,e,t={}){var o,a;if(n.provider==="hf-inference")return n.model;if(!t.task)throw new Error("task must be specified when using a third-party provider");const r=t.task==="text-generation"&&t.chatCompletion?"conversational":t.task;if((o=jM[n.provider])!=null&&o[n.model])return jM[n.provider][n.model];let s;if(WM.has(n.model)?s=WM.get(n.model):s=await((t==null?void 0:t.fetch)??fetch)(`${Lj}/api/models/${n.model}?expand[]=inferenceProviderMapping`,{headers:(a=e.accessToken)!=null&&a.startsWith("hf_")?{Authorization:`Bearer ${e.accessToken}`}:{}}).then(l=>l.json()).then(l=>l.inferenceProviderMapping).catch(()=>null),!s)throw new Error(`We have not been able to find inference provider information for model ${n.model}.`);const i=s[n.provider];if(i){if(i.task!==r)throw new Error(`Model ${n.model} is not supported for task ${r} and provider ${n.provider}. Supported task: ${i.task}.`);return i.status==="staging"&&console.warn(`Model ${n.model} is in staging mode for provider ${n.provider}. Meant for test purposes only.`),i.providerId}throw new Error(`Model ${n.model} is not supported provider ${n.provider}.`)}var the=`${Bj}/{{PROVIDER}}`,ZC=null,zj={"black-forest-labs":Due,cerebras:Lue,cohere:Wue,"fal-ai":Que,"fireworks-ai":sce,"hf-inference":uce,hyperbolic:mce,openai:Qce,nebius:wce,novita:Ece,replicate:$ce,sambanova:Bce,together:Hce};async function dN(n,e){const{provider:t,model:r}=n,s=t??"hf-inference",i=zj[s],{task:o,chatCompletion:a}=e??{};if(n.endpointUrl&&s!=="hf-inference")throw new Error("Cannot use endpointUrl with a third-party provider.");if(r&&ew(r))throw new Error("Model URLs are no longer supported. Use endpointUrl instead.");if(!r&&!o)throw new Error("No model provided, and no task has been specified.");if(!i)throw new Error(`No provider config found for provider ${s}`);if(i.clientSideRoutingOnly&&!r)throw new Error(`Provider ${s} requires a model ID to be passed directly.`);const l=r??await nhe(o),u=i.clientSideRoutingOnly?she(r,s):await ehe({model:l,provider:s},n,{task:o,chatCompletion:a,fetch:e==null?void 0:e.fetch});return Uj(u,n,e)}function Uj(n,e,t){const{accessToken:r,endpointUrl:s,provider:i,model:o,...a}=e,l=i??"hf-inference",u=zj[l],{includeCredentials:c,task:h,chatCompletion:d,signal:f}=t??{},p=(()=>{if(u.clientSideRoutingOnly){if(r&&r.startsWith("hf_"))throw new Error(`Provider ${l} is closed-source and does not support HF tokens.`);return"provider-key"}return r?r.startsWith("hf_")?"hf-token":"provider-key":c==="include"?"credentials-include":"none"})(),m=s?d?s+"/v1/chat/completions":s:u.makeUrl({authMethod:p,baseUrl:p!=="provider-key"?the.replace("{{PROVIDER}}",l):u.makeBaseUrl(h),model:n,chatCompletion:d,task:h}),g="data"in e&&!!e.data,v=u.makeHeaders({accessToken:r,authMethod:p});g||(v["Content-Type"]="application/json");const x=[`${Jce}/${Zce}`,typeof navigator<"u"?navigator.userAgent:void 0].filter(I=>I!==void 0).join(" ");v["User-Agent"]=x;const b=g?e.data:JSON.stringify(u.makeBody({args:a,model:n,task:h,chatCompletion:d}));let _;typeof c=="string"?_=c:c===!0&&(_="include");const E={headers:v,method:"POST",body:b,..._?{credentials:_}:void 0,signal:f};return{url:m,info:E}}async function nhe(n){ZC||(ZC=await rhe());const e=ZC[n];if(((e==null?void 0:e.models.length)??0)<=0)throw new Error(`No default model defined for task ${n}, please define the model explicitly.`);return e.models[0].id}async function rhe(){const n=await fetch(`${Lj}/api/tasks`);if(!n.ok)throw new Error("Failed to load tasks definitions from Hugging Face Hub.");return await n.json()}function she(n,e){if(!n.startsWith(`${e}/`))throw new Error(`Models from ${e} must be prefixed by "${e}/". Got "${n}".`);return n.slice(e.length+1)}async function zt(n,e){var i;const{url:t,info:r}=await dN(n,e),s=await((e==null?void 0:e.fetch)??fetch)(t,r);if((e==null?void 0:e.retry_on_error)!==!1&&s.status===503)return zt(n,e);if(!s.ok){const o=s.headers.get("Content-Type");if(["application/json","application/problem+json"].some(l=>o==null?void 0:o.startsWith(l))){const l=await s.json();throw[400,422,404,500].includes(s.status)&&(e!=null&&e.chatCompletion)?new Error(`Server ${n.model} does not seem to support chat completion. Error: ${JSON.stringify(l.error)}`):l.error||l.detail?new Error(JSON.stringify(l.error??l.detail)):new Error(l)}const a=o!=null&&o.startsWith("text/plain;")?await s.text():void 0;throw new Error(a??"An error occurred while fetching the blob")}return(i=s.headers.get("Content-Type"))!=null&&i.startsWith("application/json")?await s.json():await s.blob()}function ihe(n){let e,t,r,s=!1;return function(o){e===void 0?(e=o,t=0,r=-1):e=ahe(e,o);const a=e.length;let l=0;for(;t<a;){s&&(e[t]===10&&(l=++t),s=!1);let u=-1;for(;t<a&&u===-1;++t)switch(e[t]){case 58:r===-1&&(r=t-l);break;case 13:s=!0;case 10:u=t;break}if(u===-1)break;n(e.subarray(l,u),r),l=t,r=-1}l===a?e=void 0:l!==0&&(e=e.subarray(l),t-=l)}}function ohe(n,e,t){let r=HM();const s=new TextDecoder;return function(o,a){if(o.length===0)t==null||t(r),r=HM();else if(a>0){const l=s.decode(o.subarray(0,a)),u=a+(o[a+1]===32?2:1),c=s.decode(o.subarray(u));switch(l){case"data":r.data=r.data?r.data+`
`+c:c;break;case"event":r.event=c;break;case"id":n(r.id=c);break;case"retry":const h=parseInt(c,10);isNaN(h)||e(r.retry=h);break}}}}function ahe(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function HM(){return{data:"",event:"",id:"",retry:void 0}}async function*L1(n,e){var u,c;const{url:t,info:r}=await dN({...n,stream:!0},e),s=await((e==null?void 0:e.fetch)??fetch)(t,r);if((e==null?void 0:e.retry_on_error)!==!1&&s.status===503)return yield*L1(n,e);if(!s.ok){if((u=s.headers.get("Content-Type"))!=null&&u.startsWith("application/json")){const h=await s.json();if([400,422,404,500].includes(s.status)&&(e!=null&&e.chatCompletion))throw new Error(`Server ${n.model} does not seem to support chat completion. Error: ${h.error}`);if(typeof h.error=="string")throw new Error(h.error);if(h.error&&"message"in h.error&&typeof h.error.message=="string")throw new Error(h.error.message)}throw new Error(`Server response contains error: ${s.status}`)}if(!((c=s.headers.get("content-type"))!=null&&c.startsWith("text/event-stream")))throw new Error("Server does not support event stream content type, it returned "+s.headers.get("content-type"));if(!s.body)return;const i=s.body.getReader();let o=[];const l=ihe(ohe(()=>{},()=>{},h=>{o.push(h)}));try{for(;;){const{done:h,value:d}=await i.read();if(h)return;l(d);for(const f of o)if(f.data.length>0){if(f.data==="[DONE]")return;const p=JSON.parse(f.data);if(typeof p=="object"&&p!==null&&"error"in p){const m=typeof p.error=="string"?p.error:typeof p.error=="object"&&p.error&&"message"in p.error&&typeof p.error.message=="string"?p.error.message:JSON.stringify(p.error);throw new Error("Error forwarded from backend: "+m)}yield p}o=[]}}finally{i.releaseLock()}}function lhe(n,e){return Object.assign({},...e.map(t=>{if(n[t]!==void 0)return{[t]:n[t]}}))}function jj(n,e){return n.includes(e)}function Fo(n,e){const t=Array.isArray(e)?e:[e],r=Object.keys(n).filter(s=>!jj(t,s));return lhe(n,r)}function fN(n){return"data"in n?n:{...Fo(n,"inputs"),data:n.inputs}}async function uhe(n,e){const t=fN(n),r=await zt(t,{...e,task:"audio-classification"});if(!(Array.isArray(r)&&r.every(i=>typeof i.label=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{label: string, score: number}>");return r}function Of(n){if(globalThis.Buffer)return globalThis.Buffer.from(n).toString("base64");{const e=[];return n.forEach(t=>{e.push(String.fromCharCode(t))}),globalThis.btoa(e.join(""))}}async function che(n,e){const t=await hhe(n),r=await zt(t,{...e,task:"automatic-speech-recognition"});if(!(typeof(r==null?void 0:r.text)=="string"))throw new bt("Expected {text: string}");return r}var GM=["audio/mpeg","audio/mp4","audio/wav","audio/x-wav"];async function hhe(n){if(n.provider==="fal-ai"){const e="data"in n&&n.data instanceof Blob?n.data:"inputs"in n?n.inputs:void 0,t=e==null?void 0:e.type;if(!t)throw new Error("Unable to determine the input's content-type. Make sure your are passing a Blob when using provider fal-ai.");if(!GM.includes(t))throw new Error(`Provider fal-ai does not support blob type ${t} - supported content types are: ${GM.join(", ")}`);const r=Of(new Uint8Array(await e.arrayBuffer()));return{..."data"in n?Fo(n,"data"):Fo(n,"inputs"),audio_url:`data:${t};base64,${r}`}}else return fN(n)}async function dhe(n,e){const t=n.provider==="replicate"?{...Fo(n,["inputs","parameters"]),...n.parameters,text:n.inputs}:n,r=await zt(t,{...e,task:"text-to-speech"});if(r instanceof Blob)return r;if(r&&typeof r=="object"&&"output"in r){if(typeof r.output=="string")return await(await fetch(r.output)).blob();if(Array.isArray(r.output))return await(await fetch(r.output[0])).blob()}throw new bt("Expected Blob or object with output")}async function fhe(n,e){const t=fN(n),r=await zt(t,{...e,task:"audio-to-audio"});return phe(r)}function phe(n){if(!Array.isArray(n))throw new bt("Expected Array");if(!n.every(e=>typeof e=="object"&&e&&"label"in e&&typeof e.label=="string"&&"content-type"in e&&typeof e["content-type"]=="string"&&"blob"in e&&typeof e.blob=="string"))throw new bt("Expected Array<{label: string, audio: Blob}>");return n}function B1(n){return"data"in n?n:{...Fo(n,"inputs"),data:n.inputs}}async function mhe(n,e){const t=B1(n),r=await zt(t,{...e,task:"image-classification"});if(!(Array.isArray(r)&&r.every(i=>typeof i.label=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{label: string, score: number}>");return r}async function ghe(n,e){const t=B1(n),r=await zt(t,{...e,task:"image-segmentation"});if(!(Array.isArray(r)&&r.every(i=>typeof i.label=="string"&&typeof i.mask=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{label: string, mask: string, score: number}>");return r}async function vhe(n,e){var s;const t=B1(n),r=(s=await zt(t,{...e,task:"image-to-text"}))==null?void 0:s[0];if(typeof(r==null?void 0:r.generated_text)!="string")throw new bt("Expected {generated_text: string}");return r}async function yhe(n,e){const t=B1(n),r=await zt(t,{...e,task:"object-detection"});if(!(Array.isArray(r)&&r.every(i=>typeof i.label=="string"&&typeof i.score=="number"&&typeof i.box.xmin=="number"&&typeof i.box.ymin=="number"&&typeof i.box.xmax=="number"&&typeof i.box.ymax=="number")))throw new bt("Expected Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return r}function xhe(n){switch(n){case"fal-ai":return{sync_mode:!0};case"nebius":return{response_format:"b64_json"};case"replicate":return;case"together":return{response_format:"base64"};default:return}}async function bhe(n,e){const t=!n.provider||n.provider==="hf-inference"||n.provider==="sambanova"?n:{...Fo(n,["inputs","parameters"]),...n.parameters,...xhe(n.provider),prompt:n.inputs},r=await zt(t,{...e,task:"text-to-image"});if(r&&typeof r=="object"){if(n.provider==="black-forest-labs"&&"polling_url"in r&&typeof r.polling_url=="string")return await whe(r.polling_url,e==null?void 0:e.outputType);if(n.provider==="fal-ai"&&"images"in r&&Array.isArray(r.images)&&r.images[0].url)return(e==null?void 0:e.outputType)==="url"?r.images[0].url:await(await fetch(r.images[0].url)).blob();if(n.provider==="hyperbolic"&&"images"in r&&Array.isArray(r.images)&&r.images[0]&&typeof r.images[0].image=="string")return(e==null?void 0:e.outputType)==="url"?`data:image/jpeg;base64,${r.images[0].image}`:await(await fetch(`data:image/jpeg;base64,${r.images[0].image}`)).blob();if("data"in r&&Array.isArray(r.data)&&r.data[0].b64_json){const i=r.data[0].b64_json;return(e==null?void 0:e.outputType)==="url"?`data:image/jpeg;base64,${i}`:await(await fetch(`data:image/jpeg;base64,${i}`)).blob()}if("output"in r&&Array.isArray(r.output))return(e==null?void 0:e.outputType)==="url"?r.output[0]:await(await fetch(r.output[0])).blob()}if(!(r&&r instanceof Blob))throw new bt("Expected Blob");return(e==null?void 0:e.outputType)==="url"?`data:image/jpeg;base64,${await r.arrayBuffer().then(o=>Buffer.from(o).toString("base64"))}`:r}async function whe(n,e){const t=new URL(n);for(let r=0;r<5;r++){await Vj(1e3),console.debug(`Polling Black Forest Labs API for the result... ${r+1}/5`),t.searchParams.set("attempt",r.toString(10));const s=await fetch(t,{headers:{"Content-Type":"application/json"}});if(!s.ok)throw new bt("Failed to fetch result from black forest labs API");const i=await s.json();if(typeof i=="object"&&i&&"status"in i&&typeof i.status=="string"&&i.status==="Ready"&&"result"in i&&typeof i.result=="object"&&i.result&&"sample"in i.result&&typeof i.result.sample=="string")return e==="url"?i.result.sample:await(await fetch(i.result.sample)).blob()}throw new bt("Failed to fetch result from black forest labs API")}async function _he(n,e){let t;n.parameters?t={...n,inputs:Of(new Uint8Array(n.inputs instanceof ArrayBuffer?n.inputs:await n.inputs.arrayBuffer()))}:t={accessToken:n.accessToken,model:n.model,data:n.inputs};const r=await zt(t,{...e,task:"image-to-image"});if(!(r&&r instanceof Blob))throw new bt("Expected Blob");return r}async function khe(n){return n.inputs instanceof Blob?{...n,inputs:{image:Of(new Uint8Array(await n.inputs.arrayBuffer()))}}:{...n,inputs:{image:Of(new Uint8Array(n.inputs.image instanceof ArrayBuffer?n.inputs.image:await n.inputs.image.arrayBuffer()))}}}async function Che(n,e){const t=await khe(n),r=await zt(t,{...e,task:"zero-shot-image-classification"});if(!(Array.isArray(r)&&r.every(i=>typeof i.label=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{label: string, score: number}>");return r}var qM=["fal-ai","novita","replicate"];async function Ihe(n,e){if(!n.provider||!jj(qM,n.provider))throw new Error(`textToVideo inference is only supported for the following providers: ${qM.join(", ")}`);const t=n.provider==="fal-ai"||n.provider==="replicate"||n.provider==="novita"?{...Fo(n,["inputs","parameters"]),...n.parameters,prompt:n.inputs}:n,r=await zt(t,{...e,task:"text-to-video"});if(n.provider==="fal-ai"){const{url:s,info:i}=await dN(n,{...e,task:"text-to-video"});return await Jue(r,s,i.headers)}else if(n.provider==="novita"){if(!(typeof r=="object"&&!!r&&"video"in r&&typeof r.video=="object"&&!!r.video&&"video_url"in r.video&&typeof r.video.video_url=="string"&&ew(r.video.video_url)))throw new bt("Expected { video: { video_url: string } }");return await(await fetch(r.video.video_url)).blob()}else{if(!(typeof r=="object"&&!!r&&"output"in r&&typeof r.output=="string"&&ew(r.output)))throw new bt("Expected { output: string }");return await(await fetch(r.output)).blob()}}async function She(n,e){const t=await zt(n,{...e,task:"feature-extraction"});let r=!0;const s=(i,o,a=0)=>a>o?!1:i.every(l=>Array.isArray(l))?i.every(l=>s(l,o,a+1)):i.every(l=>typeof l=="number");if(r=Array.isArray(t)&&s(t,3,0),!r)throw new bt("Expected Array<number[][][] | number[][] | number[] | number>");return t}async function Ehe(n,e){const t=await zt(n,{...e,task:"fill-mask"});if(!(Array.isArray(t)&&t.every(s=>typeof s.score=="number"&&typeof s.sequence=="string"&&typeof s.token=="number"&&typeof s.token_str=="string")))throw new bt("Expected Array<{score: number, sequence: string, token: number, token_str: string}>");return t}async function The(n,e){const t=await zt(n,{...e,task:"question-answering"});if(!(Array.isArray(t)?t.every(s=>typeof s=="object"&&!!s&&typeof s.answer=="string"&&typeof s.end=="number"&&typeof s.score=="number"&&typeof s.start=="number"):typeof t=="object"&&!!t&&typeof t.answer=="string"&&typeof t.end=="number"&&typeof t.score=="number"&&typeof t.start=="number"))throw new bt("Expected Array<{answer: string, end: number, score: number, start: number}>");return Array.isArray(t)?t[0]:t}async function Nhe(n,e){const t=await zt(Ahe(n),{...e,task:"sentence-similarity"});if(!(Array.isArray(t)&&t.every(s=>typeof s=="number")))throw new bt("Expected number[]");return t}function Ahe(n){return{...Fo(n,["inputs","parameters"]),inputs:{...Fo(n.inputs,"sourceSentence")},parameters:{source_sentence:n.inputs.sourceSentence,...n.parameters}}}async function Rhe(n,e){const t=await zt(n,{...e,task:"summarization"});if(!(Array.isArray(t)&&t.every(s=>typeof(s==null?void 0:s.summary_text)=="string")))throw new bt("Expected Array<{summary_text: string}>");return t==null?void 0:t[0]}async function Dhe(n,e){const t=await zt(n,{...e,task:"table-question-answering"});if(!(Array.isArray(t)?t.every(s=>KM(s)):KM(t)))throw new bt("Expected {aggregator: string, answer: string, cells: string[], coordinates: number[][]}");return Array.isArray(t)?t[0]:t}function KM(n){return typeof n=="object"&&!!n&&"aggregator"in n&&typeof n.aggregator=="string"&&"answer"in n&&typeof n.answer=="string"&&"cells"in n&&Array.isArray(n.cells)&&n.cells.every(e=>typeof e=="string")&&"coordinates"in n&&Array.isArray(n.coordinates)&&n.coordinates.every(e=>Array.isArray(e)&&e.every(t=>typeof t=="number"))}async function $he(n,e){var s;const t=(s=await zt(n,{...e,task:"text-classification"}))==null?void 0:s[0];if(!(Array.isArray(t)&&t.every(i=>typeof(i==null?void 0:i.label)=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{label: string, score: number}>");return t}function V1(n){return Array.isArray(n)?n:[n]}async function Phe(n,e){if(n.provider==="together"){n.prompt=n.inputs;const t=await zt(n,{...e,task:"text-generation"});if(!(typeof t=="object"&&"choices"in t&&Array.isArray(t==null?void 0:t.choices)&&typeof(t==null?void 0:t.model)=="string"))throw new bt("Expected ChatCompletionOutput");return{generated_text:t.choices[0].text}}else if(n.provider==="hyperbolic"){const t={messages:[{content:n.inputs,role:"user"}],...n.parameters?{max_tokens:n.parameters.max_new_tokens,...Fo(n.parameters,"max_new_tokens")}:void 0,...Fo(n,["inputs","parameters"])},r=await zt(t,{...e,task:"text-generation"});if(!(typeof r=="object"&&"choices"in r&&Array.isArray(r==null?void 0:r.choices)&&typeof(r==null?void 0:r.model)=="string"))throw new bt("Expected ChatCompletionOutput");return{generated_text:r.choices[0].message.content}}else{const t=V1(await zt(n,{...e,task:"text-generation"}));if(!(Array.isArray(t)&&t.every(s=>"generated_text"in s&&typeof(s==null?void 0:s.generated_text)=="string")))throw new bt("Expected Array<{generated_text: string}>");return t==null?void 0:t[0]}}async function*Ohe(n,e){yield*L1(n,{...e,task:"text-generation"})}async function Fhe(n,e){const t=V1(await zt(n,{...e,task:"token-classification"}));if(!(Array.isArray(t)&&t.every(s=>typeof s.end=="number"&&typeof s.entity_group=="string"&&typeof s.score=="number"&&typeof s.start=="number"&&typeof s.word=="string")))throw new bt("Expected Array<{end: number, entity_group: string, score: number, start: number, word: string}>");return t}async function Mhe(n,e){const t=await zt(n,{...e,task:"translation"});if(!(Array.isArray(t)&&t.every(s=>typeof(s==null?void 0:s.translation_text)=="string")))throw new bt("Expected type Array<{translation_text: string}>");return(t==null?void 0:t.length)===1?t==null?void 0:t[0]:t}async function Lhe(n,e){const t=V1(await zt(n,{...e,task:"zero-shot-classification"}));if(!(Array.isArray(t)&&t.every(s=>Array.isArray(s.labels)&&s.labels.every(i=>typeof i=="string")&&Array.isArray(s.scores)&&s.scores.every(i=>typeof i=="number")&&typeof s.sequence=="string")))throw new bt("Expected Array<{labels: string[], scores: number[], sequence: string}>");return t}async function Bhe(n,e){const t=await zt(n,{...e,task:"text-generation",chatCompletion:!0});if(!(typeof t=="object"&&Array.isArray(t==null?void 0:t.choices)&&typeof(t==null?void 0:t.created)=="number"&&typeof(t==null?void 0:t.id)=="string"&&typeof(t==null?void 0:t.model)=="string"&&(t.system_fingerprint===void 0||t.system_fingerprint===null||typeof t.system_fingerprint=="string")&&typeof(t==null?void 0:t.usage)=="object"))throw new bt("Expected ChatCompletionOutput");return t}async function*Vhe(n,e){yield*L1(n,{...e,task:"text-generation",chatCompletion:!0})}async function zhe(n,e){const t={...n,inputs:{question:n.inputs.question,image:Of(new Uint8Array(await n.inputs.image.arrayBuffer()))}},r=V1(await zt(t,{...e,task:"document-question-answering"}));if(!(Array.isArray(r)&&r.every(i=>typeof i=="object"&&!!i&&typeof(i==null?void 0:i.answer)=="string"&&(typeof i.end=="number"||typeof i.end>"u")&&(typeof i.score=="number"||typeof i.score>"u")&&(typeof i.start=="number"||typeof i.start>"u"))))throw new bt("Expected Array<{answer: string, end?: number, score?: number, start?: number}>");return r[0]}async function Uhe(n,e){const t={...n,inputs:{question:n.inputs.question,image:Of(new Uint8Array(await n.inputs.image.arrayBuffer()))}},r=await zt(t,{...e,task:"visual-question-answering"});if(!(Array.isArray(r)&&r.every(i=>typeof i=="object"&&!!i&&typeof(i==null?void 0:i.answer)=="string"&&typeof i.score=="number")))throw new bt("Expected Array<{answer: string, score: number}>");return r[0]}async function jhe(n,e){const t=await zt(n,{...e,task:"tabular-regression"});if(!(Array.isArray(t)&&t.every(s=>typeof s=="number")))throw new bt("Expected number[]");return t}async function Whe(n,e){const t=await zt(n,{...e,task:"tabular-classification"});if(!(Array.isArray(t)&&t.every(s=>typeof s=="number")))throw new bt("Expected number[]");return t}var Hhe=class{constructor(n="",e={}){Ie(this,"accessToken");Ie(this,"defaultOptions");this.accessToken=n,this.defaultOptions=e;for(const[t,r]of Object.entries(hN))Object.defineProperty(this,t,{enumerable:!1,value:(s,i)=>r({...s,accessToken:n},{...e,...i})})}endpoint(n){return new Ghe(n,this.accessToken,this.defaultOptions)}},Ghe=class{constructor(n,e="",t={}){for(const[r,s]of Object.entries(hN))Object.defineProperty(this,r,{enumerable:!1,value:(i,o)=>s({...i,accessToken:e,endpointUrl:n},{...t,...o})})}},qhe=class extends Hhe{},Khe={};Mj(Khe,{getInferenceSnippets:()=>ide});var Wj={js:{fetch:{basic:`async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "application/json",
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.json();
	return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    console.log(JSON.stringify(response));
});`,basicAudio:`async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "audio/flac"
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.json();
	return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    console.log(JSON.stringify(response));
});`,basicImage:`async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "image/jpeg"
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.json();
	return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    console.log(JSON.stringify(response));
});`,textToAudio:`{% if model.library_name == "transformers" %}
async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "application/json",
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.blob();
    return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    // Returns a byte object of the Audio wavform. Use it directly!
});
{% else %}
async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "application/json",
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
    const result = await response.json();
    return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    console.log(JSON.stringify(response));
});
{% endif %} `,textToImage:`async function query(data) {
	const response = await fetch(
		"{{ fullUrl }}",
		{
			headers: {
				Authorization: "{{ authorizationHeader }}",
				"Content-Type": "application/json",
			},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.blob();
	return result;
}

query({ inputs: {{ providerInputs.asObj.inputs }} }).then((response) => {
    // Use image
});`,zeroShotClassification:`async function query(data) {
    const response = await fetch(
		"{{ fullUrl }}",
        {
            headers: {
				Authorization: "{{ authorizationHeader }}",
                "Content-Type": "application/json",
            },
            method: "POST",
            body: JSON.stringify(data),
        }
    );
    const result = await response.json();
    return result;
}

query({
    inputs: {{ providerInputs.asObj.inputs }},
    parameters: { candidate_labels: ["refund", "legal", "faq"] }
}).then((response) => {
    console.log(JSON.stringify(response));
});`},"huggingface.js":{basic:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const output = await client.{{ methodName }}({
	model: "{{ model.id }}",
	inputs: {{ inputs.asObj.inputs }},
	provider: "{{ provider }}",
});

console.log(output);`,basicAudio:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const data = fs.readFileSync({{inputs.asObj.inputs}});

const output = await client.{{ methodName }}({
	data,
	model: "{{ model.id }}",
	provider: "{{ provider }}",
});

console.log(output);`,basicImage:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const data = fs.readFileSync({{inputs.asObj.inputs}});

const output = await client.{{ methodName }}({
	data,
	model: "{{ model.id }}",
	provider: "{{ provider }}",
});

console.log(output);`,conversational:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const chatCompletion = await client.chatCompletion({
    provider: "{{ provider }}",
    model: "{{ model.id }}",
{{ inputs.asTsString }}
});

console.log(chatCompletion.choices[0].message);`,conversationalStream:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

let out = "";

const stream = await client.chatCompletionStream({
    provider: "{{ provider }}",
    model: "{{ model.id }}",
{{ inputs.asTsString }}
});

for await (const chunk of stream) {
	if (chunk.choices && chunk.choices.length > 0) {
		const newContent = chunk.choices[0].delta.content;
		out += newContent;
		console.log(newContent);
	}  
}`,textToImage:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const image = await client.textToImage({
    provider: "{{ provider }}",
    model: "{{ model.id }}",
	inputs: {{ inputs.asObj.inputs }},
	parameters: { num_inference_steps: 5 },
});
/// Use the generated image (it's a Blob)`,textToVideo:`import { InferenceClient } from "@huggingface/inference";

const client = new InferenceClient("{{ accessToken }}");

const image = await client.textToVideo({
    provider: "{{ provider }}",
    model: "{{ model.id }}",
	inputs: {{ inputs.asObj.inputs }},
});
// Use the generated video (it's a Blob)`},openai:{conversational:`import { OpenAI } from "openai";

const client = new OpenAI({
	baseURL: "{{ baseUrl }}",
	apiKey: "{{ accessToken }}",
});

const chatCompletion = await client.chat.completions.create({
	model: "{{ providerModelId }}",
{{ inputs.asTsString }}
});

console.log(chatCompletion.choices[0].message);`,conversationalStream:`import { OpenAI } from "openai";

const client = new OpenAI({
	baseURL: "{{ baseUrl }}",
	apiKey: "{{ accessToken }}",
});

let out = "";

const stream = await client.chat.completions.create({
    provider: "{{ provider }}",
    model: "{{ model.id }}",
{{ inputs.asTsString }}
});

for await (const chunk of stream) {
	if (chunk.choices && chunk.choices.length > 0) {
		const newContent = chunk.choices[0].delta.content;
		out += newContent;
		console.log(newContent);
	}  
}`}},python:{fal_client:{textToImage:`{% if provider == "fal-ai" %}
import fal_client

result = fal_client.subscribe(
    "{{ providerModelId }}",
    arguments={
        "prompt": {{ inputs.asObj.inputs }},
    },
)
print(result)
{% endif %} `},huggingface_hub:{basic:`result = client.{{ methodName }}(
    inputs={{ inputs.asObj.inputs }},
    model="{{ model.id }}",
)`,basicAudio:'output = client.{{ methodName }}({{ inputs.asObj.inputs }}, model="{{ model.id }}")',basicImage:'output = client.{{ methodName }}({{ inputs.asObj.inputs }}, model="{{ model.id }}")',conversational:`completion = client.chat.completions.create(
    model="{{ model.id }}",
{{ inputs.asPythonString }}
)

print(completion.choices[0].message) `,conversationalStream:`stream = client.chat.completions.create(
    model="{{ model.id }}",
{{ inputs.asPythonString }}
    stream=True,
)

for chunk in stream:
    print(chunk.choices[0].delta.content, end="") `,documentQuestionAnswering:`output = client.document_question_answering(
    "{{ inputs.asObj.image }}",
    question="{{ inputs.asObj.question }}",
    model="{{ model.id }}",
) `,imageToImage:`# output is a PIL.Image object
image = client.image_to_image(
    "{{ inputs.asObj.inputs }}",
    prompt="{{ inputs.asObj.parameters.prompt }}",
    model="{{ model.id }}",
) `,importInferenceClient:`from huggingface_hub import InferenceClient

client = InferenceClient(
    provider="{{ provider }}",
    api_key="{{ accessToken }}",
)`,textToImage:`# output is a PIL.Image object
image = client.text_to_image(
    {{ inputs.asObj.inputs }},
    model="{{ model.id }}",
) `,textToVideo:`video = client.text_to_video(
    {{ inputs.asObj.inputs }},
    model="{{ model.id }}",
) `},openai:{conversational:`from openai import OpenAI

client = OpenAI(
    base_url="{{ baseUrl }}",
    api_key="{{ accessToken }}"
)

completion = client.chat.completions.create(
    model="{{ providerModelId }}",
{{ inputs.asPythonString }}
)

print(completion.choices[0].message) `,conversationalStream:`from openai import OpenAI

client = OpenAI(
    base_url="{{ baseUrl }}",
    api_key="{{ accessToken }}"
)

stream = client.chat.completions.create(
    model="{{ providerModelId }}",
{{ inputs.asPythonString }}
    stream=True,
)

for chunk in stream:
    print(chunk.choices[0].delta.content, end="")`},requests:{basic:`def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

output = query({
    "inputs": {{ providerInputs.asObj.inputs }},
}) `,basicAudio:`def query(filename):
    with open(filename, "rb") as f:
        data = f.read()
    response = requests.post(API_URL, headers={"Content-Type": "audio/flac", **headers}, data=data)
    return response.json()

output = query({{ providerInputs.asObj.inputs }})`,basicImage:`def query(filename):
    with open(filename, "rb") as f:
        data = f.read()
    response = requests.post(API_URL, headers={"Content-Type": "image/jpeg", **headers}, data=data)
    return response.json()

output = query({{ providerInputs.asObj.inputs }})`,conversational:`def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

response = query({
{{ providerInputs.asJsonString }}
})

print(response["choices"][0]["message"])`,conversationalStream:`def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload, stream=True)
    for line in response.iter_lines():
        if not line.startswith(b"data:"):
            continue
        if line.strip() == b"data: [DONE]":
            return
        yield json.loads(line.decode("utf-8").lstrip("data:").rstrip("/n"))

chunks = query({
{{ providerInputs.asJsonString }},
    "stream": True,
})

for chunk in chunks:
    print(chunk["choices"][0]["delta"]["content"], end="")`,documentQuestionAnswering:`def query(payload):
    with open(payload["image"], "rb") as f:
        img = f.read()
        payload["image"] = base64.b64encode(img).decode("utf-8")
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

output = query({
    "inputs": {
        "image": "{{ inputs.asObj.image }}",
        "question": "{{ inputs.asObj.question }}",
    },
}) `,imageToImage:`def query(payload):
    with open(payload["inputs"], "rb") as f:
        img = f.read()
        payload["inputs"] = base64.b64encode(img).decode("utf-8")
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.content

image_bytes = query({
{{ providerInputs.asJsonString }}
})

# You can access the image with PIL.Image for example
import io
from PIL import Image
image = Image.open(io.BytesIO(image_bytes)) `,importRequests:`{% if importBase64 %}
import base64
{% endif %}
{% if importJson %}
import json
{% endif %}
import requests

API_URL = "{{ fullUrl }}"
headers = {"Authorization": "{{ authorizationHeader }}"}`,tabular:`def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.content

response = query({
    "inputs": {
        "data": {{ providerInputs.asObj.inputs }}
    },
}) `,textToAudio:`{% if model.library_name == "transformers" %}
def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.content

audio_bytes = query({
    "inputs": {{ providerInputs.asObj.inputs }},
})
# You can access the audio with IPython.display for example
from IPython.display import Audio
Audio(audio_bytes)
{% else %}
def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

audio, sampling_rate = query({
    "inputs": {{ providerInputs.asObj.inputs }},
})
# You can access the audio with IPython.display for example
from IPython.display import Audio
Audio(audio, rate=sampling_rate)
{% endif %} `,textToImage:`{% if provider == "hf-inference" %}
def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.content

image_bytes = query({
    "inputs": {{ providerInputs.asObj.inputs }},
})

# You can access the image with PIL.Image for example
import io
from PIL import Image
image = Image.open(io.BytesIO(image_bytes))
{% endif %}`,zeroShotClassification:`def query(payload):
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

output = query({
    "inputs": {{ providerInputs.asObj.inputs }},
    "parameters": {"candidate_labels": ["refund", "legal", "faq"]},
}) `,zeroShotImageClassification:`def query(data):
    with open(data["image_path"], "rb") as f:
        img = f.read()
    payload={
        "parameters": data["parameters"],
        "inputs": base64.b64encode(img).decode("utf-8")
    }
    response = requests.post(API_URL, headers=headers, json=payload)
    return response.json()

output = query({
    "image_path": {{ providerInputs.asObj.inputs }},
    "parameters": {"candidate_labels": ["cat", "dog", "llama"]},
}) `}},sh:{curl:{basic:`curl {{ fullUrl }} \\
    -X POST \\
    -H 'Authorization: {{ authorizationHeader }}' \\
    -H 'Content-Type: application/json' \\
    -d '{
{{ providerInputs.asCurlString }}
    }'`,basicAudio:`curl {{ fullUrl }} \\
    -X POST \\
    -H 'Authorization: {{ authorizationHeader }}' \\
    -H 'Content-Type: audio/flac' \\
    --data-binary @{{ providerInputs.asObj.inputs }}`,basicImage:`curl {{ fullUrl }} \\
    -X POST \\
    -H 'Authorization: {{ authorizationHeader }}' \\
    -H 'Content-Type: image/jpeg' \\
    --data-binary @{{ providerInputs.asObj.inputs }}`,conversational:`curl {{ fullUrl }} \\
    -H 'Authorization: {{ authorizationHeader }}' \\
    -H 'Content-Type: application/json' \\
    -d '{
{{ providerInputs.asCurlString }},
        "stream": false
    }'`,conversationalStream:`curl {{ fullUrl }} \\
    -H 'Authorization: {{ authorizationHeader }}' \\
    -H 'Content-Type: application/json' \\
    -d '{
{{ providerInputs.asCurlString }},
        "stream": true
    }'`,zeroShotClassification:`curl {{ fullUrl }} \\
    -X POST \\
    -d '{"inputs": {{ providerInputs.asObj.inputs }}, "parameters": {"candidate_labels": ["refund", "legal", "faq"]}}' \\
    -H 'Content-Type: application/json' \\
    -H 'Authorization: {{ authorizationHeader }}'`}}},Xhe=["huggingface_hub","fal_client","requests","openai"],Yhe=["fetch","huggingface.js","openai"],Qhe=["curl"],Jhe={js:[...Yhe],python:[...Xhe],sh:[...Qhe]},Zhe=(n,e,t)=>{var r,s;return((s=(r=Wj[n])==null?void 0:r[e])==null?void 0:s[t])!==void 0},pN=(n,e,t)=>{var s,i;const r=(i=(s=Wj[n])==null?void 0:s[e])==null?void 0:i[t];if(!r)throw new Error(`Template not found: ${n}/${e}/${t}`);return o=>new Iue(r).render({...o})},ede=pN("python","huggingface_hub","importInferenceClient"),tde=pN("python","requests","importRequests"),XM={"audio-classification":"audio_classification","audio-to-audio":"audio_to_audio","automatic-speech-recognition":"automatic_speech_recognition","document-question-answering":"document_question_answering","feature-extraction":"feature_extraction","fill-mask":"fill_mask","image-classification":"image_classification","image-segmentation":"image_segmentation","image-to-image":"image_to_image","image-to-text":"image_to_text","object-detection":"object_detection","question-answering":"question_answering","sentence-similarity":"sentence_similarity",summarization:"summarization","table-question-answering":"table_question_answering","tabular-classification":"tabular_classification","tabular-regression":"tabular_regression","text-classification":"text_classification","text-generation":"text_generation","text-to-image":"text_to_image","text-to-speech":"text_to_speech","text-to-video":"text_to_video","token-classification":"token_classification",translation:"translation","visual-question-answering":"visual_question_answering","zero-shot-classification":"zero_shot_classification","zero-shot-image-classification":"zero_shot_image_classification"},YM={"automatic-speech-recognition":"automaticSpeechRecognition","feature-extraction":"featureExtraction","fill-mask":"fillMask","image-classification":"imageClassification","question-answering":"questionAnswering","sentence-similarity":"sentenceSimilarity",summarization:"summarization","table-question-answering":"tableQuestionAnswering","text-classification":"textClassification","text-generation":"textGeneration","text2text-generation":"textGeneration","token-classification":"tokenClassification",translation:"translation"},Jt=(n,e)=>(t,r,s,i,o)=>{var d;t.pipeline_tag&&["text-generation","image-text-to-text"].includes(t.pipeline_tag)&&t.tags.includes("conversational")&&(n=o!=null&&o.streaming?"conversationalStream":"conversational",e=sde);const a=e?e(t,o):{inputs:Tv(t)},l=Uj(i??t.id,{accessToken:r,provider:s,...a},{chatCompletion:n.includes("conversational"),task:t.pipeline_tag});let u=a;const c=l.info.body;if(typeof c=="string")try{u=JSON.parse(c)}catch(f){console.error("Failed to parse body as JSON",f)}const h={accessToken:r,authorizationHeader:(d=l.info.headers)==null?void 0:d.Authorization,baseUrl:ode(l.url,"/chat/completions"),fullUrl:l.url,inputs:{asObj:a,asCurlString:Xa(a,"curl"),asJsonString:Xa(a,"json"),asPythonString:Xa(a,"python"),asTsString:Xa(a,"ts")},providerInputs:{asObj:u,asCurlString:Xa(u,"curl"),asJsonString:Xa(u,"json"),asPythonString:Xa(u,"python"),asTsString:Xa(u,"ts")},model:t,provider:s,providerModelId:i??t.id};return eue.map(f=>Jhe[f].map(p=>{if(!Zhe(f,p,n))return;const m=pN(f,p,n);if(p==="huggingface_hub"&&n.includes("basic")){if(!(t.pipeline_tag&&t.pipeline_tag in XM))return;h.methodName=XM[t.pipeline_tag]}if(p==="huggingface.js"&&n.includes("basic")){if(!(t.pipeline_tag&&t.pipeline_tag in YM))return;h.methodName=YM[t.pipeline_tag]}let g=m(h).trim();if(g)return p==="huggingface_hub"?g=`${ede({...h})}

${g}`:p==="requests"&&(g=`${tde({...h,importBase64:g.includes("base64"),importJson:g.includes("json.")})}

${g}`),{language:f,client:p,content:g}}).filter(p=>p!==void 0)).flat()},nde=n=>JSON.parse(Tv(n)),rde=n=>{const e=JSON.parse(Tv(n));return{inputs:e.image,parameters:{prompt:e.prompt}}},sde=(n,e)=>({messages:(e==null?void 0:e.messages)??Tv(n),...e!=null&&e.temperature?{temperature:e==null?void 0:e.temperature}:void 0,max_tokens:(e==null?void 0:e.max_tokens)??500,...e!=null&&e.top_p?{top_p:e==null?void 0:e.top_p}:void 0}),o0={"audio-classification":Jt("basicAudio"),"audio-to-audio":Jt("basicAudio"),"automatic-speech-recognition":Jt("basicAudio"),"document-question-answering":Jt("documentQuestionAnswering",nde),"feature-extraction":Jt("basic"),"fill-mask":Jt("basic"),"image-classification":Jt("basicImage"),"image-segmentation":Jt("basicImage"),"image-text-to-text":Jt("conversational"),"image-to-image":Jt("imageToImage",rde),"image-to-text":Jt("basicImage"),"object-detection":Jt("basicImage"),"question-answering":Jt("basic"),"sentence-similarity":Jt("basic"),summarization:Jt("basic"),"tabular-classification":Jt("tabular"),"tabular-regression":Jt("tabular"),"table-question-answering":Jt("basic"),"text-classification":Jt("basic"),"text-generation":Jt("basic"),"text-to-audio":Jt("textToAudio"),"text-to-image":Jt("textToImage"),"text-to-speech":Jt("textToAudio"),"text-to-video":Jt("textToVideo"),"text2text-generation":Jt("basic"),"token-classification":Jt("basic"),translation:Jt("basic"),"zero-shot-classification":Jt("zeroShotClassification"),"zero-shot-image-classification":Jt("zeroShotImageClassification")};function ide(n,e,t,r,s){var i;return n.pipeline_tag&&n.pipeline_tag in o0?((i=o0[n.pipeline_tag])==null?void 0:i.call(o0,n,e,t,r,s))??[]:[]}function Xa(n,e){switch(e){case"curl":return QM(Xa(n,"json"));case"json":return JSON.stringify(n,null,4).split(`
`).slice(1,-1).join(`
`);case"python":return QM(Object.entries(n).map(([t,r])=>{const s=JSON.stringify(r,null,4).replace(/"/g,'"');return`${t}=${s},`}).join(`
`));case"ts":return hS(n).split(`
`).slice(1,-1).join(`
`);default:throw new Error(`Unsupported format: ${e}`)}}function hS(n,e){return e=e??0,typeof n!="object"||n===null?JSON.stringify(n):Array.isArray(n)?`[
${n.map(i=>{const o=hS(i,e+1);return`${" ".repeat(4*(e+1))}${o},`}).join(`
`)}
${" ".repeat(4*e)}]`:`{
${Object.entries(n).map(([s,i])=>{const o=hS(i,e+1),a=/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(s)?s:`"${s}"`;return`${" ".repeat(4*(e+1))}${a}: ${o},`}).join(`
`)}
${" ".repeat(4*e)}}`}function QM(n){return n.split(`
`).map(e=>" ".repeat(4)+e).join(`
`)}function ode(n,e){return n.endsWith(e)?n.slice(0,-e.length):n}const ade=({onSentimentChange:n})=>{const[e,t]=q.useState(""),[r,s]=q.useState(!1),[i,o]=q.useState(null),a=async()=>{if(e.trim()){s(!0);try{const u=await new qhe("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").textClassification({model:"distilbert-base-uncased-finetuned-sst-2-english",inputs:e}),c=u[0].label==="POSITIVE"?Math.min(10,Math.round(u[0].score*10)):Math.max(1,Math.round((1-u[0].score)*10));o(c),n(c)}catch(l){console.error("Error analyzing sentiment:",l)}finally{s(!1)}}};return k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[k.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[k.jsx(CU,{className:"w-5 h-5 text-indigo-600"}),k.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"How do you feel?"})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("textarea",{value:e,onChange:l=>t(l.target.value),placeholder:"Describe your current mood...",className:"w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("button",{onClick:a,disabled:r||!e.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:r?"Analyzing...":"Analyze Mood"}),i!==null&&k.jsxs("div",{className:"text-right",children:[k.jsx("p",{className:"text-sm text-gray-600",children:"Detected Mood Level:"}),k.jsxs("p",{className:"text-2xl font-bold text-indigo-600",children:[i,"/10"]})]})]})]})]})},lde=({formData:n,isSubmitting:e,submitStatus:t,onSubmit:r,onInputChange:s})=>k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[k.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[k.jsx(LT,{className:"w-8 h-8 text-indigo-600"}),k.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Stress Tracker"})]}),k.jsxs("form",{onSubmit:r,className:"space-y-6",children:[k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{children:[k.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[k.jsx(cl,{className:"w-4 h-4"}),"Stress Level (1-10)"]}),k.jsx("input",{type:"range",min:"1",max:"10",value:n.stressLevel,onChange:i=>s("stressLevel",parseInt(i.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),k.jsxs("div",{className:"flex justify-between mt-2",children:[k.jsx("span",{className:"text-sm text-gray-500",children:"Low"}),k.jsx("span",{className:"font-medium text-indigo-600",children:n.stressLevel}),k.jsx("span",{className:"text-sm text-gray-500",children:"High"})]})]}),k.jsxs("div",{children:[k.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[k.jsx(ah,{className:"w-4 h-4"}),"Hours Slept"]}),k.jsx("input",{type:"number",min:"0",max:"24",value:n.sleepHours,onChange:i=>s("sleepHours",parseInt(i.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0}),k.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Recommended: 7-9 hours"})]}),k.jsxs("div",{children:[k.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[k.jsx(cp,{className:"w-4 h-4"}),"Screen Time (hours)"]}),k.jsx("input",{type:"number",min:"0",max:"24",value:n.screenTime,onChange:i=>s("screenTime",parseInt(i.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),k.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Recommended: Less than 6 hours"})]})]}),k.jsx("button",{type:"submit",disabled:e,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors duration-200",children:e?k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[k.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),k.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Log Entry"}),t==="success"&&k.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4 mt-4",children:k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("svg",{className:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:k.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),k.jsx("p",{className:"text-green-700",children:"Data submitted successfully!"})]})}),t==="error"&&k.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mt-4",children:k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:k.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),k.jsx("p",{className:"text-red-700",children:"Error submitting data. Please check your inputs and try again."})]})})]})]}),ude=()=>{};var JM={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hj=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},cde=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Gj={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,c=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,f=u&63;l||(f=64,o||(d=64)),r.push(t[c],t[h],t[d],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Hj(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):cde(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw new hde;const d=i<<2|a>>4;if(r.push(d),u!==64){const f=a<<4&240|u>>2;if(r.push(f),h!==64){const p=u<<6&192|h;r.push(p)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class hde extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const dde=function(n){const e=Hj(n);return Gj.encodeByteArray(e,!0)},tw=function(n){return dde(n).replace(/\./g,"")},qj=function(n){try{return Gj.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fde(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pde=()=>fde().__FIREBASE_DEFAULTS__,mde=()=>{if(typeof process>"u"||typeof JM>"u")return;const n=JM.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},gde=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&qj(n[1]);return e&&JSON.parse(e)},z1=()=>{try{return ude()||pde()||mde()||gde()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Kj=n=>{var e,t;return(t=(e=z1())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},vde=n=>{const e=Kj(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Xj=()=>{var n;return(n=z1())===null||n===void 0?void 0:n.config},Yj=n=>{var e;return(e=z1())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yde{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xde(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[tw(JSON.stringify(t)),tw(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Is(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bde(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Is())}function wde(){var n;const e=(n=z1())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _de(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function kde(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Cde(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ide(){const n=Is();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Sde(){return!wde()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ede(){try{return typeof indexedDB=="object"}catch{return!1}}function Tde(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nde="FirebaseError";class Pl extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Nde,Object.setPrototypeOf(this,Pl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nv.prototype.create)}}class Nv{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Ade(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Pl(s,a,r)}}function Ade(n,e){return n.replace(Rde,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Rde=/\{\$([^}]+)}/g;function Dde(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function _h(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(ZM(i)&&ZM(o)){if(!_h(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function ZM(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Av(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function $de(n,e){const t=new Pde(n,e);return t.subscribe.bind(t)}class Pde{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ode(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=e2),s.error===void 0&&(s.error=e2),s.complete===void 0&&(s.complete=e2);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ode(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function e2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Si(n){return n&&n._delegate?n._delegate:n}class kh{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fde{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new yde;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Lde(e))try{this.getOrInitializeService({instanceIdentifier:Vc})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Vc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Vc){return this.instances.has(e)}getOptions(e=Vc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Mde(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Vc){return this.component?this.component.multipleInstances?e:Vc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mde(n){return n===Vc?void 0:n}function Lde(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bde{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Fde(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Et||(Et={}));const Vde={debug:Et.DEBUG,verbose:Et.VERBOSE,info:Et.INFO,warn:Et.WARN,error:Et.ERROR,silent:Et.SILENT},zde=Et.INFO,Ude={[Et.DEBUG]:"log",[Et.VERBOSE]:"log",[Et.INFO]:"info",[Et.WARN]:"warn",[Et.ERROR]:"error"},jde=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Ude[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let mN=class{constructor(e){this.name=e,this._logLevel=zde,this._logHandler=jde,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Et))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Vde[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Et.DEBUG,...e),this._logHandler(this,Et.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Et.VERBOSE,...e),this._logHandler(this,Et.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Et.INFO,...e),this._logHandler(this,Et.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Et.WARN,...e),this._logHandler(this,Et.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Et.ERROR,...e),this._logHandler(this,Et.ERROR,...e)}};const Wde=(n,e)=>e.some(t=>n instanceof t);let eL,tL;function Hde(){return eL||(eL=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gde(){return tL||(tL=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Qj=new WeakMap,dS=new WeakMap,Jj=new WeakMap,t2=new WeakMap,gN=new WeakMap;function qde(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Du(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Qj.set(t,n)}).catch(()=>{}),gN.set(e,n),e}function Kde(n){if(dS.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});dS.set(n,e)}let fS={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return dS.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Jj.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Du(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Xde(n){fS=n(fS)}function Yde(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(n2(this),e,...t);return Jj.set(r,e.sort?e.sort():[e]),Du(r)}:Gde().includes(n)?function(...e){return n.apply(n2(this),e),Du(Qj.get(this))}:function(...e){return Du(n.apply(n2(this),e))}}function Qde(n){return typeof n=="function"?Yde(n):(n instanceof IDBTransaction&&Kde(n),Wde(n,Hde())?new Proxy(n,fS):n)}function Du(n){if(n instanceof IDBRequest)return qde(n);if(t2.has(n))return t2.get(n);const e=Qde(n);return e!==n&&(t2.set(n,e),gN.set(e,n)),e}const n2=n=>gN.get(n);function Jde(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Du(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Du(o.result),l.oldVersion,l.newVersion,Du(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Zde=["get","getKey","getAll","getAllKeys","count"],efe=["put","add","delete","clear"],r2=new Map;function nL(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(r2.get(e))return r2.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=efe.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Zde.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return r2.set(e,i),i}Xde(n=>({...n,get:(e,t,r)=>nL(e,t)||n.get(e,t,r),has:(e,t)=>!!nL(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tfe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(nfe(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function nfe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const pS="@firebase/app",rL="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new mN("@firebase/app"),rfe="@firebase/app-compat",sfe="@firebase/analytics-compat",ife="@firebase/analytics",ofe="@firebase/app-check-compat",afe="@firebase/app-check",lfe="@firebase/auth",ufe="@firebase/auth-compat",cfe="@firebase/database",hfe="@firebase/data-connect",dfe="@firebase/database-compat",ffe="@firebase/functions",pfe="@firebase/functions-compat",mfe="@firebase/installations",gfe="@firebase/installations-compat",vfe="@firebase/messaging",yfe="@firebase/messaging-compat",xfe="@firebase/performance",bfe="@firebase/performance-compat",wfe="@firebase/remote-config",_fe="@firebase/remote-config-compat",kfe="@firebase/storage",Cfe="@firebase/storage-compat",Ife="@firebase/firestore",Sfe="@firebase/vertexai",Efe="@firebase/firestore-compat",Tfe="firebase",Nfe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mS="[DEFAULT]",Afe={[pS]:"fire-core",[rfe]:"fire-core-compat",[ife]:"fire-analytics",[sfe]:"fire-analytics-compat",[afe]:"fire-app-check",[ofe]:"fire-app-check-compat",[lfe]:"fire-auth",[ufe]:"fire-auth-compat",[cfe]:"fire-rtdb",[hfe]:"fire-data-connect",[dfe]:"fire-rtdb-compat",[ffe]:"fire-fn",[pfe]:"fire-fn-compat",[mfe]:"fire-iid",[gfe]:"fire-iid-compat",[vfe]:"fire-fcm",[yfe]:"fire-fcm-compat",[xfe]:"fire-perf",[bfe]:"fire-perf-compat",[wfe]:"fire-rc",[_fe]:"fire-rc-compat",[kfe]:"fire-gcs",[Cfe]:"fire-gcs-compat",[Ife]:"fire-fst",[Efe]:"fire-fst-compat",[Sfe]:"fire-vertex","fire-js":"fire-js",[Tfe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg=new Map,Rfe=new Map,gS=new Map;function sL(n,e){try{n.container.addComponent(e)}catch(t){bl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ff(n){const e=n.name;if(gS.has(e))return bl.debug(`There were multiple attempts to register component ${e}.`),!1;gS.set(e,n);for(const t of Mg.values())sL(t,n);for(const t of Rfe.values())sL(t,n);return!0}function vN(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function aa(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dfe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$u=new Nv("app","Firebase",Dfe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $fe{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new kh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $u.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp=Nfe;function Rv(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:mS,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw $u.create("bad-app-name",{appName:String(s)});if(t||(t=Xj()),!t)throw $u.create("no-options");const i=Mg.get(s);if(i){if(_h(t,i.options)&&_h(r,i.config))return i;throw $u.create("duplicate-app",{appName:s})}const o=new Bde(s);for(const l of gS.values())o.addComponent(l);const a=new $fe(t,r,o);return Mg.set(s,a),a}function yN(n=mS){const e=Mg.get(n);if(!e&&n===mS&&Xj())return Rv();if(!e)throw $u.create("no-app",{appName:n});return e}function Lg(){return Array.from(Mg.values())}function Pu(n,e,t){var r;let s=(r=Afe[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bl.warn(a.join(" "));return}Ff(new kh(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pfe="firebase-heartbeat-database",Ofe=1,Bg="firebase-heartbeat-store";let s2=null;function Zj(){return s2||(s2=Jde(Pfe,Ofe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Bg)}catch(t){console.warn(t)}}}}).catch(n=>{throw $u.create("idb-open",{originalErrorMessage:n.message})})),s2}async function Ffe(n){try{const t=(await Zj()).transaction(Bg),r=await t.objectStore(Bg).get(eW(n));return await t.done,r}catch(e){if(e instanceof Pl)bl.warn(e.message);else{const t=$u.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});bl.warn(t.message)}}}async function iL(n,e){try{const r=(await Zj()).transaction(Bg,"readwrite");await r.objectStore(Bg).put(e,eW(n)),await r.done}catch(t){if(t instanceof Pl)bl.warn(t.message);else{const r=$u.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});bl.warn(r.message)}}}function eW(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mfe=1024,Lfe=30;class Bfe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new zfe(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=oL();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Lfe){const o=Ufe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){bl.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=oL(),{heartbeatsToSend:r,unsentEntries:s}=Vfe(this._heartbeatsCache.heartbeats),i=tw(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return bl.warn(t),""}}}function oL(){return new Date().toISOString().substring(0,10)}function Vfe(n,e=Mfe){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),aL(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),aL(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class zfe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ede()?Tde().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Ffe(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return iL(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return iL(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function aL(n){return tw(JSON.stringify({version:2,heartbeats:n})).length}function Ufe(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jfe(n){Ff(new kh("platform-logger",e=>new tfe(e),"PRIVATE")),Ff(new kh("heartbeat",e=>new Bfe(e),"PRIVATE")),Pu(pS,rL,n),Pu(pS,rL,"esm2017"),Pu("fire-js","")}jfe("");var lL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ou,tW;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,C){function S(){}S.prototype=C.prototype,I.D=C.prototype,I.prototype=new S,I.prototype.constructor=I,I.C=function(T,N,R){for(var D=Array(arguments.length-2),z=2;z<arguments.length;z++)D[z-2]=arguments[z];return C.prototype[N].apply(T,D)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,C,S){S||(S=0);var T=Array(16);if(typeof C=="string")for(var N=0;16>N;++N)T[N]=C.charCodeAt(S++)|C.charCodeAt(S++)<<8|C.charCodeAt(S++)<<16|C.charCodeAt(S++)<<24;else for(N=0;16>N;++N)T[N]=C[S++]|C[S++]<<8|C[S++]<<16|C[S++]<<24;C=I.g[0],S=I.g[1],N=I.g[2];var R=I.g[3],D=C+(R^S&(N^R))+T[0]+3614090360&4294967295;C=S+(D<<7&4294967295|D>>>25),D=R+(N^C&(S^N))+T[1]+3905402710&4294967295,R=C+(D<<12&4294967295|D>>>20),D=N+(S^R&(C^S))+T[2]+606105819&4294967295,N=R+(D<<17&4294967295|D>>>15),D=S+(C^N&(R^C))+T[3]+3250441966&4294967295,S=N+(D<<22&4294967295|D>>>10),D=C+(R^S&(N^R))+T[4]+4118548399&4294967295,C=S+(D<<7&4294967295|D>>>25),D=R+(N^C&(S^N))+T[5]+1200080426&4294967295,R=C+(D<<12&4294967295|D>>>20),D=N+(S^R&(C^S))+T[6]+2821735955&4294967295,N=R+(D<<17&4294967295|D>>>15),D=S+(C^N&(R^C))+T[7]+4249261313&4294967295,S=N+(D<<22&4294967295|D>>>10),D=C+(R^S&(N^R))+T[8]+1770035416&4294967295,C=S+(D<<7&4294967295|D>>>25),D=R+(N^C&(S^N))+T[9]+2336552879&4294967295,R=C+(D<<12&4294967295|D>>>20),D=N+(S^R&(C^S))+T[10]+4294925233&4294967295,N=R+(D<<17&4294967295|D>>>15),D=S+(C^N&(R^C))+T[11]+2304563134&4294967295,S=N+(D<<22&4294967295|D>>>10),D=C+(R^S&(N^R))+T[12]+1804603682&4294967295,C=S+(D<<7&4294967295|D>>>25),D=R+(N^C&(S^N))+T[13]+4254626195&4294967295,R=C+(D<<12&4294967295|D>>>20),D=N+(S^R&(C^S))+T[14]+2792965006&4294967295,N=R+(D<<17&4294967295|D>>>15),D=S+(C^N&(R^C))+T[15]+1236535329&4294967295,S=N+(D<<22&4294967295|D>>>10),D=C+(N^R&(S^N))+T[1]+4129170786&4294967295,C=S+(D<<5&4294967295|D>>>27),D=R+(S^N&(C^S))+T[6]+3225465664&4294967295,R=C+(D<<9&4294967295|D>>>23),D=N+(C^S&(R^C))+T[11]+643717713&4294967295,N=R+(D<<14&4294967295|D>>>18),D=S+(R^C&(N^R))+T[0]+3921069994&4294967295,S=N+(D<<20&4294967295|D>>>12),D=C+(N^R&(S^N))+T[5]+3593408605&4294967295,C=S+(D<<5&4294967295|D>>>27),D=R+(S^N&(C^S))+T[10]+38016083&4294967295,R=C+(D<<9&4294967295|D>>>23),D=N+(C^S&(R^C))+T[15]+3634488961&4294967295,N=R+(D<<14&4294967295|D>>>18),D=S+(R^C&(N^R))+T[4]+3889429448&4294967295,S=N+(D<<20&4294967295|D>>>12),D=C+(N^R&(S^N))+T[9]+568446438&4294967295,C=S+(D<<5&4294967295|D>>>27),D=R+(S^N&(C^S))+T[14]+3275163606&4294967295,R=C+(D<<9&4294967295|D>>>23),D=N+(C^S&(R^C))+T[3]+4107603335&4294967295,N=R+(D<<14&4294967295|D>>>18),D=S+(R^C&(N^R))+T[8]+1163531501&4294967295,S=N+(D<<20&4294967295|D>>>12),D=C+(N^R&(S^N))+T[13]+2850285829&4294967295,C=S+(D<<5&4294967295|D>>>27),D=R+(S^N&(C^S))+T[2]+4243563512&4294967295,R=C+(D<<9&4294967295|D>>>23),D=N+(C^S&(R^C))+T[7]+1735328473&4294967295,N=R+(D<<14&4294967295|D>>>18),D=S+(R^C&(N^R))+T[12]+2368359562&4294967295,S=N+(D<<20&4294967295|D>>>12),D=C+(S^N^R)+T[5]+4294588738&4294967295,C=S+(D<<4&4294967295|D>>>28),D=R+(C^S^N)+T[8]+2272392833&4294967295,R=C+(D<<11&4294967295|D>>>21),D=N+(R^C^S)+T[11]+1839030562&4294967295,N=R+(D<<16&4294967295|D>>>16),D=S+(N^R^C)+T[14]+4259657740&4294967295,S=N+(D<<23&4294967295|D>>>9),D=C+(S^N^R)+T[1]+2763975236&4294967295,C=S+(D<<4&4294967295|D>>>28),D=R+(C^S^N)+T[4]+1272893353&4294967295,R=C+(D<<11&4294967295|D>>>21),D=N+(R^C^S)+T[7]+4139469664&4294967295,N=R+(D<<16&4294967295|D>>>16),D=S+(N^R^C)+T[10]+3200236656&4294967295,S=N+(D<<23&4294967295|D>>>9),D=C+(S^N^R)+T[13]+681279174&4294967295,C=S+(D<<4&4294967295|D>>>28),D=R+(C^S^N)+T[0]+3936430074&4294967295,R=C+(D<<11&4294967295|D>>>21),D=N+(R^C^S)+T[3]+3572445317&4294967295,N=R+(D<<16&4294967295|D>>>16),D=S+(N^R^C)+T[6]+76029189&4294967295,S=N+(D<<23&4294967295|D>>>9),D=C+(S^N^R)+T[9]+3654602809&4294967295,C=S+(D<<4&4294967295|D>>>28),D=R+(C^S^N)+T[12]+3873151461&4294967295,R=C+(D<<11&4294967295|D>>>21),D=N+(R^C^S)+T[15]+530742520&4294967295,N=R+(D<<16&4294967295|D>>>16),D=S+(N^R^C)+T[2]+3299628645&4294967295,S=N+(D<<23&4294967295|D>>>9),D=C+(N^(S|~R))+T[0]+4096336452&4294967295,C=S+(D<<6&4294967295|D>>>26),D=R+(S^(C|~N))+T[7]+1126891415&4294967295,R=C+(D<<10&4294967295|D>>>22),D=N+(C^(R|~S))+T[14]+2878612391&4294967295,N=R+(D<<15&4294967295|D>>>17),D=S+(R^(N|~C))+T[5]+4237533241&4294967295,S=N+(D<<21&4294967295|D>>>11),D=C+(N^(S|~R))+T[12]+1700485571&4294967295,C=S+(D<<6&4294967295|D>>>26),D=R+(S^(C|~N))+T[3]+2399980690&4294967295,R=C+(D<<10&4294967295|D>>>22),D=N+(C^(R|~S))+T[10]+4293915773&4294967295,N=R+(D<<15&4294967295|D>>>17),D=S+(R^(N|~C))+T[1]+2240044497&4294967295,S=N+(D<<21&4294967295|D>>>11),D=C+(N^(S|~R))+T[8]+1873313359&4294967295,C=S+(D<<6&4294967295|D>>>26),D=R+(S^(C|~N))+T[15]+4264355552&4294967295,R=C+(D<<10&4294967295|D>>>22),D=N+(C^(R|~S))+T[6]+2734768916&4294967295,N=R+(D<<15&4294967295|D>>>17),D=S+(R^(N|~C))+T[13]+1309151649&4294967295,S=N+(D<<21&4294967295|D>>>11),D=C+(N^(S|~R))+T[4]+4149444226&4294967295,C=S+(D<<6&4294967295|D>>>26),D=R+(S^(C|~N))+T[11]+3174756917&4294967295,R=C+(D<<10&4294967295|D>>>22),D=N+(C^(R|~S))+T[2]+718787259&4294967295,N=R+(D<<15&4294967295|D>>>17),D=S+(R^(N|~C))+T[9]+3951481745&4294967295,I.g[0]=I.g[0]+C&4294967295,I.g[1]=I.g[1]+(N+(D<<21&4294967295|D>>>11))&4294967295,I.g[2]=I.g[2]+N&4294967295,I.g[3]=I.g[3]+R&4294967295}r.prototype.u=function(I,C){C===void 0&&(C=I.length);for(var S=C-this.blockSize,T=this.B,N=this.h,R=0;R<C;){if(N==0)for(;R<=S;)s(this,I,R),R+=this.blockSize;if(typeof I=="string"){for(;R<C;)if(T[N++]=I.charCodeAt(R++),N==this.blockSize){s(this,T),N=0;break}}else for(;R<C;)if(T[N++]=I[R++],N==this.blockSize){s(this,T),N=0;break}}this.h=N,this.o+=C},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var C=1;C<I.length-8;++C)I[C]=0;var S=8*this.o;for(C=I.length-8;C<I.length;++C)I[C]=S&255,S/=256;for(this.u(I),I=Array(16),C=S=0;4>C;++C)for(var T=0;32>T;T+=8)I[S++]=this.g[C]>>>T&255;return I};function i(I,C){var S=a;return Object.prototype.hasOwnProperty.call(S,I)?S[I]:S[I]=C(I)}function o(I,C){this.h=C;for(var S=[],T=!0,N=I.length-1;0<=N;N--){var R=I[N]|0;T&&R==C||(S[N]=R,T=!1)}this.g=S}var a={};function l(I){return-128<=I&&128>I?i(I,function(C){return new o([C|0],0>C?-1:0)}):new o([I|0],0>I?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return h;if(0>I)return g(u(-I));for(var C=[],S=1,T=0;I>=S;T++)C[T]=I/S|0,S*=4294967296;return new o(C,0)}function c(I,C){if(I.length==0)throw Error("number format error: empty string");if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(I.charAt(0)=="-")return g(c(I.substring(1),C));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=u(Math.pow(C,8)),T=h,N=0;N<I.length;N+=8){var R=Math.min(8,I.length-N),D=parseInt(I.substring(N,N+R),C);8>R?(R=u(Math.pow(C,R)),T=T.j(R).add(u(D))):(T=T.j(S),T=T.add(u(D)))}return T}var h=l(0),d=l(1),f=l(16777216);n=o.prototype,n.m=function(){if(m(this))return-g(this).m();for(var I=0,C=1,S=0;S<this.g.length;S++){var T=this.i(S);I+=(0<=T?T:4294967296+T)*C,C*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(p(this))return"0";if(m(this))return"-"+g(this).toString(I);for(var C=u(Math.pow(I,6)),S=this,T="";;){var N=b(S,C).g;S=v(S,N.j(C));var R=((0<S.g.length?S.g[0]:S.h)>>>0).toString(I);if(S=N,p(S))return R+T;for(;6>R.length;)R="0"+R;T=R+T}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function p(I){if(I.h!=0)return!1;for(var C=0;C<I.g.length;C++)if(I.g[C]!=0)return!1;return!0}function m(I){return I.h==-1}n.l=function(I){return I=v(this,I),m(I)?-1:p(I)?0:1};function g(I){for(var C=I.g.length,S=[],T=0;T<C;T++)S[T]=~I.g[T];return new o(S,~I.h).add(d)}n.abs=function(){return m(this)?g(this):this},n.add=function(I){for(var C=Math.max(this.g.length,I.g.length),S=[],T=0,N=0;N<=C;N++){var R=T+(this.i(N)&65535)+(I.i(N)&65535),D=(R>>>16)+(this.i(N)>>>16)+(I.i(N)>>>16);T=D>>>16,R&=65535,D&=65535,S[N]=D<<16|R}return new o(S,S[S.length-1]&-2147483648?-1:0)};function v(I,C){return I.add(g(C))}n.j=function(I){if(p(this)||p(I))return h;if(m(this))return m(I)?g(this).j(g(I)):g(g(this).j(I));if(m(I))return g(this.j(g(I)));if(0>this.l(f)&&0>I.l(f))return u(this.m()*I.m());for(var C=this.g.length+I.g.length,S=[],T=0;T<2*C;T++)S[T]=0;for(T=0;T<this.g.length;T++)for(var N=0;N<I.g.length;N++){var R=this.i(T)>>>16,D=this.i(T)&65535,z=I.i(N)>>>16,L=I.i(N)&65535;S[2*T+2*N]+=D*L,y(S,2*T+2*N),S[2*T+2*N+1]+=R*L,y(S,2*T+2*N+1),S[2*T+2*N+1]+=D*z,y(S,2*T+2*N+1),S[2*T+2*N+2]+=R*z,y(S,2*T+2*N+2)}for(T=0;T<C;T++)S[T]=S[2*T+1]<<16|S[2*T];for(T=C;T<2*C;T++)S[T]=0;return new o(S,0)};function y(I,C){for(;(I[C]&65535)!=I[C];)I[C+1]+=I[C]>>>16,I[C]&=65535,C++}function x(I,C){this.g=I,this.h=C}function b(I,C){if(p(C))throw Error("division by zero");if(p(I))return new x(h,h);if(m(I))return C=b(g(I),C),new x(g(C.g),g(C.h));if(m(C))return C=b(I,g(C)),new x(g(C.g),C.h);if(30<I.g.length){if(m(I)||m(C))throw Error("slowDivide_ only works with positive integers.");for(var S=d,T=C;0>=T.l(I);)S=_(S),T=_(T);var N=E(S,1),R=E(T,1);for(T=E(T,2),S=E(S,2);!p(T);){var D=R.add(T);0>=D.l(I)&&(N=N.add(S),R=D),T=E(T,1),S=E(S,1)}return C=v(I,N.j(C)),new x(N,C)}for(N=h;0<=I.l(C);){for(S=Math.max(1,Math.floor(I.m()/C.m())),T=Math.ceil(Math.log(S)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),R=u(S),D=R.j(C);m(D)||0<D.l(I);)S-=T,R=u(S),D=R.j(C);p(R)&&(R=d),N=N.add(R),I=v(I,D)}return new x(N,I)}n.A=function(I){return b(this,I).h},n.and=function(I){for(var C=Math.max(this.g.length,I.g.length),S=[],T=0;T<C;T++)S[T]=this.i(T)&I.i(T);return new o(S,this.h&I.h)},n.or=function(I){for(var C=Math.max(this.g.length,I.g.length),S=[],T=0;T<C;T++)S[T]=this.i(T)|I.i(T);return new o(S,this.h|I.h)},n.xor=function(I){for(var C=Math.max(this.g.length,I.g.length),S=[],T=0;T<C;T++)S[T]=this.i(T)^I.i(T);return new o(S,this.h^I.h)};function _(I){for(var C=I.g.length+1,S=[],T=0;T<C;T++)S[T]=I.i(T)<<1|I.i(T-1)>>>31;return new o(S,I.h)}function E(I,C){var S=C>>5;C%=32;for(var T=I.g.length-S,N=[],R=0;R<T;R++)N[R]=0<C?I.i(R+S)>>>C|I.i(R+S+1)<<32-C:I.i(R+S);return new o(N,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,tW=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=c,Ou=o}).apply(typeof lL<"u"?lL:typeof self<"u"?self:typeof window<"u"?window:{});var a0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var nW,Dm,rW,ab,vS,sW,iW,oW;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(w,A,$){return w==Array.prototype||w==Object.prototype||(w[A]=$.value),w};function t(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof a0=="object"&&a0];for(var A=0;A<w.length;++A){var $=w[A];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}var r=t(this);function s(w,A){if(A)e:{var $=r;w=w.split(".");for(var B=0;B<w.length-1;B++){var re=w[B];if(!(re in $))break e;$=$[re]}w=w[w.length-1],B=$[w],A=A(B),A!=B&&A!=null&&e($,w,{configurable:!0,writable:!0,value:A})}}function i(w,A){w instanceof String&&(w+="");var $=0,B=!1,re={next:function(){if(!B&&$<w.length){var de=$++;return{value:A(de,w[de]),done:!1}}return B=!0,{done:!0,value:void 0}}};return re[Symbol.iterator]=function(){return re},re}s("Array.prototype.values",function(w){return w||function(){return i(this,function(A,$){return $})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(w){var A=typeof w;return A=A!="object"?A:w?Array.isArray(w)?"array":A:"null",A=="array"||A=="object"&&typeof w.length=="number"}function u(w){var A=typeof w;return A=="object"&&w!=null||A=="function"}function c(w,A,$){return w.call.apply(w.bind,arguments)}function h(w,A,$){if(!w)throw Error();if(2<arguments.length){var B=Array.prototype.slice.call(arguments,2);return function(){var re=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(re,B),w.apply(A,re)}}return function(){return w.apply(A,arguments)}}function d(w,A,$){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:h,d.apply(null,arguments)}function f(w,A){var $=Array.prototype.slice.call(arguments,1);return function(){var B=$.slice();return B.push.apply(B,arguments),w.apply(this,B)}}function p(w,A){function $(){}$.prototype=A.prototype,w.aa=A.prototype,w.prototype=new $,w.prototype.constructor=w,w.Qb=function(B,re,de){for(var Ee=Array(arguments.length-2),rn=2;rn<arguments.length;rn++)Ee[rn-2]=arguments[rn];return A.prototype[re].apply(B,Ee)}}function m(w){const A=w.length;if(0<A){const $=Array(A);for(let B=0;B<A;B++)$[B]=w[B];return $}return[]}function g(w,A){for(let $=1;$<arguments.length;$++){const B=arguments[$];if(l(B)){const re=w.length||0,de=B.length||0;w.length=re+de;for(let Ee=0;Ee<de;Ee++)w[re+Ee]=B[Ee]}else w.push(B)}}class v{constructor(A,$){this.i=A,this.j=$,this.h=0,this.g=null}get(){let A;return 0<this.h?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function y(w){return/^[\s\xa0]*$/.test(w)}function x(){var w=a.navigator;return w&&(w=w.userAgent)?w:""}function b(w){return b[" "](w),w}b[" "]=function(){};var _=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function E(w,A,$){for(const B in w)A.call($,w[B],B,w)}function I(w,A){for(const $ in w)A.call(void 0,w[$],$,w)}function C(w){const A={};for(const $ in w)A[$]=w[$];return A}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(w,A){let $,B;for(let re=1;re<arguments.length;re++){B=arguments[re];for($ in B)w[$]=B[$];for(let de=0;de<S.length;de++)$=S[de],Object.prototype.hasOwnProperty.call(B,$)&&(w[$]=B[$])}}function N(w){var A=1;w=w.split(":");const $=[];for(;0<A&&w.length;)$.push(w.shift()),A--;return w.length&&$.push(w.join(":")),$}function R(w){a.setTimeout(()=>{throw w},0)}function D(){var w=U;let A=null;return w.g&&(A=w.g,w.g=w.g.next,w.g||(w.h=null),A.next=null),A}class z{constructor(){this.h=this.g=null}add(A,$){const B=L.get();B.set(A,$),this.h?this.h.next=B:this.g=B,this.h=B}}var L=new v(()=>new O,w=>w.reset());class O{constructor(){this.next=this.g=this.h=null}set(A,$){this.h=A,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let F,P=!1,U=new z,W=()=>{const w=a.Promise.resolve(void 0);F=()=>{w.then(X)}};var X=()=>{for(var w;w=D();){try{w.h.call(w.g)}catch($){R($)}var A=L;A.j(w),100>A.h&&(A.h++,w.next=A.g,A.g=w)}P=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ne(w,A){this.type=w,this.g=this.target=A,this.defaultPrevented=!1}ne.prototype.h=function(){this.defaultPrevented=!0};var he=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var w=!1,A=Object.defineProperty({},"passive",{get:function(){w=!0}});try{const $=()=>{};a.addEventListener("test",$,A),a.removeEventListener("test",$,A)}catch{}return w}();function le(w,A){if(ne.call(this,w?w.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,w){var $=this.type=w.type,B=w.changedTouches&&w.changedTouches.length?w.changedTouches[0]:null;if(this.target=w.target||w.srcElement,this.g=A,A=w.relatedTarget){if(_){e:{try{b(A.nodeName);var re=!0;break e}catch{}re=!1}re||(A=null)}}else $=="mouseover"?A=w.fromElement:$=="mouseout"&&(A=w.toElement);this.relatedTarget=A,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0),this.button=w.button,this.key=w.key||"",this.ctrlKey=w.ctrlKey,this.altKey=w.altKey,this.shiftKey=w.shiftKey,this.metaKey=w.metaKey,this.pointerId=w.pointerId||0,this.pointerType=typeof w.pointerType=="string"?w.pointerType:pe[w.pointerType]||"",this.state=w.state,this.i=w,w.defaultPrevented&&le.aa.h.call(this)}}p(le,ne);var pe={2:"touch",3:"pen",4:"mouse"};le.prototype.h=function(){le.aa.h.call(this);var w=this.i;w.preventDefault?w.preventDefault():w.returnValue=!1};var be="closure_listenable_"+(1e6*Math.random()|0),Ce=0;function ke(w,A,$,B,re){this.listener=w,this.proxy=null,this.src=A,this.type=$,this.capture=!!B,this.ha=re,this.key=++Ce,this.da=this.fa=!1}function $e(w){w.da=!0,w.listener=null,w.proxy=null,w.src=null,w.ha=null}function Se(w){this.src=w,this.g={},this.h=0}Se.prototype.add=function(w,A,$,B,re){var de=w.toString();w=this.g[de],w||(w=this.g[de]=[],this.h++);var Ee=je(w,A,B,re);return-1<Ee?(A=w[Ee],$||(A.fa=!1)):(A=new ke(A,this.src,de,!!B,re),A.fa=$,w.push(A)),A};function Ue(w,A){var $=A.type;if($ in w.g){var B=w.g[$],re=Array.prototype.indexOf.call(B,A,void 0),de;(de=0<=re)&&Array.prototype.splice.call(B,re,1),de&&($e(A),w.g[$].length==0&&(delete w.g[$],w.h--))}}function je(w,A,$,B){for(var re=0;re<w.length;++re){var de=w[re];if(!de.da&&de.listener==A&&de.capture==!!$&&de.ha==B)return re}return-1}var tt="closure_lm_"+(1e6*Math.random()|0),Qe={};function Xe(w,A,$,B,re){if(Array.isArray(A)){for(var de=0;de<A.length;de++)Xe(w,A[de],$,B,re);return null}return $=Bn($),w&&w[be]?w.K(A,$,u(B)?!!B.capture:!1,re):Ct(w,A,$,!1,B,re)}function Ct(w,A,$,B,re,de){if(!A)throw Error("Invalid event type");var Ee=u(re)?!!re.capture:!!re,rn=Yn(w);if(rn||(w[tt]=rn=new Se(w)),$=rn.add(A,$,B,Ee,de),$.proxy)return $;if(B=_t(),$.proxy=B,B.src=w,B.listener=$,w.addEventListener)he||(re=Ee),re===void 0&&(re=!1),w.addEventListener(A.toString(),B,re);else if(w.attachEvent)w.attachEvent(Xn(A.toString()),B);else if(w.addListener&&w.removeListener)w.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return $}function _t(){function w($){return A.call(w.src,w.listener,$)}const A=kn;return w}function ln(w,A,$,B,re){if(Array.isArray(A))for(var de=0;de<A.length;de++)ln(w,A[de],$,B,re);else B=u(B)?!!B.capture:!!B,$=Bn($),w&&w[be]?(w=w.i,A=String(A).toString(),A in w.g&&(de=w.g[A],$=je(de,$,B,re),-1<$&&($e(de[$]),Array.prototype.splice.call(de,$,1),de.length==0&&(delete w.g[A],w.h--)))):w&&(w=Yn(w))&&(A=w.g[A.toString()],w=-1,A&&(w=je(A,$,B,re)),($=-1<w?A[w]:null)&&Yt($))}function Yt(w){if(typeof w!="number"&&w&&!w.da){var A=w.src;if(A&&A[be])Ue(A.i,w);else{var $=w.type,B=w.proxy;A.removeEventListener?A.removeEventListener($,B,w.capture):A.detachEvent?A.detachEvent(Xn($),B):A.addListener&&A.removeListener&&A.removeListener(B),($=Yn(A))?(Ue($,w),$.h==0&&($.src=null,A[tt]=null)):$e(w)}}}function Xn(w){return w in Qe?Qe[w]:Qe[w]="on"+w}function kn(w,A){if(w.da)w=!0;else{A=new le(A,this);var $=w.listener,B=w.ha||w.src;w.fa&&Yt(w),w=$.call(B,A)}return w}function Yn(w){return w=w[tt],w instanceof Se?w:null}var Ln="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bn(w){return typeof w=="function"?w:(w[Ln]||(w[Ln]=function(A){return w.handleEvent(A)}),w[Ln])}function Qt(){Z.call(this),this.i=new Se(this),this.M=this,this.F=null}p(Qt,Z),Qt.prototype[be]=!0,Qt.prototype.removeEventListener=function(w,A,$,B){ln(this,w,A,$,B)};function jt(w,A){var $,B=w.F;if(B)for($=[];B;B=B.F)$.push(B);if(w=w.M,B=A.type||A,typeof A=="string")A=new ne(A,w);else if(A instanceof ne)A.target=A.target||w;else{var re=A;A=new ne(B,w),T(A,re)}if(re=!0,$)for(var de=$.length-1;0<=de;de--){var Ee=A.g=$[de];re=Cn(Ee,B,!0,A)&&re}if(Ee=A.g=w,re=Cn(Ee,B,!0,A)&&re,re=Cn(Ee,B,!1,A)&&re,$)for(de=0;de<$.length;de++)Ee=A.g=$[de],re=Cn(Ee,B,!1,A)&&re}Qt.prototype.N=function(){if(Qt.aa.N.call(this),this.i){var w=this.i,A;for(A in w.g){for(var $=w.g[A],B=0;B<$.length;B++)$e($[B]);delete w.g[A],w.h--}}this.F=null},Qt.prototype.K=function(w,A,$,B){return this.i.add(String(w),A,!1,$,B)},Qt.prototype.L=function(w,A,$,B){return this.i.add(String(w),A,!0,$,B)};function Cn(w,A,$,B){if(A=w.i.g[String(A)],!A)return!0;A=A.concat();for(var re=!0,de=0;de<A.length;++de){var Ee=A[de];if(Ee&&!Ee.da&&Ee.capture==$){var rn=Ee.listener,zr=Ee.ha||Ee.src;Ee.fa&&Ue(w.i,Ee),re=rn.call(zr,B)!==!1&&re}}return re&&!B.defaultPrevented}function $i(w,A,$){if(typeof w=="function")$&&(w=d(w,$));else if(w&&typeof w.handleEvent=="function")w=d(w.handleEvent,w);else throw Error("Invalid listener argument");return 2147483647<Number(A)?-1:a.setTimeout(w,A||0)}function Gl(w){w.g=$i(()=>{w.g=null,w.i&&(w.i=!1,Gl(w))},w.l);const A=w.h;w.h=null,w.m.apply(null,A)}class kc extends Z{constructor(A,$){super(),this.m=A,this.l=$,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Gl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function za(w){Z.call(this),this.h=w,this.g={}}p(za,Z);var po=[];function ql(w){E(w.g,function(A,$){this.g.hasOwnProperty($)&&Yt(A)},w),w.g={}}za.prototype.N=function(){za.aa.N.call(this),ql(this)},za.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ua=a.JSON.stringify,AY=a.JSON.parse,RY=class{stringify(w){return a.JSON.stringify(w,void 0)}parse(w){return a.JSON.parse(w,void 0)}};function Qk(){}Qk.prototype.h=null;function dP(w){return w.h||(w.h=w.i())}function fP(){}var zp={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Jk(){ne.call(this,"d")}p(Jk,ne);function Zk(){ne.call(this,"c")}p(Zk,ne);var Cc={},pP=null;function fx(){return pP=pP||new Qt}Cc.La="serverreachability";function mP(w){ne.call(this,Cc.La,w)}p(mP,ne);function Up(w){const A=fx();jt(A,new mP(A))}Cc.STAT_EVENT="statevent";function gP(w,A){ne.call(this,Cc.STAT_EVENT,w),this.stat=A}p(gP,ne);function Ns(w){const A=fx();jt(A,new gP(A,w))}Cc.Ma="timingevent";function vP(w,A){ne.call(this,Cc.Ma,w),this.size=A}p(vP,ne);function jp(w,A){if(typeof w!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){w()},A)}function Wp(){this.g=!0}Wp.prototype.xa=function(){this.g=!1};function DY(w,A,$,B,re,de){w.info(function(){if(w.g)if(de)for(var Ee="",rn=de.split("&"),zr=0;zr<rn.length;zr++){var Mt=rn[zr].split("=");if(1<Mt.length){var rs=Mt[0];Mt=Mt[1];var ss=rs.split("_");Ee=2<=ss.length&&ss[1]=="type"?Ee+(rs+"="+Mt+"&"):Ee+(rs+"=redacted&")}}else Ee=null;else Ee=de;return"XMLHTTP REQ ("+B+") [attempt "+re+"]: "+A+`
`+$+`
`+Ee})}function $Y(w,A,$,B,re,de,Ee){w.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+re+"]: "+A+`
`+$+`
`+de+" "+Ee})}function md(w,A,$,B){w.info(function(){return"XMLHTTP TEXT ("+A+"): "+OY(w,$)+(B?" "+B:"")})}function PY(w,A){w.info(function(){return"TIMEOUT: "+A})}Wp.prototype.info=function(){};function OY(w,A){if(!w.g)return A;if(!A)return null;try{var $=JSON.parse(A);if($){for(w=0;w<$.length;w++)if(Array.isArray($[w])){var B=$[w];if(!(2>B.length)){var re=B[1];if(Array.isArray(re)&&!(1>re.length)){var de=re[0];if(de!="noop"&&de!="stop"&&de!="close")for(var Ee=1;Ee<re.length;Ee++)re[Ee]=""}}}}return Ua($)}catch{return A}}var px={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},yP={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},eC;function mx(){}p(mx,Qk),mx.prototype.g=function(){return new XMLHttpRequest},mx.prototype.i=function(){return{}},eC=new mx;function Kl(w,A,$,B){this.j=w,this.i=A,this.l=$,this.R=B||1,this.U=new za(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xP}function xP(){this.i=null,this.g="",this.h=!1}var bP={},tC={};function nC(w,A,$){w.L=1,w.v=xx(ja(A)),w.m=$,w.P=!0,wP(w,null)}function wP(w,A){w.F=Date.now(),gx(w),w.A=ja(w.v);var $=w.A,B=w.R;Array.isArray(B)||(B=[String(B)]),OP($.i,"t",B),w.C=0,$=w.j.J,w.h=new xP,w.g=ZP(w.j,$?A:null,!w.m),0<w.O&&(w.M=new kc(d(w.Y,w,w.g),w.O)),A=w.U,$=w.g,B=w.ca;var re="readystatechange";Array.isArray(re)||(re&&(po[0]=re.toString()),re=po);for(var de=0;de<re.length;de++){var Ee=Xe($,re[de],B||A.handleEvent,!1,A.h||A);if(!Ee)break;A.g[Ee.key]=Ee}A=w.H?C(w.H):{},w.m?(w.u||(w.u="POST"),A["Content-Type"]="application/x-www-form-urlencoded",w.g.ea(w.A,w.u,w.m,A)):(w.u="GET",w.g.ea(w.A,w.u,null,A)),Up(),DY(w.i,w.u,w.A,w.l,w.R,w.m)}Kl.prototype.ca=function(w){w=w.target;const A=this.M;A&&Wa(w)==3?A.j():this.Y(w)},Kl.prototype.Y=function(w){try{if(w==this.g)e:{const ss=Wa(this.g);var A=this.g.Ba();const yd=this.g.Z();if(!(3>ss)&&(ss!=3||this.g&&(this.h.h||this.g.oa()||UP(this.g)))){this.J||ss!=4||A==7||(A==8||0>=yd?Up(3):Up(2)),rC(this);var $=this.g.Z();this.X=$;t:if(_P(this)){var B=UP(this.g);w="";var re=B.length,de=Wa(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ic(this),Hp(this);var Ee="";break t}this.h.i=new a.TextDecoder}for(A=0;A<re;A++)this.h.h=!0,w+=this.h.i.decode(B[A],{stream:!(de&&A==re-1)});B.length=0,this.h.g+=w,this.C=0,Ee=this.h.g}else Ee=this.g.oa();if(this.o=$==200,$Y(this.i,this.u,this.A,this.l,this.R,ss,$),this.o){if(this.T&&!this.K){t:{if(this.g){var rn,zr=this.g;if((rn=zr.g?zr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(rn)){var Mt=rn;break t}}Mt=null}if($=Mt)md(this.i,this.l,$,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sC(this,$);else{this.o=!1,this.s=3,Ns(12),Ic(this),Hp(this);break e}}if(this.P){$=!0;let mo;for(;!this.J&&this.C<Ee.length;)if(mo=FY(this,Ee),mo==tC){ss==4&&(this.s=4,Ns(14),$=!1),md(this.i,this.l,null,"[Incomplete Response]");break}else if(mo==bP){this.s=4,Ns(15),md(this.i,this.l,Ee,"[Invalid Chunk]"),$=!1;break}else md(this.i,this.l,mo,null),sC(this,mo);if(_P(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ss!=4||Ee.length!=0||this.h.h||(this.s=1,Ns(16),$=!1),this.o=this.o&&$,!$)md(this.i,this.l,Ee,"[Invalid Chunked Response]"),Ic(this),Hp(this);else if(0<Ee.length&&!this.W){this.W=!0;var rs=this.j;rs.g==this&&rs.ba&&!rs.M&&(rs.j.info("Great, no buffering proxy detected. Bytes received: "+Ee.length),cC(rs),rs.M=!0,Ns(11))}}else md(this.i,this.l,Ee,null),sC(this,Ee);ss==4&&Ic(this),this.o&&!this.J&&(ss==4?XP(this.j,this):(this.o=!1,gx(this)))}else ZY(this.g),$==400&&0<Ee.indexOf("Unknown SID")?(this.s=3,Ns(12)):(this.s=0,Ns(13)),Ic(this),Hp(this)}}}catch{}finally{}};function _P(w){return w.g?w.u=="GET"&&w.L!=2&&w.j.Ca:!1}function FY(w,A){var $=w.C,B=A.indexOf(`
`,$);return B==-1?tC:($=Number(A.substring($,B)),isNaN($)?bP:(B+=1,B+$>A.length?tC:(A=A.slice(B,B+$),w.C=B+$,A)))}Kl.prototype.cancel=function(){this.J=!0,Ic(this)};function gx(w){w.S=Date.now()+w.I,kP(w,w.I)}function kP(w,A){if(w.B!=null)throw Error("WatchDog timer not null");w.B=jp(d(w.ba,w),A)}function rC(w){w.B&&(a.clearTimeout(w.B),w.B=null)}Kl.prototype.ba=function(){this.B=null;const w=Date.now();0<=w-this.S?(PY(this.i,this.A),this.L!=2&&(Up(),Ns(17)),Ic(this),this.s=2,Hp(this)):kP(this,this.S-w)};function Hp(w){w.j.G==0||w.J||XP(w.j,w)}function Ic(w){rC(w);var A=w.M;A&&typeof A.ma=="function"&&A.ma(),w.M=null,ql(w.U),w.g&&(A=w.g,w.g=null,A.abort(),A.ma())}function sC(w,A){try{var $=w.j;if($.G!=0&&($.g==w||iC($.h,w))){if(!w.K&&iC($.h,w)&&$.G==3){try{var B=$.Da.g.parse(A)}catch{B=null}if(Array.isArray(B)&&B.length==3){var re=B;if(re[0]==0){e:if(!$.u){if($.g)if($.g.F+3e3<w.F)Ix($),kx($);else break e;uC($),Ns(18)}}else $.za=re[1],0<$.za-$.T&&37500>re[2]&&$.F&&$.v==0&&!$.C&&($.C=jp(d($.Za,$),6e3));if(1>=SP($.h)&&$.ca){try{$.ca()}catch{}$.ca=void 0}}else Ec($,11)}else if((w.K||$.g==w)&&Ix($),!y(A))for(re=$.Da.g.parse(A),A=0;A<re.length;A++){let Mt=re[A];if($.T=Mt[0],Mt=Mt[1],$.G==2)if(Mt[0]=="c"){$.K=Mt[1],$.ia=Mt[2];const rs=Mt[3];rs!=null&&($.la=rs,$.j.info("VER="+$.la));const ss=Mt[4];ss!=null&&($.Aa=ss,$.j.info("SVER="+$.Aa));const yd=Mt[5];yd!=null&&typeof yd=="number"&&0<yd&&(B=1.5*yd,$.L=B,$.j.info("backChannelRequestTimeoutMs_="+B)),B=$;const mo=w.g;if(mo){const Ex=mo.g?mo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ex){var de=B.h;de.g||Ex.indexOf("spdy")==-1&&Ex.indexOf("quic")==-1&&Ex.indexOf("h2")==-1||(de.j=de.l,de.g=new Set,de.h&&(oC(de,de.h),de.h=null))}if(B.D){const hC=mo.g?mo.g.getResponseHeader("X-HTTP-Session-Id"):null;hC&&(B.ya=hC,mn(B.I,B.D,hC))}}$.G=3,$.l&&$.l.ua(),$.ba&&($.R=Date.now()-w.F,$.j.info("Handshake RTT: "+$.R+"ms")),B=$;var Ee=w;if(B.qa=JP(B,B.J?B.ia:null,B.W),Ee.K){EP(B.h,Ee);var rn=Ee,zr=B.L;zr&&(rn.I=zr),rn.B&&(rC(rn),gx(rn)),B.g=Ee}else qP(B);0<$.i.length&&Cx($)}else Mt[0]!="stop"&&Mt[0]!="close"||Ec($,7);else $.G==3&&(Mt[0]=="stop"||Mt[0]=="close"?Mt[0]=="stop"?Ec($,7):lC($):Mt[0]!="noop"&&$.l&&$.l.ta(Mt),$.v=0)}}Up(4)}catch{}}var MY=class{constructor(w,A){this.g=w,this.map=A}};function CP(w){this.l=w||10,a.PerformanceNavigationTiming?(w=a.performance.getEntriesByType("navigation"),w=0<w.length&&(w[0].nextHopProtocol=="hq"||w[0].nextHopProtocol=="h2")):w=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=w?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function IP(w){return w.h?!0:w.g?w.g.size>=w.j:!1}function SP(w){return w.h?1:w.g?w.g.size:0}function iC(w,A){return w.h?w.h==A:w.g?w.g.has(A):!1}function oC(w,A){w.g?w.g.add(A):w.h=A}function EP(w,A){w.h&&w.h==A?w.h=null:w.g&&w.g.has(A)&&w.g.delete(A)}CP.prototype.cancel=function(){if(this.i=TP(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const w of this.g.values())w.cancel();this.g.clear()}};function TP(w){if(w.h!=null)return w.i.concat(w.h.D);if(w.g!=null&&w.g.size!==0){let A=w.i;for(const $ of w.g.values())A=A.concat($.D);return A}return m(w.i)}function LY(w){if(w.V&&typeof w.V=="function")return w.V();if(typeof Map<"u"&&w instanceof Map||typeof Set<"u"&&w instanceof Set)return Array.from(w.values());if(typeof w=="string")return w.split("");if(l(w)){for(var A=[],$=w.length,B=0;B<$;B++)A.push(w[B]);return A}A=[],$=0;for(B in w)A[$++]=w[B];return A}function BY(w){if(w.na&&typeof w.na=="function")return w.na();if(!w.V||typeof w.V!="function"){if(typeof Map<"u"&&w instanceof Map)return Array.from(w.keys());if(!(typeof Set<"u"&&w instanceof Set)){if(l(w)||typeof w=="string"){var A=[];w=w.length;for(var $=0;$<w;$++)A.push($);return A}A=[],$=0;for(const B in w)A[$++]=B;return A}}}function NP(w,A){if(w.forEach&&typeof w.forEach=="function")w.forEach(A,void 0);else if(l(w)||typeof w=="string")Array.prototype.forEach.call(w,A,void 0);else for(var $=BY(w),B=LY(w),re=B.length,de=0;de<re;de++)A.call(void 0,B[de],$&&$[de],w)}var AP=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function VY(w,A){if(w){w=w.split("&");for(var $=0;$<w.length;$++){var B=w[$].indexOf("="),re=null;if(0<=B){var de=w[$].substring(0,B);re=w[$].substring(B+1)}else de=w[$];A(de,re?decodeURIComponent(re.replace(/\+/g," ")):"")}}}function Sc(w){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,w instanceof Sc){this.h=w.h,vx(this,w.j),this.o=w.o,this.g=w.g,yx(this,w.s),this.l=w.l;var A=w.i,$=new Kp;$.i=A.i,A.g&&($.g=new Map(A.g),$.h=A.h),RP(this,$),this.m=w.m}else w&&(A=String(w).match(AP))?(this.h=!1,vx(this,A[1]||"",!0),this.o=Gp(A[2]||""),this.g=Gp(A[3]||"",!0),yx(this,A[4]),this.l=Gp(A[5]||"",!0),RP(this,A[6]||"",!0),this.m=Gp(A[7]||"")):(this.h=!1,this.i=new Kp(null,this.h))}Sc.prototype.toString=function(){var w=[],A=this.j;A&&w.push(qp(A,DP,!0),":");var $=this.g;return($||A=="file")&&(w.push("//"),(A=this.o)&&w.push(qp(A,DP,!0),"@"),w.push(encodeURIComponent(String($)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$=this.s,$!=null&&w.push(":",String($))),($=this.l)&&(this.g&&$.charAt(0)!="/"&&w.push("/"),w.push(qp($,$.charAt(0)=="/"?jY:UY,!0))),($=this.i.toString())&&w.push("?",$),($=this.m)&&w.push("#",qp($,HY)),w.join("")};function ja(w){return new Sc(w)}function vx(w,A,$){w.j=$?Gp(A,!0):A,w.j&&(w.j=w.j.replace(/:$/,""))}function yx(w,A){if(A){if(A=Number(A),isNaN(A)||0>A)throw Error("Bad port number "+A);w.s=A}else w.s=null}function RP(w,A,$){A instanceof Kp?(w.i=A,GY(w.i,w.h)):($||(A=qp(A,WY)),w.i=new Kp(A,w.h))}function mn(w,A,$){w.i.set(A,$)}function xx(w){return mn(w,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),w}function Gp(w,A){return w?A?decodeURI(w.replace(/%25/g,"%2525")):decodeURIComponent(w):""}function qp(w,A,$){return typeof w=="string"?(w=encodeURI(w).replace(A,zY),$&&(w=w.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w):null}function zY(w){return w=w.charCodeAt(0),"%"+(w>>4&15).toString(16)+(w&15).toString(16)}var DP=/[#\/\?@]/g,UY=/[#\?:]/g,jY=/[#\?]/g,WY=/[#\?@]/g,HY=/#/g;function Kp(w,A){this.h=this.g=null,this.i=w||null,this.j=!!A}function Xl(w){w.g||(w.g=new Map,w.h=0,w.i&&VY(w.i,function(A,$){w.add(decodeURIComponent(A.replace(/\+/g," ")),$)}))}n=Kp.prototype,n.add=function(w,A){Xl(this),this.i=null,w=gd(this,w);var $=this.g.get(w);return $||this.g.set(w,$=[]),$.push(A),this.h+=1,this};function $P(w,A){Xl(w),A=gd(w,A),w.g.has(A)&&(w.i=null,w.h-=w.g.get(A).length,w.g.delete(A))}function PP(w,A){return Xl(w),A=gd(w,A),w.g.has(A)}n.forEach=function(w,A){Xl(this),this.g.forEach(function($,B){$.forEach(function(re){w.call(A,re,B,this)},this)},this)},n.na=function(){Xl(this);const w=Array.from(this.g.values()),A=Array.from(this.g.keys()),$=[];for(let B=0;B<A.length;B++){const re=w[B];for(let de=0;de<re.length;de++)$.push(A[B])}return $},n.V=function(w){Xl(this);let A=[];if(typeof w=="string")PP(this,w)&&(A=A.concat(this.g.get(gd(this,w))));else{w=Array.from(this.g.values());for(let $=0;$<w.length;$++)A=A.concat(w[$])}return A},n.set=function(w,A){return Xl(this),this.i=null,w=gd(this,w),PP(this,w)&&(this.h-=this.g.get(w).length),this.g.set(w,[A]),this.h+=1,this},n.get=function(w,A){return w?(w=this.V(w),0<w.length?String(w[0]):A):A};function OP(w,A,$){$P(w,A),0<$.length&&(w.i=null,w.g.set(gd(w,A),m($)),w.h+=$.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const w=[],A=Array.from(this.g.keys());for(var $=0;$<A.length;$++){var B=A[$];const de=encodeURIComponent(String(B)),Ee=this.V(B);for(B=0;B<Ee.length;B++){var re=de;Ee[B]!==""&&(re+="="+encodeURIComponent(String(Ee[B]))),w.push(re)}}return this.i=w.join("&")};function gd(w,A){return A=String(A),w.j&&(A=A.toLowerCase()),A}function GY(w,A){A&&!w.j&&(Xl(w),w.i=null,w.g.forEach(function($,B){var re=B.toLowerCase();B!=re&&($P(this,B),OP(this,re,$))},w)),w.j=A}function qY(w,A){const $=new Wp;if(a.Image){const B=new Image;B.onload=f(Yl,$,"TestLoadImage: loaded",!0,A,B),B.onerror=f(Yl,$,"TestLoadImage: error",!1,A,B),B.onabort=f(Yl,$,"TestLoadImage: abort",!1,A,B),B.ontimeout=f(Yl,$,"TestLoadImage: timeout",!1,A,B),a.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=w}else A(!1)}function KY(w,A){const $=new Wp,B=new AbortController,re=setTimeout(()=>{B.abort(),Yl($,"TestPingServer: timeout",!1,A)},1e4);fetch(w,{signal:B.signal}).then(de=>{clearTimeout(re),de.ok?Yl($,"TestPingServer: ok",!0,A):Yl($,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(re),Yl($,"TestPingServer: error",!1,A)})}function Yl(w,A,$,B,re){try{re&&(re.onload=null,re.onerror=null,re.onabort=null,re.ontimeout=null),B($)}catch{}}function XY(){this.g=new RY}function YY(w,A,$){const B=$||"";try{NP(w,function(re,de){let Ee=re;u(re)&&(Ee=Ua(re)),A.push(B+de+"="+encodeURIComponent(Ee))})}catch(re){throw A.push(B+"type="+encodeURIComponent("_badmap")),re}}function bx(w){this.l=w.Ub||null,this.j=w.eb||!1}p(bx,Qk),bx.prototype.g=function(){return new wx(this.l,this.j)},bx.prototype.i=function(w){return function(){return w}}({});function wx(w,A){Qt.call(this),this.D=w,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}p(wx,Qt),n=wx.prototype,n.open=function(w,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=w,this.A=A,this.readyState=1,Yp(this)},n.send=function(w){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const A={headers:this.u,method:this.B,credentials:this.m,cache:void 0};w&&(A.body=w),(this.D||a).fetch(new Request(this.A,A)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Xp(this)),this.readyState=0},n.Sa=function(w){if(this.g&&(this.l=w,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=w.headers,this.readyState=2,Yp(this)),this.g&&(this.readyState=3,Yp(this),this.g)))if(this.responseType==="arraybuffer")w.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in w){if(this.j=w.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;FP(this)}else w.text().then(this.Ra.bind(this),this.ga.bind(this))};function FP(w){w.j.read().then(w.Pa.bind(w)).catch(w.ga.bind(w))}n.Pa=function(w){if(this.g){if(this.o&&w.value)this.response.push(w.value);else if(!this.o){var A=w.value?w.value:new Uint8Array(0);(A=this.v.decode(A,{stream:!w.done}))&&(this.response=this.responseText+=A)}w.done?Xp(this):Yp(this),this.readyState==3&&FP(this)}},n.Ra=function(w){this.g&&(this.response=this.responseText=w,Xp(this))},n.Qa=function(w){this.g&&(this.response=w,Xp(this))},n.ga=function(){this.g&&Xp(this)};function Xp(w){w.readyState=4,w.l=null,w.j=null,w.v=null,Yp(w)}n.setRequestHeader=function(w,A){this.u.append(w,A)},n.getResponseHeader=function(w){return this.h&&this.h.get(w.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const w=[],A=this.h.entries();for(var $=A.next();!$.done;)$=$.value,w.push($[0]+": "+$[1]),$=A.next();return w.join(`\r
`)};function Yp(w){w.onreadystatechange&&w.onreadystatechange.call(w)}Object.defineProperty(wx.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(w){this.m=w?"include":"same-origin"}});function MP(w){let A="";return E(w,function($,B){A+=B,A+=":",A+=$,A+=`\r
`}),A}function aC(w,A,$){e:{for(B in $){var B=!1;break e}B=!0}B||($=MP($),typeof w=="string"?$!=null&&encodeURIComponent(String($)):mn(w,A,$))}function Vn(w){Qt.call(this),this.headers=new Map,this.o=w||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}p(Vn,Qt);var QY=/^https?$/i,JY=["POST","PUT"];n=Vn.prototype,n.Ha=function(w){this.J=w},n.ea=function(w,A,$,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+w);A=A?A.toUpperCase():"GET",this.D=w,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():eC.g(),this.v=this.o?dP(this.o):dP(eC),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(A,String(w),!0),this.B=!1}catch(de){LP(this,de);return}if(w=$||"",$=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var re in B)$.set(re,B[re]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const de of B.keys())$.set(de,B.get(de));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from($.keys()).find(de=>de.toLowerCase()=="content-type"),re=a.FormData&&w instanceof a.FormData,!(0<=Array.prototype.indexOf.call(JY,A,void 0))||B||re||$.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[de,Ee]of $)this.g.setRequestHeader(de,Ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zP(this),this.u=!0,this.g.send(w),this.u=!1}catch(de){LP(this,de)}};function LP(w,A){w.h=!1,w.g&&(w.j=!0,w.g.abort(),w.j=!1),w.l=A,w.m=5,BP(w),_x(w)}function BP(w){w.A||(w.A=!0,jt(w,"complete"),jt(w,"error"))}n.abort=function(w){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=w||7,jt(this,"complete"),jt(this,"abort"),_x(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_x(this,!0)),Vn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?VP(this):this.bb())},n.bb=function(){VP(this)};function VP(w){if(w.h&&typeof o<"u"&&(!w.v[1]||Wa(w)!=4||w.Z()!=2)){if(w.u&&Wa(w)==4)$i(w.Ea,0,w);else if(jt(w,"readystatechange"),Wa(w)==4){w.h=!1;try{const Ee=w.Z();e:switch(Ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var $;if(!($=A)){var B;if(B=Ee===0){var re=String(w.D).match(AP)[1]||null;!re&&a.self&&a.self.location&&(re=a.self.location.protocol.slice(0,-1)),B=!QY.test(re?re.toLowerCase():"")}$=B}if($)jt(w,"complete"),jt(w,"success");else{w.m=6;try{var de=2<Wa(w)?w.g.statusText:""}catch{de=""}w.l=de+" ["+w.Z()+"]",BP(w)}}finally{_x(w)}}}}function _x(w,A){if(w.g){zP(w);const $=w.g,B=w.v[0]?()=>{}:null;w.g=null,w.v=null,A||jt(w,"ready");try{$.onreadystatechange=B}catch{}}}function zP(w){w.I&&(a.clearTimeout(w.I),w.I=null)}n.isActive=function(){return!!this.g};function Wa(w){return w.g?w.g.readyState:0}n.Z=function(){try{return 2<Wa(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(w){if(this.g){var A=this.g.responseText;return w&&A.indexOf(w)==0&&(A=A.substring(w.length)),AY(A)}};function UP(w){try{if(!w.g)return null;if("response"in w.g)return w.g.response;switch(w.H){case"":case"text":return w.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in w.g)return w.g.mozResponseArrayBuffer}return null}catch{return null}}function ZY(w){const A={};w=(w.g&&2<=Wa(w)&&w.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<w.length;B++){if(y(w[B]))continue;var $=N(w[B]);const re=$[0];if($=$[1],typeof $!="string")continue;$=$.trim();const de=A[re]||[];A[re]=de,de.push($)}I(A,function(B){return B.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qp(w,A,$){return $&&$.internalChannelParams&&$.internalChannelParams[w]||A}function jP(w){this.Aa=0,this.i=[],this.j=new Wp,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qp("failFast",!1,w),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qp("baseRetryDelayMs",5e3,w),this.cb=Qp("retryDelaySeedMs",1e4,w),this.Wa=Qp("forwardChannelMaxRetries",2,w),this.wa=Qp("forwardChannelRequestTimeoutMs",2e4,w),this.pa=w&&w.xmlHttpFactory||void 0,this.Xa=w&&w.Tb||void 0,this.Ca=w&&w.useFetchStreams||!1,this.L=void 0,this.J=w&&w.supportsCrossDomainXhr||!1,this.K="",this.h=new CP(w&&w.concurrentRequestLimit),this.Da=new XY,this.P=w&&w.fastHandshake||!1,this.O=w&&w.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=w&&w.Rb||!1,w&&w.xa&&this.j.xa(),w&&w.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&w&&w.detectBufferingProxy||!1,this.ja=void 0,w&&w.longPollingTimeout&&0<w.longPollingTimeout&&(this.ja=w.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=jP.prototype,n.la=8,n.G=1,n.connect=function(w,A,$,B){Ns(0),this.W=w,this.H=A||{},$&&B!==void 0&&(this.H.OSID=$,this.H.OAID=B),this.F=this.X,this.I=JP(this,null,this.W),Cx(this)};function lC(w){if(WP(w),w.G==3){var A=w.U++,$=ja(w.I);if(mn($,"SID",w.K),mn($,"RID",A),mn($,"TYPE","terminate"),Jp(w,$),A=new Kl(w,w.j,A),A.L=2,A.v=xx(ja($)),$=!1,a.navigator&&a.navigator.sendBeacon)try{$=a.navigator.sendBeacon(A.v.toString(),"")}catch{}!$&&a.Image&&(new Image().src=A.v,$=!0),$||(A.g=ZP(A.j,null),A.g.ea(A.v)),A.F=Date.now(),gx(A)}QP(w)}function kx(w){w.g&&(cC(w),w.g.cancel(),w.g=null)}function WP(w){kx(w),w.u&&(a.clearTimeout(w.u),w.u=null),Ix(w),w.h.cancel(),w.s&&(typeof w.s=="number"&&a.clearTimeout(w.s),w.s=null)}function Cx(w){if(!IP(w.h)&&!w.s){w.s=!0;var A=w.Ga;F||W(),P||(F(),P=!0),U.add(A,w),w.B=0}}function eQ(w,A){return SP(w.h)>=w.h.j-(w.s?1:0)?!1:w.s?(w.i=A.D.concat(w.i),!0):w.G==1||w.G==2||w.B>=(w.Va?0:w.Wa)?!1:(w.s=jp(d(w.Ga,w,A),YP(w,w.B)),w.B++,!0)}n.Ga=function(w){if(this.s)if(this.s=null,this.G==1){if(!w){this.U=Math.floor(1e5*Math.random()),w=this.U++;const re=new Kl(this,this.j,w);let de=this.o;if(this.S&&(de?(de=C(de),T(de,this.S)):de=this.S),this.m!==null||this.O||(re.H=de,de=null),this.P)e:{for(var A=0,$=0;$<this.i.length;$++){t:{var B=this.i[$];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(A+=B,4096<A){A=$;break e}if(A===4096||$===this.i.length-1){A=$+1;break e}}A=1e3}else A=1e3;A=GP(this,re,A),$=ja(this.I),mn($,"RID",w),mn($,"CVER",22),this.D&&mn($,"X-HTTP-Session-Id",this.D),Jp(this,$),de&&(this.O?A="headers="+encodeURIComponent(String(MP(de)))+"&"+A:this.m&&aC($,this.m,de)),oC(this.h,re),this.Ua&&mn($,"TYPE","init"),this.P?(mn($,"$req",A),mn($,"SID","null"),re.T=!0,nC(re,$,null)):nC(re,$,A),this.G=2}}else this.G==3&&(w?HP(this,w):this.i.length==0||IP(this.h)||HP(this))};function HP(w,A){var $;A?$=A.l:$=w.U++;const B=ja(w.I);mn(B,"SID",w.K),mn(B,"RID",$),mn(B,"AID",w.T),Jp(w,B),w.m&&w.o&&aC(B,w.m,w.o),$=new Kl(w,w.j,$,w.B+1),w.m===null&&($.H=w.o),A&&(w.i=A.D.concat(w.i)),A=GP(w,$,1e3),$.I=Math.round(.5*w.wa)+Math.round(.5*w.wa*Math.random()),oC(w.h,$),nC($,B,A)}function Jp(w,A){w.H&&E(w.H,function($,B){mn(A,B,$)}),w.l&&NP({},function($,B){mn(A,B,$)})}function GP(w,A,$){$=Math.min(w.i.length,$);var B=w.l?d(w.l.Na,w.l,w):null;e:{var re=w.i;let de=-1;for(;;){const Ee=["count="+$];de==-1?0<$?(de=re[0].g,Ee.push("ofs="+de)):de=0:Ee.push("ofs="+de);let rn=!0;for(let zr=0;zr<$;zr++){let Mt=re[zr].g;const rs=re[zr].map;if(Mt-=de,0>Mt)de=Math.max(0,re[zr].g-100),rn=!1;else try{YY(rs,Ee,"req"+Mt+"_")}catch{B&&B(rs)}}if(rn){B=Ee.join("&");break e}}}return w=w.i.splice(0,$),A.D=w,B}function qP(w){if(!w.g&&!w.u){w.Y=1;var A=w.Fa;F||W(),P||(F(),P=!0),U.add(A,w),w.v=0}}function uC(w){return w.g||w.u||3<=w.v?!1:(w.Y++,w.u=jp(d(w.Fa,w),YP(w,w.v)),w.v++,!0)}n.Fa=function(){if(this.u=null,KP(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var w=2*this.R;this.j.info("BP detection timer enabled: "+w),this.A=jp(d(this.ab,this),w)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ns(10),kx(this),KP(this))};function cC(w){w.A!=null&&(a.clearTimeout(w.A),w.A=null)}function KP(w){w.g=new Kl(w,w.j,"rpc",w.Y),w.m===null&&(w.g.H=w.o),w.g.O=0;var A=ja(w.qa);mn(A,"RID","rpc"),mn(A,"SID",w.K),mn(A,"AID",w.T),mn(A,"CI",w.F?"0":"1"),!w.F&&w.ja&&mn(A,"TO",w.ja),mn(A,"TYPE","xmlhttp"),Jp(w,A),w.m&&w.o&&aC(A,w.m,w.o),w.L&&(w.g.I=w.L);var $=w.g;w=w.ia,$.L=1,$.v=xx(ja(A)),$.m=null,$.P=!0,wP($,w)}n.Za=function(){this.C!=null&&(this.C=null,kx(this),uC(this),Ns(19))};function Ix(w){w.C!=null&&(a.clearTimeout(w.C),w.C=null)}function XP(w,A){var $=null;if(w.g==A){Ix(w),cC(w),w.g=null;var B=2}else if(iC(w.h,A))$=A.D,EP(w.h,A),B=1;else return;if(w.G!=0){if(A.o)if(B==1){$=A.m?A.m.length:0,A=Date.now()-A.F;var re=w.B;B=fx(),jt(B,new vP(B,$)),Cx(w)}else qP(w);else if(re=A.s,re==3||re==0&&0<A.X||!(B==1&&eQ(w,A)||B==2&&uC(w)))switch($&&0<$.length&&(A=w.h,A.i=A.i.concat($)),re){case 1:Ec(w,5);break;case 4:Ec(w,10);break;case 3:Ec(w,6);break;default:Ec(w,2)}}}function YP(w,A){let $=w.Ta+Math.floor(Math.random()*w.cb);return w.isActive()||($*=2),$*A}function Ec(w,A){if(w.j.info("Error code "+A),A==2){var $=d(w.fb,w),B=w.Xa;const re=!B;B=new Sc(B||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||vx(B,"https"),xx(B),re?qY(B.toString(),$):KY(B.toString(),$)}else Ns(2);w.G=0,w.l&&w.l.sa(A),QP(w),WP(w)}n.fb=function(w){w?(this.j.info("Successfully pinged google.com"),Ns(2)):(this.j.info("Failed to ping google.com"),Ns(1))};function QP(w){if(w.G=0,w.ka=[],w.l){const A=TP(w.h);(A.length!=0||w.i.length!=0)&&(g(w.ka,A),g(w.ka,w.i),w.h.i.length=0,m(w.i),w.i.length=0),w.l.ra()}}function JP(w,A,$){var B=$ instanceof Sc?ja($):new Sc($);if(B.g!="")A&&(B.g=A+"."+B.g),yx(B,B.s);else{var re=a.location;B=re.protocol,A=A?A+"."+re.hostname:re.hostname,re=+re.port;var de=new Sc(null);B&&vx(de,B),A&&(de.g=A),re&&yx(de,re),$&&(de.l=$),B=de}return $=w.D,A=w.ya,$&&A&&mn(B,$,A),mn(B,"VER",w.la),Jp(w,B),B}function ZP(w,A,$){if(A&&!w.J)throw Error("Can't create secondary domain capable XhrIo object.");return A=w.Ca&&!w.pa?new Vn(new bx({eb:$})):new Vn(w.pa),A.Ha(w.J),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function eO(){}n=eO.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Sx(){}Sx.prototype.g=function(w,A){return new ui(w,A)};function ui(w,A){Qt.call(this),this.g=new jP(A),this.l=w,this.h=A&&A.messageUrlParams||null,w=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(w?w["X-Client-Protocol"]="webchannel":w={"X-Client-Protocol":"webchannel"}),this.g.o=w,w=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(w?w["X-WebChannel-Content-Type"]=A.messageContentType:w={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.va&&(w?w["X-WebChannel-Client-Profile"]=A.va:w={"X-WebChannel-Client-Profile":A.va}),this.g.S=w,(w=A&&A.Sb)&&!y(w)&&(this.g.m=w),this.v=A&&A.supportsCrossDomainXhr||!1,this.u=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!y(A)&&(this.g.D=A,w=this.h,w!==null&&A in w&&(w=this.h,A in w&&delete w[A])),this.j=new vd(this)}p(ui,Qt),ui.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ui.prototype.close=function(){lC(this.g)},ui.prototype.o=function(w){var A=this.g;if(typeof w=="string"){var $={};$.__data__=w,w=$}else this.u&&($={},$.__data__=Ua(w),w=$);A.i.push(new MY(A.Ya++,w)),A.G==3&&Cx(A)},ui.prototype.N=function(){this.g.l=null,delete this.j,lC(this.g),delete this.g,ui.aa.N.call(this)};function tO(w){Jk.call(this),w.__headers__&&(this.headers=w.__headers__,this.statusCode=w.__status__,delete w.__headers__,delete w.__status__);var A=w.__sm__;if(A){e:{for(const $ in A){w=$;break e}w=void 0}(this.i=w)&&(w=this.i,A=A!==null&&w in A?A[w]:void 0),this.data=A}else this.data=w}p(tO,Jk);function nO(){Zk.call(this),this.status=1}p(nO,Zk);function vd(w){this.g=w}p(vd,eO),vd.prototype.ua=function(){jt(this.g,"a")},vd.prototype.ta=function(w){jt(this.g,new tO(w))},vd.prototype.sa=function(w){jt(this.g,new nO)},vd.prototype.ra=function(){jt(this.g,"b")},Sx.prototype.createWebChannel=Sx.prototype.g,ui.prototype.send=ui.prototype.o,ui.prototype.open=ui.prototype.m,ui.prototype.close=ui.prototype.close,oW=function(){return new Sx},iW=function(){return fx()},sW=Cc,vS={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},px.NO_ERROR=0,px.TIMEOUT=8,px.HTTP_ERROR=6,ab=px,yP.COMPLETE="complete",rW=yP,fP.EventType=zp,zp.OPEN="a",zp.CLOSE="b",zp.ERROR="c",zp.MESSAGE="d",Qt.prototype.listen=Qt.prototype.K,Dm=fP,Vn.prototype.listenOnce=Vn.prototype.L,Vn.prototype.getLastError=Vn.prototype.Ka,Vn.prototype.getLastErrorCode=Vn.prototype.Ba,Vn.prototype.getStatus=Vn.prototype.Z,Vn.prototype.getResponseJson=Vn.prototype.Oa,Vn.prototype.getResponseText=Vn.prototype.oa,Vn.prototype.send=Vn.prototype.ea,Vn.prototype.setWithCredentials=Vn.prototype.Ha,nW=Vn}).apply(typeof a0<"u"?a0:typeof self<"u"?self:typeof window<"u"?window:{});const uL="@firebase/firestore",cL="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hs.UNAUTHENTICATED=new hs(null),hs.GOOGLE_CREDENTIALS=new hs("google-credentials-uid"),hs.FIRST_PARTY=new hs("first-party-uid"),hs.MOCK_USER=new hs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gp="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch=new mN("@firebase/firestore");function Ad(){return Ch.logLevel}function Pe(n,...e){if(Ch.logLevel<=Et.DEBUG){const t=e.map(xN);Ch.debug(`Firestore (${gp}): ${n}`,...t)}}function wl(n,...e){if(Ch.logLevel<=Et.ERROR){const t=e.map(xN);Ch.error(`Firestore (${gp}): ${n}`,...t)}}function Mf(n,...e){if(Ch.logLevel<=Et.WARN){const t=e.map(xN);Ch.warn(`Firestore (${gp}): ${n}`,...t)}}function xN(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(n="Unexpected state"){const e=`FIRESTORE (${gp}) INTERNAL ASSERTION FAILED: `+n;throw wl(e),new Error(e)}function qt(n,e){n||st()}function ht(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ve={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Me extends Pl{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aW{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wfe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(hs.UNAUTHENTICATED))}shutdown(){}}class Hfe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Gfe{constructor(e){this.t=e,this.currentUser=hs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){qt(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Fu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Fu,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Fu)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(qt(typeof r.accessToken=="string"),new aW(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return qt(e===null||typeof e=="string"),new hs(e)}}class qfe{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=hs.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Kfe{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new qfe(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(hs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xfe{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,aa(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){qt(this.o===void 0);const r=i=>{i.error!=null&&Pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):Pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new hL(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(qt(typeof t.token=="string"),this.R=t.token,new hL(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yfe(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lW(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uW{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Yfe(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function xt(n,e){return n<e?-1:n>e?1:0}function yS(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),s=e.codePointAt(t);if(r!==s){if(r<128&&s<128)return xt(r,s);{const i=lW(),o=Qfe(i.encode(dL(n,t)),i.encode(dL(e,t)));return o!==0?o:xt(r,s)}}t+=r>65535?2:1}return xt(n.length,e.length)}function dL(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Qfe(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return xt(n[t],e[t]);return xt(n.length,e.length)}function Lf(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL=-62135596800,pL=1e6;class tr{static now(){return tr.fromMillis(Date.now())}static fromDate(e){return tr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*pL);return new tr(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Me(ve.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Me(ve.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<fL)throw new Me(ve.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Me(ve.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pL}_compareTo(e){return this.seconds===e.seconds?xt(this.nanoseconds,e.nanoseconds):xt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-fL;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{static fromTimestamp(e){return new at(e)}static min(){return new at(new tr(0,0))}static max(){return new at(new tr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mL="__name__";class ea{constructor(e,t,r){t===void 0?t=0:t>e.length&&st(),r===void 0?r=e.length-t:r>e.length-t&&st(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ea.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ea?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=ea.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return xt(e.length,t.length)}static compareSegments(e,t){const r=ea.isNumericId(e),s=ea.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?ea.extractNumericId(e).compare(ea.extractNumericId(t)):yS(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ou.fromString(e.substring(4,e.length-2))}}class xn extends ea{construct(e,t,r){return new xn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Me(ve.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new xn(t)}static emptyPath(){return new xn([])}}const Jfe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qr extends ea{construct(e,t,r){return new qr(e,t,r)}static isValidIdentifier(e){return Jfe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mL}static keyField(){return new qr([mL])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Me(ve.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Me(ve.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Me(ve.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Me(ve.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qr(t)}static emptyPath(){return new qr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e){this.path=e}static fromPath(e){return new Ze(xn.fromString(e))}static fromName(e){return new Ze(xn.fromString(e).popFirst(5))}static empty(){return new Ze(xn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&xn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return xn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ze(new xn(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vg=-1;function Zfe(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=at.fromTimestamp(r===1e9?new tr(t+1,0):new tr(t,r));return new Ku(s,Ze.empty(),e)}function epe(n){return new Ku(n.readTime,n.key,Vg)}class Ku{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ku(at.min(),Ze.empty(),Vg)}static max(){return new Ku(at.max(),Ze.empty(),Vg)}}function tpe(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ze.comparator(n.documentKey,e.documentKey),t!==0?t:xt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const npe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rpe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vp(n){if(n.code!==ve.FAILED_PRECONDITION||n.message!==npe)throw n;Pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ge{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&st(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ge((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ge?t:ge.resolve(t)}catch(t){return ge.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ge.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ge.reject(t)}static resolve(e){return new ge((t,r)=>{t(e)})}static reject(e){return new ge((t,r)=>{r(e)})}static waitFor(e){return new ge((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=ge.resolve(!1);for(const r of e)t=t.next(s=>s?ge.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new ge((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(c=>{o[u]=c,++a,a===i&&r(o)},c=>s(c))}})}static doWhile(e,t){return new ge((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function spe(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function yp(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.oe(r),this._e=r=>t.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}U1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bN=-1;function j1(n){return n==null}function nw(n){return n===0&&1/n==-1/0}function ipe(n){return typeof n=="number"&&Number.isInteger(n)&&!nw(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cW="";function ope(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=gL(e)),e=ape(n.get(t),e);return gL(e)}function ape(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case cW:t+="";break;default:t+=i}}return t}function gL(n){return n+cW+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vL(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Kh(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function hW(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t){this.comparator=e,this.root=t||Wr.EMPTY}insert(e,t){return new Fn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wr.BLACK,null,null))}remove(e){return new Fn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new l0(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new l0(this.root,e,this.comparator,!1)}getReverseIterator(){return new l0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new l0(this.root,e,this.comparator,!0)}}class l0{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wr{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Wr.RED,this.left=s??Wr.EMPTY,this.right=i??Wr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Wr(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Wr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Wr.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw st();const e=this.left.check();if(e!==this.right.check())throw st();return e+(this.isRed()?0:1)}}Wr.EMPTY=null,Wr.RED=!0,Wr.BLACK=!1;Wr.EMPTY=new class{constructor(){this.size=0}get key(){throw st()}get value(){throw st()}get color(){throw st()}get left(){throw st()}get right(){throw st()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Wr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e){this.comparator=e,this.data=new Fn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yL(this.data.getIterator())}getIteratorFrom(e){return new yL(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof wr)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new wr(this.comparator);return t.data=e,t}}class yL{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e){this.fields=e,e.sort(qr.comparator)}static empty(){return new So([])}unionWith(e){let t=new wr(qr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new So(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Lf(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dW extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new dW("Invalid base64 string: "+i):i}}(e);return new Yr(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Yr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return xt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yr.EMPTY_BYTE_STRING=new Yr("");const lpe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xu(n){if(qt(!!n),typeof n=="string"){let e=0;const t=lpe.exec(n);if(qt(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Qn(n.seconds),nanos:Qn(n.nanos)}}function Qn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Yu(n){return typeof n=="string"?Yr.fromBase64String(n):Yr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fW="server_timestamp",pW="__type__",mW="__previous_value__",gW="__local_write_time__";function wN(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[pW])===null||t===void 0?void 0:t.stringValue)===fW}function W1(n){const e=n.mapValue.fields[mW];return wN(e)?W1(e):e}function zg(n){const e=Xu(n.mapValue.fields[gW].timestampValue);return new tr(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class upe{constructor(e,t,r,s,i,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}const rw="(default)";class Ug{constructor(e,t){this.projectId=e,this.database=t||rw}static empty(){return new Ug("","")}get isDefaultDatabase(){return this.database===rw}isEqual(e){return e instanceof Ug&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vW="__type__",cpe="__max__",u0={mapValue:{}},yW="__vector__",sw="value";function Qu(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wN(n)?4:dpe(n)?9007199254740991:hpe(n)?10:11:st()}function Ta(n,e){if(n===e)return!0;const t=Qu(n);if(t!==Qu(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zg(n).isEqual(zg(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Xu(s.timestampValue),a=Xu(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Yu(s.bytesValue).isEqual(Yu(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Qn(s.geoPointValue.latitude)===Qn(i.geoPointValue.latitude)&&Qn(s.geoPointValue.longitude)===Qn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Qn(s.integerValue)===Qn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Qn(s.doubleValue),a=Qn(i.doubleValue);return o===a?nw(o)===nw(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Lf(n.arrayValue.values||[],e.arrayValue.values||[],Ta);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(vL(o)!==vL(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ta(o[l],a[l])))return!1;return!0}(n,e);default:return st()}}function jg(n,e){return(n.values||[]).find(t=>Ta(t,e))!==void 0}function Bf(n,e){if(n===e)return 0;const t=Qu(n),r=Qu(e);if(t!==r)return xt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return xt(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Qn(i.integerValue||i.doubleValue),l=Qn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return xL(n.timestampValue,e.timestampValue);case 4:return xL(zg(n),zg(e));case 5:return yS(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Yu(i),l=Yu(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const c=xt(a[u],l[u]);if(c!==0)return c}return xt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=xt(Qn(i.latitude),Qn(o.latitude));return a!==0?a:xt(Qn(i.longitude),Qn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return bL(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,c;const h=i.fields||{},d=o.fields||{},f=(a=h[sw])===null||a===void 0?void 0:a.arrayValue,p=(l=d[sw])===null||l===void 0?void 0:l.arrayValue,m=xt(((u=f==null?void 0:f.values)===null||u===void 0?void 0:u.length)||0,((c=p==null?void 0:p.values)===null||c===void 0?void 0:c.length)||0);return m!==0?m:bL(f,p)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===u0.mapValue&&o===u0.mapValue)return 0;if(i===u0.mapValue)return 1;if(o===u0.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const d=yS(l[h],c[h]);if(d!==0)return d;const f=Bf(a[l[h]],u[c[h]]);if(f!==0)return f}return xt(l.length,c.length)}(n.mapValue,e.mapValue);default:throw st()}}function xL(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return xt(n,e);const t=Xu(n),r=Xu(e),s=xt(t.seconds,r.seconds);return s!==0?s:xt(t.nanos,r.nanos)}function bL(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Bf(t[s],r[s]);if(i)return i}return xt(t.length,r.length)}function Vf(n){return xS(n)}function xS(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Xu(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Yu(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ze.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=xS(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${xS(t.fields[o])}`;return s+"}"}(n.mapValue):st()}function lb(n){switch(Qu(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=W1(n);return e?16+lb(e):16;case 5:return 2*n.stringValue.length;case 6:return Yu(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+lb(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Kh(r.fields,(i,o)=>{s+=i.length+lb(o)}),s}(n.mapValue);default:throw st()}}function wL(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bS(n){return!!n&&"integerValue"in n}function _N(n){return!!n&&"arrayValue"in n}function _L(n){return!!n&&"nullValue"in n}function kL(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ub(n){return!!n&&"mapValue"in n}function hpe(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[vW])===null||t===void 0?void 0:t.stringValue)===yW}function rg(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Kh(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=rg(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=rg(n.arrayValue.values[t]);return e}return Object.assign({},n)}function dpe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===cpe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this.value=e}static empty(){return new Wi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ub(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rg(t)}setAll(e){let t=qr.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=rg(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ub(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ta(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ub(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Kh(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Wi(rg(this.value))}}function xW(n){const e=[];return Kh(n.fields,(t,r)=>{const s=new qr([t]);if(ub(r)){const i=xW(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new So(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ms(e,0,at.min(),at.min(),at.min(),Wi.empty(),0)}static newFoundDocument(e,t,r,s){return new ms(e,1,t,at.min(),r,s,0)}static newNoDocument(e,t){return new ms(e,2,t,at.min(),at.min(),Wi.empty(),0)}static newUnknownDocument(e,t){return new ms(e,3,t,at.min(),at.min(),Wi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(at.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Wi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Wi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=at.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ms&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ms(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,t){this.position=e,this.inclusive=t}}function CL(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ze.comparator(Ze.fromName(o.referenceValue),t.key):r=Bf(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function IL(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ta(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e,t="asc"){this.field=e,this.dir=t}}function fpe(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bW{}class ar extends bW{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new mpe(e,t,r):t==="array-contains"?new ype(e,r):t==="in"?new xpe(e,r):t==="not-in"?new bpe(e,r):t==="array-contains-any"?new wpe(e,r):new ar(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new gpe(e,r):new vpe(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Bf(t,this.value)):t!==null&&Qu(this.value)===Qu(t)&&this.matchesComparison(Bf(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return st()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mo extends bW{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Mo(e,t)}matches(e){return wW(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function wW(n){return n.op==="and"}function _W(n){return ppe(n)&&wW(n)}function ppe(n){for(const e of n.filters)if(e instanceof Mo)return!1;return!0}function wS(n){if(n instanceof ar)return n.field.canonicalString()+n.op.toString()+Vf(n.value);if(_W(n))return n.filters.map(e=>wS(e)).join(",");{const e=n.filters.map(t=>wS(t)).join(",");return`${n.op}(${e})`}}function kW(n,e){return n instanceof ar?function(r,s){return s instanceof ar&&r.op===s.op&&r.field.isEqual(s.field)&&Ta(r.value,s.value)}(n,e):n instanceof Mo?function(r,s){return s instanceof Mo&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&kW(o,s.filters[a]),!0):!1}(n,e):void st()}function CW(n){return n instanceof ar?function(t){return`${t.field.canonicalString()} ${t.op} ${Vf(t.value)}`}(n):n instanceof Mo?function(t){return t.op.toString()+" {"+t.getFilters().map(CW).join(" ,")+"}"}(n):"Filter"}class mpe extends ar{constructor(e,t,r){super(e,t,r),this.key=Ze.fromName(r.referenceValue)}matches(e){const t=Ze.comparator(e.key,this.key);return this.matchesComparison(t)}}class gpe extends ar{constructor(e,t){super(e,"in",t),this.keys=IW("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class vpe extends ar{constructor(e,t){super(e,"not-in",t),this.keys=IW("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function IW(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ze.fromName(r.referenceValue))}class ype extends ar{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _N(t)&&jg(t.arrayValue,this.value)}}class xpe extends ar{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&jg(this.value.arrayValue,t)}}class bpe extends ar{constructor(e,t){super(e,"not-in",t)}matches(e){if(jg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!jg(this.value.arrayValue,t)}}class wpe extends ar{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_N(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>jg(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _pe{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.le=null}}function SL(n,e=null,t=[],r=[],s=null,i=null,o=null){return new _pe(n,e,t,r,s,i,o)}function kN(n){const e=ht(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>wS(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),j1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Vf(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Vf(r)).join(",")),e.le=t}return e.le}function CN(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!fpe(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!kW(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!IL(n.startAt,e.startAt)&&IL(n.endAt,e.endAt)}function _S(n){return Ze.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function kpe(n,e,t,r,s,i,o,a){return new xp(n,e,t,r,s,i,o,a)}function IN(n){return new xp(n)}function EL(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function SW(n){return n.collectionGroup!==null}function sg(n){const e=ht(n);if(e.he===null){e.he=[];const t=new Set;for(const i of e.explicitOrderBy)e.he.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new wr(qr.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.he.push(new Wg(i,r))}),t.has(qr.keyField().canonicalString())||e.he.push(new Wg(qr.keyField(),r))}return e.he}function ma(n){const e=ht(n);return e.Pe||(e.Pe=Cpe(e,sg(n))),e.Pe}function Cpe(n,e){if(n.limitType==="F")return SL(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Wg(s.field,i)});const t=n.endAt?new iw(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new iw(n.startAt.position,n.startAt.inclusive):null;return SL(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function kS(n,e){const t=n.filters.concat([e]);return new xp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ow(n,e,t){return new xp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function H1(n,e){return CN(ma(n),ma(e))&&n.limitType===e.limitType}function EW(n){return`${kN(ma(n))}|lt:${n.limitType}`}function Rd(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>CW(s)).join(", ")}]`),j1(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Vf(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Vf(s)).join(",")),`Target(${r})`}(ma(n))}; limitType=${n.limitType})`}function G1(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ze.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of sg(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=CL(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,sg(r),s)||r.endAt&&!function(o,a,l){const u=CL(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,sg(r),s))}(n,e)}function Ipe(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function TW(n){return(e,t)=>{let r=!1;for(const s of sg(n)){const i=Spe(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Spe(n,e,t){const r=n.field.isKeyField()?Ze.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Bf(l,u):st()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return st()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Kh(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return hW(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Epe=new Fn(Ze.comparator);function _l(){return Epe}const NW=new Fn(Ze.comparator);function $m(...n){let e=NW;for(const t of n)e=e.insert(t.key,t);return e}function AW(n){let e=NW;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Zc(){return ig()}function RW(){return ig()}function ig(){return new Xh(n=>n.toString(),(n,e)=>n.isEqual(e))}const Tpe=new Fn(Ze.comparator),Npe=new wr(Ze.comparator);function Tt(...n){let e=Npe;for(const t of n)e=e.add(t);return e}const Ape=new wr(xt);function Rpe(){return Ape}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SN(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nw(e)?"-0":e}}function DW(n){return{integerValue:""+n}}function Dpe(n,e){return ipe(e)?DW(e):SN(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(){this._=void 0}}function $pe(n,e,t){return n instanceof aw?function(s,i){const o={fields:{[pW]:{stringValue:fW},[gW]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&wN(i)&&(i=W1(i)),i&&(o.fields[mW]=i),{mapValue:o}}(t,e):n instanceof Hg?PW(n,e):n instanceof Gg?OW(n,e):function(s,i){const o=$W(s,i),a=TL(o)+TL(s.Ie);return bS(o)&&bS(s.Ie)?DW(a):SN(s.serializer,a)}(n,e)}function Ppe(n,e,t){return n instanceof Hg?PW(n,e):n instanceof Gg?OW(n,e):t}function $W(n,e){return n instanceof lw?function(r){return bS(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class aw extends q1{}class Hg extends q1{constructor(e){super(),this.elements=e}}function PW(n,e){const t=FW(e);for(const r of n.elements)t.some(s=>Ta(s,r))||t.push(r);return{arrayValue:{values:t}}}class Gg extends q1{constructor(e){super(),this.elements=e}}function OW(n,e){let t=FW(e);for(const r of n.elements)t=t.filter(s=>!Ta(s,r));return{arrayValue:{values:t}}}class lw extends q1{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function TL(n){return Qn(n.integerValue||n.doubleValue)}function FW(n){return _N(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Ope(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Hg&&s instanceof Hg||r instanceof Gg&&s instanceof Gg?Lf(r.elements,s.elements,Ta):r instanceof lw&&s instanceof lw?Ta(r.Ie,s.Ie):r instanceof aw&&s instanceof aw}(n.transform,e.transform)}class Fpe{constructor(e,t){this.version=e,this.transformResults=t}}class dl{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new dl}static exists(e){return new dl(void 0,e)}static updateTime(e){return new dl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cb(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class K1{}function MW(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new BW(n.key,dl.none()):new Dv(n.key,n.data,dl.none());{const t=n.data,r=Wi.empty();let s=new wr(qr.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Yh(n.key,r,new So(s.toArray()),dl.none())}}function Mpe(n,e,t){n instanceof Dv?function(s,i,o){const a=s.value.clone(),l=AL(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Yh?function(s,i,o){if(!cb(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=AL(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(LW(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function og(n,e,t,r){return n instanceof Dv?function(i,o,a,l){if(!cb(i.precondition,o))return a;const u=i.value.clone(),c=RL(i.fieldTransforms,l,o);return u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Yh?function(i,o,a,l){if(!cb(i.precondition,o))return a;const u=RL(i.fieldTransforms,l,o),c=o.data;return c.setAll(LW(i)),c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(i,o,a){return cb(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Lpe(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=$W(r.transform,s||null);i!=null&&(t===null&&(t=Wi.empty()),t.set(r.field,i))}return t||null}function NL(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Lf(r,s,(i,o)=>Ope(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Dv extends K1{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Yh extends K1{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function LW(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function AL(n,e,t){const r=new Map;qt(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ppe(o,a,t[s]))}return r}function RL(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,$pe(i,o,e))}return r}class BW extends K1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Bpe extends K1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vpe{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Mpe(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=og(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=og(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=RW();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=MW(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(at.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Tt())}isEqual(e){return this.batchId===e.batchId&&Lf(this.mutations,e.mutations,(t,r)=>NL(t,r))&&Lf(this.baseMutations,e.baseMutations,(t,r)=>NL(t,r))}}class EN{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){qt(e.mutations.length===r.length);let s=function(){return Tpe}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new EN(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zpe{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Upe{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sr,Dt;function jpe(n){switch(n){case ve.OK:return st();case ve.CANCELLED:case ve.UNKNOWN:case ve.DEADLINE_EXCEEDED:case ve.RESOURCE_EXHAUSTED:case ve.INTERNAL:case ve.UNAVAILABLE:case ve.UNAUTHENTICATED:return!1;case ve.INVALID_ARGUMENT:case ve.NOT_FOUND:case ve.ALREADY_EXISTS:case ve.PERMISSION_DENIED:case ve.FAILED_PRECONDITION:case ve.ABORTED:case ve.OUT_OF_RANGE:case ve.UNIMPLEMENTED:case ve.DATA_LOSS:return!0;default:return st()}}function VW(n){if(n===void 0)return wl("GRPC error has no .code"),ve.UNKNOWN;switch(n){case sr.OK:return ve.OK;case sr.CANCELLED:return ve.CANCELLED;case sr.UNKNOWN:return ve.UNKNOWN;case sr.DEADLINE_EXCEEDED:return ve.DEADLINE_EXCEEDED;case sr.RESOURCE_EXHAUSTED:return ve.RESOURCE_EXHAUSTED;case sr.INTERNAL:return ve.INTERNAL;case sr.UNAVAILABLE:return ve.UNAVAILABLE;case sr.UNAUTHENTICATED:return ve.UNAUTHENTICATED;case sr.INVALID_ARGUMENT:return ve.INVALID_ARGUMENT;case sr.NOT_FOUND:return ve.NOT_FOUND;case sr.ALREADY_EXISTS:return ve.ALREADY_EXISTS;case sr.PERMISSION_DENIED:return ve.PERMISSION_DENIED;case sr.FAILED_PRECONDITION:return ve.FAILED_PRECONDITION;case sr.ABORTED:return ve.ABORTED;case sr.OUT_OF_RANGE:return ve.OUT_OF_RANGE;case sr.UNIMPLEMENTED:return ve.UNIMPLEMENTED;case sr.DATA_LOSS:return ve.DATA_LOSS;default:return st()}}(Dt=sr||(sr={}))[Dt.OK=0]="OK",Dt[Dt.CANCELLED=1]="CANCELLED",Dt[Dt.UNKNOWN=2]="UNKNOWN",Dt[Dt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Dt[Dt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Dt[Dt.NOT_FOUND=5]="NOT_FOUND",Dt[Dt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Dt[Dt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Dt[Dt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Dt[Dt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Dt[Dt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Dt[Dt.ABORTED=10]="ABORTED",Dt[Dt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Dt[Dt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Dt[Dt.INTERNAL=13]="INTERNAL",Dt[Dt.UNAVAILABLE=14]="UNAVAILABLE",Dt[Dt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wpe=new Ou([4294967295,4294967295],0);function DL(n){const e=lW().encode(n),t=new tW;return t.update(e),new Uint8Array(t.digest())}function $L(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ou([t,r],0),new Ou([s,i],0)]}class TN{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Pm(`Invalid padding: ${t}`);if(r<0)throw new Pm(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Pm(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Pm(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=Ou.fromNumber(this.Ee)}Ae(e,t,r){let s=e.add(t.multiply(Ou.fromNumber(r)));return s.compare(Wpe)===1&&(s=new Ou([s.getBits(0),s.getBits(1)],0)),s.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=DL(e),[r,s]=$L(t);for(let i=0;i<this.hashCount;i++){const o=this.Ae(r,s,i);if(!this.Re(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new TN(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ee===0)return;const t=DL(e),[r,s]=$L(t);for(let i=0;i<this.hashCount;i++){const o=this.Ae(r,s,i);this.Ve(o)}}Ve(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Pm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,$v.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new X1(at.min(),s,new Fn(xt),_l(),Tt())}}class $v{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new $v(r,t,Tt(),Tt(),Tt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e,t,r,s){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=s}}class zW{constructor(e,t){this.targetId=e,this.ge=t}}class UW{constructor(e,t,r=Yr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class PL{constructor(){this.pe=0,this.ye=OL(),this.we=Yr.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Tt(),t=Tt(),r=Tt();return this.ye.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:st()}}),new $v(this.we,this.Se,e,t,r)}Me(){this.be=!1,this.ye=OL()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,qt(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class Hpe{constructor(e){this.ke=e,this.qe=new Map,this.Qe=_l(),this.$e=c0(),this.Ue=c0(),this.Ke=new Fn(xt)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(t);break;case 3:this.Je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Ce(e.resumeToken));break;default:st()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((r,s)=>{this.Je(s)&&t(s)})}Ze(e){const t=e.targetId,r=e.ge.count,s=this.Xe(t);if(s){const i=s.target;if(_S(i))if(r===0){const o=new Ze(i.path);this.ze(t,o,ms.newNoDocument(o,at.min()))}else qt(r===1);else{const o=this.et(t);if(o!==r){const a=this.tt(e),l=a?this.nt(a,e,o):1;if(l!==0){this.Ye(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Yu(r).toUint8Array()}catch(l){if(l instanceof dW)return Mf("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new TN(o,s,i)}catch(l){return Mf(l instanceof Pm?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ee===0?null:a}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(e,t){const r=this.ke.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.ke.it(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.ze(t,i,null),s++)}),s}ot(e){const t=new Map;this.qe.forEach((i,o)=>{const a=this.Xe(o);if(a){if(i.current&&_S(a.target)){const l=new Ze(a.target.path);this._t(l).has(o)||this.ut(o,l)||this.ze(o,l,ms.newNoDocument(l,e))}i.ve&&(t.set(o,i.Fe()),i.Me())}});let r=Tt();this.Ue.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Xe(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.Qe.forEach((i,o)=>o.setReadTime(e));const s=new X1(e,t,this.Ke,this.Qe,r);return this.Qe=_l(),this.$e=c0(),this.Ue=c0(),this.Ke=new Fn(xt),s}Ge(e,t){if(!this.Je(e))return;const r=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const s=this.He(e);this.ut(e,t)?s.xe(t,1):s.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),r&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new PL,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new wr(xt),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new wr(xt),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||Pe("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new PL),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function c0(){return new Fn(Ze.comparator)}function OL(){return new Fn(Ze.comparator)}const Gpe={asc:"ASCENDING",desc:"DESCENDING"},qpe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kpe={and:"AND",or:"OR"};class Xpe{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function CS(n,e){return n.useProto3Json||j1(e)?e:{value:e}}function uw(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jW(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Ype(n,e){return uw(n,e.toTimestamp())}function ga(n){return qt(!!n),at.fromTimestamp(function(t){const r=Xu(t);return new tr(r.seconds,r.nanos)}(n))}function NN(n,e){return IS(n,e).canonicalString()}function IS(n,e){const t=function(s){return new xn(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function WW(n){const e=xn.fromString(n);return qt(XW(e)),e}function SS(n,e){return NN(n.databaseId,e.path)}function i2(n,e){const t=WW(e);if(t.get(1)!==n.databaseId.projectId)throw new Me(ve.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Me(ve.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ze(GW(t))}function HW(n,e){return NN(n.databaseId,e)}function Qpe(n){const e=WW(n);return e.length===4?xn.emptyPath():GW(e)}function ES(n){return new xn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function GW(n){return qt(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function FL(n,e,t){return{name:SS(n,e),fields:t.value.mapValue.fields}}function Jpe(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:st()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,c){return u.useProto3Json?(qt(c===void 0||typeof c=="string"),Yr.fromBase64String(c||"")):(qt(c===void 0||c instanceof Buffer||c instanceof Uint8Array),Yr.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=u.code===void 0?ve.UNKNOWN:VW(u.code);return new Me(c,u.message||"")}(o);t=new UW(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=i2(n,r.document.name),i=ga(r.document.updateTime),o=r.document.createTime?ga(r.document.createTime):at.min(),a=new Wi({mapValue:{fields:r.document.fields}}),l=ms.newFoundDocument(s,i,o,a),u=r.targetIds||[],c=r.removedTargetIds||[];t=new hb(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=i2(n,r.document),i=r.readTime?ga(r.readTime):at.min(),o=ms.newNoDocument(s,i),a=r.removedTargetIds||[];t=new hb([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=i2(n,r.document),i=r.removedTargetIds||[];t=new hb([],i,s,null)}else{if(!("filter"in e))return st();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new Upe(s,i),a=r.targetId;t=new zW(a,o)}}return t}function Zpe(n,e){let t;if(e instanceof Dv)t={update:FL(n,e.key,e.value)};else if(e instanceof BW)t={delete:SS(n,e.key)};else if(e instanceof Yh)t={update:FL(n,e.key,e.data),updateMask:lme(e.fieldMask)};else{if(!(e instanceof Bpe))return st();t={verify:SS(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof aw)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Hg)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Gg)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof lw)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw st()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Ype(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:st()}(n,e.precondition)),t}function eme(n,e){return n&&n.length>0?(qt(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?ga(s.updateTime):ga(i);return o.isEqual(at.min())&&(o=ga(i)),new Fpe(o,s.transformResults||[])}(t,e))):[]}function tme(n,e){return{documents:[HW(n,e.path)]}}function nme(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=HW(n,s);const i=function(u){if(u.length!==0)return KW(Mo.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(c=>function(d){return{field:Dd(d.field),direction:ime(d.dir)}}(c))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=CS(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ht:t,parent:s}}function rme(n){let e=Qpe(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){qt(r===1);const c=t.from[0];c.allDescendants?s=c.collectionId:e=e.child(c.collectionId)}let i=[];t.where&&(i=function(h){const d=qW(h);return d instanceof Mo&&_W(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(p){return new Wg($d(p.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,j1(d)?null:d}(t.limit));let l=null;t.startAt&&(l=function(h){const d=!!h.before,f=h.values||[];return new iw(f,d)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const d=!h.before,f=h.values||[];return new iw(f,d)}(t.endAt)),kpe(e,s,o,i,a,"F",l,u)}function sme(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return st()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function qW(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=$d(t.unaryFilter.field);return ar.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=$d(t.unaryFilter.field);return ar.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=$d(t.unaryFilter.field);return ar.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=$d(t.unaryFilter.field);return ar.create(o,"!=",{nullValue:"NULL_VALUE"});default:return st()}}(n):n.fieldFilter!==void 0?function(t){return ar.create($d(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return st()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Mo.create(t.compositeFilter.filters.map(r=>qW(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return st()}}(t.compositeFilter.op))}(n):st()}function ime(n){return Gpe[n]}function ome(n){return qpe[n]}function ame(n){return Kpe[n]}function Dd(n){return{fieldPath:n.canonicalString()}}function $d(n){return qr.fromServerFormat(n.fieldPath)}function KW(n){return n instanceof ar?function(t){if(t.op==="=="){if(kL(t.value))return{unaryFilter:{field:Dd(t.field),op:"IS_NAN"}};if(_L(t.value))return{unaryFilter:{field:Dd(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kL(t.value))return{unaryFilter:{field:Dd(t.field),op:"IS_NOT_NAN"}};if(_L(t.value))return{unaryFilter:{field:Dd(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dd(t.field),op:ome(t.op),value:t.value}}}(n):n instanceof Mo?function(t){const r=t.getFilters().map(s=>KW(s));return r.length===1?r[0]:{compositeFilter:{op:ame(t.op),filters:r}}}(n):st()}function lme(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function XW(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e,t,r,s,i=at.min(),o=at.min(),a=Yr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new gu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ume{constructor(e){this.Tt=e}}function cme(n){const e=rme({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ow(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hme{constructor(){this.Tn=new dme}addToCollectionParentIndex(e,t){return this.Tn.add(t),ge.resolve()}getCollectionParents(e,t){return ge.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return ge.resolve()}deleteFieldIndex(e,t){return ge.resolve()}deleteAllFieldIndexes(e){return ge.resolve()}createTargetIndexes(e,t){return ge.resolve()}getDocumentsMatchingTarget(e,t){return ge.resolve(null)}getIndexType(e,t){return ge.resolve(0)}getFieldIndexes(e,t){return ge.resolve([])}getNextCollectionGroupToUpdate(e){return ge.resolve(null)}getMinOffset(e,t){return ge.resolve(Ku.min())}getMinOffsetFromCollectionGroup(e,t){return ge.resolve(Ku.min())}updateCollectionGroup(e,t,r){return ge.resolve()}updateIndexEntries(e,t){return ge.resolve()}}class dme{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new wr(xn.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new wr(xn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ML={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},YW=41943040;class Ws{static withCacheSize(e){return new Ws(e,Ws.DEFAULT_COLLECTION_PERCENTILE,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ws.DEFAULT_COLLECTION_PERCENTILE=10,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ws.DEFAULT=new Ws(YW,Ws.DEFAULT_COLLECTION_PERCENTILE,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ws.DISABLED=new Ws(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new zf(0)}static Kn(){return new zf(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL="LruGarbageCollector",fme=1048576;function BL([n,e],[t,r]){const s=xt(n,t);return s===0?xt(e,r):s}class pme{constructor(e){this.Hn=e,this.buffer=new wr(BL),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();BL(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class mme{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Pe(LL,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){yp(t)?Pe(LL,"Ignoring IndexedDB error during garbage collection: ",t):await vp(t)}await this.er(3e5)})}}class gme{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return ge.resolve(U1.ae);const r=new pme(t);return this.tr.forEachTarget(e,s=>r.Zn(s.sequenceNumber)).next(()=>this.tr.rr(e,s=>r.Zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Pe("LruGarbageCollector","Garbage collection skipped; disabled"),ge.resolve(ML)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ML):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let r,s,i,o,a,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(u=Date.now(),Ad()<=Et.DEBUG&&Pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-c}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),ge.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function vme(n,e){return new gme(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yme{constructor(){this.changes=new Xh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ms.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?ge.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xme{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bme{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&og(r.mutation,s,So.empty(),tr.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Tt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Tt()){const s=Zc();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=$m();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Zc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Tt()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=_l();const o=ig(),a=function(){return ig()}();return t.forEach((l,u)=>{const c=r.get(u.key);s.has(u.key)&&(c===void 0||c.mutation instanceof Yh)?i=i.insert(u.key,u):c!==void 0?(o.set(u.key,c.mutation.getFieldMask()),og(c.mutation,u,c.mutation.getFieldMask(),tr.now())):o.set(u.key,So.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,c)=>o.set(u,c)),t.forEach((u,c)=>{var h;return a.set(u,new xme(c,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ig();let s=new Fn((o,a)=>o-a),i=Tt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let c=r.get(l)||So.empty();c=a.applyToLocalView(u,c),r.set(l,c);const h=(s.get(a.batchId)||Tt()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,c=l.value,h=RW();c.forEach(d=>{if(!i.has(d)){const f=MW(t.get(d),r.get(d));f!==null&&h.set(d,f),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return ge.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ze.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):SW(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):ge.resolve(Zc());let a=Vg,l=i;return o.next(u=>ge.forEach(u,(c,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(c)?ge.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{l=l.insert(c,d)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,Tt())).next(c=>({batchId:a,changes:AW(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ze(t)).next(r=>{let s=$m();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=$m();return this.indexManager.getCollectionParents(e,i).next(a=>ge.forEach(a,l=>{const u=function(h,d){return new xp(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(c=>{c.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const c=u.getKey();o.get(c)===null&&(o=o.insert(c,ms.newInvalidDocument(c)))});let a=$m();return o.forEach((l,u)=>{const c=i.get(l);c!==void 0&&og(c.mutation,u,So.empty(),tr.now()),G1(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wme{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return ge.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:ga(s.createTime)}}(t)),ge.resolve()}getNamedQuery(e,t){return ge.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(s){return{name:s.name,query:cme(s.bundledQuery),readTime:ga(s.readTime)}}(t)),ge.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _me{constructor(){this.overlays=new Fn(Ze.comparator),this.Rr=new Map}getOverlay(e,t){return ge.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Zc();return ge.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.Et(e,t,i)}),ge.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Rr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Rr.delete(r)),ge.resolve()}getOverlaysForCollection(e,t,r){const s=Zc(),i=t.length+1,o=new Ze(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return ge.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Fn((u,c)=>u-c);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let c=i.get(u.largestBatchId);c===null&&(c=Zc(),i=i.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const a=Zc(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>a.set(u,c)),!(a.size()>=s)););return ge.resolve(a)}Et(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Rr.get(s.largestBatchId).delete(r.key);this.Rr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new zpe(t,r));let i=this.Rr.get(t);i===void 0&&(i=Tt(),this.Rr.set(t,i)),this.Rr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kme{constructor(){this.sessionToken=Yr.EMPTY_BYTE_STRING}getSessionToken(e){return ge.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ge.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AN{constructor(){this.Vr=new wr(Nr.mr),this.gr=new wr(Nr.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const r=new Nr(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.wr(new Nr(e,t))}Sr(e,t){e.forEach(r=>this.removeReference(r,t))}br(e){const t=new Ze(new xn([])),r=new Nr(t,e),s=new Nr(t,e+1),i=[];return this.gr.forEachInRange([r,s],o=>{this.wr(o),i.push(o.key)}),i}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new Ze(new xn([])),r=new Nr(t,e),s=new Nr(t,e+1);let i=Tt();return this.gr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Nr(e,0),r=this.Vr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Nr{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return Ze.comparator(e.key,t.key)||xt(e.Cr,t.Cr)}static pr(e,t){return xt(e.Cr,t.Cr)||Ze.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cme{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new wr(Nr.mr)}checkEmpty(e){return ge.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Vpe(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Mr=this.Mr.add(new Nr(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ge.resolve(o)}lookupMutationBatch(e,t){return ge.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Nr(r),i=s<0?0:s;return ge.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ge.resolve(this.mutationQueue.length===0?bN:this.Fr-1)}getAllMutationBatches(e){return ge.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Nr(t,0),s=new Nr(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([r,s],o=>{const a=this.Or(o.Cr);i.push(a)}),ge.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wr(xt);return t.forEach(s=>{const i=new Nr(s,0),o=new Nr(s,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([i,o],a=>{r=r.add(a.Cr)})}),ge.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ze.isDocumentKey(i)||(i=i.child(""));const o=new Nr(new Ze(i),0);let a=new wr(xt);return this.Mr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Cr)),!0)},o),ge.resolve(this.Br(a))}Br(e){const t=[];return e.forEach(r=>{const s=this.Or(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){qt(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return ge.forEach(t.mutations,s=>{const i=new Nr(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,t){const r=new Nr(t,0),s=this.Mr.firstAfterOrEqual(r);return ge.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ge.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ime{constructor(e){this.kr=e,this.docs=function(){return new Fn(Ze.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return ge.resolve(r?r.document.mutableCopy():ms.newInvalidDocument(t))}getEntries(e,t){let r=_l();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ms.newInvalidDocument(s))}),ge.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=_l();const o=t.path,a=new Ze(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||tpe(epe(c),r)<=0||(s.has(c.key)||G1(t,c))&&(i=i.insert(c.key,c.mutableCopy()))}return ge.resolve(i)}getAllFromCollectionGroup(e,t,r,s){st()}qr(e,t){return ge.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Sme(this)}getSize(e){return ge.resolve(this.size)}}class Sme extends yme{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Ir.addEntry(e,s)):this.Ir.removeEntry(r)}),ge.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eme{constructor(e){this.persistence=e,this.Qr=new Xh(t=>kN(t),CN),this.lastRemoteSnapshotVersion=at.min(),this.highestTargetId=0,this.$r=0,this.Ur=new AN,this.targetCount=0,this.Kr=zf.Un()}forEachTarget(e,t){return this.Qr.forEach((r,s)=>t(s)),ge.resolve()}getLastRemoteSnapshotVersion(e){return ge.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ge.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),ge.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),ge.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new zf(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,ge.resolve()}updateTargetData(e,t){return this.zn(t),ge.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,ge.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Qr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),ge.waitFor(i).next(()=>s)}getTargetCount(e){return ge.resolve(this.targetCount)}getTargetData(e,t){const r=this.Qr.get(t)||null;return ge.resolve(r)}addMatchingKeys(e,t,r){return this.Ur.yr(t,r),ge.resolve()}removeMatchingKeys(e,t,r){this.Ur.Sr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),ge.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),ge.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ur.vr(t);return ge.resolve(r)}containsKey(e,t){return ge.resolve(this.Ur.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QW{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new U1(0),this.zr=!1,this.zr=!0,this.jr=new kme,this.referenceDelegate=e(this),this.Hr=new Eme(this),this.indexManager=new hme,this.remoteDocumentCache=function(s){return new Ime(s)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new ume(t),this.Yr=new wme(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _me,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new Cme(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){Pe("MemoryPersistence","Starting transaction:",e);const s=new Tme(this.Gr.next());return this.referenceDelegate.Zr(),r(s).next(i=>this.referenceDelegate.Xr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}ei(e,t){return ge.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,t)))}}class Tme extends rpe{constructor(e){super(),this.currentSequenceNumber=e}}class RN{constructor(e){this.persistence=e,this.ti=new AN,this.ni=null}static ri(e){return new RN(e)}get ii(){if(this.ni)return this.ni;throw st()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),ge.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),ge.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),ge.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(s=>this.ii.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.ii.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ge.forEach(this.ii,r=>{const s=Ze.fromPath(r);return this.si(e,s).next(i=>{i||t.removeEntry(s,at.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(r=>{r?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return ge.or([()=>ge.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class cw{constructor(e,t){this.persistence=e,this.oi=new Xh(r=>ope(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=vme(this,t)}static ri(e,t){return new cw(e,t)}Zr(){}Xr(e){return ge.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}sr(e){let t=0;return this.rr(e,r=>{t++}).next(()=>t)}rr(e,t){return ge.forEach(this.oi,(r,s)=>this.ar(e,r,s).next(i=>i?ge.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.qr(e,o=>this.ar(e,o,t).next(a=>{a||(r++,i.removeEntry(o,at.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),ge.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),ge.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),ge.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),ge.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=lb(e.data.value)),t}ar(e,t,r){return ge.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.oi.get(t);return ge.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DN{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=s}static Yi(e,t){let r=Tt(),s=Tt();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new DN(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nme{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ame{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Sde()?8:spe(Is())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.rs(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ss(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Nme;return this._s(e,t,o).next(a=>{if(i.result=a,this.Xi)return this.us(e,t,o,a.size)})}).next(()=>i.result)}us(e,t,r,s){return r.documentReadCount<this.es?(Ad()<=Et.DEBUG&&Pe("QueryEngine","SDK will not create cache indexes for query:",Rd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),ge.resolve()):(Ad()<=Et.DEBUG&&Pe("QueryEngine","Query:",Rd(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ts*s?(Ad()<=Et.DEBUG&&Pe("QueryEngine","The SDK decides to create cache indexes for query:",Rd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ma(t))):ge.resolve())}rs(e,t){if(EL(t))return ge.resolve(null);let r=ma(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ow(t,null,"F"),r=ma(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Tt(...i);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.cs(t,a);return this.ls(t,u,o,l.readTime)?this.rs(e,ow(t,null,"F")):this.hs(e,u,t,l)}))})))}ss(e,t,r,s){return EL(t)||s.isEqual(at.min())?ge.resolve(null):this.ns.getDocuments(e,r).next(i=>{const o=this.cs(t,i);return this.ls(t,o,r,s)?ge.resolve(null):(Ad()<=Et.DEBUG&&Pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Rd(t)),this.hs(e,o,t,Zfe(s,Vg)).next(a=>a))})}cs(e,t){let r=new wr(TW(e));return t.forEach((s,i)=>{G1(e,i)&&(r=r.add(i))}),r}ls(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}_s(e,t,r){return Ad()<=Et.DEBUG&&Pe("QueryEngine","Using full collection scan to execute query:",Rd(t)),this.ns.getDocumentsMatchingQuery(e,t,Ku.min(),r)}hs(e,t,r,s){return this.ns.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N="LocalStore",Rme=3e8;class Dme{constructor(e,t,r,s){this.persistence=e,this.Ps=t,this.serializer=s,this.Ts=new Fn(xt),this.Is=new Xh(i=>kN(i),CN),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bme(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function $me(n,e,t,r){return new Dme(n,e,t,r)}async function JW(n,e){const t=ht(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.As(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Tt();for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of i){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Rs:u,removedBatchIds:o,addedBatchIds:a}))})})}function Pme(n,e){const t=ht(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.ds.newChangeBuffer({trackRemovals:!0});return function(a,l,u,c){const h=u.batch,d=h.keys();let f=ge.resolve();return d.forEach(p=>{f=f.next(()=>c.getEntry(l,p)).next(m=>{const g=u.docVersions.get(p);qt(g!==null),m.version.compareTo(g)<0&&(h.applyToRemoteDocument(m,u),m.isValidDocument()&&(m.setReadTime(u.commitVersion),c.addEntry(m)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Tt();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function ZW(n){const e=ht(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function Ome(n,e){const t=ht(n),r=e.snapshotVersion;let s=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.ds.newChangeBuffer({trackRemovals:!0});s=t.Ts;const a=[];e.targetChanges.forEach((c,h)=>{const d=s.get(h);if(!d)return;a.push(t.Hr.removeMatchingKeys(i,c.removedDocuments,h).next(()=>t.Hr.addMatchingKeys(i,c.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Yr.EMPTY_BYTE_STRING,at.min()).withLastLimboFreeSnapshotVersion(at.min()):c.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(c.resumeToken,r)),s=s.insert(h,f),function(m,g,v){return m.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=Rme?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(d,f,c)&&a.push(t.Hr.updateTargetData(i,f))});let l=_l(),u=Tt();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push(Fme(i,o,e.documentUpdates).next(c=>{l=c.Vs,u=c.fs})),!r.isEqual(at.min())){const c=t.Hr.getLastRemoteSnapshotVersion(i).next(h=>t.Hr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(c)}return ge.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ts=s,i))}function Fme(n,e,t){let r=Tt(),s=Tt();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=_l();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(at.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Pe($N,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Vs:o,fs:s}})}function Mme(n,e){const t=ht(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=bN),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Lme(n,e){const t=ht(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Hr.getTargetData(r,e).next(i=>i?(s=i,ge.resolve(s)):t.Hr.allocateTargetId(r).next(o=>(s=new gu(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Hr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ts.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(r.targetId,r),t.Is.set(e,r.targetId)),r})}async function TS(n,e,t){const r=ht(n),s=r.Ts.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!yp(o))throw o;Pe($N,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ts=r.Ts.remove(e),r.Is.delete(s.target)}function VL(n,e,t){const r=ht(n);let s=at.min(),i=Tt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,c){const h=ht(l),d=h.Is.get(c);return d!==void 0?ge.resolve(h.Ts.get(d)):h.Hr.getTargetData(u,c)}(r,o,ma(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Ps.getDocumentsMatchingQuery(o,e,t?s:at.min(),t?i:Tt())).next(a=>(Bme(r,Ipe(e),a),{documents:a,gs:i})))}function Bme(n,e,t){let r=n.Es.get(e)||at.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Es.set(e,r)}class zL{constructor(){this.activeTargetIds=Rpe()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vme{constructor(){this.ho=new zL,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new zL,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zme{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL="ConnectivityMonitor";class jL{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Pe(UL,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Pe(UL,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h0=null;function NS(){return h0===null?h0=function(){return 268435456+Math.round(2147483648*Math.random())}():h0++,"0x"+h0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2="RestConnection",Ume={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jme{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/${s}`,this.wo=this.databaseId.database===rw?`project_id=${r}`:`project_id=${r}&database_id=${s}`}So(e,t,r,s,i){const o=NS(),a=this.bo(e,t.toUriEncodedString());Pe(o2,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(l,s,i),this.vo(e,a,l,r).then(u=>(Pe(o2,`Received RPC '${e}' ${o}: `,u),u),u=>{throw Mf(o2,`RPC '${e}' ${o} failed with error: `,u,"url: ",a,"request:",r),u})}Co(e,t,r,s,i,o){return this.So(e,t,r,s,i)}Do(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+gp}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}bo(e,t){const r=Ume[e];return`${this.po}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wme{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const as="WebChannelConnection";class Hme extends jme{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,s){const i=NS();return new Promise((o,a)=>{const l=new nW;l.setWithCredentials(!0),l.listenOnce(rW.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case ab.NO_ERROR:const c=l.getResponseJson();Pe(as,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(c)),o(c);break;case ab.TIMEOUT:Pe(as,`RPC '${e}' ${i} timed out`),a(new Me(ve.DEADLINE_EXCEEDED,"Request time out"));break;case ab.HTTP_ERROR:const h=l.getStatus();if(Pe(as,`RPC '${e}' ${i} failed with status:`,h,"response text:",l.getResponseText()),h>0){let d=l.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d==null?void 0:d.error;if(f&&f.status&&f.message){const p=function(g){const v=g.toLowerCase().replace(/_/g,"-");return Object.values(ve).indexOf(v)>=0?v:ve.UNKNOWN}(f.status);a(new Me(p,f.message))}else a(new Me(ve.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Me(ve.UNAVAILABLE,"Connection failed."));break;default:st()}}finally{Pe(as,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);Pe(as,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",u,r,15)})}Wo(e,t,r){const s=NS(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=oW(),a=iW(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const c=i.join("");Pe(as,`Creating RPC '${e}' stream ${s}: ${c}`,l);const h=o.createWebChannel(c,l);let d=!1,f=!1;const p=new Wme({Fo:g=>{f?Pe(as,`Not sending because RPC '${e}' stream ${s} is closed:`,g):(d||(Pe(as,`Opening RPC '${e}' stream ${s} transport.`),h.open(),d=!0),Pe(as,`RPC '${e}' stream ${s} sending:`,g),h.send(g))},Mo:()=>h.close()}),m=(g,v,y)=>{g.listen(v,x=>{try{y(x)}catch(b){setTimeout(()=>{throw b},0)}})};return m(h,Dm.EventType.OPEN,()=>{f||(Pe(as,`RPC '${e}' stream ${s} transport opened.`),p.Qo())}),m(h,Dm.EventType.CLOSE,()=>{f||(f=!0,Pe(as,`RPC '${e}' stream ${s} transport closed`),p.Uo())}),m(h,Dm.EventType.ERROR,g=>{f||(f=!0,Mf(as,`RPC '${e}' stream ${s} transport errored:`,g),p.Uo(new Me(ve.UNAVAILABLE,"The operation could not be completed")))}),m(h,Dm.EventType.MESSAGE,g=>{var v;if(!f){const y=g.data[0];qt(!!y);const x=y,b=(x==null?void 0:x.error)||((v=x[0])===null||v===void 0?void 0:v.error);if(b){Pe(as,`RPC '${e}' stream ${s} received error:`,b);const _=b.status;let E=function(S){const T=sr[S];if(T!==void 0)return VW(T)}(_),I=b.message;E===void 0&&(E=ve.INTERNAL,I="Unknown error status: "+_+" with message "+b.message),f=!0,p.Uo(new Me(E,I)),h.close()}else Pe(as,`RPC '${e}' stream ${s} received:`,y),p.Ko(y)}}),m(a,sW.STAT_EVENT,g=>{g.stat===vS.PROXY?Pe(as,`RPC '${e}' stream ${s} detected buffering proxy`):g.stat===vS.NOPROXY&&Pe(as,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.$o()},0),p}}function a2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y1(n){return new Xpe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=s,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),s=Math.max(0,t-r);s>0&&Pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,s,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WL="PersistentStream";class t6{constructor(e,t,r,s,i,o,a,l){this.Ti=e,this.n_=r,this.r_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new e6(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===ve.RESOURCE_EXHAUSTED?(wl(t.toString()),wl("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===ve.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.i_===t&&this.V_(r,s)},r=>{e(()=>{const s=new Me(ve.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(s)})})}V_(e,t){const r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(s=>{r(()=>this.m_(s))}),this.stream.onMessage(s=>{r(()=>++this.__==1?this.g_(s):this.onNext(s))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Pe(WL,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(Pe(WL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Gme extends t6{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=Jpe(this.serializer,e),r=function(i){if(!("targetChange"in i))return at.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?at.min():o.readTime?ga(o.readTime):at.min()}(e);return this.listener.p_(t,r)}y_(e){const t={};t.database=ES(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=_S(l)?{documents:tme(i,l)}:{query:nme(i,l).ht},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=jW(i,o.resumeToken);const u=CS(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(at.min())>0){a.readTime=uw(i,o.snapshotVersion.toTimestamp());const u=CS(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=sme(this.serializer,e);r&&(t.labels=r),this.I_(t)}w_(e){const t={};t.database=ES(this.serializer),t.removeTarget=e,this.I_(t)}}class qme extends t6{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return qt(!!e.streamToken),this.lastStreamToken=e.streamToken,qt(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){qt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=eme(e.writeResults,e.commitTime),r=ga(e.commitTime);return this.listener.v_(r,t)}C_(){const e={};e.database=ES(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Zpe(this.serializer,r))};this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kme{}class Xme extends Kme{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.F_=!1}M_(){if(this.F_)throw new Me(ve.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.So(e,IS(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ve.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Me(ve.UNKNOWN,i.toString())})}Co(e,t,r,s,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,IS(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ve.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Me(ve.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Yme{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(wl(t),this.N_=!1):Pe("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih="RemoteStore";class Qme{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(o=>{r.enqueueAndForget(async()=>{Qh(this)&&(Pe(Ih,"Restarting streams for network reachability change."),await async function(l){const u=ht(l);u.W_.add(4),await Pv(u),u.j_.set("Unknown"),u.W_.delete(4),await Q1(u)}(this))})}),this.j_=new Yme(r,s)}}async function Q1(n){if(Qh(n))for(const e of n.G_)await e(!0)}async function Pv(n){for(const e of n.G_)await e(!1)}function n6(n,e){const t=ht(n);t.K_.has(e.targetId)||(t.K_.set(e.targetId,e),MN(t)?FN(t):bp(t).c_()&&ON(t,e))}function PN(n,e){const t=ht(n),r=bp(t);t.K_.delete(e),r.c_()&&r6(t,e),t.K_.size===0&&(r.c_()?r.P_():Qh(t)&&t.j_.set("Unknown"))}function ON(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(at.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bp(n).y_(e)}function r6(n,e){n.H_.Ne(e),bp(n).w_(e)}function FN(n){n.H_=new Hpe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),bp(n).start(),n.j_.B_()}function MN(n){return Qh(n)&&!bp(n).u_()&&n.K_.size>0}function Qh(n){return ht(n).W_.size===0}function s6(n){n.H_=void 0}async function Jme(n){n.j_.set("Online")}async function Zme(n){n.K_.forEach((e,t)=>{ON(n,e)})}async function ege(n,e){s6(n),MN(n)?(n.j_.q_(e),FN(n)):n.j_.set("Unknown")}async function tge(n,e,t){if(n.j_.set("Online"),e instanceof UW&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.K_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.K_.delete(a),s.H_.removeTarget(a))}(n,e)}catch(r){Pe(Ih,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await hw(n,r)}else if(e instanceof hb?n.H_.We(e):e instanceof zW?n.H_.Ze(e):n.H_.je(e),!t.isEqual(at.min()))try{const r=await ZW(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.H_.ot(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=i.K_.get(u);c&&i.K_.set(u,c.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const c=i.K_.get(l);if(!c)return;i.K_.set(l,c.withResumeToken(Yr.EMPTY_BYTE_STRING,c.snapshotVersion)),r6(i,l);const h=new gu(c.target,l,u,c.sequenceNumber);ON(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Pe(Ih,"Failed to raise snapshot:",r),await hw(n,r)}}async function hw(n,e,t){if(!yp(e))throw e;n.W_.add(1),await Pv(n),n.j_.set("Offline"),t||(t=()=>ZW(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Pe(Ih,"Retrying IndexedDB access"),await t(),n.W_.delete(1),await Q1(n)})}function i6(n,e){return e().catch(t=>hw(n,t,e))}async function J1(n){const e=ht(n),t=Ju(e);let r=e.U_.length>0?e.U_[e.U_.length-1].batchId:bN;for(;nge(e);)try{const s=await Mme(e.localStore,r);if(s===null){e.U_.length===0&&t.P_();break}r=s.batchId,rge(e,s)}catch(s){await hw(e,s)}o6(e)&&a6(e)}function nge(n){return Qh(n)&&n.U_.length<10}function rge(n,e){n.U_.push(e);const t=Ju(n);t.c_()&&t.S_&&t.b_(e.mutations)}function o6(n){return Qh(n)&&!Ju(n).u_()&&n.U_.length>0}function a6(n){Ju(n).start()}async function sge(n){Ju(n).C_()}async function ige(n){const e=Ju(n);for(const t of n.U_)e.b_(t.mutations)}async function oge(n,e,t){const r=n.U_.shift(),s=EN.from(r,e,t);await i6(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await J1(n)}async function age(n,e){e&&Ju(n).S_&&await async function(r,s){if(function(o){return jpe(o)&&o!==ve.ABORTED}(s.code)){const i=r.U_.shift();Ju(r).h_(),await i6(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await J1(r)}}(n,e),o6(n)&&a6(n)}async function HL(n,e){const t=ht(n);t.asyncQueue.verifyOperationInProgress(),Pe(Ih,"RemoteStore received new credentials");const r=Qh(t);t.W_.add(3),await Pv(t),r&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await Q1(t)}async function lge(n,e){const t=ht(n);e?(t.W_.delete(2),await Q1(t)):e||(t.W_.add(2),await Pv(t),t.j_.set("Unknown"))}function bp(n){return n.J_||(n.J_=function(t,r,s){const i=ht(t);return i.M_(),new Gme(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{xo:Jme.bind(null,n),No:Zme.bind(null,n),Lo:ege.bind(null,n),p_:tge.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),MN(n)?FN(n):n.j_.set("Unknown")):(await n.J_.stop(),s6(n))})),n.J_}function Ju(n){return n.Y_||(n.Y_=function(t,r,s){const i=ht(t);return i.M_(),new qme(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:sge.bind(null,n),Lo:age.bind(null,n),D_:ige.bind(null,n),v_:oge.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await J1(n)):(await n.Y_.stop(),n.U_.length>0&&(Pe(Ih,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Fu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new LN(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Me(ve.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function BN(n,e){if(wl("AsyncQueue",`${e}: ${n}`),yp(n))return new Me(ve.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{static emptySet(e){return new uf(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ze.comparator(t.key,r.key):(t,r)=>Ze.comparator(t.key,r.key),this.keyedMap=$m(),this.sortedSet=new Fn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uf)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new uf;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL{constructor(){this.Z_=new Fn(Ze.comparator)}track(e){const t=e.doc.key,r=this.Z_.get(t);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(t):e.type===1&&r.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):st():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Uf{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Uf(e,t,uf.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&H1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uge{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class cge{constructor(){this.queries=qL(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,r){const s=ht(t),i=s.queries;s.queries=qL(),i.forEach((o,a)=>{for(const l of a.ta)l.onError(r)})})(this,new Me(ve.ABORTED,"Firestore shutting down"))}}function qL(){return new Xh(n=>EW(n),H1)}async function l6(n,e){const t=ht(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.na()&&e.ra()&&(r=2):(i=new uge,r=e.ra()?0:1);try{switch(r){case 0:i.ea=await t.onListen(s,!0);break;case 1:i.ea=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=BN(o,`Initialization of query '${Rd(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.ta.push(e),e.sa(t.onlineState),i.ea&&e.oa(i.ea)&&VN(t)}async function u6(n,e){const t=ht(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.ta.indexOf(e);o>=0&&(i.ta.splice(o,1),i.ta.length===0?s=e.ra()?0:1:!i.na()&&e.ra()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function hge(n,e){const t=ht(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.ta)a.oa(s)&&(r=!0);o.ea=s}}r&&VN(t)}function dge(n,e,t){const r=ht(n),s=r.queries.get(e);if(s)for(const i of s.ta)i.onError(t);r.queries.delete(e)}function VN(n){n.ia.forEach(e=>{e.next()})}var AS,KL;(KL=AS||(AS={}))._a="default",KL.Cache="cache";class c6{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Uf(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const r=t!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Uf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==AS.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6{constructor(e){this.key=e}}class d6{constructor(e){this.key=e}}class fge{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Tt(),this.mutatedKeys=Tt(),this.ya=TW(e),this.wa=new uf(this.ya)}get Sa(){return this.fa}ba(e,t){const r=t?t.Da:new GL,s=t?t.wa:this.wa;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((c,h)=>{const d=s.get(c),f=G1(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),m=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let g=!1;d&&f?d.data.isEqual(f.data)?p!==m&&(r.track({type:3,doc:f}),g=!0):this.va(d,f)||(r.track({type:2,doc:f}),g=!0,(l&&this.ya(f,l)>0||u&&this.ya(f,u)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),g=!0):d&&!f&&(r.track({type:1,doc:d}),g=!0,(l||u)&&(a=!0)),g&&(f?(o=o.add(f),i=m?i.add(c):i.delete(c)):(o=o.delete(c),i=i.delete(c)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const c=this.query.limitType==="F"?o.last():o.first();o=o.delete(c.key),i=i.delete(c.key),r.track({type:1,doc:c})}return{wa:o,Da:r,ls:a,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort((c,h)=>function(f,p){const m=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return st()}};return m(f)-m(p)}(c.type,h.type)||this.ya(c.doc,h.doc)),this.Ca(r),s=s!=null&&s;const a=t&&!s?this.Fa():[],l=this.pa.size===0&&this.current&&!s?1:0,u=l!==this.ga;return this.ga=l,o.length!==0||u?{snapshot:new Uf(this.query,e.wa,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new GL,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Tt(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const t=[];return e.forEach(r=>{this.pa.has(r)||t.push(new d6(r))}),this.pa.forEach(r=>{e.has(r)||t.push(new h6(r))}),t}Oa(e){this.fa=e.gs,this.pa=Tt();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Uf.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const zN="SyncEngine";class pge{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class mge{constructor(e){this.key=e,this.Ba=!1}}class gge{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new Xh(a=>EW(a),H1),this.qa=new Map,this.Qa=new Set,this.$a=new Fn(Ze.comparator),this.Ua=new Map,this.Ka=new AN,this.Wa={},this.Ga=new Map,this.za=zf.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function vge(n,e,t=!0){const r=y6(n);let s;const i=r.ka.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Na()):s=await f6(r,e,t,!0),s}async function yge(n,e){const t=y6(n);await f6(t,e,!0,!1)}async function f6(n,e,t,r){const s=await Lme(n.localStore,ma(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await xge(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&n6(n.remoteStore,s),a}async function xge(n,e,t,r,s){n.Ha=(h,d,f)=>async function(m,g,v,y){let x=g.view.ba(v);x.ls&&(x=await VL(m.localStore,g.query,!1).then(({documents:I})=>g.view.ba(I,x)));const b=y&&y.targetChanges.get(g.targetId),_=y&&y.targetMismatches.get(g.targetId)!=null,E=g.view.applyChanges(x,m.isPrimaryClient,b,_);return YL(m,g.targetId,E.Ma),E.snapshot}(n,h,d,f);const i=await VL(n.localStore,e,!0),o=new fge(e,i.gs),a=o.ba(i.documents),l=$v.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);YL(n,t,u.Ma);const c=new pge(e,t,o);return n.ka.set(e,c),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),u.snapshot}async function bge(n,e,t){const r=ht(n),s=r.ka.get(e),i=r.qa.get(s.targetId);if(i.length>1)return r.qa.set(s.targetId,i.filter(o=>!H1(o,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await TS(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&PN(r.remoteStore,s.targetId),RS(r,s.targetId)}).catch(vp)):(RS(r,s.targetId),await TS(r.localStore,s.targetId,!0))}async function wge(n,e){const t=ht(n),r=t.ka.get(e),s=t.qa.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),PN(t.remoteStore,r.targetId))}async function _ge(n,e,t){const r=Nge(n);try{const s=await function(o,a){const l=ht(o),u=tr.now(),c=a.reduce((f,p)=>f.add(p.key),Tt());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",f=>{let p=_l(),m=Tt();return l.ds.getEntries(f,c).next(g=>{p=g,p.forEach((v,y)=>{y.isValidDocument()||(m=m.add(v))})}).next(()=>l.localDocuments.getOverlayedDocuments(f,p)).next(g=>{h=g;const v=[];for(const y of a){const x=Lpe(y,h.get(y.key).overlayedDocument);x!=null&&v.push(new Yh(y.key,x,xW(x.value.mapValue),dl.exists(!0)))}return l.mutationQueue.addMutationBatch(f,u,v,a)}).next(g=>{d=g;const v=g.applyToLocalDocumentSet(h,m);return l.documentOverlayCache.saveOverlays(f,g.batchId,v)})}).then(()=>({batchId:d.batchId,changes:AW(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Wa[o.currentUser.toKey()];u||(u=new Fn(xt)),u=u.insert(a,l),o.Wa[o.currentUser.toKey()]=u}(r,s.batchId,t),await Ov(r,s.changes),await J1(r.remoteStore)}catch(s){const i=BN(s,"Failed to persist write");t.reject(i)}}async function p6(n,e){const t=ht(n);try{const r=await Ome(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Ua.get(i);o&&(qt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Ba=!0:s.modifiedDocuments.size>0?qt(o.Ba):s.removedDocuments.size>0&&(qt(o.Ba),o.Ba=!1))}),await Ov(t,r,e)}catch(r){await vp(r)}}function XL(n,e,t){const r=ht(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.ka.forEach((i,o)=>{const a=o.view.sa(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ht(o);l.onlineState=a;let u=!1;l.queries.forEach((c,h)=>{for(const d of h.ta)d.sa(a)&&(u=!0)}),u&&VN(l)}(r.eventManager,e),s.length&&r.La.p_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function kge(n,e,t){const r=ht(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Ua.get(e),i=s&&s.key;if(i){let o=new Fn(Ze.comparator);o=o.insert(i,ms.newNoDocument(i,at.min()));const a=Tt().add(i),l=new X1(at.min(),new Map,new Fn(xt),o,a);await p6(r,l),r.$a=r.$a.remove(i),r.Ua.delete(e),UN(r)}else await TS(r.localStore,e,!1).then(()=>RS(r,e,t)).catch(vp)}async function Cge(n,e){const t=ht(n),r=e.batch.batchId;try{const s=await Pme(t.localStore,e);g6(t,r,null),m6(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ov(t,s)}catch(s){await vp(s)}}async function Ige(n,e,t){const r=ht(n);try{const s=await function(o,a){const l=ht(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,a).next(h=>(qt(h!==null),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(r.localStore,e);g6(r,e,t),m6(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ov(r,s)}catch(s){await vp(s)}}function m6(n,e){(n.Ga.get(e)||[]).forEach(t=>{t.resolve()}),n.Ga.delete(e)}function g6(n,e,t){const r=ht(n);let s=r.Wa[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Wa[r.currentUser.toKey()]=s}}function RS(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.qa.get(e))n.ka.delete(r),t&&n.La.Ja(r,t);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(r=>{n.Ka.containsKey(r)||v6(n,r)})}function v6(n,e){n.Qa.delete(e.path.canonicalString());const t=n.$a.get(e);t!==null&&(PN(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ua.delete(t),UN(n))}function YL(n,e,t){for(const r of t)r instanceof h6?(n.Ka.addReference(r.key,e),Sge(n,r)):r instanceof d6?(Pe(zN,"Document no longer in limbo: "+r.key),n.Ka.removeReference(r.key,e),n.Ka.containsKey(r.key)||v6(n,r.key)):st()}function Sge(n,e){const t=e.key,r=t.path.canonicalString();n.$a.get(t)||n.Qa.has(r)||(Pe(zN,"New document in limbo: "+t),n.Qa.add(r),UN(n))}function UN(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const t=new Ze(xn.fromString(e)),r=n.za.next();n.Ua.set(r,new mge(t)),n.$a=n.$a.insert(t,r),n6(n.remoteStore,new gu(ma(IN(t.path)),r,"TargetPurposeLimboResolution",U1.ae))}}async function Ov(n,e,t){const r=ht(n),s=[],i=[],o=[];r.ka.isEmpty()||(r.ka.forEach((a,l)=>{o.push(r.Ha(l,e,t).then(u=>{var c;if((u||t)&&r.isPrimaryClient){const h=u?!u.fromCache:(c=t==null?void 0:t.targetChanges.get(l.targetId))===null||c===void 0?void 0:c.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){s.push(u);const h=DN.Yi(l.targetId,u);i.push(h)}}))}),await Promise.all(o),r.La.p_(s),await async function(l,u){const c=ht(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ge.forEach(u,d=>ge.forEach(d.Hi,f=>c.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>ge.forEach(d.Ji,f=>c.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!yp(h))throw h;Pe($N,"Failed to update sequence numbers: "+h)}for(const h of u){const d=h.targetId;if(!h.fromCache){const f=c.Ts.get(d),p=f.snapshotVersion,m=f.withLastLimboFreeSnapshotVersion(p);c.Ts=c.Ts.insert(d,m)}}}(r.localStore,i))}async function Ege(n,e){const t=ht(n);if(!t.currentUser.isEqual(e)){Pe(zN,"User change. New user:",e.toKey());const r=await JW(t.localStore,e);t.currentUser=e,function(i,o){i.Ga.forEach(a=>{a.forEach(l=>{l.reject(new Me(ve.CANCELLED,o))})}),i.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ov(t,r.Rs)}}function Tge(n,e){const t=ht(n),r=t.Ua.get(e);if(r&&r.Ba)return Tt().add(r.key);{let s=Tt();const i=t.qa.get(e);if(!i)return s;for(const o of i){const a=t.ka.get(o);s=s.unionWith(a.view.Sa)}return s}}function y6(n){const e=ht(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=p6.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Tge.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kge.bind(null,e),e.La.p_=hge.bind(null,e.eventManager),e.La.Ja=dge.bind(null,e.eventManager),e}function Nge(n){const e=ht(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Cge.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ige.bind(null,e),e}class dw{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Y1(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return $me(this.persistence,new Ame,e.initialUser,this.serializer)}Xa(e){return new QW(RN.ri,this.serializer)}Za(e){return new Vme}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}dw.provider={build:()=>new dw};class Age extends dw{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){qt(this.persistence.referenceDelegate instanceof cw);const r=this.persistence.referenceDelegate.garbageCollector;return new mme(r,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?Ws.withCacheSize(this.cacheSizeBytes):Ws.DEFAULT;return new QW(r=>cw.ri(r,t),this.serializer)}}class DS{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>XL(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ege.bind(null,this.syncEngine),await lge(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new cge}()}createDatastore(e){const t=Y1(e.databaseInfo.databaseId),r=function(i){return new Hme(i)}(e.databaseInfo);return function(i,o,a,l){return new Xme(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new Qme(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>XL(this.syncEngine,t,0),function(){return jL.D()?new jL:new zme}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,c){const h=new gge(s,i,o,a,l,u);return c&&(h.ja=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ht(s);Pe(Ih,"RemoteStore shutting down."),i.W_.add(5),await Pv(i),i.z_.shutdown(),i.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}DS.provider={build:()=>new DS};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x6{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):wl("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zu="FirestoreClient";class Rge{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=hs.UNAUTHENTICATED,this.clientId=uW.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Pe(Zu,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Pe(Zu,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Fu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=BN(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function l2(n,e){n.asyncQueue.verifyOperationInProgress(),Pe(Zu,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await JW(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function QL(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Dge(n);Pe(Zu,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>HL(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>HL(e.remoteStore,s)),n._onlineComponents=e}async function Dge(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Pe(Zu,"Using user provided OfflineComponentProvider");try{await l2(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===ve.FAILED_PRECONDITION||s.code===ve.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Mf("Error using user provided cache. Falling back to memory cache: "+t),await l2(n,new dw)}}else Pe(Zu,"Using default OfflineComponentProvider"),await l2(n,new Age(void 0));return n._offlineComponents}async function b6(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Pe(Zu,"Using user provided OnlineComponentProvider"),await QL(n,n._uninitializedComponentsProvider._online)):(Pe(Zu,"Using default OnlineComponentProvider"),await QL(n,new DS))),n._onlineComponents}function $ge(n){return b6(n).then(e=>e.syncEngine)}async function $S(n){const e=await b6(n),t=e.eventManager;return t.onListen=vge.bind(null,e.syncEngine),t.onUnlisten=bge.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yge.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wge.bind(null,e.syncEngine),t}function Pge(n,e,t={}){const r=new Fu;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const c=new x6({next:d=>{c.su(),o.enqueueAndForget(()=>u6(i,h)),d.fromCache&&l.source==="server"?u.reject(new Me(ve.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new c6(a,c,{includeMetadataChanges:!0,Ta:!0});return l6(i,h)}(await $S(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w6(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JL=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _6(n,e,t){if(!t)throw new Me(ve.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Oge(n,e,t,r){if(e===!0&&r===!0)throw new Me(ve.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ZL(n){if(!Ze.isDocumentKey(n))throw new Me(ve.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function e3(n){if(Ze.isDocumentKey(n))throw new Me(ve.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Z1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":st()}function uh(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Me(ve.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Z1(n);throw new Me(ve.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k6="firestore.googleapis.com",t3=!0;class n3{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Me(ve.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=k6,this.ssl=t3}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:t3;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=YW;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<fme)throw new Me(ve.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Oge("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=w6((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Me(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Me(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Me(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class e_{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new n3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Me(ve.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Me(ve.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new n3(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Wfe;switch(r.type){case"firstParty":return new Kfe(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Me(ve.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=JL.get(t);r&&(Pe("ComponentProvider","Removing Datastore"),JL.delete(t),r.terminate())}(this),Promise.resolve()}}function Fge(n,e,t,r={}){var s;const i=(n=uh(n,e_))._getSettings(),o=Object.assign(Object.assign({},i),{emulatorOptions:n._getEmulatorOptions()}),a=`${e}:${t}`;i.host!==k6&&i.host!==a&&Mf("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},i),{host:a,ssl:!1,emulatorOptions:r});if(!_h(l,o)&&(n._setSettings(l),r.mockUserToken)){let u,c;if(typeof r.mockUserToken=="string")u=r.mockUserToken,c=hs.MOCK_USER;else{u=xde(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new Me(ve.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new hs(h)}n._authCredentials=new Hfe(new aW(u,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ol(this.firestore,e,this._query)}}class _i{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _i(this.firestore,e,this._key)}}class Mu extends Ol{constructor(e,t,r){super(e,t,IN(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _i(this.firestore,null,new Ze(e))}withConverter(e){return new Mu(this.firestore,e,this._path)}}function Sh(n,e,...t){if(n=Si(n),_6("collection","path",e),n instanceof e_){const r=xn.fromString(e,...t);return e3(r),new Mu(n,null,r)}{if(!(n instanceof _i||n instanceof Mu))throw new Me(ve.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(xn.fromString(e,...t));return e3(r),new Mu(n.firestore,null,r)}}function Mge(n,e,...t){if(n=Si(n),arguments.length===1&&(e=uW.newId()),_6("doc","path",e),n instanceof e_){const r=xn.fromString(e,...t);return ZL(r),new _i(n,null,new Ze(r))}{if(!(n instanceof _i||n instanceof Mu))throw new Me(ve.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(xn.fromString(e,...t));return ZL(r),new _i(n.firestore,n instanceof Mu?n.converter:null,new Ze(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r3="AsyncQueue";class s3{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new e6(this,"async_queue_retry"),this.Su=()=>{const r=a2();r&&Pe(r3,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=e;const t=a2();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=a2();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new Fu;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!yp(e))throw e;Pe(r3,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.bu.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw wl("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.pu=!1,r))));return this.bu=t,t}enqueueAfterDelay(e,t,r){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const s=LN.createAndSchedule(this,e,t,r,i=>this.Fu(i));return this.fu.push(s),s}Du(){this.gu&&st()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function i3(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class qg extends e_{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new s3,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new s3(e),this._firestoreClient=void 0,await e}}}function t_(n,e){const t=typeof n=="object"?n:yN(),r=typeof n=="string"?n:rw,s=vN(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=vde("firestore");i&&Fge(s,...i)}return s}function jN(n){if(n._terminated)throw new Me(ve.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Lge(n),n._firestoreClient}function Lge(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,u,c){return new upe(a,l,u,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,w6(c.experimentalLongPollingOptions),c.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new Rge(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jf(Yr.fromBase64String(e))}catch(t){throw new Me(ve.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new jf(Yr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Me(ve.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C6{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Me(ve.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Me(ve.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return xt(this._lat,e._lat)||xt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bge=/^__.*__$/;class Vge{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Yh(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dv(e,this.data,t,this.fieldTransforms)}}function I6(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw st()}}class qN{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new qN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ku({path:r,Qu:!1});return s.$u(e),s}Uu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ku({path:r,Qu:!1});return s.Bu(),s}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return fw(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(I6(this.Lu)&&Bge.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class zge{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Y1(e)}ju(e,t,r,s=!1){return new qN({Lu:e,methodName:t,zu:r,path:qr.emptyPath(),Qu:!1,Gu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function S6(n){const e=n._freezeSettings(),t=Y1(n._databaseId);return new zge(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Uge(n,e,t,r,s,i={}){const o=n.ju(i.merge||i.mergeFields?2:0,e,t,s);N6("Data must be an object, but it was:",o,r);const a=E6(r,o);let l,u;if(i.merge)l=new So(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const c=[];for(const h of i.mergeFields){const d=Wge(e,h,t);if(!o.contains(d))throw new Me(ve.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Gge(c,d)||c.push(d)}l=new So(c),u=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=o.fieldTransforms;return new Vge(new Wi(a),l,u)}function jge(n,e,t,r=!1){return KN(t,n.ju(r?4:3,e))}function KN(n,e){if(T6(n=Si(n)))return N6("Unsupported field value:",e,n),E6(n,e);if(n instanceof C6)return function(r,s){if(!I6(s.Lu))throw s.Wu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Wu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=KN(a,s.Ku(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Si(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Dpe(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=tr.fromDate(r);return{timestampValue:uw(s.serializer,i)}}if(r instanceof tr){const i=new tr(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:uw(s.serializer,i)}}if(r instanceof HN)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jf)return{bytesValue:jW(s.serializer,r._byteString)};if(r instanceof _i){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Wu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:NN(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof GN)return function(o,a){return{mapValue:{fields:{[vW]:{stringValue:yW},[sw]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Wu("VectorValues must only contain numeric values.");return SN(a.serializer,u)})}}}}}}(r,s);throw s.Wu(`Unsupported field value: ${Z1(r)}`)}(n,e)}function E6(n,e){const t={};return hW(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Kh(n,(r,s)=>{const i=KN(s,e.qu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function T6(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof tr||n instanceof HN||n instanceof jf||n instanceof _i||n instanceof C6||n instanceof GN)}function N6(n,e,t){if(!T6(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Z1(t);throw r==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+r)}}function Wge(n,e,t){if((e=Si(e))instanceof WN)return e._internalPath;if(typeof e=="string")return A6(n,e);throw fw("Field path arguments must be of type string or ",n,!1,void 0,t)}const Hge=new RegExp("[~\\*/\\[\\]]");function A6(n,e,t){if(e.search(Hge)>=0)throw fw(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new WN(...e.split("."))._internalPath}catch{throw fw(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fw(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Me(ve.INVALID_ARGUMENT,a+n+l)}function Gge(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R6{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new _i(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new qge(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(XN("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class qge extends R6{data(){return super.data()}}function XN(n,e){return typeof e=="string"?A6(n,e):e instanceof WN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Me(ve.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class YN{}class QN extends YN{}function JN(n,e,...t){let r=[];e instanceof YN&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof eA).length,a=i.filter(l=>l instanceof ZN).length;if(o>1||o>0&&a>0)throw new Me(ve.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class ZN extends QN{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ZN(e,t,r)}_apply(e){const t=this._parse(e);return $6(e._query,t),new Ol(e.firestore,e.converter,kS(e._query,t))}_parse(e){const t=S6(e.firestore);return function(i,o,a,l,u,c,h){let d;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new Me(ve.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){a3(h,c);const p=[];for(const m of h)p.push(o3(l,i,m));d={arrayValue:{values:p}}}else d=o3(l,i,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||a3(h,c),d=jge(a,o,h,c==="in"||c==="not-in");return ar.create(u,c,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class eA extends YN{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new eA(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Mo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)$6(o,l),o=kS(o,l)}(e._query,t),new Ol(e.firestore,e.converter,kS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class tA extends QN{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new tA(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Me(ve.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Me(ve.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Wg(i,o)}(e._query,this._field,this._direction);return new Ol(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new xp(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function nA(n,e="asc"){const t=e,r=XN("orderBy",n);return tA._create(r,t)}class rA extends QN{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new rA(e,t,r)}_apply(e){return new Ol(e.firestore,e.converter,ow(e._query,this._limit,this._limitType))}}function Kge(n){return rA._create("limit",n,"F")}function o3(n,e,t){if(typeof(t=Si(t))=="string"){if(t==="")throw new Me(ve.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!SW(e)&&t.indexOf("/")!==-1)throw new Me(ve.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(xn.fromString(t));if(!Ze.isDocumentKey(r))throw new Me(ve.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return wL(n,new Ze(r))}if(t instanceof _i)return wL(n,t._key);throw new Me(ve.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Z1(t)}.`)}function a3(n,e){if(!Array.isArray(n)||n.length===0)throw new Me(ve.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $6(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Me(ve.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Me(ve.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Xge{convertValue(e,t="none"){switch(Qu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Yu(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw st()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Kh(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t[sw].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Qn(o.doubleValue));return new GN(i)}convertGeoPoint(e){return new HN(Qn(e.latitude),Qn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=W1(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zg(e));default:return null}}convertTimestamp(e){const t=Xu(e);return new tr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=xn.fromString(e);qt(XW(r));const s=new Ug(r.get(1),r.get(3)),i=new Ze(r.popFirst(5));return s.isEqual(t)||wl(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yge(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class P6 extends R6{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new db(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(XN("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class db extends P6{data(e={}){return super.data(e)}}class O6{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Om(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new db(this._firestore,this._userDataWriter,r.key,r,new Om(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Me(ve.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new db(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Om(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new db(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Om(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,c=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),c=o.indexOf(a.doc.key)),{type:Qge(a.type),doc:l,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Qge(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return st()}}class sA extends Xge{constructor(e){super(),this.firestore=e}convertBytes(e){return new jf(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new _i(this.firestore,null,t)}}function Jge(n){n=uh(n,Ol);const e=uh(n.firestore,qg),t=jN(e),r=new sA(e);return D6(n._query),Pge(t,n._query).then(s=>new O6(e,r,n,s))}function iA(n,e){const t=uh(n.firestore,qg),r=Mge(n),s=Yge(n.converter,e);return Zge(t,[Uge(S6(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,dl.exists(!1))]).then(()=>r)}function oA(n,...e){var t,r,s;n=Si(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||i3(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(i3(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let l,u,c;if(n instanceof _i)u=uh(n.firestore,qg),c=IN(n._key.path),l={next:h=>{e[o]&&e[o](eve(u,n,h))},error:e[o+1],complete:e[o+2]};else{const h=uh(n,Ol);u=uh(h.firestore,qg),c=h._query;const d=new sA(u);l={next:f=>{e[o]&&e[o](new O6(u,d,h,f))},error:e[o+1],complete:e[o+2]},D6(n._query)}return function(d,f,p,m){const g=new x6(m),v=new c6(f,g,p);return d.asyncQueue.enqueueAndForget(async()=>l6(await $S(d),v)),()=>{g.su(),d.asyncQueue.enqueueAndForget(async()=>u6(await $S(d),v))}}(jN(u),c,a,l)}function Zge(n,e){return function(r,s){const i=new Fu;return r.asyncQueue.enqueueAndForget(async()=>_ge(await $ge(r),s,i)),i.promise}(jN(n),e)}function eve(n,e,t){const r=t.docs.get(e._key),s=new sA(n);return new P6(n,s,e._key,r,new Om(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){gp=s})(mp),Ff(new kh("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new qg(new Gfe(r.getProvider("auth-internal")),new Xfe(o,r.getProvider("app-check-internal")),function(u,c){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Me(ve.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ug(u.options.projectId,c)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Pu(uL,cL,e),Pu(uL,cL,"esm2017")})();var tve="firebase",nve="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pu(tve,nve,"app");const rve={apiKey:"AIzaSyA6F4Cy-MGSZ6sUX4xmehsl7mktCuu22tM",authDomain:"burnouttrackersimple.firebaseapp.com",projectId:"burnouttrackersimple",storageBucket:"burnouttrackersimple.firebasestorage.app",messagingSenderId:"1079690085368",appId:"1:1079690085368:web:8be282a2baae73ba4a4c0d"},sve=Rv(rve),aA=t_(sve),ive=n=>{const e=JN(Sh(aA,"stressData"),nA("timestamp","desc"));return oA(e,t=>{const r=[];t.forEach(s=>{const i=s.data();r.push({id:s.id,stressLevel:i.stressLevel,sleepHours:i.sleepHours,screenTime:i.screenTime,timestamp:i.timestamp.toDate()})}),n(r)},t=>{console.error("Error fetching data:",t)})},ove=async n=>{try{if(!n.stressLevel||!n.sleepHours||!n.screenTime||!n.timestamp)throw new Error("Missing required fields");const e=tr.fromDate(n.timestamp),t=await iA(Sh(aA,"stressData"),{...n,timestamp:e});return console.log("Data saved successfully with ID:",t.id),t.id}catch(e){throw console.error("Error adding stress data:",e),e}},ave=async()=>{try{const n=await Jge(Sh(aA,"stressData")),e=[];return n.forEach(t=>{const r=t.data();e.push({id:t.id,stressLevel:r.stressLevel,sleepHours:r.sleepHours,screenTime:r.screenTime,timestamp:r.timestamp.toDate()})}),e}catch(n){throw console.error("Error fetching stress data:",n),n}};function lve(){const[n,e]=q.useState({stressLevel:5,sleepHours:7,screenTime:4,timestamp:new Date}),[t,r]=q.useState(!1),[s,i]=q.useState(null),[o,a]=q.useState([]),[l,u]=q.useState(null);q.useEffect(()=>{(async()=>{try{const m=await ave();a(m)}catch(m){console.error("Error loading initial data:",m),u("Failed to load data. Please check your connection.")}})();const p=ive(m=>{a(m)});return()=>p()},[]);const c=async f=>{if(f.preventDefault(),r(!0),i(null),u(null),n.stressLevel<1||n.stressLevel>10){i("error"),u("Stress level must be between 1 and 10"),r(!1);return}if(n.sleepHours<0||n.sleepHours>24){i("error"),u("Sleep hours must be between 0 and 24"),r(!1);return}if(n.screenTime<0||n.screenTime>24){i("error"),u("Screen time must be between 0 and 24"),r(!1);return}try{const p={...n,timestamp:new Date};await ove(p),i("success"),e({stressLevel:5,sleepHours:7,screenTime:4,timestamp:new Date})}catch(p){console.error("Error saving data:",p),i("error"),u("Failed to save data. Please try again.")}finally{r(!1)}},h=(f,p)=>{e(m=>({...m,[f]:p}))},d=f=>{e(p=>({...p,stressLevel:f}))};return k.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50",children:k.jsx("div",{className:"container mx-auto px-4 py-8",children:k.jsxs("div",{className:"max-w-4xl mx-auto",children:[l&&k.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:k.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),k.jsx("p",{className:"text-red-700",children:l})]})}),k.jsx(lde,{formData:n,isSubmitting:t,submitStatus:s,onSubmit:c,onInputChange:h,onSentimentChange:d}),k.jsx(ade,{onSentimentChange:d}),k.jsx(Lie,{data:o})]})})})}const uve=()=>k.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white pt-16",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("div",{className:"flex items-center justify-center mb-6",children:k.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center",children:k.jsx(cl,{className:"w-8 h-8 text-indigo-600"})})}),k.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Digital Detox Assistant"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Smart screen time tracking and gentle nudges to help you maintain focus."})]}),k.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[k.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg",children:[k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Features"}),k.jsxs("ul",{className:"space-y-4",children:[k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Screen time monitoring across devices"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Smart notifications for breaks"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Focus mode for distraction-free study"})]})]})]}),k.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg",children:[k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Benefits"}),k.jsxs("ul",{className:"space-y-4",children:[k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Improved productivity and focus"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Better digital well-being"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Reduced eye strain and fatigue"})]})]})]})]}),k.jsx("div",{className:"text-center mt-8",children:k.jsx(Ui,{to:"/features/game",children:k.jsx("button",{className:"bg-indigo-600 text-white px-4 py-2 rounded-full hover:bg-indigo-700",children:"Play Game"})})})]})}),cve=()=>k.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white pt-16",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("div",{className:"flex items-center justify-center mb-6",children:k.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center",children:k.jsx(zT,{className:"w-8 h-8 text-indigo-600"})})}),k.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"24/7 AI Support"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Intelligent chatbot offering round-the-clock mental health support and guidance."})]}),k.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[k.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg",children:[k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Features"}),k.jsxs("ul",{className:"space-y-4",children:[k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Always available support system"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Natural language understanding"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Personalized responses"})]})]})]}),k.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg",children:[k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Support Areas"}),k.jsxs("ul",{className:"space-y-4",children:[k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Stress management"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Study techniques"})]}),k.jsxs("li",{className:"flex items-start",children:[k.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),k.jsx("p",{children:"Mental health guidance"})]})]})]})]})]})}),hve={apiKey:"AIzaSyChGT1uTyeSEefHgEzZLY0qhLdZpATt6HI",authDomain:"meditation-coach-d4c9b.firebaseapp.com",projectId:"meditation-coach-d4c9b",storageBucket:"meditation-coach-d4c9b.firebasestorage.app",messagingSenderId:"169916790708",appId:"1:169916790708:web:004d95dd2b0e46805264e1"},dve=Lg().length===0?Rv(hve):Lg()[0],l3=t_(dve);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fve=1e-7,pve=1e-4;class F6{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class lA{refCount(e){return js("refCount")}incRef(e){return js("incRef")}timerAvailable(){return!0}time(e){return js("time")}read(e){return js("read")}readSync(e){return js("readSync")}readToGPU(e,t){return js("readToGPU")}numDataIds(){return js("numDataIds")}disposeData(e,t){return js("disposeData")}write(e,t,r){return js("write")}move(e,t,r,s,i){return js("move")}createTensorFromGPUData(e,t,r){return js("createTensorFromGPUData")}memory(){return js("memory")}floatPrecision(){return js("floatPrecision")}epsilon(){return this.floatPrecision()===32?fve:pve}dispose(){return js("dispose")}}function js(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mve(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Pd(n,e,t)}function Eh(n,e,t){return Math.max(n,Math.min(e,t))}function uA(n){return n%2===0?n:n+1}function Pd(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function gve(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function M(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function cA(n,e,t=""){M(Ut(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function M6(n){M(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function fe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Ut(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Wf(n){return n%1===0}function PS(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function cf(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function u3(n,e=s=>0,t,r){return new Promise((s,i)=>{let o=0;const a=()=>{if(n()){s();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function L6(n,e){let t=1,r=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function vt(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),M(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),M(n.every(r=>Wf(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function cc(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:vt(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Qr(n,e){return jn(n,e)}function jn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function vve(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function yve(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function B6(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function pw(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function xve(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Fv(n){return typeof n=="string"||n instanceof String}function bve(n){return typeof n=="boolean"}function OS(n){return typeof n=="number"}function wp(n){return Array.isArray(n)?wp(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":OS(n)?"float32":Fv(n)?"string":bve(n)?"bool":"float32"}function FS(n){return!!(n&&n.constructor&&n.call&&n.apply)}function MS(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Ke(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function V6(n,e,t,r=!1){const s=new Array;if(e.length===1){const i=e[0]*(r?2:1);for(let o=0;o<i;o++)s[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(r?2:1);for(let l=0;l<i;l++)s[l]=V6(n+l*a,o,t,r)}return s}function Ro(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,i)=>s*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return V6(0,n,e,t)}function wve(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function hA(n,e){const t=Jr(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function Jr(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function z6(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return Ro(n,new Float32Array(t));if(e==="int32")return Ro(n,new Int32Array(t));if(e==="bool")return Ro(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Fl(n){n.forEach(e=>{M(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function va(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function _p(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function dA(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c3="tfjsflags";class _ve{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=kve,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(dA(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);c3 in e&&e[c3].split(",").forEach(r=>{const[s,i]=r.split(":");this.urlFlags[s]=Ive(s,i)})}}function kve(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(Cve(e,r[0],r[1]),r.join("="))),e}function Cve(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ive(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function oe(){return U6}let U6=null;function Sve(n){U6=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let u2;function j6(){if(u2==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");u2=n}return u2}function Eve(){const n=j6();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function fA(n,e){const t=Eve();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const n_="Abs",Mv="Acos",Lv="Acosh",kp="Add",pA="AddN",mA="All",gA="Any",r_="ArgMax",s_="ArgMin",Bv="Asin",Vv="Asinh",zv="Atan",Uv="Atanh",jv="Atan2",i_="AvgPool",vA="AvgPoolGrad",o_="AvgPool3D",yA="AvgPool3DGrad",a_="BatchMatMul",l_="BatchToSpaceND",xA="Bincount",bA="BitwiseAnd",Tve="BroadcastTo",W6="BroadcastArgs",Wv="Cast",Hv="Ceil",Gv="ClipByValue",wA="Complex",u_="ComplexAbs",c_="Concat",h_="Conv2D",_A="Conv2DBackpropFilter",d_="Conv2DBackpropInput",f_="Conv3D",kA="Conv3DBackpropFilterV2",CA="Conv3DBackpropInputV2",qv="Cos",Kv="Cosh",IA="Cumprod",p_="Cumsum",SA="CropAndResize",EA="DenseBincount",TA="DepthToSpace",m_="DepthwiseConv2dNative",NA="DepthwiseConv2dNativeBackpropFilter",AA="DepthwiseConv2dNativeBackpropInput",H6="Diag",g_="Dilation2D",LS="Dilation2DBackpropInput",BS="Dilation2DBackpropFilter",Nve="Draw",Xv="RealDiv",RA="Einsum",Yv="Elu",DA="EluGrad",Qv="Erf",v_="Equal",Jv="Exp",y_="ExpandDims",Zv="Expm1",$A="FFT",PA="Fill",OA="FlipLeftRight",ey="Floor",ty="FloorDiv",x_="FusedBatchNorm",b_="GatherV2",G6="GatherNd",w_="Greater",ny="GreaterEqual",ry="Identity",FA="IFFT",MA="Imag",sy="IsFinite",iy="IsInf",oy="IsNan",__="LeakyRelu",k_="Less",C_="LessEqual",q6="LinSpace",ay="Log",ly="Log1p",I_="LogicalAnd",S_="LogicalNot",E_="LogicalOr",Ave="LogSoftmax",T_="LRN",LA="LRNGrad",N_="Max",uy="Maximum",A_="MaxPool",BA="MaxPoolGrad",R_="MaxPool3D",VA="MaxPool3DGrad",K6="MaxPoolWithArgmax",D_="Mean",$_="Min",cy="Minimum",P_="MirrorPad",hy="Mod",X6="Multinomial",dy="Multiply",O_="Neg",F_="NotEqual",zA="NonMaxSuppressionV3",UA="NonMaxSuppressionV4",jA="NonMaxSuppressionV5",M_="OnesLike",L_="OneHot",B_="Pack",V_="PadV2",fy="Pow",z_="Prelu",U_="Prod",Y6="RaggedGather",Q6="RaggedRange",J6="RaggedTensorToTensor",WA="Range",HA="Real",py="Reciprocal",my="Relu",j_="Reshape",W_="ResizeNearestNeighbor",GA="ResizeNearestNeighborGrad",H_="ResizeBilinear",qA="ResizeBilinearGrad",gy="Relu6",G_="Reverse",vy="Round",yy="Rsqrt",Z6="ScatterNd",e5="TensorScatterUpdate",t5="SearchSorted",q_="Select",xy="Selu",K_="Slice",by="Sin",wy="Sinh",_y="Sign",ky="Sigmoid",Cy="Softplus",Iy="Sqrt",X_="Sum",Y_="SpaceToBatchND",Q_="SplitV",J_="Softmax",n5="SparseFillEmptyRows",r5="SparseReshape",s5="SparseSegmentMean",i5="SparseSegmentSum",o5="SparseToDense",Sy="SquaredDifference",KA="Square",XA="StaticRegexReplace",YA="StridedSlice",a5="StringNGrams",l5="StringSplit",u5="StringToHashBucketFast",Ey="Sub",Ty="Tan",Ny="Tanh",Ay="Tile",QA="TopK",JA="Transform",hf="Transpose",ZA="Unique",Z_="Unpack",ek="UnsortedSegmentSum",tk="ZerosLike",Ry="Step",Rve="FromPixels",eR="RotateWithOffset",mw="_FusedMatMul",gw="FusedConv2D",c5="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(...n){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(...n)}function Dve(...n){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vw=fA("kernelRegistry",()=>new Map),VS=fA("gradRegistry",()=>new Map);function h3(n,e){const t=d5(n,e);return vw.get(t)}function d3(n){return VS.get(n)}function f3(n){const e=vw.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[i,o]=s,[a]=i.split("_");a===n&&t.push(o)}return t}function h5(n){const{kernelName:e,backendName:t}=n,r=d5(e,t);vw.has(r)&&mi(`The kernel '${e}' for backend '${t}' is already registered`),vw.set(r,n)}function $ve(n){const{kernelName:e}=n;VS.has(e)&&oe().getBool("DEBUG")&&mi(`Overriding the gradient for '${e}'`),VS.set(e,n)}function d5(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var p5=dn,Yi=null;try{Yi=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function dn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}dn.prototype.__isLong__;Object.defineProperty(dn.prototype,"__isLong__",{value:!0});function li(n){return(n&&n.__isLong__)===!0}dn.isLong=li;var p3={},m3={};function Jh(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=m3[n],r)?r:(t=fn(n,(n|0)<0?-1:0,!0),s&&(m3[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=p3[n],r)?r:(t=fn(n,n<0?-1:0,!1),s&&(p3[n]=t),t))}dn.fromInt=Jh;function Qi(n,e){if(isNaN(n))return e?eh:Ji;if(e){if(n<0)return eh;if(n>=m5)return y5}else{if(n<=-9223372036854776e3)return Qs;if(n+1>=Ove)return v5}return n<0?Qi(-n,e).neg():fn(n%Hf|0,n/Hf|0,e)}dn.fromNumber=Qi;function fn(n,e,t){return new dn(n,e,t)}dn.fromBits=fn;var yw=Math.pow;function tR(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ji;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return tR(n.substring(1),e,t).neg();for(var s=Qi(yw(t,8)),i=Ji,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+a),t);if(a<8){var u=Qi(yw(t,a));i=i.mul(u).add(Qi(l))}else i=i.mul(s),i=i.add(Qi(l))}return i.unsigned=e,i}dn.fromString=tR;function Uo(n,e){return typeof n=="number"?Qi(n,e):typeof n=="string"?tR(n,e):fn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}dn.fromValue=Uo;var g3=65536,Pve=1<<24,Hf=g3*g3,m5=Hf*Hf,Ove=m5/2,v3=Jh(Pve),Ji=Jh(0);dn.ZERO=Ji;var eh=Jh(0,!0);dn.UZERO=eh;var Zd=Jh(1);dn.ONE=Zd;var g5=Jh(1,!0);dn.UONE=g5;var zS=Jh(-1);dn.NEG_ONE=zS;var v5=fn(-1,2147483647,!1);dn.MAX_VALUE=v5;var y5=fn(-1,-1,!0);dn.MAX_UNSIGNED_VALUE=y5;var Qs=fn(0,-2147483648,!1);dn.MIN_VALUE=Qs;var Ne=dn.prototype;Ne.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ne.toNumber=function(){return this.unsigned?(this.high>>>0)*Hf+(this.low>>>0):this.high*Hf+(this.low>>>0)};Ne.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Qs)){var t=Qi(e),r=this.div(t),s=r.mul(t).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Qi(yw(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),u=o.sub(l.mul(i)).toInt()>>>0,c=u.toString(e);if(o=l,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};Ne.getHighBits=function(){return this.high};Ne.getHighBitsUnsigned=function(){return this.high>>>0};Ne.getLowBits=function(){return this.low};Ne.getLowBitsUnsigned=function(){return this.low>>>0};Ne.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Qs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Ne.isZero=function(){return this.high===0&&this.low===0};Ne.eqz=Ne.isZero;Ne.isNegative=function(){return!this.unsigned&&this.high<0};Ne.isPositive=function(){return this.unsigned||this.high>=0};Ne.isOdd=function(){return(this.low&1)===1};Ne.isEven=function(){return(this.low&1)===0};Ne.equals=function(e){return li(e)||(e=Uo(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ne.eq=Ne.equals;Ne.notEquals=function(e){return!this.eq(e)};Ne.neq=Ne.notEquals;Ne.ne=Ne.notEquals;Ne.lessThan=function(e){return this.comp(e)<0};Ne.lt=Ne.lessThan;Ne.lessThanOrEqual=function(e){return this.comp(e)<=0};Ne.lte=Ne.lessThanOrEqual;Ne.le=Ne.lessThanOrEqual;Ne.greaterThan=function(e){return this.comp(e)>0};Ne.gt=Ne.greaterThan;Ne.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ne.gte=Ne.greaterThanOrEqual;Ne.ge=Ne.greaterThanOrEqual;Ne.compare=function(e){if(li(e)||(e=Uo(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ne.comp=Ne.compare;Ne.negate=function(){return!this.unsigned&&this.eq(Qs)?Qs:this.not().add(Zd)};Ne.neg=Ne.negate;Ne.add=function(e){li(e)||(e=Uo(e));var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,h=0,d=0,f=0;return f+=i+u,d+=f>>>16,f&=65535,d+=s+l,h+=d>>>16,d&=65535,h+=r+a,c+=h>>>16,h&=65535,c+=t+o,c&=65535,fn(d<<16|f,c<<16|h,this.unsigned)};Ne.subtract=function(e){return li(e)||(e=Uo(e)),this.add(e.neg())};Ne.sub=Ne.subtract;Ne.multiply=function(e){if(this.isZero())return Ji;if(li(e)||(e=Uo(e)),Yi){var t=Yi.mul(this.low,this.high,e.low,e.high);return fn(t,Yi.get_high(),this.unsigned)}if(e.isZero())return Ji;if(this.eq(Qs))return e.isOdd()?Qs:Ji;if(e.eq(Qs))return this.isOdd()?Qs:Ji;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v3)&&e.lt(v3))return Qi(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,h=0,d=0,f=0,p=0;return p+=o*c,f+=p>>>16,p&=65535,f+=i*c,d+=f>>>16,f&=65535,f+=o*u,d+=f>>>16,f&=65535,d+=s*c,h+=d>>>16,d&=65535,d+=i*u,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=r*c+s*u+i*l+o*a,h&=65535,fn(f<<16|p,h<<16|d,this.unsigned)};Ne.mul=Ne.multiply;Ne.divide=function(e){if(li(e)||(e=Uo(e)),e.isZero())throw Error("division by zero");if(Yi){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Yi.div_u:Yi.div_s)(this.low,this.high,e.low,e.high);return fn(t,Yi.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?eh:Ji;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return eh;if(e.gt(this.shru(1)))return g5;i=eh}else{if(this.eq(Qs)){if(e.eq(Zd)||e.eq(zS))return Qs;if(e.eq(Qs))return Zd;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ji)?e.isNegative()?Zd:zS:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(Qs))return this.unsigned?eh:Ji;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ji}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:yw(2,a-48),u=Qi(r),c=u.mul(e);c.isNegative()||c.gt(s);)r-=l,u=Qi(r,this.unsigned),c=u.mul(e);u.isZero()&&(u=Zd),i=i.add(u),s=s.sub(c)}return i};Ne.div=Ne.divide;Ne.modulo=function(e){if(li(e)||(e=Uo(e)),Yi){var t=(this.unsigned?Yi.rem_u:Yi.rem_s)(this.low,this.high,e.low,e.high);return fn(t,Yi.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ne.mod=Ne.modulo;Ne.rem=Ne.modulo;Ne.not=function(){return fn(~this.low,~this.high,this.unsigned)};Ne.and=function(e){return li(e)||(e=Uo(e)),fn(this.low&e.low,this.high&e.high,this.unsigned)};Ne.or=function(e){return li(e)||(e=Uo(e)),fn(this.low|e.low,this.high|e.high,this.unsigned)};Ne.xor=function(e){return li(e)||(e=Uo(e)),fn(this.low^e.low,this.high^e.high,this.unsigned)};Ne.shiftLeft=function(e){return li(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fn(0,this.low<<e-32,this.unsigned)};Ne.shl=Ne.shiftLeft;Ne.shiftRight=function(e){return li(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ne.shr=Ne.shiftRight;Ne.shiftRightUnsigned=function(e){if(li(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return fn(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?fn(t,0,this.unsigned):fn(t>>>e-32,0,this.unsigned)};Ne.shru=Ne.shiftRightUnsigned;Ne.shr_u=Ne.shiftRightUnsigned;Ne.toSigned=function(){return this.unsigned?fn(this.low,this.high,!1):this};Ne.toUnsigned=function(){return this.unsigned?this:fn(this.low,this.high,!0)};Ne.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ne.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ne.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};dn.fromBytes=function(e,t,r){return r?dn.fromBytesLE(e,t):dn.fromBytesBE(e,t)};dn.fromBytesLE=function(e,t){return new dn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};dn.fromBytesBE=function(e,t){return new dn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const x5=lV(p5),Fve=sQ({__proto__:null,default:x5},[p5]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wc=x5||Fve;function nk(n){return Wc.fromString(n,!0,16)}const b5=nk("c3a5c85c97cb3127"),zc=nk("b492b66fbe98f273"),gs=nk("9ae16a3b2f90404f");function US(n){return n.xor(n.shru(47))}function w5(n,e,t){const r=n.slice(e,e+t);return Wc.fromBytes(Array.from(r),!0,!0)}function sn(n,e){return w5(n,e,8)}function y3(n,e){return w5(n,e,4)}function vr(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Lu(n,e,t=nk("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function Mve(n,e,t,r,s,i){s=s.add(n),i=vr(i.add(s).add(r),21);const o=s;return s=s.add(e),s=s.add(t),i=i.add(vr(s,44)),[s.add(r),i.add(o)]}function d0(n,e,t,r){return Mve(sn(n,e),sn(n,e+8),sn(n,e+16),sn(n,e+24),t,r)}function Lve(n,e=n.length){if(e>=8){const t=gs.add(e*2),r=sn(n,0).add(gs),s=sn(n,e-8),i=vr(s,37).mul(t).add(r),o=vr(r,25).add(s).mul(t);return Lu(i,o,t)}if(e>=4){const t=gs.add(e*2),r=y3(n,0);return Lu(r.shl(3).add(e),y3(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],i=t+(r<<8),o=e+(s<<2);return US(gs.mul(i).xor(b5.mul(o))).mul(gs)}return gs}function Bve(n,e=n.length){const t=gs.add(e*2),r=sn(n,0).mul(zc),s=sn(n,8),i=sn(n,e-8).mul(t),o=sn(n,e-16).mul(gs);return Lu(vr(r.add(s),43).add(vr(i,30)).add(o),r.add(vr(s.add(gs),18)).add(i),t)}function Vve(n,e=n.length){const t=gs.add(e*2),r=sn(n,0).mul(gs),s=sn(n,8),i=sn(n,e-8).mul(t),o=sn(n,e-16).mul(gs),a=vr(r.add(s),43).add(vr(i,30)).add(o),l=Lu(a,r.add(vr(s.add(gs),18)).add(i),t),u=sn(n,16).mul(t),c=sn(n,24),h=a.add(sn(n,e-32)).mul(t),d=l.add(sn(n,e-24)).mul(t);return Lu(vr(u.add(c),43).add(vr(h,30)).add(d),u.add(vr(c.add(r),18)).add(h),t)}function zve(n,e=n.length){const t=Wc.fromNumber(81,!0);if(e<=32)return e<=16?Lve(n,e):Bve(n,e);if(e<=64)return Vve(n,e);let r=t,s=t.mul(zc).add(113),i=US(s.mul(gs).add(113)).mul(gs),o=[Wc.UZERO,Wc.UZERO],a=[Wc.UZERO,Wc.UZERO];r=r.mul(gs).add(sn(n,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do r=vr(r.add(s).add(o[0]).add(sn(n,l+8)),37).mul(zc),s=vr(s.add(o[1]).add(sn(n,l+48)),42).mul(zc),r=r.xor(a[1]),s=s.add(o[0]).add(sn(n,l+40)),i=vr(i.add(a[0]),33).mul(zc),o=d0(n,l,o[1].mul(zc),r.add(a[0])),a=d0(n,l+32,i.add(a[1]),s.add(sn(n,l+16))),[i,r]=[r,i],l+=64;while(l!==u);const h=zc.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=vr(r.add(s).add(o[0]).add(sn(n,l+8)),37).mul(h),s=vr(s.add(o[1]).add(sn(n,l+48)),42).mul(h),r=r.xor(a[1].mul(9)),s=s.add(o[0].mul(9).add(sn(n,l+40))),i=vr(i.add(a[0]),33).mul(h),o=d0(n,l,o[1].mul(h),r.add(a[0])),a=d0(n,l+32,i.add(a[1]),s.add(sn(n,l+16))),[i,r]=[r,i],Lu(Lu(o[0],a[0],h).add(US(s).mul(b5)).add(i),Lu(o[1],a[1],h).add(r),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hc(n,e){return e==="string"?Bu(n):Zh([n],e)}function Uve(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Zh(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Th(n)),oe().getBool("DEBUG")&&vve(n,e),Uve(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Rs(){return oe().platform.now()}function Bu(n,e="utf-8"){return e=e||"utf-8",oe().platform.encode(n,e)}function ec(n,e="utf-8"){return e=e||"utf-8",oe().platform.decode(n,e)}function ao(n){return oe().platform.isTypedArray!=null?oe().platform.isTypedArray(n):f5(n)}function Th(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||dA(n)||n==null||ao(n)&&t)e.push(n);else if(Array.isArray(n)||ao(n))for(let r=0;r<n.length;++r)Th(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Th(n[s],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jve{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Hve)}profileKernel(e,t,r){let s;const i=()=>{s=r()};let o;const a=Rs();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of s)u.dataSync();o=Promise.resolve({kernelMs:Rs()-a})}if(oe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<s.length;u++){const c=s[u];c.data().then(h=>{Wve(h,c.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:i,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),s,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function Wve(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class Hve{logKernelProfile(e,t,r,s,i,o){const a=typeof s=="number"?cf(`${s}ms`,9):s.error,l=cf(e,25),u=t.rank,c=t.size,h=cf(t.shape.toString(),14);let d="";for(const f in i){const p=i[f];if(p!=null){const m=p.shape||t.shape,g=m.length;d+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${c}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gve(n,e,t){const r={},s={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],c=u.inputs;for(const h in c){const d=c[h];let f=!1;for(let p=0;p<e.length;p++)if(r[d.id]){u.outputs.forEach(m=>r[m.id]=!0),f=!0,s[u.id]=!0;break}if(f)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],c=u.inputs;for(let h=0;h<u.outputs.length;h++)if(i[u.outputs[h].id]){for(const d in c)i[c[d].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(s[u.id]&&o[u.id]){const c={};for(const d in u.inputs){const f=u.inputs[d];r[f.id]&&(c[d]=f)}const h=Object.assign({},u);h.inputs=c,h.outputs=u.outputs,a.push(h)}}return a}function qve(n,e,t,r){for(let s=e.length-1;s>=0;s--){const i=e[s],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=i.inputs[l];if(!Ut(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(n[c.id]==null)n[c.id]=u;else{const h=n[c.id];n[c.id]=r(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3=20,pm=3,c2=7;function Kve(n,e,t,r){const s=Ke(e),i=Xve(n,e,t,s),o=e.length,a=fb(n,e,t,s,i),l=["Tensor"];return r&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function Xve(n,e,t,r){const s=fe(e),i=r[r.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Mm(n):n;if(a>1)for(let u=0;u<s/i;u++){const c=u*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],Fm(l[c+h],0,t).length)}return o}function Fm(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(c2))} + ${parseFloat(n[1].toFixed(c2))}j`:Fv(n)?r=`'${n}'`:t==="bool"?r=_5(n):r=parseFloat(n.toFixed(c2)).toString(),cf(r,e)}function _5(n){return n===0?"false":"true"}function fb(n,e,t,r,s,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const m=Mm(n);return[Fm(m[0],0,t)]}return t==="bool"?[_5(n[0])]:[n[0].toString()]}if(l===1){if(a>x3){const g=pm*o;let v=Array.from(n.slice(0,g)),y=Array.from(n.slice((a-pm)*o,a*o));return t==="complex64"&&(v=Mm(v),y=Mm(y)),["["+v.map((x,b)=>Fm(x,s[b],t)).join(", ")+", ..., "+y.map((x,b)=>Fm(x,s[a-pm+b],t)).join(", ")+"]"]}return["["+(t==="complex64"?Mm(n):Array.from(n)).map((g,v)=>Fm(g,s[v],t)).join(", ")+"]"]}const u=e.slice(1),c=r.slice(1),h=r[0]*o,d=[];if(a>x3){for(let m=0;m<pm;m++){const g=m*h,v=g+h;d.push(...fb(n.slice(g,v),u,t,c,s,!1))}d.push("...");for(let m=a-pm;m<a;m++){const g=m*h,v=g+h;d.push(...fb(n.slice(g,v),u,t,c,s,m===a-1))}}else for(let m=0;m<a;m++){const g=m*h,v=g+h;d.push(...fb(n.slice(g,v),u,t,c,s,m===a-1))}const f=l===2?",":"";d[0]="["+(a>0?d[0]+f:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function Mm(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Or{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=fe(e),r!=null){const s=r.length;M(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||jn(t,this.size),this.strides=Ke(e)}set(e,...t){t.length===0&&(t=[0]),M(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return _o().makeTensor(this.values,this.shape,this.dtype)}}let _o=null,Od=null;function Yve(n){_o=n}function Qve(n){Od=n}class ir{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fe(e),this.strides=Ke(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Od.buffer(this.shape,this.dtype,e)}bufferSync(){return Od.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Ro(this.shape,e,this.dtype==="complex64")}arraySync(){return Ro(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=_o().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>ec(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),_o().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=_o().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ec(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await _o().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),_o().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Od.print(this,e)}clone(){return this.throwIfDisposed(),Od.clone(this)}toString(e=!1){const t=this.dataSync();return Kve(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Od.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),_o().makeVariable(this,e,t,r)}}Object.defineProperty(ir,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ce(){return fA("Tensor",()=>ir)}ce();class xw extends ir{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ut(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);_o().disposeTensor(this),this.dataId=e.dataId,_o().incRef(this,null)}dispose(){_o().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(xw,Symbol.hasInstance,{value:n=>n instanceof ir&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b3;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(b3||(b3={}));var jS;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(jS||(jS={}));var WS;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(WS||(WS={}));var HS;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(HS||(HS={}));var GS;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(GS||(GS={}));const Jve={float32:HS,int32:jS,bool:WS,complex64:GS};function ri(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Jve[n][e]}function nR(n){return ri(n,"int32")}function k5(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function C5(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(n,e){if(n.dtype===e.dtype)return[n,e];const t=ri(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function I5(n){const e=[];return S5(n,e,new Set),e}function S5(n,e,t){if(n==null)return;if(n instanceof ir){e.push(n);return}if(!Zve(n))return;const r=n;for(const s in r){const i=r[s];t.has(i)||(t.add(i),S5(i,e,t))}}function Zve(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2(n){return n.kernelName!=null}class w3{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Gf{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new w3}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(mi(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new jve(this.backendInstance),!0}setupRegisteredKernels(){f3(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){f3(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof lA)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,i=r.then(o=>s<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,mi(`Initialization of backend ${e} failed`),mi(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return mi(`Initialization of backend ${e} failed`),mi(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:i}=this.initializeBackend(r);if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,i=this.readSync(t),o=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return Gf.nextTensorId++}nextVariableId(){return Gf.nextVariableId++}clone(e){const t=J.runKernel(ry,{x:e}),r={x:e},s=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return J.runKernel(Wv,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(h3(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let i=0;r.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=h2(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(h2(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const v=h3(p,this.backendName);M(v!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();l=v.kernelFunc({inputs:m,attrs:g,backend:this.backend});const x=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,x);const b=x.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(s){const _=this.getTensorsForGradient(p,m,b);r=this.saveTensorsForBackwardMode(_)}return b}}else{const{forwardFunc:p}=e,m=g=>{s&&(r=g.map(v=>this.keep(this.clone(v))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,g,v),v}}const{inputs:c,attrs:h}=e,d=h2(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(f=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),t=f.outputs)}),s&&this.addTapeNode(u,c,t,d,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:t.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const s=d3(e);if(s!=null){const i=s.inputsToSave||[],o=s.outputsToSave||[];let a;s.saveAllInputs?(M(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=r.filter((u,c)=>o[c]);return a.concat(l)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let i=e;r==="string"&&Fv(e[0])&&(i=e.map(l=>Bu(l)));const o=s.write(i,t,r),a=new ir(t,r,o,this.nextTensorId());if(this.trackTensor(a,s),r==="string"){const l=this.state.tensorInfo.get(o),u=xve(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,r,s){r=r||"float32";const i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:i}=e,o=new ir(s,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const i=new xw(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*pw(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof xw||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*pw(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},l=d3(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=u=>(u=u.map((c,h)=>{if(c==null){const d=r[h],f=Jr(d.size,d.dtype);return this.makeTensor(f,d.shape,d.dtype)}return c}),s(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=I5(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,t,r,s=!1){if(M(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));M(i instanceof ir,()=>"The result y returned by f() must be a tensor.");const o=Gve(this.state.activeTape,t,i);if(!s&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=r??eye(i.shape),qve(a,o,u=>this.tidy(u),tye);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return M(FS(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{M(t.every(a=>a instanceof ir),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((a,l)=>{s[l]=a});const i=(a,l)=>(r=e(...t,l),M(r.value instanceof ir,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),M(FS(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const u=r.gradFunc(a,l),c=Array.isArray(u)?u:[u];M(c.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),M(c.every(d=>d instanceof ir),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,f)=>{h[f]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Rs(),r=await this.backend.time(e);return r.wallMs=Rs()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new w3;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Gf.nextTensorId=0;Gf.nextVariableId=0;function eye(n){const e=hA(fe(n),"float32");return J.makeTensor(e,n,"float32")}function E5(){const n=j6();if(n._tfengine==null){const e=new _ve(n);n._tfengine=new Gf(e)}return Sve(n._tfengine.ENV),Yve(()=>n._tfengine),n._tfengine}const J=E5();function tye(n,e){const t={a:n,b:e};return J.runKernel(kp,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nye(){return typeof navigator<"u"&&navigator!=null}function T5(n){if(n||nye()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function N5(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ms=oe();Ms.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ms.registerFlag("IS_BROWSER",()=>N5());Ms.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ms.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ms.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ms.registerFlag("PROD",()=>!1);Ms.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ms.getBool("DEBUG"));Ms.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ms.registerFlag("IS_TEST",()=>!1);Ms.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ms.getBool("DEBUG"));Ms.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ms.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ms.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rk(n,e){let t=n;if(ao(n))return e==="string"?[]:[n.length];if(k5(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(C5(n))return[n.buffer.size/(e==null?4:pw(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||ao(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&oe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&A5(n,r,[]),r}function A5(n,e,t){if(t=t||[],!Array.isArray(n)&&!ao(n)){M(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}M(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),M(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)A5(n[s],r,t.concat(s))}function _3(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function H(n,e,t,r="numeric"){if(n instanceof ce())return _3(r,n.dtype,e,t),n;let s=wp(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),_3(r,s,e,t),n==null||!ao(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=rk(n,s);!ao(n)&&!Array.isArray(n)&&(n=[n]);const a=s!=="string"?Zh(n,s):Th(n,[],!0);return J.makeTensor(a,i,s)}function R5(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>H(i,`${e}[${o}]`,t,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rye="__op";function te(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+rye;const s=(...i)=>{J.startScope(t);try{const o=r(...i);return dA(o)&&console.error("Cannot return a Promise inside of tidy."),J.endScope(o),o}catch(o){throw J.endScope(null),o}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sye(n,e){const t=H(n,"real","complex"),r=H(e,"imag","complex");cA(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return J.runKernel(wA,s)}const qf=te({complex_:sye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sk(n,e,t,r){if(r==null)r=wp(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(C5(n)||k5(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return J.backend.createTensorFromGPUData(n,e||t,r)}if(!ao(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Fl(e);const s=fe(e),i=fe(t);M(s===i,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==fe(e.slice(o)):!0;M(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!ao(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Zh(n,r):Th(n,[],!0),J.makeTensor(n,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(n,e,t){const r=rk(n,t);return sk(n,e,r,t)}class Cp{static join(e){return new Cp(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>ao(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+s.byteLength;this.shards.push({buffer:s,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,i=new ArrayBuffer(s),o=new Uint8Array(i);let a=0;for(let l=r;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,d=a,p=Math.min(t,u.end)-u.start,m=new Uint8Array(u.buffer,h,p-h);if(o.set(m,d),a+=m.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=iye(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function iye(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,i=e(n[s]);if(i===0)return s;i<0?r=s:t=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jo(){return J}function k3(){return J.memory()}function se(n,e){return J.tidy(n,e)}function wt(n){I5(n).forEach(t=>t.dispose())}function ya(n){return J.keep(n)}function $5(n,e,t=1){return J.registerBackend(n,e,t)}function oye(){return J.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3=4;async function I3(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<s.length;++o){const a=s[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async h=>{const d=await l.bytes(),f=d.reduce((g,v)=>g+v.length,0)+C3*d.length,p=new Uint8Array(f);let m=0;for(let g=0;g<d.length;g++){const v=d[g],y=new Uint8Array(new Uint32Array([v.length]).buffer);p.set(y,m),m+=C3,p.set(v,m),m+=v.length}h(p)});r.push(c)}else r.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(r);return{data:aye(i),specs:t}}function aye(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(i=>{r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}const rR=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function S3(n){return rR?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function lye(n){if(rR)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function uye(n){if(rR){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function cye(n){return Cp.join(n)}function P5(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:S3(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:S3(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Cp(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cs{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return cs.instance==null&&(cs.instance=new cs),cs.instance}static registerSaveRouter(e){cs.getInstance().saveRouters.push(e)}static registerLoadRouter(e){cs.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return cs.getHandlers(e,"save")}static getLoadHandlers(e,t){return cs.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?cs.getInstance().loadRouters:cs.getInstance().saveRouters).forEach(o=>{const a=o(e,r);a!==null&&s.push(a)}),s}}const hye=n=>cs.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qS="tensorflowjs",KS=1,th="models_store",vu="model_info_store";function O5(){if(!oe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function XS(n){const e=n.result;e.createObjectStore(th,{keyPath:"modelPath"}),e.createObjectStore(vu,{keyPath:"modelPath"})}class Nh{constructor(e){if(this.indexedDB=O5(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const i=this.indexedDB.open(qS,KS);i.onupgradeneeded=()=>XS(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(th,"readonly"),u=a.objectStore(th).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(u.result.modelArtifacts)},u.onerror=c=>(o.close(),s(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Cp.join(t.weightData);const a=P5(t),l=o.transaction(vu,"readwrite");let u=l.objectStore(vu),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return s(d)}let h;c.onsuccess=()=>{h=o.transaction(th,"readwrite");const d=h.objectStore(th);let f;try{f=d.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(p){return s(p)}f.onsuccess=()=>r({modelArtifactsInfo:a}),f.onerror=p=>{u=l.objectStore(vu);const m=u.delete(this.modelPath);m.onsuccess=()=>(o.close(),s(f.error)),m.onerror=g=>(o.close(),s(f.error))}},c.onerror=d=>(o.close(),s(c.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>s(i.error)})}}Nh.URL_SCHEME="indexeddb://";const F5=n=>oe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Nh.URL_SCHEME)?dye(n.slice(Nh.URL_SCHEME.length)):null;cs.registerSaveRouter(F5);cs.registerLoadRouter(F5);function dye(n){return new Nh(n)}function fye(n){return n.startsWith(Nh.URL_SCHEME)?n.slice(Nh.URL_SCHEME.length):n}class pye{constructor(){this.indexedDB=O5()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(qS,KS);r.onupgradeneeded=()=>XS(r),r.onsuccess=()=>{const s=r.result,i=s.transaction(vu,"readonly"),a=i.objectStore(vu).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),t(a.error)),i.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=fye(e),new Promise((t,r)=>{const s=this.indexedDB.open(qS,KS);s.onupgradeneeded=()=>XS(s),s.onsuccess=()=>{const i=s.result,o=i.transaction(vu,"readwrite"),a=o.objectStore(vu),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),h=()=>{u=i.transaction(th,"readwrite");const f=u.objectStore(th).delete(e);f.onsuccess=()=>t(l.result.modelArtifactsInfo),f.onerror=p=>r(l.error)};c.onsuccess=h,c.onerror=d=>(h(),i.close(),r(l.error))}},l.onerror=c=>(i.close(),r(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},s.onerror=i=>r(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tl="/",Fd="tensorflowjs_models",M5="info",mye="model_topology",gye="weight_specs",vye="weight_data",yye="model_metadata";function L5(n){return{info:[Fd,n,M5].join(tl),topology:[Fd,n,mye].join(tl),weightSpecs:[Fd,n,gye].join(tl),weightData:[Fd,n,vye].join(tl),modelMetadata:[Fd,n,yye].join(tl)}}function B5(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function xye(n){const e=n.split(tl);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(tl)}function bye(n){return n.startsWith(Ah.URL_SCHEME)?n.slice(Ah.URL_SCHEME.length):n}class Ah{constructor(e){if(!oe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=L5(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=P5(e),i=Cp.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,lye(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw B5(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=uye(o),t}}Ah.URL_SCHEME="localstorage://";const V5=n=>oe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ah.URL_SCHEME)?wye(n.slice(Ah.URL_SCHEME.length)):null;cs.registerSaveRouter(V5);cs.registerLoadRouter(V5);function wye(n){return new Ah(n)}class _ye{constructor(){M(oe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),M(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Fd+tl,r=tl+M5;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(t)&&i.endsWith(r)){const o=xye(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=bye(e);const t=L5(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return B5(t),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E3="://";class ta{constructor(){this.managers={}}static getInstance(){return ta.instance==null&&(ta.instance=new ta),ta.instance}static registerManager(e,t){M(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(E3)&&(e=e.slice(0,e.indexOf(E3))),M(e.length>0,()=>"scheme must not be an empty string.");const r=ta.getInstance();M(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=ta.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(ta.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kye{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!oe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return f5(e)}}if(oe().get("IS_BROWSER")){oe().setPlatform("browser",new kye);try{ta.registerManager(Ah.URL_SCHEME,new _ye)}catch{}try{ta.registerManager(Nh.URL_SCHEME,new pye)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cye={importFetch:()=>require("node-fetch")};let d2;class Iye{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return oe().global.fetch!=null?oe().global.fetch(e,t):(d2==null&&(d2=Cye.importFetch()),d2(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}oe().get("IS_NODE")&&!oe().get("IS_BROWSER")&&oe().setPlatform("node",new Iye);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gt(n,e="float32",t){return e=e||"float32",Fl(n),new Or(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sye(n,e){const t=H(n,"x","cast");if(!yve(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return J.runKernel(Wv,r,s)}const De=te({cast_:Sye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eye(n){const t={x:H(n,"x","clone","string_or_numeric")};return J.runKernel(ry,t)}const ch=te({clone_:Eye});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tye(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */E5();const Nye={buffer:gt,cast:De,clone:ch,print:Tye};Qve(Nye);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aye(n,e){let t=H(n,"a","add"),r=H(e,"b","add");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(kp,s)}const we=te({add_:Aye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rye(n,e){let t=H(n,"a","floorDiv"),r=H(e,"b","floorDiv");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(ty,s)}const z5=te({floorDiv_:Rye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dye(n,e){let t=H(n,"a","div"),r=H(e,"b","div");if([t,r]=Hn(t,r),t.dtype==="int32"&&r.dtype==="int32")return z5(t,r);const s={a:t,b:r},i={};return J.runKernel(Xv,s,i)}const Je=te({div_:Dye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ye(n,e){let t=H(n,"a","mul"),r=H(e,"b","mul");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(dy,s)}const Y=te({mul_:$ye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pye(n){const e=H(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return J.runKernel(u_,t)}else{const t={x:e};return J.runKernel(n_,t)}}const ds=te({abs_:Pye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(n){const t={x:H(n,"x","acos")};return J.runKernel(Mv,t)}const Fye=te({acos_:Oye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mye(n){const t={x:H(n,"x","acosh")};return J.runKernel(Lv,t)}const Lye=te({acosh_:Mye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bye(n,e=null,t=!1){const s={x:H(n,"x","all","bool")},i={axis:e,keepDims:t};return J.runKernel(mA,s,i)}const U5=te({all_:Bye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vye(n,e=null,t=!1){const s={x:H(n,"x","any","bool")},i={axis:e,keepDims:t};return J.runKernel(gA,s,i)}const YS=te({any_:Vye});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(n,e=0){const r={x:H(n,"x","argMax")},s={axis:e};return J.runKernel(r_,r,s)}const Kg=te({argMax_:zye});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uye(n,e=0){const r={x:H(n,"x","argMin")},s={axis:e};return J.runKernel(s_,r,s)}const jye=te({argMin_:Uye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wye(n){const t={x:H(n,"x","asin")};return J.runKernel(Bv,t)}const Hye=te({asin_:Wye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gye(n){const t={x:H(n,"x","asinh")};return J.runKernel(Vv,t)}const qye=te({asinh_:Gye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kye(n){const t={x:H(n,"x","atan")};return J.runKernel(zv,t)}const Xye=te({atan_:Kye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yye(n,e){let t=H(n,"a","atan2"),r=H(e,"b","atan2");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(jv,s)}const Qye=te({atan2_:Yye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jye(n){const t={x:H(n,"x","atanh")};return J.runKernel(Uv,t)}const Zye=te({atanh_:Jye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(n,e,t,r,s="NHWC",i){const o=n[3],a=[...e,o],l=Ll(s);return Lr(n,a,t,i,r,null,null,l)}function uo(n,e,t,r,s,i,o="channelsLast"){const[a,l]=Xg(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Lr(n,u,t,r,s,i,!1,o)}function Ml(n,e,t,r,s,i,o="NDHWC"){const[a,l,u]=QS(e);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,l,u,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return dc(n,c,t,r,s,!1,h,i)}function Lr(n,e,t,r,s,i,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,h]=n;else if(a==="channelsFirst")[l,h,u,c]=n;else throw new Error(`Unknown dataFormat ${a}`);const[d,f,,p]=e,[m,g]=Xg(t),[v,y]=Xg(r),x=df(d,v),b=df(f,y),{padInfo:_,outHeight:E,outWidth:I}=nxe(s,u,c,m,g,x,b,i,a),C=o?p*h:p;let S;return a==="channelsFirst"?S=[l,C,E,I]:a==="channelsLast"&&(S=[l,E,I,C]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:E,outWidth:I,outChannels:C,padInfo:_,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:f,effectiveFilterHeight:x,effectiveFilterWidth:b,dilationHeight:v,dilationWidth:y,inShape:n,outShape:S,filterShape:e}}function dc(n,e,t,r,s,i=!1,o="channelsLast",a){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,c,h,d]=n;else if(o==="channelsFirst")[l,d,u,c,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[f,p,m,,g]=e,[v,y,x]=QS(t),[b,_,E]=QS(r),I=df(f,b),C=df(p,_),S=df(m,E),{padInfo:T,outDepth:N,outHeight:R,outWidth:D}=rxe(s,u,c,h,v,y,x,I,C,S,a),z=i?g*d:g;let L;return o==="channelsFirst"?L=[l,z,N,R,D]:o==="channelsLast"&&(L=[l,N,R,D,z]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:N,outHeight:R,outWidth:D,outChannels:z,padInfo:T,strideDepth:v,strideHeight:y,strideWidth:x,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationDepth:b,dilationHeight:_,dilationWidth:E,inShape:n,outShape:L,filterShape:e}}function exe(n,e,t,r,s){r==null&&(r=sR(n,e,t));const i=n[0],o=n[1],a=Yg((i-e+2*r)/t+1,s),l=Yg((o-e+2*r)/t+1,s);return[a,l]}function txe(n,e,t,r,s,i){s==null&&(s=sR(n,e[0],r[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*s>=e[a]&&(o[a]=Yg((n[a]-e[a]+2*s)/r[a]+1,i));return o}function sR(n,e,t,r=1){const s=df(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function Xg(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function QS(n){return typeof n=="number"?[n,n,n]:n}function df(n,e){return e<=1?n:n+(n-1)*(e-1)}function nxe(n,e,t,r,s,i,o,a,l){let u,c,h;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const f=exe([e,t],i,r,n,a);c=f[0],h=f[1]}else if(n==="same"){c=Math.ceil(e/r),h=Math.ceil(t/s);const d=Math.max(0,(c-1)*r+i-e),f=Math.max(0,(h-1)*s+o-t),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2),v=f-g;u={top:p,bottom:m,left:g,right:v,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),h=Math.ceil((t-o+1)/s);else if(typeof n=="object"){const d=l==="channelsLast"?n[1][0]:n[2][0],f=l==="channelsLast"?n[1][1]:n[2][1],p=l==="channelsLast"?n[2][0]:n[3][0],m=l==="channelsLast"?n[2][1]:n[3][1];u={top:d,bottom:f,left:p,right:m,type:d===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=Yg((e-i+d+f)/r+1,a),h=Yg((t-o+p+m)/s+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:c,outWidth:h}}function rxe(n,e,t,r,s,i,o,a,l,u,c){let h,d,f,p;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const g=txe([e,t,r,1],[a,l,u],1,[s,i,o],n,c);d=g[0],f=g[1],p=g[2]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/i),p=Math.ceil(r/o);const m=(d-1)*s+a-e,g=(f-1)*i+l-t,v=(p-1)*o+u-r,y=Math.floor(m/2),x=m-y,b=Math.floor(g/2),_=g-b,E=Math.floor(v/2),I=v-E;h={top:b,bottom:_,left:E,right:I,front:y,back:x,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}function Yg(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Rh(n){const[e,t,r]=Xg(n);return e===1&&t===1&&r===1}function es(n,e){return Rh(n)||Rh(e)}function Dh(n){return Xg(n).every(e=>e>0)}function Ll(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function zs(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")M(Wf(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{M(Wf(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sxe(n,e){const r={x:H(n,"x","reshape","string_or_numeric")},s={shape:e};return J.runKernel(j_,r,s)}const ee=te({reshape_:sxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ixe(n,e,t,r,s){const i=H(n,"x","avgPool","float32"),o=1;M(es(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),zs("avgPool",r,s);const u={x:a},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let h=J.runKernel(i_,u,c);return h=De(h,i.dtype),l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const iR=te({avgPool_:ixe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oxe(n,e,t,r,s,i="NDHWC"){const o=H(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),M(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),M(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),zs("avgPool3d",r,s);const u={x:a},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i};let h=J.runKernel(o_,u,c);return h=De(h,a.dtype),l?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const axe=te({avgPool3d_:oxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lxe(n,e=0){M(n.length>=1,()=>"Pass at least one tensor to concat");const t=R5(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return ch(t[0]);const r=t,s={axis:e};return J.runKernel(c_,r,s)}const Fs=te({concat_:lxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uxe(n,e,t=!1,r=!1){let s=H(n,"a","matMul"),i=H(e,"b","matMul");[s,i]=Hn(s,i);const o={a:s,b:i},a={transposeA:t,transposeB:r};return J.runKernel(a_,o,a)}const Lt=te({matMul_:uxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cxe(n){const t={x:H(n,"x","sigmoid","float32")};return J.runKernel(ky,t)}const Ip=te({sigmoid_:cxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hxe(n,e,t){const r=H(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},i={begin:e,size:t};return J.runKernel(K_,s,i)}const on=te({slice_:hxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dxe(n){const t={x:H(n,"x","tanh","float32")};return J.runKernel(Ny,t)}const ik=te({tanh_:dxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fxe(n,e,t){const r=H(n,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);M(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),M(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),M(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const i={x:r},o={blockShape:e,crops:t};return J.runKernel(l_,i,o)}const oR=te({batchToSpaceND_:fxe});function pxe(n){let e;return n.rank===0||n.rank===1?e=ee(n,[1,1,1,n.size]):n.rank===2?e=ee(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mxe(n,e,t,r,s,i){i==null&&(i=.001);const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;s!=null&&(u=H(s,"scale","batchNorm"));let c;r!=null&&(c=H(r,"offset","batchNorm")),M(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:pxe(o),scale:u,offset:c,mean:a,variance:l},f={varianceEpsilon:i},p=J.runKernel(x_,d,f);return ee(p,o.shape)}const ok=te({batchNorm_:mxe});function gxe(n,e,t,r,s,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;s!=null&&(u=H(s,"scale","batchNorm"));let c;return r!=null&&(c=H(r,"offset","batchNorm")),M(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),M(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),M(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&M(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&M(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),ok(o,a,l,c,u,i)}const vxe=te({batchNorm2d_:gxe});function yxe(n,e,t,r,s,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;s!=null&&(u=H(s,"scale","batchNorm"));let c;return r!=null&&(c=H(r,"offset","batchNorm")),M(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),M(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),M(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&M(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&M(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),ok(o,a,l,c,u,i)}const xxe=te({batchNorm3d_:yxe});function bxe(n,e,t,r,s,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;s!=null&&(u=H(s,"scale","batchNorm"));let c;return r!=null&&(c=H(r,"offset","batchNorm")),M(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),M(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),M(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&M(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&M(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),ok(o,a,l,c,u,i)}const wxe=te({batchNorm4d_:bxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _xe(n,e,t){const r=H(n,"x","bincount"),s=H(e,"weights","bincount");M(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),M(t>=0,()=>`size must be non-negative, but got ${t}.`),M(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const i={x:r,weights:s},o={size:t};return J.runKernel(xA,i,o)}const kxe=te({bincount_:_xe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cxe(n,e){let t=H(n,"broadcastTo","x");const r=t.shape;if(Fl(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ee(t,u)}const s=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(s[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return ch(t);const a={x:t},l={reps:i};return J.runKernel(Ay,a,l)}const ag=te({broadcastTo_:Cxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ixe(n){const t={x:H(n,"x","ceil","float32")};return J.runKernel(Hv,t)}const Sxe=te({ceil_:Ixe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ak(n,e,t){Fl(n),t=t||wp(e);const r={shape:n,value:e,dtype:t};return J.runKernel(PA,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Exe(n,e,t){const r=H(n,"x","clipByValue");if(M(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return ak(r.shape,e,r.dtype);const s={x:r},i={clipValueMin:e,clipValueMax:t};return J.runKernel(Gv,s,i)}const Ei=te({clipByValue_:Exe});function Txe(n){return Fs(n,0)}const Nxe=te({concat1d_:Txe});function Axe(n,e){return Fs(n,e)}const Rxe=te({concat2d_:Axe});function Dxe(n,e){return Fs(n,e)}const $xe=te({concat3d_:Dxe});function Pxe(n,e){return Fs(n,e)}const Oxe=te({concat4d_:Pxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fxe(n,e,t,r,s="NHWC",i=[1,1],o){const a=H(n,"x","conv2d","float32"),l=H(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),M(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),zs("conv2d",r,o);const h=s==="NHWC"?u.shape[3]:u.shape[1];M(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),M(es(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),M(Dh(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),M(Dh(t),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:u,filter:l},f={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},p=J.runKernel(h_,d,f);return c?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const $h=te({conv2d_:Fxe});function Mxe(n,e,t,r,s="NWC",i=1,o){const a=H(n,"x","conv1d"),l=H(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=ee(a,[1,a.shape[0],a.shape[1]])),M(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),M(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),zs("conv1d",r,o),M(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),M(es(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),M(Dh(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),M(Dh(t),()=>"Error in conv1D: Stride should be larger than 0."),M(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const h=ee(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=ee(u,[u.shape[0],1,u.shape[1],u.shape[2]]),g=$h(d,h,[1,t],r,"NHWC",[1,i],o);return c?ee(g,[g.shape[2],g.shape[3]]):ee(g,[g.shape[0],g.shape[2],g.shape[3]])}const j5=te({conv1d_:Mxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lxe(n,e,t,r,s,i="NHWC",o){M(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),M(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),M(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),M(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];M(c===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[2]}.`),M(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),zs("conv2dDerInput",s,o);const d={dy:l,filter:t},f={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,inputShape:a},p=J.runKernel(d_,d,f);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const aR=te({conv2DBackpropInput_:Lxe});function Bxe(n,e,t,r,s,i){const o=H(n,"x","conv2dTranspose"),a=H(e,"filter","conv2dTranspose");return aR(t,o,a,r,s,"NHWC",i)}const W5=te({conv2dTranspose_:Bxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxe(n,e,t,r,s="NDHWC",i=[1,1,1]){const o=H(n,"x","conv3d"),a=H(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),M(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),M(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),M(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),M(es(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),M(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),M(Dh(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),M(Dh(t),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},h={strides:t,pad:r,dataFormat:s,dilations:i},d=J.runKernel(f_,c,h);return u?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const zxe=te({conv3d_:Vxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uxe(n,e,t,r,s){M(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];M(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),M(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),M(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),M(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),M(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const c={dy:o,filter:t},h={pad:s,strides:r,inputShape:i},d=J.runKernel(CA,c,h);return a?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const H5=te({conv3DBackpropInput_:Uxe});function jxe(n,e,t,r,s){const i=H(n,"x","conv3dTranspose"),o=H(e,"filter","conv3dTranspose");return H5(t,i,o,r,s)}const Wxe=te({conv3dTranspose_:jxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(n){const t={x:H(n,"x","cos","float32")};return J.runKernel(qv,t)}const lR=te({cos_:Hxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gxe(n){const t={x:H(n,"x","cosh","float32")};return J.runKernel(Kv,t)}const G5=te({cosh_:Gxe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxe(n,e=0,t=!1,r=!1){const i={x:H(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return J.runKernel(IA,i,o)}const JS=te({cumprod_:qxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kxe(n,e=0,t=!1,r=!1){const i={x:H(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return J.runKernel(p_,i,o)}const q5=te({cumsum_:Kxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(n,e,t,r=!1){const s=H(n,"x","denseBincount"),i=H(e,"weights","denseBincount");M(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),M(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),M(t>=0,()=>`size must be non-negative, but got ${t}.`),M(i.size===s.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${i.shape}.`);const o={x:s,weights:i},a={size:t,binaryOutput:r};return J.runKernel(EA,o,a)}const T3=te({denseBincount_:Xxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(n,e,t="NHWC"){const r=H(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];M(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),M(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),M(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),M(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:t};return J.runKernel(TA,a,l)}const Qxe=te({depthToSpace_:Yxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(n,e,t,r,s="NHWC",i=[1,1],o){const a=H(n,"x","depthwiseConv2d","float32"),l=H(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),M(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=s==="NHWC"?u.shape[3]:u.shape[1];M(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),zs("depthwiseConv2d",r,o);const d={x:u,filter:l},f={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},p=J.runKernel(m_,d,f);return c?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const uR=te({depthwiseConv2d_:Jxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zxe(n,e,t,r,s=[1,1],i="NHWC"){const o=H(n,"x","dilation2d"),a=H(e,"filter","dilation2d");M(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),M(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),M(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),M(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},h={strides:t,pad:r,dilations:s},d=J.runKernel(g_,c,h);return u?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const e0e=te({dilation2d_:Zxe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kf(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const i=t-1-s,o=n[i]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(i)}return r}function fr(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],i=e.length-r-1,o=e[i];(s==null||s===1&&o>1)&&t.unshift(i)}return t}function ct(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let i=n[n.length-s-1];i==null&&(i=1);let o=e[e.length-s-1];if(o==null&&(o=1),i===1)r[t-s-1]=o;else if(o===1)r[t-s-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else r[t-s-1]=i}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0e(n,e){let t=H(n,"a","equal","string_or_numeric"),r=H(e,"b","equal","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(v_,s)}const Na=te({equal_:t0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(n,e,t){const r=H(e,"a","where"),s=H(t,"b","where"),i=H(n,"condition","where","bool"),o=ct(ct(i.shape,r.shape),s.shape),a=ag(i,o),l=ag(r,o),u=ag(s,o),c={condition:a,t:l,e:u};return J.runKernel(q_,c)}const ks=te({where_:n0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0e(n){const t={x:H(n,"x","zerosLike")};return J.runKernel(tk,t)}const At=te({zerosLike_:r0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s0e(n,e){let t=H(n,"a","div"),r=H(e,"b","div");[t,r]=Hn(t,r);const s=Je(t,r),i=At(s),o=Na(r,i);return ks(o,i,s)}const i0e=te({divNoNan_:s0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(n,e){const t=H(n,"t1","dot"),r=H(e,"t2","dot");M((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(M(s===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${i}.`),t.rank===1&&r.rank===1){const o=ee(t,[1,-1]),a=ee(r,[-1,1]),l=Lt(o,a);return ee(l,[])}else if(t.rank===1&&r.rank===2){const o=ee(t,[1,-1]),a=ee(r,[r.shape[0],r.shape[1]]),l=Lt(o,a);return ee(l,[l.size])}else if(t.rank===2&&r.rank===1){const o=ee(r,[-1,1]),a=Lt(t,o);return ee(a,[a.size])}else{const o=ee(r,[r.shape[0],r.shape[1]]);return Lt(t,o)}}const a0e=te({dot_:o0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(n,...e){const t=e.map((s,i)=>H(s,`tensors${i}`,"einsum")),r={equation:n};return J.runKernel(RA,t,r)}const mm=te({einsum_:l0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(n){const t={x:H(n,"x","elu","float32")};return J.runKernel(Yv,t)}const lk=te({elu_:u0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0e(n){let e=H(n,"x","erf");M(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=De(e,"float32"));const t={x:e};return J.runKernel(Qv,t)}const K5=te({erf_:c0e});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cR(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function X5(n,e,t){const r=n.length+e.length,s=[];let i=0,o=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[i++]):s.push(e[o++]);return s}function Sr(n,e){const t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);const s=e.map(i=>n[i]);return[t,s]}function rr(n,e){const t=e.map(r=>1);return X5(n,t,e)}function Br(n,e,t){M(cR(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Tn(n,e){if(cR(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function fc(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Gn(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(n,e=null,t=!1){const s={x:H(n,"x","max")},i={reductionIndices:e,keepDims:t};return J.runKernel(N_,s,i)}const Do=te({max_:h0e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(n,e=null,t=!1){const s={x:H(n,"x","min")},i={axis:e,keepDims:t};return J.runKernel($_,s,i)}const bw=te({min_:d0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0e(n,e){let t=H(n,"base","pow"),r=H(e,"exp","pow");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(fy,s)}const Ph=te({pow_:f0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(n,e){if((ao(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ao(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return sk(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0e(n){const t={x:H(n,"x","sqrt","float32")};return J.runKernel(Iy,t)}const Zr=te({sqrt_:p0e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0e(n){const e=H(n,"x","square"),t={};return J.runKernel("Square",{x:e},t)}const hn=te({square_:m0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(n,e=null,t=!1){let r=H(n,"x","sum");r.dtype==="bool"&&(r=De(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return J.runKernel(X_,s,i)}const Ye=te({sum_:g0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(n,e="euclidean",t=null,r=!1){n=H(n,"x","norm");const s=Y5(n,e,t);let i=s.shape;if(r){const o=vt(t,n.shape);i=rr(s.shape,o)}return ee(s,i)}function Y5(n,e,t=null){if(n.rank===0)return ds(n);if(n.rank!==1&&t===null)return Y5(ee(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ye(ds(n),t);if(e===1/0)return Do(ds(n),t);if(e===-1/0)return bw(ds(n),t);if(e==="euclidean"||e===2)return Zr(Ye(Ph(ds(n),Vt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Do(Ye(ds(n),t[0]),t[1]-1);if(e===1/0)return Do(Ye(ds(n),t[1]),t[0]);if(e===-1/0)return bw(Ye(ds(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Zr(Ye(hn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const uk=te({norm_:v0e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0e(n,e=null,t=!1){return uk(n,"euclidean",e,t)}const x0e=te({euclideanNorm_:y0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0e(n){const t={x:H(n,"x","exp")};return J.runKernel(Jv,t)}const Aa=te({exp_:b0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e(n,e=0){const t=H(n,"x","expandDims","string_or_numeric");M(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return J.runKernel(y_,r,s)}const Ds=te({expandDims_:w0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _0e(n){const t={x:H(n,"x","expm1")};return J.runKernel(Zv,t)}const k0e=te({expm1_:_0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0e(n,e){const t=H(n,"x","tile","string_or_numeric");M(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return J.runKernel(Ay,r,s)}const Eo=te({tile_:C0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(n,e,t,r="float32"){e==null&&(e=n);const s=gt([n,e],r),i=n<=e?n:e;for(let a=0;a<i;++a)s.set(1,a,a);const o=ee(s.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Eo(Ds(o,0),[t[0],1,1]);if(t.length===2)return Eo(Ds(Ds(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Eo(Ds(Ds(Ds(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Q5=te({eye_:I0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(n){const t={x:H(n,"x","floor","float32")};return J.runKernel(ey,t)}const ck=te({floor_:S0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0e(n,e,t=0,r=0){const s=H(n,"x","gather"),i=H(e,"indices","gather","int32"),o={x:s,indices:i},a={axis:t,batchDims:r};return J.runKernel(b_,o,a)}const hR=te({gather_:E0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(n,e){let t=H(n,"a","greater","string_or_numeric"),r=H(e,"b","greater","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(w_,s)}const Ri=te({greater_:T0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0e(n,e){let t=H(n,"a","greaterEqual","string_or_numeric"),r=H(e,"b","greaterEqual","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(ny,s)}const ed=te({greaterEqual_:N0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0e(n){const t={input:H(n,"input","imag")};return J.runKernel(MA,t)}const dR=te({imag_:A0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0e(n){const t={x:H(n,"x","isFinite")};return J.runKernel(sy,t)}const D0e=te({isFinite_:R0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(n){const t={x:H(n,"x","isInf")};return J.runKernel(iy,t)}const P0e=te({isInf_:$0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O0e(n){const t={x:H(n,"x","isNaN")};return J.runKernel(oy,t)}const F0e=te({isNaN_:O0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(n,e=.2){const r={x:H(n,"x","leakyRelu")},s={alpha:e};return J.runKernel(__,r,s)}const fR=te({leakyRelu_:M0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(n,e){let t=H(n,"a","less","string_or_numeric"),r=H(e,"b","less","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(k_,s)}const ww=te({less_:L0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(n,e){let t=H(n,"a","lessEqual","string_or_numeric"),r=H(e,"b","lessEqual","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(C_,s)}const Sp=te({lessEqual_:B0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0e(n,e=5,t=1,r=1,s=.5){const i=H(n,"x","localResponseNormalization");M(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),M(Wf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:r,beta:s},c=J.runKernel(T_,l,u);return a?ee(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const z0e=te({localResponseNormalization_:V0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0e(n){const t={x:H(n,"x","log","float32")};return J.runKernel(ay,t)}const Ra=te({log_:U0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(n){const t={x:H(n,"x","log1p")};return J.runKernel(ly,t)}const J5=te({log1p_:j0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(n,e){M(FS(n),()=>"The f passed in variableGrads(f) must be a function"),M(e==null||Array.isArray(e)&&e.every(u=>u instanceof xw),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in J.registeredVariables)e.push(J.registeredVariables[u])}const r=t?e.filter(u=>!u.trainable):null,s=e.length;e=e.filter(u=>u.trainable),M(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const i=!0,{value:o,grads:a}=J.gradients(n,e,null,i);M(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),M(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),r!=null&&r.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Xf(n){return J.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0e(n){const t={x:H(n,"x","neg")};return J.runKernel(O_,t)}const Wn=te({neg_:H0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0e(n){const t={x:H(n,"x","softplus")};return J.runKernel(Cy,t)}const $y=te({softplus_:G0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0e(n){const e=H(n,"x","logSigmoid");return Xf(r=>({value:Wn($y(Wn(r))),gradFunc:o=>Y(o,Ip(Wn(r)))}))(e)}const K0e=te({logSigmoid_:q0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0e(n,e){let t=H(n,"a","sub"),r=H(e,"b","sub");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(Ey,s)}const et=te({sub_:X0e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(n,e=-1){const t=H(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Xf((s,i)=>{const a=Do(s,e,!0),l=et(s,a),u=et(De(l,"float32"),Ra(Ye(Aa(l),e,!0)));return i([u]),{value:u,gradFunc:(h,d)=>{const[f]=d,p=!0,m=Aa(f);return et(h,Y(Ye(h,e,p),m))}}})(t)}const Z5=te({logSoftmax_:Y0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0e(n,e=null,t=!1){const r=H(n,"x","logSumExp"),s=vt(e,r.shape),i=Do(r,s,!0),o=et(r,i),a=Aa(o),l=Ye(a,s),u=Ra(l),c=we(ee(i,u.shape),u);if(t){const h=rr(c.shape,s);return ee(c,h)}return c}const eH=te({logSumExp_:Q0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0e(n,e){const t=H(n,"a","logicalAnd","bool"),r=H(e,"b","logicalAnd","bool");ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(I_,s)}const kl=te({logicalAnd_:J0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(n){const t={x:H(n,"x","logicalNot","bool")};return J.runKernel(S_,t)}const pR=te({logicalNot_:Z0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ebe(n,e){const t=H(n,"a","logicalOr","bool"),r=H(e,"b","logicalOr","bool");ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(E_,s)}const tH=te({logicalOr_:ebe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tbe(n,e){const t=H(n,"a","logicalXor","bool"),r=H(e,"b","logicalXor","bool");return ct(t.shape,r.shape),kl(tH(n,e),pR(kl(n,e)))}const nbe=te({logicalXor_:tbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbe(n,e,t,r,s){const i=H(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),M(es(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),zs("maxPool",r,s);const u={x:a},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s},h=J.runKernel(A_,u,c);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const mR=te({maxPool_:rbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sbe(n,e=[1,1,1],t,r,s,i="NDHWC"){const o=H(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),M(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),zs("maxPool3d",r,s);const u={x:a},c={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i},h=J.runKernel(R_,u,c);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const ibe=te({maxPool3d_:sbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function obe(n,e){let t=H(n,"a","maximum"),r=H(e,"b","maximum");[t,r]=Hn(t,r),t.dtype==="bool"&&(t=De(t,"int32"),r=De(r,"int32")),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(uy,s)}const pc=te({maximum_:obe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function abe(n,e=null,t=!1){const s={x:H(n,"x","mean")},i={axis:e,keepDims:t};return J.runKernel(D_,s,i)}const Zn=te({mean_:abe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yr(n,e="float32"){if(Fl(n),e==="complex64"){const r=yr(n,"float32"),s=yr(n,"float32");return qf(r,s)}const t=Jr(fe(n),e);return J.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mc(n,e="float32"){if(Fl(n),e==="complex64"){const r=mc(n,"float32"),s=yr(n,"float32");return qf(r,s)}const t=hA(fe(n),e);return J.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lbe(n,e){let t=H(n,"a","minimum"),r=H(e,"b","minimum");[t,r]=Hn(t,r),t.dtype==="bool"&&(t=De(t,"int32"),r=De(r,"int32")),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(cy,s)}const Qg=te({minimum_:lbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ube(n,e,t){M(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=H(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");M(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let a=0;a<r.rank;a++)M(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),M(e[a][0]>=0&&e[a][0]<=r.shape[a]-s&&e[a][1]>=0&&e[a][1]<=r.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-s} or less than 0 for input of shape ${r.shape}`);const i={paddings:e,mode:t},o={x:r};return J.runKernel(P_,o,i)}const cbe=te({mirrorPad_:ube});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbe(n,e){let t=H(n,"a","mod"),r=H(e,"b","mod");[t,r]=Hn(t,r);const s={a:t,b:r};return J.runKernel(hy,s)}const dbe=te({mod_:hbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fbe(n,e=null,t=!1){n=H(n,"x","moments");const r=vt(e,n.shape),s=Zn(n,r,t);let i=s.shape;t||(i=rr(s.shape,r));const o=hn(et(De(n,"float32"),ee(s,i))),a=Zn(o,r,t);return{mean:s,variance:a}}const gR=te({moments_:fbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pbe(n,e){let t=H(n,"a","notEqual","string_or_numeric"),r=H(e,"b","notEqual","string_or_numeric");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r};return J.runKernel(F_,s)}const _w=te({notEqual_:pbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:H(n,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:t,offValue:r};return J.runKernel(L_,o,a)}const nH=te({oneHot_:mbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gbe(n){const t={x:H(n,"x","onesLike")};return J.runKernel(M_,t)}const lo=te({onesLike_:gbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(n,e,t=0){const r=H(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},i={x:r};return J.runKernel(V_,i,s)}const vR=te({pad_:vbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ybe(n,e,t){const r=H(n,"x","spaceToBatchND");M(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),M(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),M(r.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},i={blockShape:e,paddings:t};return J.runKernel(Y_,s,i)}const yR=te({spaceToBatchND_:ybe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xbe(n,e,t,r,s,i,o){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");const a=H(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(es(i,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`);const c=uo(l.shape,e,i,s,r),h=[c.dilationHeight,c.dilationWidth];let d;r==="same"?d=wbe([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[p,m]=bbe([c.inHeight,c.inWidth],h,d),g=f?r:"valid",v=f?l:yR(l,h,p),x=(t==="avg"?()=>iR(v,e,i,g,o):()=>mR(v,e,i,g,o))(),b=f?x:oR(x,h,m);return u?ee(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function bbe(n,e,t){const r=t.map(c=>c[0]),s=t.map(c=>c[1]),i=n.concat(r,s),o=e.map((c,h)=>(c-i[h]%c)%c),a=s.map((c,h)=>c+o[h]),l=e.map((c,h)=>[r[h],a[h]]),u=e.map((c,h)=>[0,o[h]]);return[l,u]}function wbe(n,e){const r=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),s=r.map(o=>Math.floor(o/2)),i=r.map((o,a)=>o-s[a]);return r.map((o,a)=>[s[a],i[a]])}const _be=te({pool_:xbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(n,e){const t=H(n,"x","prelu"),r=H(e,"alpha","prelu"),s={x:t,alpha:r};return J.runKernel(z_,s)}const xR=te({prelu_:kbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(n,e=null,t=!1){let r=H(n,"x","prod");r.dtype==="bool"&&(r=De(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return J.runKernel(U_,s,i)}const Ibe=te({prod_:Cbe});var bR={exports:{}};bR.exports;(function(n){(function(e,t,r){function s(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new s(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(jh,n)})(bR);var Sbe=bR.exports,wR={exports:{}};wR.exports;(function(n){(function(e,t,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xor128=o})(jh,n)})(wR);var Ebe=wR.exports,_R={exports:{}};_R.exports;(function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xorwow=o})(jh,n)})(_R);var Tbe=_R.exports,kR={exports:{}};kR.exports;(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xorshift7=o})(jh,n)})(kR);var Nbe=kR.exports,CR={exports:{}};CR.exports;(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,g,v=[],y=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,y=Math.max(y,h.length)),p=0,m=-32;m<y;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=v[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(v[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=v[p+34&127],d=v[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,v[p]=f^d;c.w=g,c.X=v,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xor4096=o})(jh,n)})(CR);var Abe=CR.exports,IR={exports:{}};IR.exports;(function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.tychei=o})(jh,n)})(IR);var Rbe=IR.exports,rH={exports:{}};const Dbe={},$be=Object.freeze(Object.defineProperty({__proto__:null,default:Dbe},Symbol.toStringTag,{value:"Module"})),Pbe=iQ($be);(function(n){(function(e,t,r){var s=256,i=6,o=52,a="random",l=r.pow(s,i),u=r.pow(2,o),c=u*2,h=s-1,d;function f(b,_,E){var I=[];_=_==!0?{entropy:!0}:_||{};var C=v(g(_.entropy?[b,x(t)]:b??y(),3),I),S=new p(I),T=function(){for(var N=S.g(i),R=l,D=0;N<u;)N=(N+D)*s,R*=s,D=S.g(1);for(;N>=c;)N/=2,R/=2,D>>>=1;return(N+D)/R};return T.int32=function(){return S.g(4)|0},T.quick=function(){return S.g(4)/4294967296},T.double=T,v(x(S.S),t),(_.pass||E||function(N,R,D,z){return z&&(z.S&&m(z,S),N.state=function(){return m(S,{})}),D?(r[a]=N,R):N})(T,C,"global"in _?_.global:this==r,_.state)}function p(b){var _,E=b.length,I=this,C=0,S=I.i=I.j=0,T=I.S=[];for(E||(b=[E++]);C<s;)T[C]=C++;for(C=0;C<s;C++)T[C]=T[S=h&S+b[C%E]+(_=T[C])],T[S]=_;(I.g=function(N){for(var R,D=0,z=I.i,L=I.j,O=I.S;N--;)R=O[z=h&z+1],D=D*s+O[h&(O[z]=O[L=h&L+R])+(O[L]=R)];return I.i=z,I.j=L,D})(s)}function m(b,_){return _.i=b.i,_.j=b.j,_.S=b.S.slice(),_}function g(b,_){var E=[],I=typeof b,C;if(_&&I=="object")for(C in b)try{E.push(g(b[C],_-1))}catch{}return E.length?E:I=="string"?b:b+"\0"}function v(b,_){for(var E=b+"",I,C=0;C<E.length;)_[h&C]=h&(I^=_[h&C]*19)+E.charCodeAt(C++);return x(_)}function y(){try{var b;return d&&(b=d.randomBytes)?b=b(s):(b=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(b)),x(b)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,x(t)]}}function x(b){return String.fromCharCode.apply(0,b)}if(v(r.random(),t),n.exports){n.exports=f;try{d=Pbe}catch{}}else r["seed"+a]=f})(typeof self<"u"?self:jh,[],Math)})(rH);var Obe=rH.exports,Fbe=Sbe,Mbe=Ebe,Lbe=Tbe,Bbe=Nbe,Vbe=Abe,zbe=Rbe,td=Obe;td.alea=Fbe;td.xor128=Mbe;td.xorwow=Lbe;td.xorshift7=Bbe;td.xor4096=Vbe;td.tychei=zbe;var SR=td;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sH{constructor(e,t,r,s,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=SR.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,i,o;do s=2*this.random()-1,i=2*this.random()-1,o=s*s+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*s*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Ube{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=SR.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jbe(n,e=0,t=1,r,s){if(Fl(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const i=new sH(e,t,r,!1,s),o=gt(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Wbe=te({randomNormal_:jbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hbe(n,e=0,t=1,r="float32",s){Fl(n);const i=gt(n,r),o=new Ube(e,t,null,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Py=te({randomUniform_:Hbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jg(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return J.runKernel(WA,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gbe(n){const t={input:H(n,"input","real")};return J.runKernel(HA,t)}const kw=te({real_:Gbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qbe(n){const t={x:H(n,"x","reciprocal")};return J.runKernel(py,t)}const Kbe=te({reciprocal_:qbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(n){const t={x:H(n,"x","relu")};return J.runKernel(my,t)}const nd=te({relu_:Xbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ybe(n){const t={x:H(n,"x","relu6")};return J.runKernel(gy,t)}const iH=te({relu6_:Ybe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qbe(n,e){const r={x:H(n,"x","reverse")},s={dims:e};return J.runKernel(G_,r,s)}const Oh=te({reverse_:Qbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jbe(n){const t={x:H(n,"x","round")};return J.runKernel(vy,t)}const oH=te({round_:Jbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zbe(n){const t={x:H(n,"x","rsqrt","float32")};return J.runKernel(yy,t)}const aH=te({rsqrt_:Zbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ewe(n){const t={x:H(n,"x","selu")};return J.runKernel(xy,t)}const lH=te({selu_:ewe});function twe(n,e,t,r,s,i=[1,1],o="NHWC"){const a=H(n,"x","separableConv2d"),l=H(e,"depthwiseFilter","separableConv2d"),u=H(t,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");M(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),M(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),M(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),M(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const d=l.shape[2],f=l.shape[3];M(u.shape[2]===d*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*f}, but got ${u.shape[2]}.`);const p=uR(c,l,r,s,o,i),g=$h(p,u,1,"valid",o);return h?ee(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const uH=te({separableConv2d_:twe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nwe(n){const t={x:H(n,"x","sign")};return J.runKernel(_y,t)}const rwe=te({sign_:nwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function swe(n){const t={x:H(n,"x","sin","float32")};return J.runKernel(by,t)}const cH=te({sin_:swe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iwe(n){const t={x:H(n,"x","sinh")};return J.runKernel(wy,t)}const hH=te({sinh_:iwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function owe(n,e,t){const r=H(n,"x","slice1d");return M(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),on(r,[e],[t])}const ER=te({slice1d_:owe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function awe(n,e,t){const r=H(n,"x","slice2d");return M(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),on(r,e,t)}const dH=te({slice2d_:awe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lwe(n,e,t){const r=H(n,"x","slice3d");return M(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),on(r,e,t)}const TR=te({slice3d_:lwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uwe(n,e,t){const r=H(n,"x","slice4d");return M(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),on(r,e,t)}const Cw=te({slice4d_:uwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cwe(n,e=-1){const t=H(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return J.runKernel(J_,r,s)}const NR=te({softmax_:cwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hwe(n){M(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return J.runKernel($A,e)}const fH=te({fft_:hwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dwe(n){M(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return J.runKernel(FA,e)}const ZS=te({ifft_:dwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fwe(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=ee(n,[t,e]);r=ZS(s)}else{const s=[t,2*(e-1)],i=ee(kw(n),[t,e]),o=ee(dR(n),[t,e]),a=Oh(on(i,[0,1],[t,e-2]),1),l=Y(Oh(on(o,[0,1],[t,e-2]),1),Vt(-1)),u=Fs([i,a],1),c=Fs([o,l],1),h=ee(qf(u,c),[s[0],s[1]]);r=ZS(h)}if(r=kw(r),n.rank===3&&n.shape[0]!==0){const s=r,i=n.shape[0];r=ee(r,[i,r.shape[0]/i,r.shape[1]]),s.dispose()}return r}const pwe=te({irfft_:fwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwe(n,e,t=0){const s={x:H(n,"x","split")},i={numOrSizeSplits:e,axis:t};return J.runKernel(Q_,s,i)}const ki=te({split_:mwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gwe(n,e){M(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const p=n.shape.map(g=>0),m=n.shape.map(g=>g);m[n.shape.length-1]=e,s=on(n,p,m),t=e}else if(e!=null&&e>t){const p=n.shape.map(m=>m);p[n.shape.length-1]=e-t,s=Fs([n,yr(p)],n.shape.length-1),t=e}else s=n;const i=At(s),o=ee(qf(s,i),[r,t]),a=fH(o),l=Math.floor(t/2)+1,u=kw(a),c=dR(a),h=ki(u,[l,t-l],u.shape.length-1),d=ki(c,[l,t-l],c.shape.length-1),f=s.shape.slice();return f[s.shape.length-1]=l,ee(qf(h[0],d[0]),f)}const vwe=te({rfft_:gwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe(n,e){let t=H(n,"a","squaredDifference"),r=H(e,"b","squaredDifference");[t,r]=Hn(t,r),ct(t.shape,r.shape);const s={a:t,b:r},i={};return J.runKernel(Sy,s,i)}const xwe=te({squaredDifference_:ywe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bwe(n,e){const t=H(n,"x","squeeze","string_or_numeric");return ee(t,cc(t.shape,e).newShape)}const Oy=te({squeeze_:bwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwe(n,e=0){const t=R5(n,"tensors","stack","string_or_numeric");M(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&M(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return J.runKernel(B_,r,s)}const Cl=te({stack_:wwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(n,e=0){const r={x:H(n,"x","step")},s={alpha:e};return J.runKernel(Ry,r,s)}const Fy=te({step_:_we});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kwe(n,e,t,r,s=0,i=0,o=0,a=0,l=0){const c={x:H(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:r,beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return J.runKernel(YA,c,h)}const Cwe=te({stridedSlice_:kwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iwe(n){const t={x:H(n,"x","tan","float32")};return J.runKernel(Ty,t)}const Swe=te({tan_:Iwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(n,e){M6(n);const t=rk(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return sk(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2(n,e,t){if(M6(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=rk(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return sk(n,e,r,t)}function pH(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(i+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(i+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(i+` update.rank != ${s+n.length-r}`);for(let o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(i+` updates.shape[${o+s}] (${t.shape[o+s]}) != shape[${o+s}] (${n[o+s]})`)}function Ewe(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}pH(t,e,n)}function rd(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,i=t.length;let o=1;for(let h=s;h<i;++h)o*=t[h];const a=s<1?1:s,l=fe(e.shape)/a,u=[...Ke(t.slice(0,s)),1],c=fe(t);return{sliceRank:s,numUpdates:l,sliceSize:o,strides:u,outputSize:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Twe(n,e=1,t=!0){const r=H(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const i={x:r},o={k:e,sorted:t},[a,l]=J.runKernel(QA,i,o);return{values:a,indices:l}}const Nwe=te({topk_:Twe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Awe(n,e=0,t=1,r,s){if(Fl(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new sH(e,t,r,!0,s),o=gt(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const mH=te({truncatedNormal_:Awe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rwe(n,e=0){const t=H(n,"x","unique","string_or_numeric");M(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[i,o]=J.runKernel(ZA,r,s);return{values:i,indices:o}}const Dwe=te({unique_:Rwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $we(n,e,t){const r=H(n,"x","unsortedSegmentSum"),s=H(e,"segmentIds","unsortedSegmentSum","int32");M(Wf(t),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:s},o={numSegments:t};return J.runKernel(ek,i,o)}const gH=te({unsortedSegmentSum_:$we});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pwe(n,e=0){const t=H(n,"x","unstack","string_or_numeric");M(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return J.runKernel(Z_,r,s)}const Fh=te({unstack_:Pwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(n,e=!0,t,r){return J.makeVariable(n,e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vH(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const r=gt(n,"int32"),s=gt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=r.indexToLoc(t[i]),a=i*n.length;s.values.set(o,a)}return s.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fwe(n,e,t){const r=H(n,"x","transpose");if(e==null&&(e=r.shape.map((o,a)=>a).reverse()),M(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{M(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},i={perm:e};return r.dtype==="complex64"?se(()=>{let o=kw(r),a=dR(r);return o=J.runKernel(hf,{x:o},i),a=J.runKernel(hf,{x:a},i),t&&(a=Wn(a)),qf(o,a)}):J.runKernel(hf,s,i)}const Nt=te({transpose_:Fwe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mwe(n,e){if(e==null)return n.shape.slice();if(Ut(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lwe(n,e,t,r){const s=H(n,"x","dropout");if(M(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),M(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof ir?s.clone():s;const i=Mwe(s,t),o=1-e,a=Je(ck(we(Py(i,0,1,"float32",r),o)),o);return Y(s,a)}const Bwe=te({dropout_:Lwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vwe(n,e,t,r,s,i="NHWC",o){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),M(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),M(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),M(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];M(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),M(c===t[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${t[3]}).`),zs("conv2dDerFilter",s,o);const h={x:a,dy:l},d={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,filterShape:t};return J.runKernel(_A,h,d)}const AR=te({conv2DBackpropFilter_:Vwe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RR(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Y(n,Fy(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function DR(n,e){let t=e;const r=fr(n.shape,e.shape);return r.length>0&&(t=Ye(t,r)),ee(t,n.shape)}function $R(n,e,t,r){if(e==="linear")return n;if(e==="relu")return nd(n);if(e==="elu")return lk(n);if(e==="relu6")return iH(n);if(e==="prelu")return xR(n,t);if(e==="leakyrelu")return fR(n,r);if(e==="sigmoid")return Ip(n);throw new Error(`Unknown fused activation ${e}.`)}const PR=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zwe({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",PR(J.state.gradientDepth,l)===!1){M(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let E=$h(n,e,t,r,s,i,o);return a!=null&&(E=we(E,a)),$R(E,l,u,c)}const h=H(n,"x","conv2d","float32"),d=H(e,"filter","conv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=ee(h,[1,h.shape[0],h.shape[1],h.shape[2]])),M(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),M(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),zs("fused conv2d",r,o);const m=s==="NHWC"?f.shape[3]:f.shape[1];M(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),M(es(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const g=Lr(f.shape,d.shape,t,i,r,o);let v;a!=null&&(v=H(a,"bias","fused conv2d"),[v]=Hn(v,h),s==="NHWC"?ct(g.outShape,v.shape):(M(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),M(v.shape.length===0||v.shape[0]===g.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let y;if(u!=null){const E=u.shape;if(M(E.length<=1||E.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${E.length}.`),E.length===1)M(E[0]===1||E[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the number of output channels (${g.outChannels}).`);else if(E.length===3)try{ct(E,g.outShape)}catch{const C=`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(C)}y=H(u,"prelu weights","fused conv2d")}const x=(E,I)=>{M(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[C,S,T,N]=I,R=RR(E,T,l);M(Rh(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const D=aR(S.shape,R,C,t,r),z=AR(S,R,C.shape,t,r),L=[D,z];if(N!=null){const O=DR(N,R);L.push(O)}return L},b={x:f,filter:d,bias:v,preluActivationWeights:y},_={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Xf((I,C,S)=>{let T=J.runKernel(gw,b,_);return S([C,I,T]),p&&(T=ee(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:x}})(f,d):Xf((I,C,S,T)=>{let N=J.runKernel(gw,b,_);return T([C,I,N,S]),p&&(N=ee(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:x}})(f,d,v)}const Uwe=te({fusedConv2d_:zwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jwe(n,e,t,r,s,i=[1,1],o){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:r,pad:s,dimRoundingMode:o,dilations:i,filterShape:t};return J.runKernel(NA,u,c)}const Wwe=te({depthwiseConv2dNativeBackpropFilter_:jwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(n,e,t,r,s,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},c={strides:r,pad:s,dimRoundingMode:o,dilations:i,inputShape:n},h=J.runKernel(AA,u,c);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Gwe=te({depthwiseConv2dNativeBackpropInput_:Hwe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qwe({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(PR(J.state.gradientDepth,i)===!1){let N=Lt(n,e,t,r);return s!=null&&(N=we(N,s)),$R(N,i,o,a)}let l=H(n,"a","fused matMul"),u=H(e,"b","fused matMul");[l,u]=Hn(l,u);const c=t?l.shape[l.rank-2]:l.shape[l.rank-1],h=r?u.shape[u.rank-1]:u.shape[u.rank-2],d=t?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=fe(p),v=fe(m);M(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${r} must match.`);const x=ct(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([d,f]),b=t?ee(l,[g,c,d]):ee(l,[g,d,c]),_=r?ee(u,[v,f,h]):ee(u,[v,h,f]);let E;s!=null&&(E=H(s,"bias","fused matMul"),[E]=Hn(E,l),ct(x,E.shape));let I;o!=null&&(I=H(o,"prelu weights","fused matMul"));const C=(N,R)=>{const[D,z,L,O]=R,F=RR(ee(N,L.shape),L,i);let P,U;if(!t&&!r?(P=Lt(F,z,!1,!0),U=Lt(D,F,!0,!1)):!t&&r?(P=Lt(F,z,!1,!1),U=Lt(F,D,!0,!1)):t&&!r?(P=Lt(z,F,!1,!0),U=Lt(D,F,!1,!1)):(P=Lt(z,F,!0,!0),U=Lt(F,D,!0,!0)),s!=null){const W=DR(O,F);return[P,U,W]}else return[P,U]},S={a:b,b:_,bias:E,preluActivationWeights:I},T={transposeA:t,transposeB:r,activation:i,leakyreluAlpha:a};return s==null?Xf((R,D,z)=>{const L=J.runKernel(mw,S,T);return z([R,D,L]),{value:ee(L,x),gradFunc:C}})(b,_):Xf((R,D,z,L)=>{const O=J.runKernel(mw,S,T);return L([R,D,O,z]),{value:ee(O,x),gradFunc:C}})(b,_,E)}const N3=te({fusedMatMul_:qwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kwe(n,e,t,r,s="bilinear",i=0){const o=H(n,"image","cropAndResize"),a=H(e,"boxes","cropAndResize","float32"),l=H(t,"boxInd","cropAndResize","int32"),u=a.shape[0];M(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),M(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),M(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),M(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),M(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),M(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const c={image:o,boxes:a,boxInd:l},h={method:s,extrapolationValue:i,cropSize:r};return J.runKernel(SA,c,h)}const Xwe=te({cropAndResize_:Kwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ywe(n){const e=H(n,"image","flipLeftRight","float32");M(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return J.runKernel(OA,t,{})}const Qwe=te({flipLeftRight_:Ywe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jwe(n){const e=H(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];M(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),M(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,Eo(e,s)}const Zwe=te({grayscaleToRGB_:Jwe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1e(n){const e=H(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];M(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),M(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,i=De(e,"float32"),o=Js([.2989,.587,.114]);let a;switch(e.rank){case 2:a=mm("ij,j->i",i,o);break;case 3:a=mm("ijk,k->ij",i,o);break;case 4:a=mm("ijkl,l->ijk",i,o);break;case 5:a=mm("ijklm,m->ijkl",i,o);break;case 6:a=mm("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Ds(a,-1),De(a,s)}const t1e=te({rgbToGrayscale_:e1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n1e(n,e,t=0,r=.5){const s=H(n,"image","rotateWithOffset","float32");M(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const i={image:s},o={radians:e,fillValue:t,center:r};return J.runKernel(eR,i,o)}const r1e=te({rotateWithOffset_:n1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ep(n,e,t,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),M(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),M(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),M(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),M(e.rank===1,()=>"scores must be a 1D tensor"),M(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),M(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppression","float32"),o=H(e,"scores","nonMaxSuppression","float32"),a=Ep(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return J.runKernel(zA,{boxes:i,scores:o},l)}const i1e=te({nonMaxSuppression_:s1e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o1e(n,e,t){const r=a1e(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function a1e(n,e,t){return u1e(n,e,t||l1e)}function l1e(n,e){return n>e?1:n<e?-1:0}function u1e(n,e,t){let r=0,s=n.length,i=0,o=!1;for(;r<s;){i=r+(s-r>>>1);const a=t(e,n[i]);a>0?r=i+1:(s=i,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n,e,t,r,s){return LR(n,e,t,r,s,0)}function FR(n,e,t,r,s,i){return LR(n,e,t,r,s,0,!1,i,!0)}function MR(n,e,t,r,s,i){return LR(n,e,t,r,s,i,!0)}function LR(n,e,t,r,s,i,o=!1,a=!1,l=!1){const u=[];for(let g=0;g<e.length;g++)e[g]>s&&u.push({score:e[g],boxIndex:g,suppressBeginIndex:0});u.sort(A3);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<t&&u.length>0;){const g=u.pop(),{score:v,boxIndex:y,suppressBeginIndex:x}=g;if(v<s)break;let b=!1;for(let _=h.length-1;_>=x;--_){const E=c1e(n,y,h[_]);if(E>=r){b=!0;break}if(g.score=g.score*h1e(r,c,E),g.score<=s)break}g.suppressBeginIndex=h.length,b||(g.score===v?(h.push(y),d.push(g.score)):g.score>s&&o1e(u,g,A3))}const f=h.length,p=t-f;a&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=f),m}function c1e(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),h=Math.max(s[0],s[2]),d=Math.max(s[1],s[3]),f=(a-i)*(l-o),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;const m=Math.max(i,u),g=Math.max(o,c),v=Math.min(a,h),y=Math.min(l,d),x=Math.max(v-m,0)*Math.max(y-g,0);return x/(f+p-x)}function h1e(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function A3(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function d1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppressionAsync"),o=H(e,"scores","nonMaxSuppressionAsync"),a=Ep(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:h}=OR(u,c,t,r,s);return i!==n&&i.dispose(),o!==e&&o.dispose(),Js(h,"int32")}const f1e=d1e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=Ep(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},c={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i},h=J.runKernel(jA,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const m1e=te({nonMaxSuppressionWithScore_:p1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function g1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=Ep(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:f}=MR(c,h,t,r,s,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Js(d,"int32"),selectedScores:Js(f)}}const v1e=g1e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=Ep(o,a,t,r,s,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,d={boxes:o,scores:a},f={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},p=J.runKernel(UA,d,f);return{selectedIndices:p[0],validOutputs:p[1]}}const x1e=te({nonMaxSuppressionPadded_:y1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function b1e(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=Ep(o,a,t,r,s,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,f]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=FR(d,f,u,c,h,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Js(p,"int32"),validOutputs:Vt(m,"int32")}}const w1e=b1e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1e(n,e,t=!1,r=!1){const s=H(n,"images","resizeBilinear");M(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),M(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),M(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},u=J.runKernel(H_,a,l);return o?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const yH=te({resizeBilinear_:_1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1e(n,e,t=!1,r=!1){const s=H(n,"images","resizeNearestNeighbor");M(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),M(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),M(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),M(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},u=J.runKernel(W_,a,l);return o?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const xH=te({resizeNearestNeighbor_:k1e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1e(n,e="binary",t=!1,r=.5){const s=H(n,"image","threshold"),i=.2989,o=.587,a=.114,l=s.shape[0]*s.shape[1];let u=Y(Js([r]),255),c,h,d,f;if(M(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),M(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),M(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),M(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[c,h,d]=ki(s,[1,1,1],-1);const g=Y(c,i),v=Y(h,o),y=Y(d,a);f=we(we(g,v),y)}else f=n;if(e==="otsu"){const g=kxe(De(oH(f),"int32"),D5([]),256);u=I1e(g,l)}const p=t?Sp(f,u):Ri(f,u);return De(Y(p,255),"int32")}function I1e(n,e){let t=Js([-1]),r=Js([0]),s=Js([0]),i,o,a,l,u,c;for(let h=0;h<n.size-1;h++){i=on(n,0,h+1),o=on(n,h+1),u=Je(Ye(i),e),c=Je(Ye(o),e);const d=Ye(Y(i,Jg(0,i.size)));a=Je(d,Ye(i));const f=ak(o.shape,i.size),p=we(Jg(0,o.size),f),m=Y(o,p);l=Je(Ye(m),Ye(o));const g=et(a,l),v=et(a,l),y=Y(u,c);s=Y(Y(y,g),v);const x=Ri(s,r);r=ks(x,s,r),t=ks(x,Js([h]),t)}return t}const S1e=te({threshold_:C1e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(n,e,t="nearest",r="constant",s=0,i){const o=H(n,"image","transform","float32"),a=H(e,"transforms","transform","float32");M(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),M(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),M(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:r,fillValue:s,outputShape:i};return J.runKernel(JA,l,u)}const T1e=te({transform_:E1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(n,e,t){const r=H(n,"a","bandPart");M(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[i,o]=r.shape.slice(-2);let a,l;typeof e=="number"?(M(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),M(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=H(e<0?i:e,"numLower","bandPart")):(M(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ks(ww(e,0),i,Qg(e,i))),typeof t=="number"?(M(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),M(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=H(t<0?o:t,"numUpper","bandPart")):(M(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ks(ww(t,0),o,Qg(t,o)));const u=ee(Jg(0,i,1,"int32"),[-1,1]),c=Jg(0,o,1,"int32"),h=et(u,c),d=kl(Sp(h,a),ed(h,Wn(l))),f=yr([i,o],r.dtype);return ee(Cl(Fh(ee(r,[-1,i,o])).map(p=>ks(d,p,f))),s)}const A1e=te({bandPart_:N1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1e(n){let e;if(Array.isArray(n)){e=!1,M(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let i=1;i<n.length;++i)M(n[i].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${s})`)}else e=!0,n=ki(n,n.shape[0],0).map(s=>Oy(s,[0]));M(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(J.tidy(()=>{let i=r[s];if(s>0)for(let o=0;o<s;++o){const a=Y(Ye(Y(t[o],i)),t[o]);i=et(i,a)}return Je(i,uk(i,"euclidean"))}));return e?Cl(t,0):t}const D1e=te({gramSchmidt_:R1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1e(n,e=!1){if(M(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return R3(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),r=Fh(ee(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],i=[];r.forEach(l=>{const[u,c]=R3(l,e);s.push(u),i.push(c)});const o=ee(Cl(s,0),n.shape),a=ee(Cl(i,0),n.shape);return[o,a]}}function R3(n,e=!1){return J.tidy(()=>{M(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=Q5(t),i=ch(n);const o=f2([[1]],[1,1]);let a=ch(o);const l=t>=r?r:t;for(let u=0;u<l;++u){const c=i,h=a,d=s;[a,i,s]=J.tidy(()=>{const f=on(i,[u,u],[t-u,1]),p=uk(f),m=on(i,[u,u],[1,1]),g=ks(Ri(m,0),f2([[-1]]),f2([[1]])),v=et(m,Y(g,p)),y=Je(f,v);y.shape[0]===1?a=ch(o):a=Fs([o,on(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);const x=Wn(Je(Lt(g,v),p)),b=on(i,[u,0],[t-u,r]),_=Y(x,a),E=Nt(a);if(u===0)i=et(b,Lt(_,Lt(E,b)));else{const S=et(b,Lt(_,Lt(E,b)));i=Fs([on(i,[0,0],[u,r]),S],0)}const I=Nt(_),C=on(s,[0,u],[t,s.shape[1]-u]);if(u===0)s=et(C,Lt(Lt(C,a),I));else{const S=et(C,Lt(Lt(C,a),I));s=Fs([on(s,[0,0],[t,u]),S],1)}return[a,i,s]}),wt([c,h,d])}return!e&&t>r&&(s=on(s,[0,0],[t,r]),i=on(i,[0,0],[r,r])),[s,i]})}const P1e=te({qr_:$1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const il={flipLeftRight:Qwe,grayscaleToRGB:Zwe,resizeNearestNeighbor:xH,resizeBilinear:yH,rgbToGrayscale:t1e,rotateWithOffset:r1e,cropAndResize:Xwe,nonMaxSuppression:i1e,nonMaxSuppressionAsync:f1e,nonMaxSuppressionWithScore:m1e,nonMaxSuppressionWithScoreAsync:v1e,nonMaxSuppressionPadded:x1e,nonMaxSuppressionPaddedAsync:w1e,threshold:S1e,transform:T1e},O1e={bandPart:A1e,gramSchmidt:D1e,qr:P1e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F1e=new Map,M1e=new Map;class Tp{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Hi{constructor(){this.classNameMap={}}static getMap(){return Hi.instance==null&&(Hi.instance=new Hi),Hi.instance}static register(e){Hi.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function xe(n,e,t){M(n.className!=null,()=>"Class being registered does not have the static className property defined."),M(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),M(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return Hi.register(n),F1e.set(s,n),M1e.set(n,s),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gc extends Tp{minimize(e,t=!1,r){const{value:s,grads:i}=this.computeGradients(e,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return wt(i),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return W0e(e,t)}dispose(){this.iterations_!=null&&wt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Vt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(gc,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bH extends gc{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=J.registeredVariables[r],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:se(()=>At(i).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:se(()=>At(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[s].variable,u=this.accumulatedUpdates[s].variable;se(()=>{const c=we(Y(l,this.rho),Y(hn(a),1-this.rho)),h=Y(Je(Zr(we(u,this.epsilon)),Zr(we(l,this.epsilon))),a),d=we(Y(u,this.rho),Y(hn(h),1-this.rho));l.assign(c),u.assign(d);const f=we(Y(h,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(wt(this.accumulatedGrads.map(e=>e.variable)),wt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wH extends gc{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=J.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:se(()=>ak(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const a=this.accumulatedGrads[s].variable;se(()=>{const l=we(a,hn(o));a.assign(l);const u=we(Y(Je(o,Zr(we(l,J.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&wt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _H extends gc{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],se(()=>{this.accBeta1=Vt(t).variable(),this.accBeta2=Vt(r).variable()}),s==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);se(()=>{const r=et(1,this.accBeta1),s=et(1,this.accBeta2);t.forEach((i,o)=>{const a=J.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:se(()=>At(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:se(()=>At(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=we(Y(c,this.beta1),Y(u,1-this.beta1)),f=we(Y(h,this.beta2),Y(hn(u),1-this.beta2)),p=Je(d,r),m=Je(f,s);c.assign(d),h.assign(f);const g=we(Y(Je(p,we(Zr(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(Y(this.accBeta1,this.beta1)),this.accBeta2.assign(Y(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&wt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),se(()=>{this.accBeta1.assign(Ph(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ph(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kH extends gc{static get className(){return"Adamax"}constructor(e,t,r,s=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],se(()=>{this.iteration=Vt(0).variable(),this.accBeta1=Vt(t).variable()}),s==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);se(()=>{const r=et(1,this.accBeta1),s=Je(-this.learningRate,we(Y(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=J.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:At(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:At(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=we(Y(c,this.beta1),Y(u,1-this.beta1)),f=Y(h,this.beta2),p=ds(u),m=pc(f,p);c.assign(d),h.assign(m);const g=we(Y(Je(s,r),Je(d,we(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(we(this.iteration,1)),this.accBeta1.assign(Y(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&wt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BR extends gc{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const o=J.registeredVariables[r];se(()=>{const a=we(Y(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ya(Vt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CH extends BR{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=Vt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=J.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:se(()=>At(i).variable(!1))});const o=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[r];a!=null&&se(()=>{let l;const u=we(Y(this.m,o),a);this.useNesterov?l=we(Y(this.c,we(a,Y(u,this.m))),i):l=we(Y(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&wt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IH extends gc{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=J.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=J.registeredVariables[r],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:se(()=>At(i).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:se(()=>At(i).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:se(()=>At(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,u=this.accumulatedMoments[s].variable;se(()=>{const c=we(Y(l,this.decay),Y(hn(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[s].variable,d=we(Y(h,this.decay),Y(a,1-this.decay)),f=Je(Y(a,this.learningRate),Zr(et(c,we(hn(d),this.epsilon)))),p=we(Y(u,this.momentum),f);l.assign(c),h.assign(d),u.assign(p);const m=et(i,p);i.assign(m)}else{const h=we(Y(l,this.decay),Y(hn(a),1-this.decay)),d=we(Y(u,this.momentum),Je(Y(a,this.learningRate),Zr(we(h,this.epsilon))));l.assign(h),u.assign(d);const f=et(i,d);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&wt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&wt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&wt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L1e=[bH,wH,_H,kH,CH,IH,BR];function B1e(){for(const n of L1e)xe(n)}function VR(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(fe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,i=s[s.length-1];let o=1;for(let h=0;h<s.length-1;++h)o*=s[h];const a=n.shape,l=s.slice();l.pop();let u=1;for(let h=i;h<t;++h)u*=a[h],l.push(a[h]);const c=[...Ke(n.shape).map(h=>h/u),1].slice(0,i);return[l,o,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eE=-2,V1e=-1;function zR(n,e,t){const r=n.shape.length;M(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),M(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)M(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function z1e(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function UR(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function SH(n,e,t,r){const s=[...n];for(let i=s.length;i<r.length;i++)s.push(1);for(let i=0;i<t;i++)i===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function EH(n,e,t){return t<=n?t:t-(e-1)}function TH(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function U1e(n,e,t,r,s,i,o,a,l){const u=n.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(e.length&&t>0){const f=e[0],p=t+1;c=NH(o,f,p,r,n),h=AH(a,f,p,s,n),d=SH(i,f,p,n)}else for(let f=0;f<u;f++)c[f]=DH(o,r,i,n,f,l),h[f]=$H(a,s,i,n,f,l),d[f]=RH(i,f,l);return{begin:c,end:h,strides:d}}function NH(n,e,t,r,s){const i=[...s],o=TH(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=EH(e,t,a);let u=r[l];n&1<<l&&(u=0),i[a]=u}return i}function AH(n,e,t,r,s){const i=[...s],o=TH(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=EH(e,t,a);let u=r[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=s[a];i[a]<0&&(i[a]+=l),i[a]=Eh(0,i[a],s[a])}return i}function RH(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function DH(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),o=Eh(0,o,l-1),o}function $H(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),a>0?o=Eh(0,o,l):o=Eh(-1,o,l-1),o}function jR(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function WR(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function hk(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(o=>{M(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(s).fill(-1):typeof t=="number"?i=[t,...new Array(s-1).fill(-1)]:t.length<s?i=t.concat(new Array(s-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(M(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,i]}function HR(n,e,t,r,s,i,o,a,l){let u;if(r==null?(u=new Array(e.length),u.fill(1)):u=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let x=0;x<h.dims;x++)c&&1<<x&a&&h.numAddAxisAfterEllipsis++,1<<x&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};j1e(h,d);let f=!0,p=!0,m=!0;const g=[],v=[];for(let x=0;x<n.length;++x){if(d.strides[x]===0)throw Error(`strides[${x}] must be non-zero`);const b=!!(d.shrinkAxisMask&1<<x),_=n[x];if(_===-1){g.push(b?1:-1);continue}const E=[d.beginMask&1<<x,d.endMask&1<<x],I=[d.strides[x]>0?0:-1,d.strides[x]>0?_:_-1];if(b&&d.strides[x]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[x]===1;const C=!!(d.beginMask&1<<x&&d.endMask&1<<x);if(d.beginValid&&d.endValid){if(b){const R=d.begin[x]<0?_+d.begin[x]:d.begin[x];if(d.begin[x]=R,d.end[x]=d.begin[x]+1,R<0||R>=_)throw Error(`slice index ${d.begin[x]} of dimension ${x} out of bounds.`)}else d.begin[x]=D3(d.begin[x],0,d.strides[x],_,E,I),d.end[x]=D3(d.end[x],1,d.strides[x],_,E,I);const N=d.strides[x]===1&&d.begin[x]===0&&d.end[x]===_;f=f&&N,p=p&&(x===0&&d.strides[x]===1||N)}else f=f&&d.strides[x]===1&&C,p=p&&(x===0&&d.strides[x]===1||C);let S,T=!1;if(d.beginValid&&d.endValid?(S=d.end[x]-d.begin[x],T=!0):b?(S=1,T=!0):C&&_>=0&&(d.strides[x]<0?S=-_:S=_,T=!0),T){let N;S===0||S<0!=d.strides[x]<0?N=0:N=Math.trunc(S/d.strides[x])+(S%d.strides[x]!==0?1:0),g.push(N)}else g.push(-1)}for(let x=0;x<d.finalShapeGatherIndices.length;++x){const b=d.finalShapeGatherIndices[x];b>=0?v.push(g[b]):b===eE&&v.push(1)}return{finalShapeSparse:v.filter((x,b)=>d.finalShapeGatherIndices[b]!==eE),finalShape:v,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function j1e(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(eE),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(V1e),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function D3(n,e,t,r,s,i){if(s[e])return t>0?i[e]:i[e+1&1];{const o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const W1e=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:zR,computeFlatOffset:WR,computeOutShape:UR,getNormalizedAxes:U1e,isSliceContinous:jR,maskToAxes:z1e,parseSliceParams:hk,sliceInfo:HR,startForAxis:DH,startIndicesWithElidedDims:NH,stopForAxis:$H,stopIndicesWithElidedDims:AH,stridesForAxis:RH,stridesWithElidedDims:SH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H1e{static sgd(e){return new BR(e)}static momentum(e,t,r=!1){return new CH(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,i=!1){return new IH(e,t,r,s,i)}static adam(e=.001,t=.9,r=.999,s=null){return new _H(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new bH(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,i=0){return new kH(e,t,r,s,i)}static adagrad(e,t=.1){return new wH(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wd=H1e;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G1e=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function PH(){return new Promise(n=>G1e(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e){const t=n[0].length;n.forEach((s,i)=>{M(s.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),M(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,i)=>{for(let o=0;o<t;o++)M(o===e||s[o]===r[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function xa(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ko;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ko||(ko={}));function OH(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const i=t[s],o=r[r.length-t.length+s],a=r[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${i} but shape[${s+n}] = ${a}`)}else r[o]=i}return r}function FH(n){const e={FIRST_DIM_SIZE:ko.FIRST_DIM_SIZE,VALUE_ROWIDS:ko.VALUE_ROWIDS,ROW_LENGTHS:ko.ROW_LENGTHS,ROW_SPLITS:ko.ROW_SPLITS,ROW_LIMITS:ko.ROW_LIMITS,ROW_STARTS:ko.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function MH(n){return n.length===0?0:n[0]===ko.FIRST_DIM_SIZE?n.length-1:n.length}function LH(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const i=n[s],o=e[s+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${i} but ragged tensor input.flatValues.shape[${s-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qR=30;function dk(n){return n<=qR?n:MS(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function My(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(i+1))}return s}function Ly(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):s.push(o);r.push(...s),r.push(0),r.push(...i)}return r}function By(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?r?s.push(e[i-1]*n[i]):s.push(n[i]/e[i-1]):s.push(n[i]);return s}function XR(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function YR(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fk=1.7580993408473768,pk=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR=.3275911,JR=.254829592,ZR=-.284496736,eD=1.421413741,tD=-1.453152027,nD=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Il(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function BH(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function VH(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function zH(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function rD(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function UH(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function jH(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const i=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(i),r[s]=Math.sin(i)}return{real:t,imag:r}}function WH(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),i=Math.sin(r);return{real:s,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p2="->",q1e=/->/g,$3=",",P3="...";function sD(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(q1e,"").length)/p2.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${p2}").`);const[r,s]=n.split(p2);M(r.indexOf(P3)===-1,()=>`The ellipsis notation ("${P3}") is not supported yet.`);const i=r.split($3),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<s.length;++d){const f=s[d];if(!i.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let d=0;d<r.length;++d){const f=r[d];a.indexOf(f)===-1&&f!==$3&&a.push(f)}const l=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let f=0;f<i[d].length;++f)l[d].push(a.indexOf(i[d][f]))}const u=a.length,c=s.length,h=[];for(let d=c;d<u;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function iD(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function oD(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const i=t[s].shape;for(let o=0;o<e[s].length;++o)r[e[s][o]]===void 0?r[e[s][o]]=i[o]:M(r[e[s][o]]===i[o],()=>`Expected dimension ${r[e[s][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function aD(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let o=0;o<s;++o)r.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=K1e(e,a);for(const u of l)i.indexOf(u)===-1&&(r[o].push(u),i.push(u))}return{path:t,steps:r}}function lD(n){return n.every((e,t)=>e===t)}function K1e(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function uD(n,e,t=0){let r=[];if(typeof e=="number")M(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);M(s<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}M(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HH(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function GH(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function qH(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KH(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function XH(n,e){return`size ${n} must be non-negative, not ${e}`}function YH(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function QH(n,e){const t=fe(n),r=fe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function JH(n,e){const t=fe(n),r=fe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tE(){return"segment ids must be >= 0"}function ZH(){return"segment ids are not increasing"}function eG(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function tG(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(n,e){let t=!1,r;for(n<=qR?(r=n,t=!0):r=MS(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=MS(n,r+1);return r}function rG(n,e,t){const r=[],s=n.length;for(let i=0;i<s;i++)i!==e?r.push(n[i]):r.push(t);return r}function cD(n,e,t,r){const s=e.shape.length,i=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let h=0;h<r;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=n.shape[t],a=[];let l=1,u=1,c=1;for(let h=0;h<r;++h)a.push(n.shape[h]),l*=n.shape[h];for(let h=r;h<t;h++)a.push(n.shape[h]),u*=n.shape[h];for(let h=r;h<s;h++)a.push(e.shape[h]);for(let h=t+1;h<i;h++)a.push(n.shape[h]),c*=n.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:a}}const X1e=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:cD,computeOutShape:rG,segOpComputeOptimalWindowSize:nG},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(n){try{return n.map(e=>ec(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function sG(n){return n.map(e=>Bu(e))}const Y1e=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:JR,ERF_A2:ZR,ERF_A3:eD,ERF_A4:tD,ERF_A5:nD,ERF_P:QR,PARALLELIZE_THRESHOLD:qR,get RowPartitionType(){return ko},SELU_SCALE:pk,SELU_SCALEALPHA:fk,applyActivation:$R,assertAndGetBroadcastShape:ct,assertAxesAreInnerMostDims:Br,assertParamsConsistent:GR,assignToTypedArray:UH,axesAreInnerMostDims:cR,calculateShapes:rd,checkEinsumDimSizes:oD,checkPadOnDimRoundingMode:zs,combineLocations:X5,combineRaggedTensorToTensorShapes:OH,complexWithEvenIndex:VH,complexWithOddIndex:zH,computeConv2DInfo:Lr,computeConv3DInfo:dc,computeDefaultPad:sR,computeDilation2DInfo:Dy,computeOptimalWindowSize:dk,computeOutAndReduceShapes:Sr,computeOutShape:xa,computePool2DInfo:uo,computePool3DInfo:Ml,convertConv2DDataFormat:Ll,decodeEinsumEquation:sD,eitherStridesOrDilationsAreOne:es,expandShapeToKeepDim:rr,exponent:WH,exponents:jH,fromStringArrayToUint8:sG,fromUint8ToStringArray:Sl,getAxesPermutation:Tn,getBroadcastDims:Kf,getComplexWithIndex:rD,getEinsumComputePath:aD,getEinsumPermutation:iD,getFusedBiasGradient:DR,getFusedDyActivation:RR,getImageCenter:KR,getInnerMostAxes:Gn,getPermuted:Ly,getRaggedRank:MH,getReductionAxes:fr,getReshaped:My,getReshapedPermuted:By,getRowPartitionTypesHelper:FH,getSliceBeginCoords:XR,getSliceSize:YR,getSparseFillEmptyRowsIndicesDenseShapeMismatch:HH,getSparseFillEmptyRowsNegativeIndexErrorMessage:GH,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:qH,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:YH,getSparseReshapeInputOutputMismatchErrorMessage:JH,getSparseReshapeInputOutputMultipleErrorMessage:QH,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:KH,getSparseReshapeNegativeOutputDimErrorMessage:XH,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:tG,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:tE,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:ZH,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:eG,getUndoAxesPermutation:fc,isIdentityPermutation:lD,log:Dve,mergeRealAndImagArrays:Il,prepareAndValidate:VR,prepareSplitSize:uD,segment_util:X1e,shouldFuse:PR,slice_util:W1e,splitRealAndImagArrays:BH,stridesOrDilationsArePositive:Dh,tupleValuesAreOne:Rh,upcastType:ri,validateDefaultValueShape:LH,validateInput:Ewe,validateUpdateShape:pH,warn:mi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */B1e();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:n_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Fy(De(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e={kernelName:Mv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=hn(De(t,"float32")),s=Zr(et(Vt(1),r));return Wn(Je(n,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e={kernelName:Lv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Zr(et(hn(De(t,"float32")),1));return Je(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z1e={kernelName:kp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{let a=n;const l=fr(t.shape,s);return l.length>0&&(a=Ye(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=fr(r.shape,s);return l.length>0&&(a=Ye(a,l)),ee(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_e={kernelName:pA,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_e={kernelName:r_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>At(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_e={kernelName:s_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>At(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_e={kernelName:Bv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,Zr(et(Vt(1),hn(De(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_e={kernelName:Vv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Zr(we(Vt(1),hn(De(t,"float32"))));return Je(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_e={kernelName:jv,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{const a=we(hn(t),hn(r));let l=Y(n,Je(r,a));const u=fr(t.shape,s);return u.length>0&&(l=Ye(l,u)),ee(l,t.shape)},b:()=>{const a=we(hn(t),hn(r));let l=Wn(Y(n,Je(t,a)));const u=fr(r.shape,s);return u.length>0&&(l=Ye(l,u)),ee(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_e={kernelName:zv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,we(hn(De(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_e={kernelName:Uv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,et(Vt(1),hn(De(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(n,e,t,r,s,i){const o=H(n,"dy","avgPool3dGrad"),a=H(e,"input","avgPool3dGrad");let l=o,u=a,c=!1;a.rank===4&&(c=!0,l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),M(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),M(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),zs("avgPool3dGrad",s,i);const h={dy:l,input:u},d={filterSize:t,strides:r,pad:s,dimRoundingMode:i},f=J.runKernel(yA,h,d);return c?ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const u_e=te({avgPool3dGrad_:l_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_e={kernelName:o_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>u_e(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_e(n,e,t,r,s){const i=H(n,"dy","avgPoolGrad"),o=H(e,"input","avgPoolGrad");M(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),M(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},h={filterSize:t,strides:r,pad:s},d=J.runKernel(vA,c,h);return u?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const d_e=te({avgPoolGrad_:h_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_e={kernelName:i_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o}=t;return{x:()=>d_e(n,r,s,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_e={kernelName:a_,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Lt(n,s,!1,!0),b:()=>Lt(r,n,!0,!1)}:!i&&o?{a:()=>Lt(n,s,!1,!1),b:()=>Lt(n,r,!0,!1)}:i&&!o?{a:()=>Lt(s,n,!1,!0),b:()=>Lt(r,n,!1,!1)}:{a:()=>Lt(s,n,!0,!0),b:()=>Lt(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_e={kernelName:l_,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>yR(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_e={kernelName:Tve,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,i=r.shape,o=Array.from(i);for(let l=s.length-1;l>=0;l--)if(s[l]===i[l])o[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ye(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v_e={kernelName:Wv,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_e={kernelName:Hv,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_e={kernelName:Gv,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:i}=t;return{x:()=>ks(kl(ed(r,s),Sp(r,i)),n,At(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_e={kernelName:u_,inputsToSave:["x"],gradFunc:iG.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_e={kernelName:c_,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(l=>l.shape),{axis:s}=t,i=vt(s,e[0].shape)[0],o=r.map(l=>l[i]);return ki(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __e={kernelName:h_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return M(Rh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>aR(r.shape,n,s,o,a,l),filter:()=>AR(r,n,s.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_e={kernelName:d_,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>$h(n,s,i,o,a,1,l),filter:()=>AR(n,r,s.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_e(n,e,t,r,s){let i=n;n.rank===4&&(i=ee(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),M(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),M(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),M(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),M(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),M(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:r,pad:s,filterShape:t};return J.runKernel(kA,a,l)}const I_e=te({conv3DBackpropFilter_:C_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S_e={kernelName:f_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i}=t;M(Rh(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>H5(o.shape,n,a,s,i),filter:()=>I_e(o,n,a.shape,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_e={kernelName:qv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(Wn(cH(De(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_e={kernelName:Kv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(hH(De(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_e={kernelName:p_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:i,reverse:o}=t;return{x:()=>{const a=Tn([s],r.rank);let l=q5(n,s,i,!o);return a!=null&&(l=Nt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_e={kernelName:m_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i,dimRoundingMode:o}=t,a=r??[1,1];M(Rh(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return M(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),M(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),M(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),M(es(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),zs("depthwiseConv2d",i,o),{x:()=>Gwe(l.shape,n,u,s,i,a,o),filter:()=>Wwe(l,n,u.shape,s,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_e={kernelName:g_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,i={x:r,filter:s,dy:n},o={x:r,filter:s,dy:n};return{x:()=>J.runKernel(LS,i,t),filter:()=>J.runKernel(BS,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_e={kernelName:Yv,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>J.runKernel(DA,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $_e={kernelName:Qv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=Y(Aa(Wn(hn(t))),2/Math.sqrt(Math.PI));return{x:()=>Y(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_e={kernelName:Jv,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_e={kernelName:y_,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_e={kernelName:Zv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Aa(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_e={kernelName:ey,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L_e={kernelName:ty,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{const a=Je(n,De(r,"float32")),l=fr(t.shape,s);return l.length>0?ee(Ye(a,l),t.shape):a},b:()=>{let a=Y(n,De(t,"float32"));const l=fr(r.shape,s);l.length>0&&(a=ee(Ye(a,l),r.shape));const u=hn(r);return Wn(Je(a,De(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_e={kernelName:x_,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,i,o,a]=e,l=a??Vt(1),u=fr(i.shape,s.shape),c=[];if(i.rank===1){for(let b=0;b<s.shape.length-1;++b)c.push(s.shape[b]);c.push(1)}const h=et(s,i),d=Y(n,l),f=aH(we(o,Vt(r))),p=Y(Y(Y(f,f),f),Vt(-.5));return{x:()=>i.rank===1?ee(Y(Y(n,Eo(ee(f,[1,1,1,i.shape[0]]),c)),l),s.shape):ee(Y(Y(n,f),l),s.shape),mean:()=>{let b=Y(Y(f,Vt(-1)),d);return i.rank===1&&(b=Ye(b,u)),ee(b,i.shape)},variance:()=>{let b=Y(Y(p,h),d);return i.rank===1&&(b=Ye(b,u)),ee(b,i.shape)},scale:()=>{const b=Y(h,f);let _=Y(n,b);return i.rank===1&&(_=Ye(_,u)),ee(_,i.shape)},offset:()=>{let b=n;return i.rank===1&&(b=Ye(b,u)),ee(b,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V_e={kernelName:b_,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:i,batchDims:o}=t,a=vt(i,r.shape)[0],l=(u,c,h)=>()=>{const d=u.shape,f=c.size,p=d.slice(0,a),m=p.length,g=d.slice(i,d.length).slice(1),v=g.length,y=O3(0,m),x=O3(m+1,m+1+v),b=F3([p,[f],g]),_=ee(h,b),E=ee(c,[f]),I=F3([[m],y,x]),C=Nt(_,I);let S=gH(C,E,u.shape[a]);const T=fc(I);return S=Nt(S,T),S};if(o===1){const u=r.shape[0],c=r.split(u,0);return{x:()=>Cl(c.map((f,p)=>l(f,s.slice(p,1),n.slice(p,1))())).reshape(r.shape),indices:()=>s}}else return{x:l(r,s,n),indices:()=>s}}};function O3(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function F3(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_e={kernelName:ny,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>At(t),b:()=>At(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_e={kernelName:ry,gradFunc:n=>({x:()=>De(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j_e={kernelName:sy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_e={kernelName:iy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_e={kernelName:oy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_e={kernelName:__,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,i=Ri(r,0);return{x:()=>ks(i,n,Y(n,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_e={kernelName:ly,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,we(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_e={kernelName:ay,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,De(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_e={kernelName:Ave,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const o=Aa(r);return et(n,Y(Ye(n,s,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(n,e,t,r=5,s=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:r,bias:s,alpha:i,beta:o};return J.runKernel(LA,a,l)}const Q_e=te({localResponseNormalizationBackprop_:Y_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_e={kernelName:T_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>Q_e(r,s,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oG(n,e,t,r){return e.rank<t.rank&&(e=ee(e,rr(e.shape,r))),n.rank<t.rank&&(n=ee(n,rr(n.shape,r))),{x:()=>Y(n,De(Na(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3={kernelName:N_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,i=e[0],o=e[1],a=vt(s,i.shape),l=oG(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z_e={kernelName:uy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>Y(n,De(ed(t,r),"float32")),b:()=>Y(n,De(ww(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eke(n,e,t,r,s,i,o){const a=H(n,"dy","maxPool3dGrad"),l=H(e,"input","maxPool3dGrad"),u=H(t,"output","maxPool3dGrad");let c=a,h=l,d=u,f=!1;l.rank===4&&(f=!0,c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ee(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=ee(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),M(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),M(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),M(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),zs("maxPool3dGrad",i,o);const p={dy:c,input:h,output:d},m={filterSize:r,strides:s,pad:i,dimRoundingMode:o},g=J.runKernel(VA,p,m);return f?ee(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const tke=te({maxPool3dGrad_:eke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nke={kernelName:R_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>tke(n,r,s,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(n,e,t,r,s,i,o){const a=H(n,"dy","maxPoolGrad"),l=H(e,"input","maxPoolGrad"),u=H(t,"output","maxPoolGrad");M(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),M(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),M(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),zs("maxPoolGrad",i,o);const c={dy:a,input:l,output:u},h={filterSize:r,strides:s,pad:i,dimRoundingMode:o};return J.runKernel(BA,c,h)}const ske=te({maxPoolGrad_:rke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ike={kernelName:A_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>ske(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oke={kernelName:D_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,i=vt(s,r.shape),a=Sr(r.shape,i)[1],l=fe(a);return{x:()=>{const c=r.shape.slice();i.forEach(f=>{c[f]=1});const h=ee(n,c);return Je(Y(h,mc(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ake={kernelName:$_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[i,o]=e,a=vt(s,i.shape),l=oG(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lke={kernelName:cy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>Y(n,De(Sp(t,r),"float32")),b:()=>Y(n,De(Ri(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uke={kernelName:P_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>on(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cke={kernelName:hy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{const a=fr(t.shape,s);return a.length>0?ee(Ye(n,a),t.shape):n},b:()=>{const a=Y(n,Wn(ck(Je(t,r)))),l=fr(r.shape,s);return l.length>0?ee(Ye(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hke={kernelName:dy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{const a=Y(n,De(r,"float32")),l=fr(t.shape,s);return l.length>0?ee(Ye(a,l),t.shape):a},b:()=>{const a=Y(n,De(t,"float32")),l=fr(r.shape,s);return l.length>0?ee(Ye(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dke={kernelName:O_,gradFunc:n=>({x:()=>Wn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fke={kernelName:L_,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>yr(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pke={kernelName:M_,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mke={kernelName:B_,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return Fh(n,r).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L3={kernelName:V_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>on(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gke={kernelName:fy,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,i=t,o=r,a=ct(i.shape,o.shape);return{a:()=>{const c=De(o,"float32");let h=Y(n,Y(c,Ph(i,et(c,Vt(1)))));const d=fr(i.shape,a);return d.length>0&&(h=Ye(h,d)),ee(h,i.shape)},b:()=>{const c=Ri(i,0),h=ks(c,Ra(i),At(i));let d=Y(n,Y(s,h));const f=fr(o.shape,a);return f.length>0&&(d=Ye(d,f)),ee(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vke={kernelName:z_,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=Ri(t,0);return{x:()=>ks(s,n,Y(n,r)),alpha:()=>{let i=ks(s,At(n),Y(n,t));const o=fr(r.shape,n.shape);return o.length>0&&(i=Ye(i,o)),ee(i,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yke(n,e,t){const r=n.shape.slice();r[t]=1;const s=ee(e,r),i=JS(n,t,!0,!1),o=JS(n,t,!0,!0),a=Y(i,o);return Y(s,a)}function xke(n,e,t){const r=n.shape.length,s=r-t.length,i=Tn(t,r);let o=n;i!=null&&(o=Nt(n,i));const a=o.shape.slice(),u=a.splice(r-t.length,t.length).reduce((d,f)=>d*f,1);a.push(u);const c=o.reshape(a);let h=yke(c,e,s);if(h=h.reshape(o.shape),i!=null){const d=fc(i);h=Nt(h,d)}return h}const bke={kernelName:U_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let i=[];return s==null?i=r.shape.map((o,a)=>a):typeof s=="number"?i=[s]:i=s,{x:()=>xke(r,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wke={kernelName:Xv,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{const a=Je(n,De(r,"float32")),l=fr(t.shape,s);return l.length>0?ee(Ye(a,l),t.shape):a},b:()=>{let a=Y(n,De(t,"float32"));const l=fr(r.shape,s);l.length>0&&(a=ee(Ye(a,l),r.shape));const u=hn(r);return Wn(Je(a,De(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ke={kernelName:py,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,Wn(hn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kke={kernelName:gy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=Y(Sp(t,6),Fy(t));return{x:()=>Y(n,De(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cke={kernelName:my,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,De(Fy(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ike={kernelName:j_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ske={kernelName:H_,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>J.runKernel(qA,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eke={kernelName:W_,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>J.runKernel(GA,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tke={kernelName:G_,gradFunc:(n,e,t)=>{const{dims:r}=t,s=vt(r,n.shape);return{x:()=>Oh(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nke={kernelName:vy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ake={kernelName:yy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Wn(Je(n,Y(Ph(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rke={kernelName:q_,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>De(At(t),"float32"),t:()=>Y(n,De(t,n.dtype)),e:()=>Y(n,De(pR(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dke={kernelName:xy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ri(t,Vt(0)),s=Vt(fk),i=Vt(pk),o=Y(n,i),a=Y(Y(n,s),Aa(De(t,"float32")));return ks(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ke={kernelName:ky,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Y(t,et(Vt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pke={kernelName:_y,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oke={kernelName:by,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(lR(De(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fke={kernelName:wy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(G5(De(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mke={kernelName:K_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:i}=t,o=r.shape,[a,l]=hk(r,s,i),u=[];for(let c=0;c<n.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>vR(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lke={kernelName:J_,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,i=!0,o=Y(n,r);return{logits:()=>et(o,Y(Ye(o,[s],i),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bke={kernelName:Cy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Ip(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B3={kernelName:Y_,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>oR(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3={kernelName:Q_,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>Fs(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vke={kernelName:Iy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,Y(Zr(De(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zke={kernelName:KA,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Y(De(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uke={kernelName:Sy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Vt(2);return{a:()=>Y(n,Y(s,et(t,r))),b:()=>Y(n,Y(s,et(r,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jke={kernelName:Ry,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wke={kernelName:Ey,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ct(t.shape,r.shape);return{a:()=>{let a=n;const l=fr(t.shape,s);return l.length>0&&(a=Ye(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=fr(r.shape,s);return l.length>0&&(a=Ye(a,l)),ee(Wn(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hke={kernelName:X_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:i}=t;vt(i,r.shape).forEach(u=>{s[u]=1});const a=ee(n,s),l=Y(a,mc(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gke={kernelName:Ty,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Je(n,hn(lR(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qke={kernelName:Ny,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(et(Vt(1),hn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kke={kernelName:Ay,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let o=At(r);if(r.rank===1)for(let a=0;a<s[0];++a)o=we(o,on(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)o=we(o,on(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)o=we(o,on(n,[a*r.shape[0],l*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)for(let c=0;c<s[3];++c)o=we(o,on(n,[a*r.shape[0],l*r.shape[1],u*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xke={kernelName:hf,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,i=fc(s);return{x:()=>Nt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yke={kernelName:Z_,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>Cl(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qke={kernelName:ek,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Jke(n,t)}}};function Jke(n,e){const t=pc(e,At(e)),r=hR(n,t);let s=ed(e,Vt(0,"int32"));const i=r.rank-s.rank;for(let a=0;a<i;++a)s=Ds(s,a+1);s=kl(s,mc(r.shape,"bool"));const o=At(r);return ks(s,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zke={kernelName:tk,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eCe=[iG,Q1e,J1e,Z1e,e_e,t_e,n_e,r_e,s_e,i_e,o_e,a_e,c_e,f_e,p_e,m_e,g_e,v_e,y_e,x_e,b_e,w_e,k_e,__e,S_e,E_e,T_e,N_e,A_e,R_e,wke,D_e,$_e,P_e,O_e,F_e,L_e,M_e,B_e,V_e,z_e,U_e,j_e,W_e,H_e,G_e,q_e,K_e,X_e,J_e,M3,M3,Z_e,nke,ike,oke,ake,lke,uke,cke,hke,dke,fke,pke,mke,L3,L3,gke,vke,bke,_ke,kke,Cke,Ike,Ske,Eke,Tke,Nke,Ake,Rke,Dke,$ke,Pke,Oke,Fke,Mke,Lke,Bke,B3,B3,V3,V3,Vke,Uke,zke,jke,Wke,Hke,Gke,qke,Kke,Xke,Yke,Qke,Zke];for(const n of eCe)$ve(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.abs=function(){return this.throwIfDisposed(),ds(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.acos=function(){return this.throwIfDisposed(),Fye(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.acosh=function(){return this.throwIfDisposed(),Lye(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.add=function(n){return this.throwIfDisposed(),we(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.all=function(n,e){return this.throwIfDisposed(),U5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.any=function(n,e){return this.throwIfDisposed(),YS(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.argMax=function(n){return this.throwIfDisposed(),Kg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.argMin=function(n){return this.throwIfDisposed(),jye(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.asScalar=function(){return this.throwIfDisposed(),M(this.size===1,()=>"The array must have only 1 element."),ee(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.asType=function(n){return this.throwIfDisposed(),De(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.as1D=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.as2D=function(n,e){return this.throwIfDisposed(),ee(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ee(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),ee(this,[n,e,t,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),ee(this,[n,e,t,r,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.asin=function(){return this.throwIfDisposed(),Hye(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.asinh=function(){return this.throwIfDisposed(),qye(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.atan=function(){return this.throwIfDisposed(),Xye(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.atan2=function(n){return this.throwIfDisposed(),Qye(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.atanh=function(){return this.throwIfDisposed(),Zye(this)};ce().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),iR(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),oR(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),ok(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.broadcastTo=function(n){return this.throwIfDisposed(),ag(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.cast=function(n){return this.throwIfDisposed(),De(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.ceil=function(){return this.throwIfDisposed(),Sxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Ei(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof ir&&(n=[n]),Fs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.conv1d=function(n,e,t,r,s,i){return this.throwIfDisposed(),j5(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),W5(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.conv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),$h(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.cos=function(){return this.throwIfDisposed(),lR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.cosh=function(){return this.throwIfDisposed(),G5(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),JS(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),q5(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Qxe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.depthwiseConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),uR(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),e0e(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.divNoNan=function(n){return this.throwIfDisposed(),i0e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.div=function(n){return this.throwIfDisposed(),Je(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.dot=function(n){return this.throwIfDisposed(),a0e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.elu=function(){return this.throwIfDisposed(),lk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.equal=function(n){return this.throwIfDisposed(),Na(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.erf=function(){return this.throwIfDisposed(),K5(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),x0e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.exp=function(){return this.throwIfDisposed(),Aa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.expandDims=function(n){return this.throwIfDisposed(),Ds(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.expm1=function(){return this.throwIfDisposed(),k0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.fft=function(){return this.throwIfDisposed(),fH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.flatten=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.floor=function(){return this.throwIfDisposed(),ck(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.floorDiv=function(n){return this.throwIfDisposed(),z5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.gather=function(n,e,t){return this.throwIfDisposed(),hR(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.greaterEqual=function(n){return this.throwIfDisposed(),ed(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.greater=function(n){return this.throwIfDisposed(),Ri(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.ifft=function(){return this.throwIfDisposed(),ZS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.irfft=function(){return this.throwIfDisposed(),pwe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.isFinite=function(){return this.throwIfDisposed(),D0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.isInf=function(){return this.throwIfDisposed(),P0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.isNaN=function(){return this.throwIfDisposed(),F0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.leakyRelu=function(n){return this.throwIfDisposed(),fR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.lessEqual=function(n){return this.throwIfDisposed(),Sp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.less=function(n){return this.throwIfDisposed(),ww(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),z0e(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),K0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Z5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),eH(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.log=function(){return this.throwIfDisposed(),Ra(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.log1p=function(){return this.throwIfDisposed(),J5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logicalAnd=function(n){return this.throwIfDisposed(),kl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logicalNot=function(){return this.throwIfDisposed(),pR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logicalOr=function(n){return this.throwIfDisposed(),tH(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.logicalXor=function(n){return this.throwIfDisposed(),nbe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Lt(this,n,e,t)};ce().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),mR(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.max=function(n,e){return this.throwIfDisposed(),Do(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.maximum=function(n){return this.throwIfDisposed(),pc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.mean=function(n,e){return this.throwIfDisposed(),Zn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.min=function(n,e){return this.throwIfDisposed(),bw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.minimum=function(n){return this.throwIfDisposed(),Qg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),cbe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.mod=function(n){return this.throwIfDisposed(),dbe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.mul=function(n){return this.throwIfDisposed(),Y(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.neg=function(){return this.throwIfDisposed(),Wn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.norm=function(n,e,t){return this.throwIfDisposed(),uk(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.notEqual=function(n){return this.throwIfDisposed(),_w(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),nH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.onesLike=function(){return this.throwIfDisposed(),lo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.pad=function(n,e){return this.throwIfDisposed(),vR(this,n,e)};ce().prototype.pool=function(n,e,t,r,s,i){return this.throwIfDisposed(),_be(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.pow=function(n){return this.throwIfDisposed(),Ph(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.prelu=function(n){return this.throwIfDisposed(),xR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.prod=function(n,e){return this.throwIfDisposed(),Ibe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.reciprocal=function(){return this.throwIfDisposed(),Kbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.relu=function(){return this.throwIfDisposed(),nd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.relu6=function(){return this.throwIfDisposed(),iH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ee(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.reshape=function(n){return this.throwIfDisposed(),ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),yH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),xH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.reverse=function(n){return this.throwIfDisposed(),Oh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.rfft=function(){return this.throwIfDisposed(),vwe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.round=function(){return this.throwIfDisposed(),oH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.rsqrt=function(){return this.throwIfDisposed(),aH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.selu=function(){return this.throwIfDisposed(),lH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.separableConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),uH(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sigmoid=function(){return this.throwIfDisposed(),Ip(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sign=function(){return this.throwIfDisposed(),rwe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sin=function(){return this.throwIfDisposed(),cH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sinh=function(){return this.throwIfDisposed(),hH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.slice=function(n,e){return this.throwIfDisposed(),on(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.softmax=function(n){return this.throwIfDisposed(),NR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.softplus=function(){return this.throwIfDisposed(),$y(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),yR(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.split=function(n,e){return this.throwIfDisposed(),ki(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sqrt=function(){return this.throwIfDisposed(),Zr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.square=function(){return this.throwIfDisposed(),hn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.squaredDifference=function(n){return this.throwIfDisposed(),xwe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.squeeze=function(n){return this.throwIfDisposed(),Oy(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof ir?[this,n]:[this,...n];return Cl(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.step=function(n){return this.throwIfDisposed(),Fy(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.stridedSlice=function(n,e,t,r,s,i,o,a){return this.throwIfDisposed(),Cwe(this,n,e,t,r,s,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sub=function(n){return this.throwIfDisposed(),et(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.sum=function(n,e){return this.throwIfDisposed(),Ye(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.tan=function(){return this.throwIfDisposed(),Swe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.tanh=function(){return this.throwIfDisposed(),ik(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.tile=function(n){return this.throwIfDisposed(),Eo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.toBool=function(){return this.throwIfDisposed(),De(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.toFloat=function(){return this.throwIfDisposed(),De(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.toInt=function(){return this.throwIfDisposed(),De(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.topk=function(n,e){return this.throwIfDisposed(),Nwe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.transpose=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.unique=function(n){return this.throwIfDisposed(),Dwe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),gH(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.unstack=function(n){return this.throwIfDisposed(),Fh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.where=function(n,e){return this.throwIfDisposed(),ks(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ce().prototype.zerosLike=function(){return this.throwIfDisposed(),At(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class na extends Error{constructor(e){super(e),Object.setPrototypeOf(this,na.prototype)}}class Zi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zi.prototype)}}class K extends Error{constructor(e){super(e),Object.setPrototypeOf(this,K.prototype)}}class ft extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ft.prototype)}}class hD extends Error{constructor(e){super(e),Object.setPrototypeOf(this,hD.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aG{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mh(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function ra(n,e){if(!n)throw new hD(e)}function z3(n,e){let t=0;for(const r of n)r===e&&t++;return t}function $s(n){return n.length===1?n[0]:n}function Gt(n){return Array.isArray(n)?n:[n]}function el(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Hc(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Oi={};function dD(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function nE(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>nE(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:nE(r))}}}function Vy(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in Oi)o=Oi[i];else if(o=e[i],o==null)throw new K(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new K(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in Oi?[a,l]=Oi.className:o in e&&([a,l]=e[o]),a==null)throw new K(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const f of Object.keys(Oi))u[f]=Oi[f];for(const f of Object.keys(t))u[f]=t[f];const c=i.config;c.customObjects=u;const h=Object.assign({},Oi);for(const f of Object.keys(t))Oi[f]=t[f];nE(i.config);const d=l(a,i.config,t,s);return Oi=Object.assign({},h),d}else{const u=Object.assign({},Oi);for(const h of Object.keys(t))Oi[h]=t[h];const c=new a(i.config);return Oi=Object.assign({},u),c}}}function tCe(n,e){return n<e?-1:n>e?1:0}function f0(n,e){return-1*tCe(n,e)}function Vu(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function nCe(n){if(n==null)throw new K(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function sd(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new K(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function fD(n,e,t=0,r=1/0){return ra(t>=0),ra(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function br(n,e){Array.isArray(n)?(M(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>br(t,`element ${r+1} of ${e}`))):M(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${lG(n)}.`)}function lG(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>lG(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function rCe(n,e,t){let r=t!=null?t():Rs(),s;return(...o)=>{const a=t!=null?t():Rs();return a-r<e||(r=a,s=n(...o)),s}}function uG(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let sCe=0;function cG(){return sCe++}const p0={};function mk(n=""){return n in p0||(p0[n]=0),p0[n]+=1,n+p0[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iCe=["channelsFirst","channelsLast"],oCe=["nearest","bilinear"],aCe=["valid","same","causal"],lCe=["max","avg"],uCe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _d=new Map;function qn(n){sd(iCe,"DataFormat",n)}function cCe(n){sd(oCe,"InterpolationFormat",n)}function Di(n){sd(aCe,"PaddingMode",n)}function hG(n){sd(lCe,"PoolMode",n)}const lg=[],U3="/";function hh(n,e){lg.push(n);try{const t=e();return lg.pop(),t}catch(t){throw lg.pop(),t}}function hCe(){return lg.length===0?"":lg.join(U3)+U3}function dG(n){if(!pG(n))throw new Error("Not a valid tensor name: '"+n+"'");return hCe()+n}function fG(n){if(!pG(n))throw new Error("Not a valid tensor name: '"+n+"'");_d.has(n)||_d.set(n,0);const e=_d.get(n);if(_d.set(n,_d.get(n)+1),e>0){const t=`${n}_${e}`;return _d.set(t,1),t}else return n}const dCe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function pG(n){return!!n.match(dCe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fCe(n){return n===parseInt(n.toString(),10)}function zu(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function Yf(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function tc(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function Lo(n,e){if(e<n)throw new K(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let m2;function ur(){return m2==null&&(m2=oye().epsilon()),m2}function Bo(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ba(n,e){return De(n,e)}function zy(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ee(n,t)}function pCe(n,e){return se(()=>{if(n.shape.length!==2)throw new K(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=zy(n,1);return rE(t,[1,e,1])})}function mCe(n){const e=[zu(n.shape)];return ee(n,e)}function gCe(n){if(n.rank<=1)throw new K(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],zu(n.shape,1)];return ee(n,e)}function dh(n,e,t){return se(()=>{switch(n.rank){case 1:return ER(n,e,t);case 2:return dH(n,[e,0],[t,n.shape[1]]);case 3:return TR(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Cw(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return on(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return on(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new K(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function g2(n,e,t){return se(()=>{switch(n.rank){case 1:return ER(n,e,t);case 2:return dH(n,[0,e],[n.shape[0],t]);case 3:return TR(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Cw(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new K(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function m0(n,e,t,r){return se(()=>{switch(n.rank){case 1:return ER(n,e,t);case 2:switch(r){case 1:return dh(n,e,t);case 2:return g2(n,e,t);default:throw new K(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return dh(n,e,t);case 2:return TR(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return g2(n,e,t);default:throw new K(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return dh(n,e,t);case 2:return Cw(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Cw(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return g2(n,e,t);default:throw new K(`The axis is not within the rank of the tensor ${r}`)}default:throw new K(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function pD(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Fs(n,e)}function j3(n,e){switch(n.rank){case 1:return Nxe([n,e]);case 2:return Rxe([n,e],0);case 3:return $xe([n,e],0);case 4:return Oxe([n,e],0);default:throw new K(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function rE(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new K(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Eo(n,e)}function gk(n,e=0,t=1,r,s){return Wbe(n,e,t,r,s)}function wa(n,e,t,r){if(n.rank<2||e.rank<2)throw new ft(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(s!==i)throw new ft(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return N3({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?sE(n.rank,r,Bo()):null,activation:t});{const s=n.shape.slice(),i=s.pop();n=ee(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],c=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=ee(Nt(e,c),[l,-1]);const h=[...s,...u];return ee(N3({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?sE(n.rank,r,Bo()):null,activation:t}),h)}}function mG(n,e,t){return se(()=>(Array.isArray(e)?e=Js(e,"int32"):e=De(e,"int32"),hR(n,e,t)))}function Uy(n){return Y(n,n)}function sE(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new K(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1,1,1]):ee(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,1,1,r[0]]):ee(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1,1]):ee(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,1,r[0]]):ee(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1]):ee(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,r[0]]):ee(e,[1].concat(r))}else if(n<3)return e;throw new K(`Unsupported input rank by biasAdd: ${e.rank}`)}function jo(n,e,t){return se(()=>(t==null&&(t=Bo()),qn(t),we(n,sE(n.rank,e,t))))}function vCe(n,e=1){if(e!==1)throw new ft(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return lk(n)}function yCe(n){return se(()=>Je(n,we(ds(n),1)))}function gG(n,e,t,r){return se(()=>Bwe(n,e,t,r))}function xCe(n){return se(()=>{const e=we(.5,Y(.2,n));return Ei(e,0,1)})}function jy(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bCe=["fanIn","fanOut","fanAvg"],wCe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _Ce(n){sd(bCe,"FanMode",n)}function kCe(n){sd(wCe,"Distribution",n)}class co extends Tp{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class vG extends co{apply(e,t){return yr(e,t)}}vG.className="Zeros";xe(vG);class mD extends co{apply(e,t){return mc(e,t)}}mD.className="Ones";xe(mD);class yG extends co{constructor(e){if(super(),typeof e!="object")throw new K(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new K(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return se(()=>Y(Vt(this.value),mc(e,t)))}getConfig(){return{value:this.value}}}yG.className="Constant";xe(yG);class xG extends co{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Py(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}xG.className="RandomUniform";xe(xG);class bG extends co{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`randomNormal does not support dType ${t}.`);return gk(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}bG.className="RandomNormal";xe(bG);class wG extends co{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`truncatedNormal does not support dType ${t}.`);return mH(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}wG.className="TruncatedNormal";xe(wG);class _G extends co{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return se(()=>{if(e.length!==2||e[0]!==e[1])throw new K("Identity matrix initializer can only be used for 2D square matrices.");return Y(this.gain,Q5(e[0]))})}getConfig(){return{gain:this.gain}}}_G.className="Identity";xe(_G);function CCe(n,e="channelsLast"){let t,r;if(qn(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=zu(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=zu(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=zu(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class si extends co{constructor(e){if(super(),e.scale<0)throw new K(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,_Ce(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,kCe(this.distribution),this.seed=e.seed}apply(e,t){const r=CCe(e),s=r[0],i=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,s):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(s+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`${this.getClassName()} does not support dType ${t}.`);return mH(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return Py(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}si.className="VarianceScaling";xe(si);class gD extends si{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return si.className}}gD.className="GlorotUniform";xe(gD);class vD extends si{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return si.className}}vD.className="GlorotNormal";xe(vD);class yD extends si{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return si.className}}yD.className="HeNormal";xe(yD);class xD extends si{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return si.className}}xD.className="HeUniform";xe(xD);class bD extends si{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return si.className}}bD.className="LeCunNormal";xe(bD);class wD extends si{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return si.className}}wD.className="LeCunUniform";xe(wD);class kG extends co{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return se(()=>{if(e.length<2)throw new ft("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=fe(e.slice(0,-1)),s=e[e.length-1],i=r*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(s,r),Math.min(s,r)],a=gk(o,0,1,t,this.seed),l=O1e.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return u=Y(u,h.sign()),r<s&&(u=u.transpose()),Y(Vt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}kG.className="Orthogonal";xe(kG);const W3={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function H3(n,e={}){return Vy(n,Hi.getMap().classNameMap,e,"initializer")}function En(n){return dD(n)}function wn(n){if(typeof n=="string"){const e=n in W3?W3[n]:n;if(e==="GlorotNormal")return new vD;if(e==="GlorotUniform")return new gD;if(e==="HeNormal")return new yD;if(e==="HeUniform")return new xD;if(e==="LeCunNormal")return new bD;if(e==="LeCunUniform")return new wD;{const t={};return t.className=e,t.config={},H3(t)}}else return n instanceof co?n:H3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iE(n){return Array.isArray(n)&&Array.isArray(n[0])}function Iw(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function nt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new K(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Ot(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new K(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sw(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const G3="Variable";class ICe{constructor(e,t="float32",r=G3,s=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=cG(),r=r??G3,this.originalName=dG(r),this.name=fG(this.originalName),this.trainable_=s,this.constraint=i,this.val=Owe(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),SCe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function SCe(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function oE(n){return n.map(e=>e.read())}function _D(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cr{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Da{constructor(e,t,r,s,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=i,this.outputTensorIndex=a,this.id=cG(),o!=null&&(this.originalName=dG(o),this.name=fG(this.originalName)),this.rank=t.length}}let ECe=0;class vk{constructor(e,t){this.callArgs=t,this.id=ECe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let TCe=0;class yt extends Tp{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=TCe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=el(r)+"_"+mk(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),r=[i].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Zi(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new K(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return $s(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return $s(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new na(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new na(`Layer ${this.name} is not connected, no input to return.`);return $s(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new na(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new na(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return $s(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Gt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=Gt(this.inputSpec);if(t.length!==r.length)throw new K(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const i=t[s],o=r[s];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new K(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new K(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new K(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new K(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const c=Number(u),h=o.axes[u],d=c>=0?l[c]:l[l.length+c];if(h!=null&&[h,null].indexOf(d)===-1)throw new K(`Input ${s} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new K(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=Gt(e),s=RCe(e),i=DCe(e);if(s===i)throw new K("Arguments to apply() must be all SymbolicTensors or all Tensors");return hh(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Gt(e))o.push(a.shape);this.build($s(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Gt(o),l=[];for(let u of a)r.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=$s(l),this.activityRegularizer!=null)throw new ft("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=NCe(e),a=this.computeOutputShape(o);let l;const u=ACe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,h)=>new Da(u,c,this,Gt(e),t,this.name,h)):l=new Da(u,a,this,Gt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new ft("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new na(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new na(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Zi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Sw(this.weights)}build(e){this.built=!0}getWeights(e=!1){return oE(e?this.trainableWeights:this.weights)}setWeights(e){se(()=>{const t=this.weights;if(t.length!==e.length)throw new K(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=oE(t);for(let i=0;i<s.length;++i){const o=s[i],a=t[i],l=e[i];if(!Ut(o.shape,l.shape))throw new K(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}_D(r)})}addWeight(e,t,r,s,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new K(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():wn("zeros"));const u=s.apply(t,r),c=new ICe(u,r,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Gt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),i=Gt(t),o=Gt(s);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,r,s,i,o,a=null){const l=Gt(e);t=Gt(t),r=Gt(r),s=Gt(s),i=Iw(i),o=Iw(o);const u=[],c=[],h=[];for(const d of l)u.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new vk({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:h,inputTensors:l,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:i,outputShapes:o},a);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function NCe(n){n=Gt(n);const e=[];for(const t of n)e.push(t.shape);return $s(e)}function ACe(n){return"float32"}function CG(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let i=0;i<r.inboundLayers.length;i++){const o=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],u=CG(o,a,l);for(const c of u)s.indexOf(c)===-1&&s.push(c)}return s}}}function RCe(n){let e=!0;for(const t of Gt(n))if(!(t instanceof Da)){e=!1;break}return e}function DCe(n){let e=!0;for(const t of Gt(n))if(t instanceof Da){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wy extends yt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:mk("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new K("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new K("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new K("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new Da(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new vk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new K(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Wy.className="InputLayer";xe(Wy);function $Ce(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new K("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Wy({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PCe(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return De(e,n.dtype)}catch{throw new K(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class yu{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof yu)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=PCe(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new K(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Da){if(this.id2Value[e.id]==null)throw new K(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new K(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Da){if(this.id2Value[e.id]==null)throw new K(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new K(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&wt(this.id2Mask)}}const Ew=new aG,Tw=new aG;function OCe(n){Ew!=null&&Ew.setMaxEntries(n),Tw!=null&&Tw.setMaxEntries(n)}function Lm(n,e,t,r){const s=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(p=>p.name),l=[],u=e.names();for(const p of a)u.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let h=Ew.get(c),d;if(h==null){const p=FCe(o,e);h=p.sorted,d=p.recipientCounts,Ew.put(c,h),Tw.put(c,d)}d={},s||Object.assign(d,Tw.get(c));const f=new yu(e);for(let p=0;p<h.length;++p){const m=h[p],g=m.sourceLayer;if(g instanceof Wy)continue;const v=[],y=[],x=[];let b=!1;for(const S of m.inputs){const T=f.getValue(S),N=f.getMask(S);v.push(T),y.push(N),N!=null&&(b=!0),s||(d[S.name]--,d[S.name]===0&&!e.hasKey(S)&&a.indexOf(S.name)===-1&&!T.isDisposed&&S.sourceLayer.stateful!==!0&&x.push(T))}b&&(t=t||{},t.mask=y[0]);const _=Gt(g.apply(v,t));let E=null;g.supportsMasking&&(E=g.computeMask(v,y));const I=LCe(m),C=Array.isArray(I)?I:[I];for(let S=0;S<C.length;++S){f.hasKey(C[S])||f.add(C[S],_[S],Array.isArray(E)?E[0]:E);const T=a.indexOf(C[S].name);T!==-1&&(l[T]=_[S])}s||wt(x)}return f.disposeMasks(),i?l:l[0]}function FCe(n,e){M(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=q3(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const i of n){const{sorted:o,recipientMap:a}=q3(i,e);for(const l of o)s.has(l.name)||(t.push(l),s.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(u=>r[l].add(u))}}return{sorted:t,recipientCounts:MCe(r)}}function MCe(n){const e={};for(const t in n)e[t]=n[t].size;return e}function q3(n,e){const t=new Set,r=[],s={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)s[u.name]==null&&(s[u.name]=new Set),s[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:r,recipientMap:s}}function LCe(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BCe=oe();BCe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,OCe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kD(n,e){return se(()=>Zr(Ye(Y(n,n),e,!0)))}class Hy extends Tp{getConfig(){return{}}}class IG extends Hy{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>{const t=kD(e,this.axis),r=Ei(t,0,this.maxValue);return Y(e,Je(r,we(ur(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}IG.className="MaxNorm";xe(IG);class SG extends Hy{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>Je(e,we(ur(),kD(e,this.axis))))}getConfig(){return{axis:this.axis}}}SG.className="UnitNorm";xe(SG);class EG extends Hy{apply(e){return nd(e)}}EG.className="NonNeg";xe(EG);class TG extends Hy{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>{const t=kD(e,this.axis),r=we(Y(this.rate,Ei(t,this.minValue,this.maxValue)),Y(1-this.rate,t));return Y(e,Je(r,we(ur(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}TG.className="MinMaxNorm";xe(TG);const K3={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function hr(n){return dD(n)}function X3(n,e={}){return Vy(n,Hi.getMap().classNameMap,e,"constraint")}function dr(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in K3?K3[n]:n,config:{}};return X3(t)}else return n instanceof Hy?n:X3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function $c(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const i=n[s];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(s),r.push(o)}}if(e.length>0){const s=await Promise.all(e);for(let i=0;i<s.length;++i)n[t[i]]=s[i][0];wt(r)}}function NG(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Y3;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(Y3||(Y3={}));const VCe=125;class Zg{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class zCe{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class UCe extends Zg{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const i=t[s];if(typeof i=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+i*r;else{let o;s in this.totals?o=this.totals[s]:this.totals[s]=0;const a=se(()=>we(this.totals[s],Y(i,r)));this.totals[s]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:se(()=>{const s=Y(Je(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),ya(t[r])}))}}class jCe extends Zg{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),r.push(a)}}const s=await Promise.all(e);for(let i=0;i<s.length;++i)this.history[t[i]][r[i]].dispose(),this.history[t[i]][r[i]]=s[i][0]}}class WCe extends Zg{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||PH,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=VCe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");OS(this.yieldEvery)&&(this.maybeWait=rCe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await $c(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await $c(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await $c(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await $c(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await $c(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):OS(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await $c(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await $c(e),await this.trainEnd(e))}}function AG(n,e){return n==null&&(n={}),n instanceof Zg?[n]:Array.isArray(n)&&n[0]instanceof Zg?n:Gt(n).map(r=>new WCe(r,e))}class Mi{constructor(){}static registerCallbackConstructor(e,t){M(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Mi.checkForDuplicate(t),Mi.constructors[e]==null&&(Mi.constructors[e]=[]),Mi.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Mi.constructors)Mi.constructors[+t].forEach(s=>{if(s===e)throw new K("Duplicate callback constructor.")})}static clear(){Mi.constructors={}}static createCallbacks(e){const t=[];for(const r in Mi.constructors){const s=+r;e>=s&&t.push(...Mi.constructors[s])}return t.map(r=>new r)}}Mi.constructors={};function RG(n,e,t,r,s,i,o,a,l){const u=new jCe,c=[new UCe,...Mi.createCallbacks(e)];n!=null&&c.push(...n),c.push(u);const h=new zCe(c);return h.setParams({epochs:t,initialEpoch:r,samples:s,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fl(n,e={},t=!1){return Vy(n,Hi.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nw(n,e){return se(()=>{n.dtype!=="float32"&&(n=De(n,"float32"));const t=Ye(Uy(n),e,!0),r=ak(t.shape,ur()),s=Zr(pc(t,r));return Je(n,s)})}function yk(n,e){return se(()=>Zn(Uy(et(e,n)),-1))}function CD(n,e){return se(()=>Zn(ds(et(e,n)),-1))}function ID(n,e){return se(()=>{const t=et(n,e),r=Ei(ds(n),ur(),Number.MAX_VALUE),s=ds(Je(t,r));return Y(100,Zn(s,-1))})}function HCe(n,e){return se(()=>{const t=Ei(e,ur(),Number.MAX_VALUE),r=Ra(we(1,t)),s=Ei(n,ur(),Number.MAX_VALUE),i=Ra(we(1,s));return Zn(Uy(et(r,i)),-1)})}function GCe(n,e){return se(()=>{const t=pc(0,et(1,Y(n,e)));return Zn(Uy(t),-1)})}function qCe(n,e){return se(()=>{const t=pc(0,et(1,Y(n,e)));return Zn(t,-1)})}function KCe(n,e){return se(()=>{const t=Ye(Y(n,e),-1),r=Do(Y(et(1,n),e),-1);return pc(0,we(1,et(r,t)))})}function XCe(n,e){return se(()=>{const t=Math.log(2),r=et(e,n),s=et(we(r,$y(Y(-2,r))),t);return Zn(s,-1)})}function ev(n,e,t=!1){return se(()=>{if(t)e=NR(e);else{const r=Ye(e,e.shape.length-1,!0);e=Je(e,r)}return e=Ei(e,ur(),1-ur()),Wn(Ye(Y(De(n,"float32"),Ra(e)),e.shape.length-1))})}function Aw(n,e,t=!1){return se(()=>{const r=De(ck(mCe(n)),"int32");e=Ei(e,ur(),1-ur());const s=e.shape,i=ee(nH(r,s[s.length-1]),s);return ev(i,e,t)})}function YCe(n,e){if(!Ut(n.shape,e.shape))throw new K(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return se(()=>{const t=nd(e),r=Wn(ds(e));return we(et(t,Y(e,n)),J5(Aa(r)))})}function xk(n,e){return se(()=>{let t;return t=Ei(e,ur(),1-ur()),t=Ra(Je(t,et(1,t))),Zn(YCe(n,t),-1)})}function QCe(n,e){return se(()=>{const t=Ei(n,ur(),1),r=Ei(e,ur(),1);return Ye(Y(n,Ra(Je(t,r))),-1)})}function JCe(n,e){return se(()=>{const t=Ra(we(ur(),e));return Zn(et(e,Y(n,t)),-1)})}function DG(n,e){return se(()=>{const t=Nw(n,-1),r=Nw(e,-1),s=Y(t,r);return Wn(Ye(s,-1))})}const Rw={meanSquaredError:yk,meanAbsoluteError:CD,meanAbsolutePercentageError:ID,meanSquaredLogarithmicError:HCe,squaredHinge:GCe,hinge:qCe,categoricalHinge:KCe,logcosh:XCe,categoricalCrossentropy:ev,sparseCategoricalCrossentropy:Aw,binaryCrossentropy:xk,kullbackLeiblerDivergence:QCe,poisson:JCe,cosineProximity:DG};function v2(n){if(typeof n=="string"){if(n in Rw)return Rw[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new K(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $G(n,e){return se(()=>{const t=Y(.5,lo(e)),r=ba(Ri(e,t),n.dtype);return Zn(Na(n,r),-1)})}function PG(n,e){return se(()=>ba(Na(Kg(n,-1),Kg(e,-1)),"float32"))}function ZCe(n,e){return se(()=>De(Ye(kl(Na(n,1),Na(e,1))),"float32"))}function e2e(n,e){return se(()=>De(Ye(kl(Na(n,0),Na(e,1))),"float32"))}function t2e(n,e){return se(()=>{const t=ZCe(n,e),r=e2e(n,e),s=we(t,r);return De(ks(Ri(s,0),Je(t,s),0),"float32")})}function n2e(n,e){return xk(n,e)}function r2e(n,e){return n.rank===e.rank&&(n=Oy(n,[n.rank-1])),e=Kg(e,-1),e.dtype!==n.dtype&&(e=De(e,n.dtype)),De(Na(n,e),"float32")}const s2e=yk,i2e=yk,o2e=CD,a2e=CD,l2e=ID,u2e=ID,OG=ev,c2e=DG,FG=Aw,Dw={binaryAccuracy:$G,categoricalAccuracy:PG,precision:t2e,categoricalCrossentropy:OG,sparseCategoricalCrossentropy:FG,mse:s2e,MSE:i2e,mae:o2e,MAE:a2e,mape:l2e,MAPE:u2e,cosine:c2e};function h2e(n){if(typeof n=="string"&&n in Dw)return Dw[n];if(typeof n!="string"&&n!=null)return n;throw new K(`Unknown metric ${n}`)}function g0(n){if(ra(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Rw))if(Rw[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Dw))if(Dw[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function d2e(n){const e={Adagrad:()=>wd.adagrad(.01),Adadelta:()=>wd.adadelta(1,.95,ur()),Adam:()=>wd.adam(.001,.9,.999,ur()),Adamax:()=>wd.adamax(.002,.9,.999,ur(),0),RMSProp:()=>wd.rmsprop(.001,.9,0,ur()),SGD:()=>wd.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new K(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Q3=1*1024*1024;function J3(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!aE(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>Q3&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Q3}.`)}}function aE(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!aE(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!aE(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function f2e(n,e,t,r=console.log){const s=m2e(n),i=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(c=>Math.floor(e*c)));let o;if(!s){i.push("Receives inputs"),o=[];for(const c in n.nodesByDepth)o.push(...n.nodesByDepth[c])}r("_".repeat(e)),$w(i,t,r),r("=".repeat(e));const a=n.layers;for(let c=0;c<a.length;++c)s?g2e(a[c],t,r):v2e(a[c],t,o,r),r((c===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=p2e(n),u=Sw(n.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(e))}function p2e(n){let e;return n.collectedTrainableWeights!=null?e=Sw(n.collectedTrainableWeights):e=Sw(n.trainableWeights),e}function m2e(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let i=!1;for(const o of s.inboundNodes)if(r.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function $w(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function g2e(n,e,t){let r,s;try{s=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,s,r,n.countParams().toString()];$w(a,e,t)}function v2e(n,e,t,r){let s,i;try{i=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const f=h.inboundLayers[d].name,p=h.nodeIndices[d],m=h.tensorIndices[d];o.push(`${f}[${p}][${m}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],c=[`${a} (${l})`,i,s,n.countParams().toString(),u];$w(c,e,r);for(let h=1;h<o.length;++h)$w(["","","","",o[h]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MG(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function lE(n,e){if(n===null)return null;if(typeof n=="string")return Hc(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];MG(e,s,i)?t.push(i):t.push(lE(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const i=Hc(r);t[i]=lE(s,i)}}return t}}function uE(n,e){if(n==null)return null;if(typeof n=="string")return el(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];MG(e,s,i)?t.push(i):t.push(uE(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],i=el(r);(r==="name"||r==="className")&&typeof s=="string"?t[i]=s:t[i]=uE(s,r)}return t}}/** @license See the LICENSE file. */const LG="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const y2e=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class yo extends yt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const y=this.getClassName().toLowerCase();this.name=mk(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Vu(this.inputs).length!==this.inputs.length)throw new K(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);Vu(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const x=y.sourceLayer,b=y.nodeIndex,_=y.tensorIndex;this.outputLayers.push(x),this.outputLayersNodeIndices.push(b),this.outputLayersTensorIndices.push(_)}for(const y of this.inputs){const x=y.sourceLayer,b=y.nodeIndex,_=y.tensorIndex;ra(b===0,"input layer has >1 nodes"),ra(_===0,"input layer has >1 tensors"),this.inputLayers.push(x),this.inputLayersNodeIndices.push(b),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const x=this.inputLayers[y];if(!(x instanceof Wy))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${x.getClassName()}.`);this.inputNames.push(x.name),this.feedInputShapes.push(x.batchInputShape),this.feedInputNames.push(x.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);const t={},r={},s={},i={},o={},a=[],l=(y,x,b,_,E,I)=>{(_==null||E==null||I==null)&&(_=y.sourceLayer,E=y.nodeIndex,I=y.tensorIndex);const C=_.inboundNodes[E];if(b.indexOf(C)!==-1)throw new Zi(`The tensor ${y.name} at layer "${_.name}" is part of a cycle.`);if(x.indexOf(C)!==-1)return;this.containerNodes.add(yo.nodeKey(_,E)),_.id in o||(o[_.id]=Object.keys(o).length),b.indexOf(C)===-1&&b.push(C);const S=C.inboundLayers.length;for(let T=0;T<S;T++){const N=C.inputTensors[T],R=C.inboundLayers[T],D=C.nodeIndices[T],z=C.tensorIndices[T];l(N,x,b,R,D,z)}for(x.push(C);b.indexOf(C)>=0;)b.splice(b.indexOf(C),1);a.push(C)},u=[],c=[];for(const y of this.outputs)l(y,u,c);const h=a.slice().reverse();for(const y of h){r[y.id]=y,y.id in t||(t[y.id]=0);let x=t[y.id];const b=s[y.outboundLayer.id]==null?0:s[y.outboundLayer.id];x=Math.max(x,b),s[y.outboundLayer.id]=x,i[y.outboundLayer.id]=y.outboundLayer,t[y.id]=x;for(let _=0;_<y.inboundLayers.length;_++){const E=y.inboundLayers[_],I=y.nodeIndices[_],C=E.inboundNodes[I],S=t[C.id]==null?0:t[C.id];t[C.id]=Math.max(x+1,S),r[C.id]=C}}const d={};for(const y in t){const x=t[y];x in d||(d[x]=[]),d[x].push(r[y])}const f={};for(const y in s){const x=s[y];x in f||(f[x]=[]),f[x].push(i[y])}let p=Object.keys(f).map(y=>parseInt(y,10)).sort(f0);this.layers=[];for(const y of p){const x=f[y];x.sort((b,_)=>{const E=o[b.id],I=o[_.id];return E<I?-1:E>I?1:0});for(const b of x)b instanceof yo&&this.internalContainerRefs.push(b),this.layers.push(b)}this.layersByDepth=f,p=Object.keys(d).map(y=>parseInt(y,10)).sort(f0);const m=this.inputs.slice(),g=[];for(const y of p)for(const x of d[y]){const b=x.outboundLayer;if(b!=null){for(const _ of x.inputTensors)if(m.indexOf(_)===-1)throw new Zi(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${b.name}". The following previous layers were accessed without issue: ${g}`);for(const _ of x.outputTensors)m.push(_);g.push(b.name)}}this.nodesByDepth=d;const v=this.layers.map(y=>y.name);for(const y of v){const x=v.filter(b=>b===y).length;if(x!==1)throw new Zi(`The name "${y}" is used ${x} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new vk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new K("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const i=y2e(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(r[c]!=null)throw new K(`Duplicate weight name: ${c}`);r[c]=u,s++}const o=[];for(const a in e){let l=a;if(r[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[l]!=null)o.push([r[l],e[a]]);else if(t)throw new K(`Provided weight data has no target variable: ${a}`);delete r[l]}if(t){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new K(`${a.length} of ${s} weights are not set: ${a}`)}_D(o)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],i=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!s.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${LG}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=uE(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return se(()=>{e=Gt(e);const r=new yu;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return Lm(this.outputs,r,t)})}computeMask(e,t){return se(()=>{e=Gt(e);let r;return t==null?r=Mh(null,e.length):r=Gt(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=Iw(e);if(t.length!==this.inputLayers.length)throw new K(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],c=l.name+"_0_0";r[c]=u}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(f0);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const h=[];for(let m=0;m<u.inboundLayers.length;m++){const g=u.inboundLayers[m],v=u.nodeIndices[m],y=u.tensorIndices[m],x=`${g.name}_${v}_${y}`,b=r[x];h.push(b)}const d=c.computeOutputShape($s(h)),f=Iw(d),p=c.inboundNodes.indexOf(u);for(let m=0;m<f.length;m++){const g=`${c.name}_${p}_${m}`;r[g]=f[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];ra(l in r),i.push(r[l])}return $s(i)}runInternalGraph(e,t){t==null&&(t=Mh(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],h=t[l];r[u.id]=[c,h]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(f0);for(const l of s){const u=this.nodesByDepth[l];for(const c of u){const h=c.outboundLayer,d=c.inputTensors,f=c.outputTensors,p=new Array;for(const m of d)m.id in r&&p.push(r[m.id]);if(p.length===d.length){let m={},g,v,y,x;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[b,_]=p[0];m.mask==null&&(m.mask=_),y=Gt(h.call(b,m)),x=Gt(h.computeMask(b,_)),g=[b],v=[_]}else g=p.map(b=>b[0]),v=p.map(b=>b[1]),m.mask==null&&(m.mask=v),y=Gt(h.call(g,m)),x=Gt(h.computeMask(g,v));if(h.activityRegularizer)throw new ft("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let b=0;b<f.length;++b){const _=f[b],E=y[b],I=x[b];r[_.id]=[E,I]}}}}const i=[],o=[],a=[];for(const l of this.outputs){ra(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=r[l.id];a.push(u.shape),i.push(u),o.push(c)}return[i,o,a]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof yo?1:0;for(let i=0;i<s.inboundNodes.length;i++){const o=yo.nodeKey(s,i);this.containerNodes.has(o)&&(t[o]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new K("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new K(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new K(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return se(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=yo.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],f=yo.nodeKey(o,h);let p={};if(this.containerNodes.has(f)){if(d.callArgs)try{JSON.stringify(d.callArgs),p=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(d.inboundLayers.length>0){const m=[];for(let g=0;g<d.inboundLayers.length;g++){const v=d.inboundLayers[g],y=d.nodeIndices[g],x=d.tensorIndices[g],b=yo.nodeKey(v,y);let _=t[b];_==null&&(_=0),m.push([v.name,_,x,p])}u.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=l,c.inboundNodes=u,r.push(c)}e.layers=r;const s=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=yo.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=t[u];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];s.push([a.name,c,h])}e.inputLayers=s;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=yo.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=t[u];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return e.outputLayers=i,e}static fromConfig(e,t,r={},s=!1){const i={},o={};function a(g,v){g.name in o?o[g.name].push(v):o[g.name]=[v]}function l(g,v){const y=[];let x;for(const b of v){const _=b[0],E=b[1],I=b[2];if(x=b[3]==null?{}:b[3],!(_ in i)){a(g,v);return}const C=i[_];if(C.inboundNodes.length<=E){a(g,v);return}const S=C.inboundNodes[E];y.push(S.outputTensors[I])}y.length>0&&g.apply($s(y),x)}function u(g){const v=g.name,y=fl(g,t.customObjects!=null?t.customObjects:{});y.setFastWeightInitDuringBuild(s),i[v]=y,g.inboundNodes.forEach(b=>{if(!(b instanceof Array))throw new K(`Corrupted configuration, expected array for nodeData: ${b}`);a(y,b)})}const c=t.name,h=t.layers;for(const g of h)u(g);for(;!nCe(o);)for(const g of h){const v=i[g.name];if(v.name in o){const y=o[v.name];delete o[v.name];for(const x of y)l(v,x)}}const d=[],f=[],p=t.inputLayers;for(const g of p){const v=g[0],y=g[1],x=g[2];ra(v in i);const _=i[v].inboundNodes[y].outputTensors;d.push(_[x])}const m=t.outputLayers;for(const g of m){const v=g[0],y=g[1],x=g[2];ra(v in i);const _=i[v].inboundNodes[y].outputTensors;f.push(_[x])}return new e({inputs:d,outputs:f,name:c})}get stateful(){if(this._stateful)throw new K("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){se(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function x2e(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(i=>{i in n?s.push(n[i]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function BG(n,e){return x2e(n,e,"classWeight")}async function VG(n,e,t,r){if(t!=null){const s=se(()=>{if(n.shape.length===1)return ch(n);if(n.shape.length===2){if(n.shape[1]>1)return Kg(n,1);if(n.shape[1]===1)return ee(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await s.data());wt(s);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),Js(o,"float32")}else return null}function b2e(n,e){return Y(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const w2e=32;function zG(n,e){let t,r;const s=e;t=s.xs,r=s.ys,M(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=Z3("input",n.inputNames,t),o=Z3("output",n.outputNames,r),a=i[0].shape[0];M(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),M(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)M(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)M(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function Z3(n,e,t){if(t instanceof ir)return[t];if(Array.isArray(t))return M(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new K(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function _2e(n){if(n.length===3)throw new ft("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function k2e(n,e,t){const r=t.batchesPerEpoch!=null;if(M(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),M(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),M(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),M(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),M(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let i,o;if(s)if(e4(t.validationData))M(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const g=_2e(t.validationData);i=g.xs,o=g.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;s?u=l.slice().concat(l.map(g=>"val_"+g)):u=l.slice();const c=AG(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:d,history:f}=RG(c,h,t.epochs,null,null,C2e(e,t),null,s,u);d.setModel(n),n.history=f,await d.onTrainBegin(),n.stopTraining_=!1;let p=t.initialEpoch==null?0:t.initialEpoch,m=await e.iterator();for(;p<t.epochs;){const g={};await d.onEpochBegin(p);let v=0,y=0;for(r||(m=await e.iterator());!r||v<t.batchesPerEpoch;){const x=await m.next();if(r&&x.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(x.value!=null){const{xs:b,ys:_}=zG(n,x.value),E={};E.batch=y,E.size=b[0].shape[0],await d.onBatchBegin(y,E);const I=[];if(t.classWeight!=null){const T=BG(t.classWeight,n.outputNames);for(let N=0;N<T.length;++N)I.push(await VG(_[N],null,T[N]))}const C=b.concat(_).concat(I),S=a(C);wt(C);for(let T=0;T<l.length;++T){const N=l[T],R=S[T];E[N]=R,ya(R)}await d.onBatchEnd(y,E),NG(E),y++,v++}if(r?v>=t.batchesPerEpoch:x.done){if(s){let b;e4(t.validationData)?b=Gt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):b=Gt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?w2e:t.validationBatchSize,verbose:0}));for(let _=0;_<n.metricsNames.length;++_)g[`val_${n.metricsNames[_]}`]=b[_]}break}if(n.stopTraining_)break}if(await d.onEpochEnd(p,g),p++,n.stopTraining_)break}return await d.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function C2e(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function e4(n){return typeof n.iterator=="function"}function I2e(n){return typeof n.next=="function"}async function S2e(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let i=[];if(t.verbose>0)throw new ft("Verbose mode is not implemented yet.");M(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=I2e(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<t.batches;){const u=await o.next();if(i=se(()=>{if(u.value){const{xs:c,ys:h}=zG(n,u.value),d=c.concat(h),f=se(()=>s(d));if(wt(d),l===0)for(let m=0;m<f.length;++m)i.push(Vt(0));const p=d[0].shape[0];for(let m=0;m<f.length;++m){const g=f[m],v=i[m];i[m]=se(()=>we(i[m],Y(p,g))),l>0&&wt(v)}wt(f),a+=p,++l}return i}),u.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const c=i[u];i[u]=Je(i[u],a),wt(c)}return $s(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function y2(n){M(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function gm(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>dh(r,e,t-e)):dh(n,e,t-e)}function cE(n,e){return se(()=>n==null?null:Array.isArray(n)?n.map(t=>cE(t,e)):mG(n,e.dtype==="int32"?e:De(e,"int32")))}function x2(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function UG(n){const e=[];n instanceof ir&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(zy(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function vo(n,e){if(n==null)return;const t=[];if(e instanceof ir)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const i=e[s];t.push(i.id)}const r=[];if(n instanceof ir)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const i=n[s];t.indexOf(i.id)===-1&&r.push(i)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E2e(n){return n instanceof ir}function hE(n){return Array.isArray(n)}function t4(n){return!E2e(n)&&!hE(n)}function n4(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(hE(n)&&n.length>0)o=!0;else if(t4(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new K(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(t4(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new K(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(hE(n)){if(n=n,n.length!==e.length)throw new K(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new K(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=UG(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new K(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],c=t[o][l];if(c!=null&&c>=0&&u!==c)throw new K(`${s} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function T2e(n,e,t){const r=Vu(n.map(i=>i.shape[0]));r.sort();const s=Vu(e.map(i=>i.shape[0]));if(s.sort(),r.length>1)throw new K(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(s.length>1)throw new K(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(r.length>0&&s.length>0&&!Ut(r,s))throw new K(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function N2e(n,e,t){const r=[yk,xk,ev];for(let s=0;s<n.length;++s){const i=n[s],o=e[s],a=t[s];if(o!=null){if(o===ev&&i.shape[i.shape.length-1]===1)throw new K(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const h=l[c],d=u[c];if(d!=null&&h!==d)throw new K(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function r4(n,e,t,r=!0,s=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new K(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new K(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new K(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],c=t[o][l];if(c!=null&&c!==u)throw new K(`Error when checking ${s}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function A2e(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let i=t.hasOwnProperty(s)?t[s]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}const R2e="layers-model";class ff extends yo{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new K("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");f2e(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=d2e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof gc))throw new K("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new K(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(v2(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new K(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>v2(a))}else{const o=v2(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],hh("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const s=A2e(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};hh("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=s[o];(u=>{const c="";let h,d,f;for(const p of u){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===xk?["accuracy","acc"].indexOf(p)!==-1?d=$G:["crossentropy","ce"].indexOf(p)!==-1&&(d=n2e):this.lossFunctions[o]===Aw?["accuracy","acc"].indexOf(p)!==-1?d=r2e:["crossentropy","ce"].indexOf(p)!==-1&&(d=FG):["accuracy","acc"].indexOf(p)!==-1?d=PG:["crossentropy","ce"].indexOf(p)!==-1&&(d=OG);let v;["accuracy","acc"].indexOf(p)!==-1?v="acc":["crossentropy","ce"].indexOf(p)!==-1&&(v="ce"),f=d,h=c+v}else f=h2e(p),h=c+g0(p);let m;hh(h,()=>{m=f}),i(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;y2(s);const o=this.standardizeUserDataXY(e,t,!0,s);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,s,r.verbose,r.steps);return $s(u)}finally{vo(o[0],e),vo(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),S2e(this,e,t)}checkNumSamples(e,t,r,s="steps"){let i;if(r!=null){if(i=null,t!=null)throw new K(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new K(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new K("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],i=this.retrieveSymbolicTensors(s),o=new yu;if(e instanceof ir&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new K(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new K(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Lm(i,o);return r?a:a[0]}retrieveSymbolicTensors(e){const t=Mh(null,e.length);let r=e.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((i,o)=>{i==null&&s.push(e[o])}),new K(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return se(()=>{const s=this.checkNumSamples(e);if(r)throw new ft("Verbose predictLoop() is not implemented yet.");const i=x2(s,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)se(()=>{const u=i[a][0],c=i[a][1],h=gm(e,u,c),d=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)d.push({key:this.inputs[p],value:h[p]});else d.push({key:this.inputs[0],value:h});const f=new yu(d);return Lm(this.outputs,f)}).forEach((u,c)=>o[c].push(u));return $s(o.map(a=>Fs(a,0)))})}predict(e,t={}){const r=UG(e);r4(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return y2(s),this.predictLoop(r,s)}finally{vo(r,e)}}predictOnBatch(e){r4(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new Zi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Aw?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=n4(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=n4(t,this.feedOutputNames,i,!1,"target"),T2e(e,t),N2e(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new K(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(r!=null)throw new Error("sample weight is not supported yet.");let u=null;if(s!=null){const c=BG(s,this.outputNames);u=[];for(let h=0;h<c.length;++h)u.push(await VG(l[h],null,c[h]))}return[a,l,u]}testLoop(e,t,r,s=0,i){return se(()=>{const o=this.checkNumSamples(t,r,i,"steps"),a=[];if(s>0)throw new ft("Verbose mode is not implemented yet.");if(i!=null)throw new ft("steps mode in testLoop() is not implemented yet");{const l=x2(o,r),u=Js(Lo(0,o));for(let c=0;c<l.length;++c){const h=l[c][0],d=l[c][1],f=dh(u,h,d-h),p=cE(t,f),m=e(p);if(c===0)for(let g=0;g<m.length;++g)a.push(Vt(0));for(let g=0;g<m.length;++g){const v=m[g];a[g]=we(a[g],Y(d-h,v))}}for(let c=0;c<a.length;++c)a[c]=Je(a[c],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let i=s;if(z3(e,s)>1){const o=z3(e.slice(0,r),s);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:r[m]});const d=new yu(h),f=Lm(this.outputs,d,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let v=g(s[m],f[m]);i[m]!=null&&(v=b2e(v,i[m]));const y=Zn(v);t.push(y),m===0?p=v:p=we(p,v)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=t[m];else{const v=this.metricsTensors[m][0],y=this.metricsTensors[m][1];g=Zn(v(s[y],f[y]))}ya(g),o.push(g)}return p=Zn(p),this.calculateLosses().forEach(m=>{p=we(p,m)}),p},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>se(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:s[u]});const a=new yu(o),l=Lm(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],h=Zn(c(i[u],l[u]));u===0?r=h:r=we(r,h),t.push(r)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],h=this.metricsTensors[u][1],d=Zn(c(i[h],l[h]));t.push(d)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,i,o,a,l,u,c,h,d;try{const f=r.batchSize==null?32:r.batchSize;y2(f);const m=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,f);s=m[0],i=m[1],d=m[2];let g=!1,v;if(r.validationData!=null&&r.validationData.length>0){if(g=!0,r.validationData.length===2)l=r.validationData[0],u=r.validationData[1];else throw r.validationData.length===3?new ft("validationData including sample weights is not supported yet."):new K(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const T=await this.standardizeUserData(l,u,null,null,!0,f);c=T[0],h=T[1],v=c.concat(h)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){g=!0;const S=Math.floor(s[0].shape[0]*(1-r.validationSplit)),T=s[0].shape[0];c=gm(s,S,T),o=s,s=gm(s,0,S),h=gm(i,S,T),a=i,i=gm(i,0,S),v=c.concat(h)}else r.validationSteps!=null&&(g=!0);const y=s.concat(i).concat(d);this.checkTrainableWeightsConsistency();const x=this.makeTrainFunction(),b=this.getDedupedMetricsNames();let _,E;g?(this.makeTestFunction(),_=this.testFunction,E=b.slice().concat(b.map(S=>"val_"+S))):(_=null,v=[],E=b.slice());const I=AG(r.callbacks,r.yieldEvery);return await this.fitLoop(x,y,b,f,r.epochs,r.verbose,I,_,v,r.shuffle,E,r.initialEpoch,null,null)}finally{this.isTraining=!1,vo(s,e),vo(i,t),vo(o,e),vo(a,t),vo(c,l),vo(h,u),d!=null&&wt(d)}}async fitLoop(e,t,r,s,i,o,a,l,u,c,h,d,f,p){s==null&&(s=32),i==null&&(i=1),c==null&&(c=!0),d==null&&(d=0);let m=!1;if(l!=null&&u!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new K("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(t,s,f,"steps_per_epoch");let v;g!=null&&(v=Lo(0,g)),o==null&&(o=1);const{callbackList:y,history:x}=RG(a,o,i,d,g,f,s,m,h);y.setModel(this),this.history=x,await y.onTrainBegin(),this.stopTraining_=!1;for(let b=d;b<i;++b){await y.onEpochBegin(b);const _={};if(f!=null)throw new ft("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new ft("batch shuffling is not implemneted yet");c&&mve(v);const E=Js(v),I=x2(g,s);for(let C=0;C<I.length;++C){const S={};if(await y.onBatchBegin(C,S),se(()=>{const T=I[C][0],N=I[C][1],R=dh(E,T,N-T);S.batch=C,S.size=N-T;const D=cE(t,R),z=e(D);for(let L=0;L<r.length;++L){const O=r[L],F=z[L];S[O]=F,ya(F)}if(C===I.length-1&&m){const L=this.testLoop(l,u,s);for(let O=0;O<r.length;++O){const F=r[O],P=L[O];ya(P),_["val_"+F]=P}}}),await y.onBatchEnd(C,S),NG(S),this.stopTraining_)break}E.dispose()}if(await y.onEpochEnd(b,_),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return k2e(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],i=r[1],a=this.makeTrainFunction()(s.concat(i)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return wt(a),vo(r[0],e),vo(r[1],t),$s(l)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,i=this.getWeights(r);for(let o=0;o<s.length;++o)r&&!s[o].trainable||t.push({name:s[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=k3().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-k3().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=el(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>el(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=el(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[el(g0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>el(g0(e)));{const e={};for(const t in this.metrics)e[t]=el(g0(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=lE(e.optimizer_config),r=fl(t);let s;if(typeof e.loss=="string")s=Hc(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(o=>Hc(o));else if(e.loss!=null){s={};for(const o in e.loss)s[o]=Hc(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Hc(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Hc(e.metrics[o])}this.compile({loss:s,metrics:i,optimizer:r})}async save(e,t){if(typeof e=="string"){const u=hye(e);if(u.length===0)throw new K(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new K(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new K("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await I3(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:R2e,generatedBy:`TensorFlow.js tfjs-layers v${LG}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:h}=await I3(await this.optimizer.getWeights(),u);r.specs.push(...h),r.data=cye([r.data,c])}return this.userDefinedMetadata!=null&&(J3(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){J3(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ff.className="Model";xe(ff);class jG extends ff{}jG.className="Functional";xe(jG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tv extends ff{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:mk("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new K(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof tv||e instanceof ff;let r;if(t){if(r=e,r.outputs.length!==1)throw new K("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new K("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new K("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=$Ce({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new K(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new K("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=CG(this.outputs[0])}this.inboundNodes=[],new vk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Mh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ot(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ff({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new K("Legacy serialization format not supported yet.");i=t}else M(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof tv))throw new ft(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const c=fl(l,void 0,s);s&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new K("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new K("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}tv.className="Sequential";xe(tv);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ts=class extends Tp{getConfig(){return{}}};class WG extends ts{apply(e,t=1){return vCe(e,t)}}WG.className="elu";xe(WG);class HG extends ts{apply(e){return lH(e)}}HG.className="selu";xe(HG);class GG extends ts{apply(e){return nd(e)}}GG.className="relu";xe(GG);class qG extends ts{apply(e){return se(()=>Qg(6,nd(e)))}}qG.className="relu6";xe(qG);class KG extends ts{apply(e){return e}}KG.className="linear";xe(KG);class XG extends ts{apply(e){return Ip(e)}}XG.className="sigmoid";xe(XG);class YG extends ts{apply(e){return xCe(e)}}YG.className="hardSigmoid";xe(YG);class QG extends ts{apply(e){return $y(e)}}QG.className="softplus";xe(QG);class JG extends ts{apply(e){return yCe(e)}}JG.className="softsign";xe(JG);class ZG extends ts{apply(e){return ik(e)}}ZG.className="tanh";xe(ZG);let SD=class extends ts{apply(e,t=-1){return NR(e,t)}};SD.className="softmax";xe(SD);class eq extends ts{apply(e,t=-1){return Z5(e,t)}}eq.className="logSoftmax";xe(eq);class tq extends ts{apply(e){return se(()=>se(()=>{const t=Math.sqrt(2),r=Y(.5,we(1,K5(Je(e,t))));return Y(e,r)}))}}tq.className="gelu";xe(tq);class nq extends ts{apply(e){return se(()=>Y(.5,Y(e,we(1,ik(Y(Zr(Je(2,Math.PI)),we(e,Y(.044715,Ph(e,3)))))))))}}nq.className="gelu_new";xe(nq);class rq extends ts{apply(e){return se(()=>Y(e,ik($y(e))))}}rq.className="mish";xe(rq);class sq extends ts{apply(e,t=1){return se(()=>Y(Ip(Y(e,t)),e))}}sq.className="swish";xe(sq);function nc(n){return n.getClassName()}function b2(n,e={}){return Vy(n,Hi.getMap().classNameMap,e,"activation")}function rc(n){if(n==null){const e={};return e.className="linear",e.config={},b2(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},b2(e)}else return n instanceof ts?n:b2(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function D2e(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class iq extends Tp{}class oq extends iq{constructor(e){super(),D2e(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return se(()=>{let t=yr([1]);return this.hasL1&&(t=we(t,Ye(Y(this.l1,ds(e))))),this.hasL2&&(t=we(t,Ye(Y(this.l2,Uy(e))))),ee(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}oq.className="L1L2";xe(oq);const s4={l1l2:"L1L2"};function nn(n){return dD(n)}function i4(n,e={}){return Vy(n,Hi.getMap().classNameMap,e,"regularizer")}function _n(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in s4?s4[n]:n,config:{}};return i4(t)}else return n instanceof iq?n:i4(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aq extends yt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=nt(e);let r=nd(e);return this.maxValue!=null&&(r=Ei(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}aq.className="ReLU";xe(aq);class lq extends yt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=nt(e);return fR(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}lq.className="LeakyReLU";xe(lq);class uq extends yt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=wn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=_n(e.alphaRegularizer),this.alphaConstraint=dr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new K(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ot(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new cr({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=nt(e),xR(e,this.alpha.read())}getConfig(){const e={alphaInitializer:En(this.alphaInitializer),alphaRegularizer:nn(this.alphaRegularizer),alphaConstraint:hr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}uq.className="PReLU";xe(uq);let cq=class extends yt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new ft(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=nt(e);return lk(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};cq.className="ELU";xe(cq);class hq extends yt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=nt(e);return Y(r,De(Ri(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}hq.className="ThresholdedReLU";xe(hq);class dq extends yt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new SD().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return se(()=>{let r=nt(e);const s=t.mask;if(s!=null){const i=Y(et(mc(r.shape),De(s,r.dtype)),Vt(-1e9));r=we(r,i)}return this.axis instanceof Array?this.axis.length>1?Aa(et(r,eH(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}dq.className="Softmax";xe(dq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pf(n,e,t){if(typeof n=="number")return Mh(n,e);if(n.length!==e)throw new K(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!fCe(s))throw new K(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function $o(n,e,t,r,s=1){if(n==null)return n;const i=e+(e-1)*(s-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function sa(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+tc([t-e,0]);else if(r==="same")n=n*e;else throw new K(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ED(n,e){return se(()=>(qn(e),e==="channelsFirst"?Nt(n,[0,2,3,1]):n))}function fq(n,e){return se(()=>(qn(e),e==="channelsFirst"?Nt(n,[0,2,3,4,1]):n))}function $2e(n,e,t,r=1,s="valid",i,o=1){return se(()=>{if(i==null&&(i=Bo()),qn(i),n.shape.length!==3)throw new K(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new K(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new K(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=Nt(n,[0,2,1])),s==="causal")throw new ft("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=j5(n,e,r,s==="same"?"same":"valid","NWC",o);return t!=null&&(a=jo(a,t)),a})}function o4(n,e,t,r=[1,1],s="valid",i,o,a=null){return se(()=>{if(i==null&&(i=Bo()),qn(i),n.rank!==3&&n.rank!==4)throw new K(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new K(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=ED(n,i);if(s==="causal")throw new ft("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Uwe({x:l,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=Nt(l,[0,3,1,2])),l})}function P2e(n,e,t,r=[1,1,1],s="valid",i,o){return se(()=>{if(i==null&&(i=Bo()),qn(i),n.rank!==4&&n.rank!==5)throw new K(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new K(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=fq(n,i);if(s==="causal")throw new ft("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=zxe(a,e,r,s==="same"?"same":"valid","NDHWC",o),t!=null&&(a=jo(a,t)),i==="channelsFirst"&&(a=Nt(a,[0,4,1,2,3])),a})}class bk extends yt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",bk.verifyArgs(t),this.rank=e,br(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ft(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=pf(t.kernelSize,e,"kernelSize"),this.strides=pf(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Di(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qn(this.dataFormat),this.activation=rc(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=wn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=dr(t.biasConstraint),this.biasRegularizer=_n(t.biasRegularizer),this.activityRegularizer=_n(t.activityRegularizer),this.dilationRate=pf(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new K(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new K(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new K(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(ra("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!fD(e.kernelSize,"number",1,3))throw new K(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:nc(this.activation),useBias:this.useBias,biasInitializer:En(this.biasInitializer),biasRegularizer:nn(this.biasRegularizer),activityRegularizer:nn(this.activityRegularizer),biasConstraint:hr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Np extends bk{constructor(e,t){super(e,t),this.kernel=null,Np.verifyArgs(t),this.filters=t.filters,br(this.filters,"filters"),this.kernelInitializer=wn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=dr(t.kernelConstraint),this.kernelRegularizer=_n(t.kernelRegularizer)}build(e){e=Ot(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new K(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return se(()=>{e=nt(e);let r;const s=this.bias==null?null:this.bias.read(),i=uG(this.activation.getClassName());if(i!=null&&this.rank===2)r=o4(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=$2e(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=o4(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=P2e(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ft("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=Ot(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<r.length;++i){const o=$o(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:En(this.kernelInitializer),kernelRegularizer:nn(this.kernelRegularizer),kernelConstraint:hr(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new K(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Gy extends Np{constructor(e){super(2,e),Gy.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!fD(e.kernelSize,"number",1,2))throw new K(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Gy.className="Conv2D";xe(Gy);class qy extends Np{constructor(e){super(3,e),qy.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new K(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}qy.className="Conv3D";xe(qy);class pq extends Gy{constructor(e){if(super(e),this.inputSpec=[new cr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new K(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ot(e),e.length!==4)throw new K("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new K("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new cr({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return se(()=>{let r=nt(e);if(r.shape.length!==4)throw new K(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=s[o],u=s[a],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],f=this.strides[1],p=sa(l,d,c,this.padding),m=sa(u,f,h,this.padding),g=[i,p,m,this.filters];this.dataFormat!=="channelsLast"&&(r=Nt(r,[0,2,3,1]));let v=W5(r,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=Nt(v,[0,3,1,2])),this.bias!=null&&(v=jo(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=Ot(e);const t=e.slice();let r,s,i;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3):(r=3,s=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[r]=this.filters,t[s]=sa(t[s],l,o,this.padding),t[i]=sa(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}pq.className="Conv2DTranspose";xe(pq);class mq extends qy{constructor(e){if(super(e),this.inputSpec=[new cr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new K(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ot(e),e.length!==5)throw new K("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new K("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new cr({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return se(()=>{let r=nt(e);if(r.shape.length!==5)throw new K(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=s[l],c=s[o],h=s[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],v=this.strides[2],y=sa(u,m,d,this.padding),x=sa(c,g,f,this.padding),b=sa(h,v,p,this.padding),_=[i,y,x,b,this.filters];this.dataFormat!=="channelsLast"&&(r=Nt(r,[0,2,3,4,1]));let E=Wxe(r,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(E=Nt(E,[0,4,1,2,3])),this.bias!==null&&(E=jo(E,this.bias.read(),this.dataFormat)),this.activation!==null&&(E=this.activation.apply(E)),E})}computeOutputShape(e){e=Ot(e);const t=e.slice();let r,s,i,o;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3,o=4):(r=4,s=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return t[r]=this.filters,t[s]=sa(t[s],c,a,this.padding),t[i]=sa(t[i],h,l,this.padding),t[o]=sa(t[o],d,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}mq.className="Conv3DTranspose";xe(mq);class gq extends Np{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new K("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new K("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new K(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=wn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=_n(t.depthwiseRegularizer),this.depthwiseConstraint=dr(t.depthwiseConstraint),this.pointwiseInitializer=wn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=_n(t.pointwiseRegularizer),this.pointwiseConstraint=dr(t.pointwiseConstraint)}build(e){if(e=Ot(e),e.length<this.rank+2)throw new K(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new K(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new cr({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return se(()=>{e=nt(e);let r;if(this.rank===1)throw new ft("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Nt(e,[0,2,3,1])),r=uH(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=jo(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Nt(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=En(this.depthwiseInitializer),e.pointwiseInitializer=En(this.pointwiseInitializer),e.depthwiseRegularizer=nn(this.depthwiseRegularizer),e.pointwiseRegularizer=nn(this.pointwiseRegularizer),e.depthwiseConstraint=hr(this.depthwiseConstraint),e.pointwiseConstraint=hr(this.pointwiseConstraint),e}}gq.className="SeparableConv";class vq extends gq{constructor(e){super(2,e)}}vq.className="SeparableConv2D";xe(vq);class wk extends Np{constructor(e){super(1,e),wk.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!fD(e.kernelSize,"number",1,1))throw new K(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}wk.className="Conv1D";xe(wk);class yq extends yt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return se(()=>{if(e=nt(e),this.dataFormat==="channelsLast"){const r=m0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return m0(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=m0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return m0(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}yq.className="Cropping2D";xe(yq);class xq extends yt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,cCe(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return se(()=>{let r=nt(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=Nt(r,[0,2,3,1]);const i=this.size[0]*s[2],o=this.size[1]*s[3],a=this.interpolation==="nearest"?il.resizeNearestNeighbor(r,[i,o]):il.resizeBilinear(r,[i,o]);return Nt(a,[0,3,1,2])}else{const i=this.size[0]*s[1],o=this.size[1]*s[2];return this.interpolation==="nearest"?il.resizeNearestNeighbor(r,[i,o]):il.resizeBilinear(r,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}xq.className="UpSampling2D";xe(xq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function O2e(n,e,t=[1,1],r="valid",s,i){return se(()=>{s==null&&(s=Bo()),qn(s);let o=ED(n,s);if(n.rank!==4)throw new K(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new K(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=uR(o,e,t,r==="same"?"same":"valid","NHWC",i),s==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}class bq extends bk{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=wn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=dr(e.depthwiseConstraint),this.depthwiseRegularizer=_n(e.depthwiseRegularizer)}build(e){if(e=Ot(e),e.length<4)throw new K(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new K(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{e=nt(e);let r=O2e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=jo(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=Ot(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=$o(t,this.kernelSize[0],this.padding,this.strides[0]),o=$o(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,o]:[e[0],i,o,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=En(this.depthwiseInitializer),e.depthwiseRegularizer=nn(this.depthwiseRegularizer),e.depthwiseConstraint=hr(this.depthwiseRegularizer),e}}bq.className="DepthwiseConv2D";xe(bq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wq(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new K("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(i){return i==null||Array.isArray(i)?i:[i]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function _q(n,e,t,r=!1,s,i,o=!1,a=!1){return se(()=>{const l=e.shape.length;if(l<3)throw new K(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Lo(2,l));e=Nt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=De(De(s,"bool"),"float32"),s.rank===l-1&&(s=Ds(s,-1)),s=Nt(s,u)),r&&(e=Oh(e,0),s!=null&&(s=Oh(s,0)));const c=[];let h,d=t;const f=e.shape[0],p=Fh(e);let m;s!=null&&(m=Fh(s));for(let v=0;v<f;++v){const y=p[v],x=se(()=>n(y,d));if(s==null)h=x[0],d=x[1];else{const b=se(()=>{const _=m[v],E=et(lo(_),_),I=we(Y(x[0],_),Y(d[0],E)),C=d.map((S,T)=>we(Y(x[1][T],_),Y(S,E)));return{output:I,newStates:C}});h=b.output,d=b.newStates}a&&c.push(h)}let g;return a&&(g=Cl(c,1)),[h,g,d]})}class vc extends yt{constructor(e){super(e);let t;if(e.cell==null)throw new K("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new AD({cells:e.cell}):t=e.cell,t.stateSize==null)throw new K("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new cr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Lo(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){iE(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[s].concat(i)}else return s}computeMask(e,t){return se(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(i=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new ft("Constants support is not implemented in RNN yet.");iE(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new cr({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Ut(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new K(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new cr({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){se(()=>{if(!this.stateful)throw new na("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new K("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>yr([r,s])):this.states_=[yr([r,this.cell.stateSize])];else if(e==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>yr([r,s])):this.states_[0]=yr([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new K(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let s=0;s<this.states_.length;++s){const i=e[s],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[r,o];if(!Ut(i.shape,a))throw new K(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>ya(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=wq(e,r,s,this.numConstants);e=i.inputs,r=i.initialState,s=i.constants;let o=[],a=[];if(r!=null){t.initialState=r,o=o.concat(r),this.stateSpec=[];for(const u of r)this.stateSpec.push(new cr({shape:u.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(t.constants=s,o=o.concat(s),this.numConstants=s.length),o[0]instanceof Da){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,t);return this.inputSpec=h,d}else return super.apply(e,t)}call(e,t){return se(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let i=t==null?null:t.initialState;e=nt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new K(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},u=_q((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,i,this.goBackwards,r,null,this.unroll,this.returnSequences),c=u[0],h=u[1],d=u[2];this.stateful&&this.resetStates(d,s);const f=this.returnSequences?h:c;return this.returnState?[f].concat(d):f})}getInitialState(e){return se(()=>{let t=yr(e.shape);return t=Ye(t,[1,2]),t=zy(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?rE(t,[1,r]):t):this.cell.stateSize>1?[rE(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===vc.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,i=fl(s,r);return new e(Object.assign(t,{cell:i}))}}vc.className="RNN";xe(vc);class _k extends yt{}class TD extends _k{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,br(this.units,"units"),this.activation=rc(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=_n(e.kernelRegularizer),this.recurrentRegularizer=_n(e.recurrentRegularizer),this.biasRegularizer=_n(e.biasRegularizer),this.kernelConstraint=dr(e.kernelConstraint),this.recurrentConstraint=dr(e.recurrentConstraint),this.biasConstraint=dr(e.biasConstraint),this.dropout=Yf([1,tc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yf([1,tc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ot(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{if(e=e,e.length!==2)throw new K(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sc({ones:()=>lo(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sc({ones:()=>lo(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=wa(Y(e,o),this.kernel.read()):i=wa(e,this.kernel.read()),this.bias!=null&&(i=jo(i,this.bias.read())),a!=null&&(r=Y(r,a));let l=we(i,wa(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:nc(this.activation),useBias:this.useBias,kernelInitializer:En(this.kernelInitializer),recurrentInitializer:En(this.recurrentInitializer),biasInitializer:En(this.biasInitializer),kernelRegularizer:nn(this.kernelRegularizer),recurrentRegularizer:nn(this.recurrentRegularizer),biasRegularizer:nn(this.biasRegularizer),activityRegularizer:nn(this.activityRegularizer),kernelConstraint:hr(this.kernelConstraint),recurrentConstraint:hr(this.recurrentConstraint),biasConstraint:hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}TD.className="SimpleRNNCell";xe(TD);class kq extends vc{constructor(e){e.cell=new TD(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return new e(t)}}kq.className="SimpleRNN";xe(kq);class ND extends _k{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new K("GRUCell does not support reset_after parameter set to true.");this.units=e.units,br(this.units,"units"),this.activation=rc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=rc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=_n(e.kernelRegularizer),this.recurrentRegularizer=_n(e.recurrentRegularizer),this.biasRegularizer=_n(e.biasRegularizer),this.kernelConstraint=dr(e.kernelConstraint),this.recurrentConstraint=dr(e.recurrentConstraint),this.biasConstraint=dr(e.biasConstraint),this.dropout=Yf([1,tc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yf([1,tc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ot(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{if(e=e,e.length!==2)throw new K(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sc({ones:()=>lo(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sc({ones:()=>lo(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=Y(e,i[0]));let c=wa(e,this.kernel.read());this.useBias&&(c=jo(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=Y(s,o[0]));const h=this.recurrentKernel.read(),[d,f]=ki(h,[2*this.units,this.units],h.rank-1),p=wa(s,d),[m,g,v]=ki(c,3,c.rank-1),[y,x]=ki(p,2,p.rank-1);a=this.recurrentActivation.apply(we(m,y)),l=this.recurrentActivation.apply(we(g,x));const b=wa(Y(l,s),f);u=this.activation.apply(we(v,b));const _=we(Y(a,s),Y(we(1,Wn(a)),u));return[_,_]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:nc(this.activation),recurrentActivation:nc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:En(this.kernelInitializer),recurrentInitializer:En(this.recurrentInitializer),biasInitializer:En(this.biasInitializer),kernelRegularizer:nn(this.kernelRegularizer),recurrentRegularizer:nn(this.recurrentRegularizer),biasRegularizer:nn(this.biasRegularizer),activityRegularizer:nn(this.activityRegularizer),kernelConstraint:hr(this.kernelConstraint),recurrentConstraint:hr(this.recurrentConstraint),biasConstraint:hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}ND.className="GRUCell";xe(ND);class Cq extends vc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new ND(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Cq.className="GRU";xe(Cq);class kk extends _k{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,br(this.units,"units"),this.activation=rc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=rc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=_n(e.kernelRegularizer),this.recurrentRegularizer=_n(e.recurrentRegularizer),this.biasRegularizer=_n(e.biasRegularizer),this.kernelConstraint=dr(e.kernelConstraint),this.recurrentConstraint=dr(e.recurrentConstraint),this.biasConstraint=dr(e.biasConstraint),this.dropout=Yf([1,tc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yf([1,tc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ot(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;s=new(t=class extends co{apply(l,u){const c=i.apply([o]),h=new mD().apply([o]),d=i.apply([o*2]);return j3(j3(c,h),d)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return se(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new K(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sc({ones:()=>lo(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sc({ones:()=>lo(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,h;0<this.dropout&&this.dropout<1&&(e=Y(e,o[0]));let d=wa(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=Y(s,a[0])),d=we(d,wa(s,this.recurrentKernel.read())),this.useBias&&(d=jo(d,this.bias.read()));const[f,p,m,g]=ki(d,4,d.rank-1);l=this.recurrentActivation.apply(f),u=this.recurrentActivation.apply(p),c=we(Y(u,i),Y(l,this.activation.apply(m))),h=this.recurrentActivation.apply(g);const v=Y(h,this.activation.apply(c));return[v,v,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:nc(this.activation),recurrentActivation:nc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:En(this.kernelInitializer),recurrentInitializer:En(this.recurrentInitializer),biasInitializer:En(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:nn(this.kernelRegularizer),recurrentRegularizer:nn(this.recurrentRegularizer),biasRegularizer:nn(this.biasRegularizer),activityRegularizer:nn(this.activityRegularizer),kernelConstraint:hr(this.kernelConstraint),recurrentConstraint:hr(this.recurrentConstraint),biasConstraint:hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}kk.className="LSTMCell";xe(kk);class Iq extends vc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new kk(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Iq.className="LSTM";xe(Iq);class AD extends _k{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return se(()=>{e=e;let r=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(r.splice(0,a.stateSize.length)):s.push(r.splice(0,1));s.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=s[a],a===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=l.call(o,t),i.push(o.slice(1))}r=[];for(const a of i.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(e){iE(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{hh(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,r={}){const s=[];for(const i of t.cells)s.push(fl(i,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return oE(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,i=e.splice(s);for(let o=0;o<r.weights.length;++o)t.push([r.weights[o],i[o]])}_D(t)}}AD.className="StackedRNNCells";xe(AD);function sc(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):gG(e(),t),a=()=>jy(o,e,r);return!s||s<=1?ya(a().clone()):Array(s).fill(void 0).map(a).map(u=>ya(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var F2e=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Sq extends vc{constructor(e){if(e.unroll)throw new ft("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ft("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new cr({ndim:5})]}call(e,t){return se(()=>{if(this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new K("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return se(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)],o=yr(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){se(()=>{if(!this.stateful)throw new na("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)];if(r[0]==null)throw new K("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>yr(i)):this.states_=[yr(i)];else if(e==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>yr(i)):this.states_[0]=yr(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new K(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!Ut(l.shape,u))throw new K(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ya(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],c=e[l?4:3],h=$o(u,s[0],i,o[0],a[0]),d=$o(c,s[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[r,h,d]:[h,d,r]]}}Sq.className="ConvRNN2D";class RD extends kk{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,br(this.filters,"filters"),this.kernelSize=pf(r,2,"kernelSize"),this.kernelSize.forEach(l=>br(l,"kernelSize")),this.strides=pf(s||1,2,"strides"),this.strides.forEach(l=>br(l,"strides")),this.padding=i||"valid",Di(this.padding),this.dataFormat=o||"channelsLast",qn(this.dataFormat),this.dilationRate=pf(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>br(l,"dilationRate"))}build(e){var t;e=Ot(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new K(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],i=4,o=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(t=class extends co{apply(d,f){const p=u.apply([c]),m=mc([c]),g=u.apply([c*2]);return pD([p,m,g])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return se(()=>{if(e.length!==3)throw new K(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=sc({ones:()=>lo(s),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(W,X,Z)=>!X||!X[Z]?W:Y(X[Z],W);let c=u(s,l,0),h=u(s,l,1),d=u(s,l,2),f=u(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=sc({ones:()=>lo(i),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=u(i,p,0),g=u(i,p,1),v=u(i,p,2),y=u(i,p,3);const x=3,[b,_,E,I]=ki(this.kernel.read(),a,x),[C,S,T,N]=this.useBias?ki(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,b,C,this.padding),h=this.inputConv(h,_,S,this.padding),d=this.inputConv(d,E,T,this.padding),f=this.inputConv(f,I,N,this.padding);const[R,D,z,L]=ki(this.recurrentKernel.read(),a,x);m=this.recurrentConv(m,R),g=this.recurrentConv(g,D),v=this.recurrentConv(v,z),y=this.recurrentConv(y,L);const O=this.recurrentActivation.apply(we(c,m)),F=this.recurrentActivation.apply(we(h,g)),P=we(Y(F,o),Y(O,this.activation.apply(we(d,v)))),U=Y(this.recurrentActivation.apply(we(f,y)),this.activation.apply(P));return[U,U,P]})}getConfig(){const e=super.getConfig(),{units:t}=e,r=F2e(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),s)}inputConv(e,t,r,s){const i=$h(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?jo(i,r,this.dataFormat):i}recurrentConv(e,t){return $h(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}RD.className="ConvLSTM2DCell";xe(RD);class Eq extends Sq{constructor(e){const t=new RD(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Eq.className="ConvLSTM2D";xe(Eq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DD extends yt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,i=this.getNoiseShape(r);return jy(()=>gG(r,this.rate,i,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}DD.className="Dropout";xe(DD);class Tq extends DD{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Tq.className="SpatialDropout1D";xe(Tq);class Nq extends yt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,br(this.units,"units"),this.activation=rc(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=dr(e.kernelConstraint),this.biasConstraint=dr(e.biasConstraint),this.kernelRegularizer=_n(e.kernelRegularizer),this.biasRegularizer=_n(e.biasRegularizer),this.activityRegularizer=_n(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ot(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ot(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e),s=uG(this.activation.getClassName());let i;return s!=null?i=wa(r,this.kernel.read(),s,this.bias?this.bias.read():null):(i=wa(r,this.kernel.read()),this.bias!=null&&(i=jo(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:nc(this.activation),useBias:this.useBias,kernelInitializer:En(this.kernelInitializer),biasInitializer:En(this.biasInitializer),kernelRegularizer:nn(this.kernelRegularizer),biasRegularizer:nn(this.biasRegularizer),activityRegularizer:nn(this.activityRegularizer),kernelConstraint:hr(this.kernelConstraint),biasConstraint:hr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Nq.className="Dense";xe(Nq);class Aq extends yt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ot(e);for(const t of e.slice(1))if(t==null)throw new K(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],zu(e,1)]}call(e,t){return se(()=>{this.invokeCallHook(e,t);let r=nt(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let i=2;i<r.rank;++i)s.push(i);s.push(1),r=Nt(r,s)}return gCe(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Aq.className="Flatten";xe(Aq);class Rq extends yt{constructor(e){super(e),this.supportsMasking=!0,this.activation=rc(e.activation)}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e);return this.activation.apply(r)})}getConfig(){const e={activation:nc(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Rq.className="Activation";xe(Rq);class Dq extends yt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return se(()=>(e=nt(e),pCe(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Dq.className="RepeatVector";xe(Dq);class $q extends yt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let i=1,o=null;for(let l=0;l<s.length;++l){const u=s[l];if(this.isUnknown(u))if(o===null)o=l;else throw new K("Can only specifiy one unknown dimension.");else i*=u}const a=zu(e);if(o!==null){if(i===0||a%i!==0)throw new K(r);s[o]=a/i}else if(a!==i)throw new K(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e),s=r.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return ee(r,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}$q.className="Reshape";xe($q);class Pq extends yt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Lo(1,e.dims.length+1);if(!Ut(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new cr({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ot(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return Nt(nt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Pq.className="Permute";xe(Pq);class Oq extends yt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=nt(e);return YS(_w(r,this.maskValue),-1)}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e),o=YS(_w(r,this.maskValue),-1,!0);return Y(r,De(o,r.dtype))})}}Oq.className="Masking";xe(Oq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fq extends yt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Gt(e.inputLength))}this.inputDim=e.inputDim,br(this.inputDim,"inputDim"),this.outputDim=e.outputDim,br(this.outputDim,"outputDim"),this.embeddingsInitializer=wn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=_n(e.embeddingsRegularizer),this.activityRegularizer=_n(e.activityRegularizer),this.embeddingsConstraint=dr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return se(()=>this.maskZero?(e=nt(e),_w(e,At(e))):null)}computeOutputShape(e){if(e=Ot(e),this.inputLength==null)return[...e,this.outputDim];const t=Gt(this.inputLength);if(t.length!==e.length-1)throw new K(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const i=t[s],o=e[s+1];if(i!=null&&o!=null&&i!==o)throw new K(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[r]=o),r++}}return[e[0],...t,this.outputDim]}call(e,t){return se(()=>{this.invokeCallHook(e,t);let r=nt(e);r.dtype!=="int32"&&(r=ba(r,"int32"));const s=mG(this.embeddings.read(),ee(r,[r.size]));return ee(s,Ot(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:En(this.embeddingsInitializer),embeddingsRegularizer:nn(this.embeddingsRegularizer),activityRegularizer:nn(this.activityRegularizer),embeddingsConstraint:hr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}Fq.className="Embedding";xe(Fq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class id extends yt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ft}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const i=e[e.length-t.length+s],o=t[s];if(i==null||o==null||i<0||o<0)r.push(null);else if(i===1)r.push(o);else if(o===1)r.push(i);else{if(i!==o)throw new K("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(i)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ot(e)]),e=e,e.length<2)throw new K(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Vu(t),t.length>1)throw new K(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const s=e.map(i=>i.length);e.indexOf(null)===-1&&Vu(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return se(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(i=>i.rank);if(s.indexOf(null)===-1){const i=tc(s);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=zy(o,1);r.push(o)}return this.mergeFunction(r)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,h=c[0],d=c.slice(1).concat([h]);let f=ee(l,[h].concat(zu(c.slice(1))));f=Nt(f,[1,0]),f=ee(f,d),r.push(f),i=!0}else if(u>1){const c=Lo(1,u).concat([0]);r.push(Nt(l,c)),i=!0}else r.push(l)}let o=this.mergeFunction(r);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,c=l[u-1],h=[c].concat(l.slice(0,l.length-1));o=ee(Nt(ee(o,[-1,c]),[1,0]),h)}else if(a>1){const l=[a-1].concat(Lo(0,a-1));o=Nt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=Vu(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return se(()=>{if(t==null)return null;if(!Array.isArray(t))throw new K("`mask` should be an Array");if(!Array.isArray(e))throw new K("`inputs` should be an Array");if(t.length!==e.length)throw new K(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:Ds(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=kl(r,t[s]);return r})}}class Mq extends id{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=we(t,e[r]);return t})}}Mq.className="Add";xe(Mq);class Lq extends id{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Y(t,e[r]);return t})}}Lq.className="Multiply";xe(Lq);class Bq extends id{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=we(t,e[r]);return Y(1/e.length,t)})}}Bq.className="Average";xe(Bq);class Vq extends id{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=pc(t,e[r]);return t})}}Vq.className="Maximum";xe(Vq);class zq extends id{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Qg(t,e[r]);return t})}}zq.className="Minimum";xe(zq);class Uq extends id{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new K("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const i=e[s].slice();i.splice(this.axis,1);let o=!1;for(const a of r)if(Ut(a,i)){o=!0;break}o||r.push(i)}if(r.length>1)throw new K("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return se(()=>pD(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new K("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const i of t.slice(1)){if(r[s]==null||i[s]==null){r[s]=null;break}r[s]+=i[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new K("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new K("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new K(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return se(()=>{let r=!0;if(t.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const s=[];for(let o=0;o<e.length;++o)t[o]==null?s.push(De(lo(e[o]),"bool")):t[o].rank<e[o].rank?s.push(Ds(t[o],-1)):s.push(t[o]);const i=Fs(s,this.axis);return U5(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Uq.className="Concatenate";xe(Uq);function vm(n,e){for(;n<0;)n+=e;return n}function M2e(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new ft("batchDot is not implemented for tensors of 4D or higher rank yet");if(M(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),M(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new ft("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const i=t;return se(()=>{let o;if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);e=ee(e,e.shape.concat(l))}else if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);n=ee(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ye(Y(n,e),i[0]):a=Ye(Y(Nt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Lt(n,e,l,u)}if(o>0){let l;r>s?l=r+s-3:l=r-1;const u=[];for(let c=l;c<l+o;++c)u.push(c);a=Oy(a,u)}return a.shape.length===1&&(a=Ds(a,1)),a})}class jq extends id{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){M(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new ft("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new K(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new K(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,o)=>vm(i,e[o].shape.length)):s=[vm(this.axes,t.shape.length),vm(this.axes,r.shape.length)],this.normalize&&(t=Nw(t,s[0]),r=Nw(r,s[1])),M2e(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[vm(this.axes,e.length),vm(this.axes,t.length)],r}computeOutputShape(e){M(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new ft("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const i=t.concat(r);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}jq.className="Dot";xe(jq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wq extends yt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e);return jy(()=>we(gk(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}Wq.className="GaussianNoise";xe(Wq);class Hq extends yt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const r=nt(e);return this.rate>0&&this.rate<1?jy(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return Y(r,gk(r.shape,1,i))},()=>r,t.training||!1):r})}}Hq.className="GaussianDropout";xe(Hq);class Gq extends yt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||nt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return se(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return jy(()=>{const i=nt(e),a=-1.6732632423543772*1.0507009873554805;let l=ed(Py(r),this.rate);l=ba(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,c=-u*a*this.rate,h=we(Y(i,l),Y(we(l,-1),a));return we(Y(h,u),c)},()=>nt(e),t.training||!1)}return e})}}Gq.className="AlphaDropout";xe(Gq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nv(n,e,t,r,s,i=.001){let o;if(n.rank===2)o=vxe(n,e,t,r,s,i);else if(n.rank===3)o=xxe(n,e,t,r,s,i);else if(n.rank===4)o=wxe(n,e,t,r,s,i);else throw new ft(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function L2e(n,e,t,r,s=.001){return se(()=>{const i=gR(n,r),o=i.mean,a=i.variance;return[nv(n,o,a,t,e,s),o,a]})}function B2e(n,e,t,r,s=.001){return se(()=>{const i=gR(n,r),o=i.mean,a=i.variance,l=[];for(const p of Lo(0,n.rank))r.indexOf(p)!==-1?l.push(1):l.push(n.shape[p]);const u=ee(o,l),c=ee(a,l),h=e==null?null:ee(e,l),d=t==null?null:ee(t,l);return[nv(n,u,c,d,h,s),o,a]})}function V2e(n,e,t,r,s=.001){return Ut(r.slice().sort(),Lo(0,n.rank-1))?L2e(n,e,t,r,s):B2e(n,e,t,r,s)}class qq extends yt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=wn(e.betaInitializer||"zeros"),this.gammaInitializer=wn(e.gammaInitializer||"ones"),this.movingMeanInitializer=wn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=wn(e.movingVarianceInitializer||"ones"),this.betaConstraint=dr(e.betaConstraint),this.gammaConstraint=dr(e.gammaConstraint),this.betaRegularizer=_n(e.betaRegularizer),this.gammaRegularizer=_n(e.gammaRegularizer)}build(e){e=Ot(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new K(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new cr({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return se(()=>{const r=t.training==null?!1:t.training,s=nt(e),i=s.shape,o=i.length,a=Lo(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Mh(1,o);u[l]=i[l];const c=a.slice();c.sort();const h=!Ut(c,Lo(0,o).slice(0,o-1)),d=()=>{if(h){const y=ee(this.movingMean.read(),u),x=ee(this.movingVariance.read(),u),b=this.center?ee(this.beta.read(),u):null,_=this.scale?ee(this.gamma.read(),u):null;return nv(s,y,x,b,_,this.epsilon)}else return nv(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return d();const[f,p,m]=V2e(s,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(y,x,b)=>{se(()=>{const _=1-b,E=y.read(),I=Y(et(E,x),_);y.write(et(E,I))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:En(this.betaInitializer),gammaInitializer:En(this.gammaInitializer),movingMeanInitializer:En(this.movingMeanInitializer),movingVarianceInitializer:En(this.movingVarianceInitializer),betaRegularizer:nn(this.betaRegularizer),gammaRegularizer:nn(this.gammaRegularizer),betaConstraint:hr(this.betaConstraint),gammaConstraint:hr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}qq.className="BatchNormalization";xe(qq);class Kq extends yt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=wn(e.betaInitializer||"zeros"),this.gammaInitializer=wn(e.gammaInitializer||"ones"),this.betaRegularizer=_n(e.betaRegularizer),this.gammaRegularizer=_n(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ot(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Vu(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=nt(e),s=r.shape,i=s.length;return se(()=>{let{mean:a,variance:l}=gR(r,this.axis,!0);const u=Mh(1,i);for(const m of this.axis)u[m]=s[m];const c=m=>m!=null&&m.shape.length!==i?ee(m,u):m;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const f=[],p=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(f.push(s[m]),p.push(1)):(f.push(1),p.push(s[m]));return a=Eo(a,f),l=Eo(l,f),h!=null&&(h=Eo(h,p)),d!=null&&(d=Eo(d,p)),nv(r,a,l,d,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:En(this.betaInitializer),gammaInitializer:En(this.gammaInitializer),betaRegularizer:nn(this.betaRegularizer),gammaRegularizer:nn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}Kq.className="LayerNormalization";xe(Kq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function z2e(n,e,t){return se(()=>{if(n.rank!==4)throw new K(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new K("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Bo()),t!=="channelsLast"&&t!=="channelsFirst")throw new K(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],vR(n,r)})}class Xq extends yt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Bo():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new K(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new K(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new K(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new cr({ndim:4})]}computeOutputShape(e){e=Ot(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return se(()=>z2e(nt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Xq.className="ZeroPadding2D";xe(Xq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ck(n,e,t,r,s,i){return se(()=>{qn(s),hG(i),Di(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=Bo()),i==null&&(i="max"),n=ED(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=mR(n,e,t,a):o=iR(n,e,t,a),s==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}function Yq(n,e,t,r,s,i){return se(()=>{qn(s),hG(i),Di(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Bo()),i==null&&(i="max"),n=fq(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=ibe(n,e,t,a):o=axe(n,e,t,a),s==="channelsFirst"&&(o=Nt(o,[0,4,1,2,3])),o})}class Qq extends yt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new K(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(br(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new K(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);br(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Di(this.padding),this.inputSpec=[new cr({ndim:3})]}computeOutputShape(e){e=Ot(e);const t=$o(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return se(()=>{this.invokeCallHook(e,t),e=zy(nt(e),2);const r=this.poolingFunction(nt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Oy(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class Jq extends Qq{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Ck(e,t,r,s,i,"max")}}Jq.className="MaxPooling1D";xe(Jq);class Zq extends Qq{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Ck(e,t,r,s,i,"avg")}}Zq.className="AveragePooling1D";xe(Zq);class e8 extends yt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new K(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];br(this.poolSize,"poolSize"),br(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qn(this.dataFormat),Di(this.padding),this.inputSpec=[new cr({ndim:4})]}computeOutputShape(e){e=Ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=$o(t,this.poolSize[0],this.padding,this.strides[0]),r=$o(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return se(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class t8 extends e8{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Ck(e,t,r,s,i,"max")}}t8.className="MaxPooling2D";xe(t8);class n8 extends e8{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Ck(e,t,r,s,i,"avg")}}n8.className="AveragePooling2D";xe(n8);class r8 extends yt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new K(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];br(this.poolSize,"poolSize"),br(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qn(this.dataFormat),Di(this.padding),this.inputSpec=[new cr({ndim:5})]}computeOutputShape(e){e=Ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=$o(t,this.poolSize[0],this.padding,this.strides[0]),r=$o(r,this.poolSize[1],this.padding,this.strides[1]),s=$o(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return se(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class s8 extends r8{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Yq(e,t,r,s,i,"max")}}s8.className="MaxPooling3D";xe(s8);class i8 extends r8{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return qn(i),Di(s),Yq(e,t,r,s,i,"avg")}}i8.className="AveragePooling3D";xe(i8);class o8 extends yt{constructor(e){super(e),this.inputSpec=[new cr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new ft}}class a8 extends o8{constructor(e){super(e||{})}call(e,t){return se(()=>{const r=nt(e);return Zn(r,1)})}}a8.className="GlobalAveragePooling1D";xe(a8);class l8 extends o8{constructor(e){super(e||{})}call(e,t){return se(()=>{const r=nt(e);return Do(r,1)})}}l8.className="GlobalMaxPooling1D";xe(l8);class u8 extends yt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qn(this.dataFormat),this.inputSpec=[new cr({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new ft}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class c8 extends u8{call(e,t){return se(()=>{const r=nt(e);return this.dataFormat==="channelsLast"?Zn(r,[1,2]):Zn(r,[2,3])})}}c8.className="GlobalAveragePooling2D";xe(c8);class h8 extends u8{call(e,t){return se(()=>{const r=nt(e);return this.dataFormat==="channelsLast"?Do(r,[1,2]):Do(r,[2,3])})}}h8.className="GlobalMaxPooling2D";xe(h8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class d8 extends yt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,i=fl(s,r);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class f8 extends d8{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ot(e),e.length<3)throw new K(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ot(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return se(()=>(e=nt(e),_q((o,a)=>[nt(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}f8.className="TimeDistributed";xe(f8);function U2e(n){sd(uCe,"BidirectionalMergeMode",n)}const j2e="concat";class p8 extends d8{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=fl(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=fl(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?j2e:e.mergeMode,U2e(this.mergeMode),e.weights)throw new ft("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,i;return this.returnState&&(i=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[r].concat(i).concat(i.slice()):$s(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=wq(e,r,s,this.numConstants);if(e=i.inputs,r=i.initialState,s=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const o=[],a=[];if(r!=null){const u=r.length;if(u%2>0)throw new K("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push(...r);const c=r.map(h=>new cr({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(s!=null)throw new ft("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Da;for(const u of o)if(u instanceof Da!==l)throw new K("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,t);return this.inputSpec=h,d}else return super.apply(e,t)}call(e,t){return se(()=>{const r=t.initialState;let s,i;if(r==null)s=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=r.slice(0,r.length/2),u=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(s)&&(o=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Oh(i,1));let a;return this.mergeMode==="concat"?a=pD([s,i]):this.mergeMode==="sum"?a=we(s,i):this.mergeMode==="ave"?a=Y(.5,we(s,i)):this.mergeMode==="mul"?a=Y(s,i):this.mergeMode==null&&(a=[s,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){hh(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),hh(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(i).concat(i):[r].concat(i).concat(i)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=fl(t.layer);if(delete t.layer,t.numConstants!=null)throw new ft("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}p8.className="Bidirectional";xe(p8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class m8 extends yt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return se(()=>(e=nt(e),e.dtype!=="float32"&&(e=ba(e,"float32")),we(Y(e,this.scale),this.offset)))}}m8.className="Rescaling";xe(m8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:W2e,cropAndResize:H2e}=il;class g8 extends yt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,i,o,a,l){return se(()=>{let u,c=!1;const h=t/o,d=r/a,f=(s+t)/o,p=(i+r)/a,m=[h,d,f,p],g=[];e.rank===3?(c=!0,u=Cl([e])):u=e;for(let _=0;_<u.shape[0];_++)g.push(m);const v=D5(g,[g.length,4]),y=Jg(0,g.length,1,"int32"),b=H2e(u,v,y,[s,i],"nearest");return ba(c?nt(Fh(b)):b,l)})}upsize(e,t,r,s){return se(()=>{const i=W2e(e,[t,r]);return ba(i,s)})}call(e,t){return se(()=>{const r=nt(e),s=r.dtype,i=r.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(r,l,u,this.height,this.width,o,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ot(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}g8.className="CenterCrop";xe(g8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G2e(n,e,t,r){let s=nt(n);if(s.dtype!=="int32"&&(s=ba(s,"int32")),e==="int")return s;const i=s.shape;if(s.rank===0&&(s=Ds(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=Ds(s,-1)),s.rank>2)throw new K(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${s.rank}.`);const o=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof r<"u"&&e==="count"?l=T3(a,r,t,o):l=T3(a,[],t,o),e!=="tfIdf")return l;if(r)return Y(l,r);throw new K("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class v8 extends yt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Ot(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return se(()=>{e=nt(e),e.dtype!=="int32"&&(e=ba(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new K(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=nt(t.countWeights)}const s=Do(e),i=bw(e),o=Ri(this.numTokens,s).bufferSync().get(0),a=ed(i,0).bufferSync().get(0);if(!(o&&a))throw new K(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return G2e(e,this.outputMode,this.numTokens,r)})}}v8.className="CategoryEncoding";xe(v8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const q2e=["bilinear","nearest"],a4=new Set(q2e);class y8 extends yt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(a4.has(e.interpolation))this.interpolation=e.interpolation;else throw new K(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ot(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return se(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return il.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return il.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...a4]} are supported`)})}}y8.className="Resizing";xe(y8);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class x8{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}x8.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class b8 extends yt{constructor(e){super(e),this.randomGenerator=new x8(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}b8.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const K2e=["bilinear","nearest"],l4=new Set(K2e);class w8 extends b8{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new K(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new K(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new K(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(l4.has(r))this.interpolation=r;else throw new K(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ot(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return se(()=>{const r=nt(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=Py([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return il.resizeBilinear(e,o);case"nearest":return il.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...l4]} are supported`)}})}}w8.className="RandomWidth";xe(w8);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X2e=oe();X2e.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var u4;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(u4||(u4={}));var c4;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(c4||(c4={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var h4;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(h4||(h4={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&M(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2e=vH;class Ik extends lA{nextDataId(){return Ik.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new F6(this,Jo())}write(e,t,r){this.firstUse&&(this.firstUse=!1,oe().get("IS_NODE")&&mi(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Fv(r[0])){const i=r.map(o=>Bu(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,i){this.data.set(e,{values:t,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return Il(s,i)}return wve(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ec(s));return gt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return gt(e.shape,e.dtype,t)}makeOutput(e,t,r){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Rs();return e(),{kernelMs:Rs()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Le([e],"where");const t=this.readSync(e.dataId);return Y2e(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Ik.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const Q2e=n=>{const{x:e}=n.inputs,t=n.backend;Le(e,"abs");let r=new Float32Array(fe(e.shape));const s=t.data.get(e.dataId).values;return r=_8(s),t.makeOutput(r,e.shape,e.dtype)},J2e={kernelName:n_,backendName:"cpu",kernelFunc:Q2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kn(n){return(e,t,r,s,i)=>{const o=ct(e,t),a=o.length,l=Ke(o),u=fe(o),c=Qr(i,u),h=e.length,d=t.length,f=Ke(e),p=Ke(t),m=Kf(e,o),g=Kf(t,o);if(m.length+g.length===0)for(let v=0;v<c.length;++v)c[v]=n(r[v%r.length],s[v%s.length]);else for(let v=0;v<c.length;++v){const y=_p(v,a,l),x=y.slice(-h);m.forEach(I=>x[I]=0);const b=va(x,h,f),_=y.slice(-d);g.forEach(I=>_[I]=0);const E=va(_,d,p);c[v]=n(r[b],s[E])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ks(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=t.makeTensorInfo(r.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(s.shape,"float32",o)},a}const Z2e={kernelName:wA,backendName:"cpu",kernelFunc:Ks};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(n,e,t="float32"){if(t==="complex64"){const s=Pw(n,e,"float32"),i=Pw(n,e,"float32");return Ks({inputs:{real:s,imag:i},backend:n})}const r=Jr(fe(e),t);return n.makeTensorInfo(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const eIe={kernelName:ry,backendName:"cpu",kernelFunc:$a};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lh(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const tIe={kernelName:HA,backendName:"cpu",kernelFunc:Lh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=Zh([0],t),[i,o]=Kn((a,l)=>a!==l?1:0)(e,[],n,s,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function ic(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return $a({inputs:{x:s},backend:t});const c=Pw(t,s.shape,s.dtype),h=ic({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),d=Ks({inputs:{real:h,imag:c},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),d}if(s.dtype==="complex64"){const c=Lh({inputs:{input:s},backend:t}),h=ic({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),h}if(!B6(s.dtype,i)){const c=$a({inputs:{x:s},backend:t});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=t.data.get(s.dataId).values,[a,l,u]=k8(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,u)}const nIe={kernelName:Wv,backendName:"cpu",kernelFunc:ic};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pr(n,e,t,r){return t==null?({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;Le([o,a],n);const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=o.dtype==="string"?Sl(u):u,d=o.dtype==="string"?Sl(c):c,f=r||o.dtype,[p,m]=e(o.shape,a.shape,h,d,f);return l.makeTensorInfo(m,f,p)}:({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=ic({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,f=l.data.get(h.dataId).values,p=l.data.get(d.dataId).values,m=ic({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),v=g.complexTensorInfos.real,y=g.complexTensorInfos.imag,x=l.data.get(v.dataId).values,b=l.data.get(y.dataId).values,[_,E,I]=t(o.shape,a.shape,f,p,x,b),C=l.makeTensorInfo(I,"float32",_),S=l.makeTensorInfo(I,"float32",E),T=Ks({inputs:{real:C,imag:S},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo(S),T}else{const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=r||o.dtype,[d,f]=e(o.shape,a.shape,u,c,h);return l.makeTensorInfo(f,h,d)}}}function $D(n){return(e,t,r,s,i,o)=>{const a=ct(e,t),l=fe(a),u=a.length,c=Ke(a),h=Qr("float32",l),d=Qr("float32",l),f=Kf(e,a),p=Kf(t,a),m=Il(r,s),g=Il(i,o),v=e.length,y=Ke(e),x=t.length,b=Ke(t);if(f.length+p.length===0)for(let _=0;_<h.length;_++){const E=_%m.length,I=_%g.length,C=n(m[E*2],m[E*2+1],g[I*2],g[I*2+1]);h[_]=C.real,d[_]=C.imag}else for(let _=0;_<h.length;_++){const E=_p(_,u,c),I=E.slice(-v);f.forEach(R=>I[R]=0);const C=va(I,v,y),S=E.slice(-x);p.forEach(R=>S[R]=0);const T=va(S,x,b),N=n(m[C*2],m[C*2+1],g[T*2],g[T*2+1]);h[_]=N.real,d[_]=N.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=Kn((n,e)=>n+e),rIe=$D((n,e,t,r)=>({real:n+t,imag:e+r})),Qf=pr(kp,C8,rIe),sIe={kernelName:kp,backendName:"cpu",kernelFunc:Qf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PD(n,e,t,r,s){const i=fe(r),o=Jr(s,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function I8(n,e,t,r=!1){const s=n.shape[0],i=n.shape[1],o=gt([s,t],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(r?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S8=Kn((n,e)=>n&e),iIe=pr(bA,S8),oIe={kernelName:bA,backendName:"cpu",kernelFunc:iIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ma(n){return(e,t,r)=>{const s=jn(t,e.length);for(let i=0;i<e.length;++i)s[i]=n(e[i],r);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(n,e,t){const r=Ma(e);return yc(n,r,t)}function yc(n,e,t){return({inputs:r,attrs:s,backend:i})=>{const{x:o}=r;Le(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Sl(l)}else u=l;const c=t||o.dtype,h=e(u,c,s);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8=Ma(n=>Math.ceil(n)),aIe=yc(Hv,E8),lIe={kernelName:Hv,backendName:"cpu",kernelFunc:aIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(n,e,t,r){const s=jn(t,fe(e));if(r&&t!=="string"){let i=0;n.forEach(o=>{const a=fe(o.shape);s.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?Sl(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const c=u*e[1]+i;for(let h=0;h<o.shape[1];++h)s[c+h]=a[l++]}i+=o.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8=Kn((n,e)=>n===e?1:0),A8=pr(v_,N8,null,"bool"),uIe={kernelName:v_,backendName:"cpu",kernelFunc:A8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=Ma(n=>Math.exp(n)),D8=yc(Jv,R8,"float32"),cIe={kernelName:Jv,backendName:"cpu",kernelFunc:D8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8=Ma(n=>Math.expm1(n)),hIe=yc(Zv,$8),dIe={kernelName:Zv,backendName:"cpu",kernelFunc:hIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8=Ma(n=>Math.floor(n)),fIe=yc(ey,P8),pIe={kernelName:ey,backendName:"cpu",kernelFunc:fIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8=Kn((n,e)=>Math.floor(n/e)),mIe=pr(ty,O8,null,"int32"),gIe={kernelName:ty,backendName:"cpu",kernelFunc:mIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(n,e,t,r,s,i,o,a,l){const u=gt([r,i],t);for(let c=0;c<r;c++){const h=[];let d=0;for(let f=0;f<s;f++){const p=n[c*s+f];d+=p*o[f],h.push(p)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<i;f++)u.values[c*i+f]=e.get(...e.indexToLoc(d*i+f))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n,e,t){const r=gt(t,n.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const c=n.locToIndex(o);0<=c&&c<n.values.length&&(r.values[s]=n.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=Kn((n,e)=>n>e?1:0),vIe=pr(w_,L8,null,"bool"),yIe={kernelName:w_,backendName:"cpu",kernelFunc:vIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=Kn((n,e)=>n>=e?1:0),xIe=pr(ny,B8,null,"bool"),bIe={kernelName:ny,backendName:"cpu",kernelFunc:xIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8=Kn((n,e)=>n<e?1:0),wIe=pr(k_,V8,null,"bool"),_Ie={kernelName:k_,backendName:"cpu",kernelFunc:wIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8=Kn((n,e)=>n<=e?1:0),kIe=pr(C_,z8,null,"bool"),CIe={kernelName:C_,backendName:"cpu",kernelFunc:kIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(n,e,t){const r=(e-n)/(t-1),s=Jr(t,"float32");s[0]=n;for(let i=1;i<s.length;i++)s[i]=s[i-1]+r;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8=Ma(n=>Math.log(n)),IIe=yc(ay,j8),SIe={kernelName:ay,backendName:"cpu",kernelFunc:IIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(n,e,t,r){const s=Qr(r,fe(t));for(let i=0;i<s.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}s[i]=a}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=Kn((n,e)=>Math.max(n,e)),EIe=pr(uy,H8),TIe={kernelName:uy,backendName:"cpu",kernelFunc:EIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8=Kn((n,e)=>Math.min(n,e)),NIe=pr(cy,G8),AIe={kernelName:cy,backendName:"cpu",kernelFunc:NIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD=Kn((n,e)=>n*e),RIe=$D((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t})),Sk=pr(dy,OD,RIe),DIe={kernelName:dy,backendName:"cpu",kernelFunc:Sk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(n,e,t){const r=hc(-1,t);return OD([],e,r,n,t)}function $Ie(n){const{inputs:e,backend:t}=n,{x:r}=e;Le(r,"neg");const s=t.data.get(r.dataId).values,[i,o]=q8(s,r.shape,r.dtype);return t.makeTensorInfo(o,r.dtype,i)}const PIe={kernelName:O_,backendName:"cpu",kernelFunc:$Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8=Kn((n,e)=>n!==e?1:0),OIe=pr(F_,K8,null,"bool"),FIe={kernelName:F_,backendName:"cpu",kernelFunc:OIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FD(n,e,t,r,s){const i=e.length,o=fe(e),a=Ke(e),l=Ke(s),u=Qr(t,fe(s));for(let c=0;c<o;++c){const h=_p(c,i,a),d=new Array(h.length);for(let p=0;p<d.length;p++)d[p]=h[r[p]];const f=va(d,i,l);u[f]=n[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ls(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:i}=t;Le(s,"transpose");const o=s.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=s.shape[i[h]];const l=r.data.get(s.dataId).values,u=FD(l,s.shape,s.dtype,i,a);return{dataId:r.write(u,a,s.dtype),shape:a,dtype:s.dtype}}const MIe={kernelName:hf,backendName:"cpu",kernelFunc:Ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(n,e,t,r){const[s,i]=Sr(n,r),o=ri(e,"int32"),a=Jr(fe(s),o),l=fe(i);for(let u=0;u<a.length;++u){const c=u*l;let h=1;for(let d=0;d<l;++d)h*=t[c+d];a[u]=h}return{outVals:a,outShape:s,outDtype:o}}function LIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Le(s,"prod");const a=s.shape.length,l=vt(i,s.shape),u=Tn(l,a);let c=l,h=s;const d=[];u!=null&&(h=Ls({inputs:{x:s},backend:t,attrs:{perm:u}}),d.push(h),c=Gn(c.length,a));const f=t.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:g}=X8(h.shape,h.dtype,f,c);let v=m;return o&&(v=rr(m,l)),d.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(v,g,p)}const BIe={kernelName:U_,backendName:"cpu",kernelFunc:LIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const i=_p(s,e.length,Ke(e)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${t})`)}})}function zIe(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function UIe(n,e,t,r){const s=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);zIe(t,r);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*c)}for(let u=0;u<n.length;++u){let c=n[u],h=n[u]+1;for(let d=0;d<t.length;++d){const f=t[d],p=d+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-f[c];for(let v=c;v<h;++v)a[p].push(f[v+1]+g)}c=f[c],h=f[h]}h!==c&&(s.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:s,numValues:i}}function jIe(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=jn("int32",r);e.push(s),n[t].forEach((i,o)=>s[o]=i)}return e}function d4(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function WIe(n,e,t,r,s,i){const o=d4(e,2)[1],a=d4(i,2)[1];let l=0;for(const u of t)for(let c=u[0];c<u[1];++c){for(let h=0;h<r;++h)s[l*a+h]=n[c*o+h];++l}}function HIe(n,e,t,r,s){const i=e.slice();i[0]=s;const o=jn(t,fe(i)),a=n.length,l=a===0?0:a/e[0];return WIe(n,e,r,l,o,i),[o,i]}function Y8(n,e,t,r,s,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(VIe(i,o,l),r.length===0)throw new Error("params.rank must be nonzero");const u=r[0],{outSplits:c,valueSlices:h,numValues:d}=UIe(i,o,n,u),f=jIe(c),p=HIe(t,r,s,h,d);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f4=2147483647;function Q8(n,e,t,r,s,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,u=o.length===0,c=[];a||c.push(e[0]),l||c.push(s[0]),u||c.push(o[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=jn("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const v=a?n[0]:n[g],y=l?r[0]:r[g],x=u?i[0]:i[g];if(x===0)throw new Error("Requires delta != 0");let b;if(x>0&&y<v||x<0&&y>v)b=0;else if(b=Math.ceil(Math.abs((y-v)/x)),b>f4)throw new Error(`Requires ((limit - start) / delta) <= ${f4}`);d[g+1]=d[g]+b}const f=d[h],p=jn(t,f);let m=0;for(let g=0;g<h;++g){const v=d[g+1]-d[g];let y=a?n[0]:n[g];const x=u?i[0]:i[g];for(let b=0;b<v;++b)p[m++]=y,y+=x}return[d,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fi=ko;class Ow{constructor(e,t,r,s,i,o,a,l,u,c){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=FH(c),this.raggedRank=MH(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Fi.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Fi.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Fi.VALUE_ROWIDS:return Ow.getMaxWidthValueRowID(t);case Fi.ROW_SPLITS:return Ow.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Fi[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const i=e[s+1]-e[s];i>r&&(r=i)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==s&&(s=a,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return m4(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;LH(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=OH(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),i=[];let o=0;for(let a=0;a<s;++a,o+=t)i.push(o);for(let a=s;a<e;++a)i.push(-1);return M(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,r,s){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(s,l),c=t[a];c===-1&&(u=0);for(let h=0;h<u;++h)o.push(c),c+=r;for(let h=0;h<l-u;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,r,s){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let c=1;c<i;++c){const h=e[c];if(h===l)u>=0&&(++a,a<s?u+=r:u=-1);else{if(a=0,l=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);u=t[h]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,r,s){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Fi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,s);case Fi.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,r,s);default:throw new Error(`Unsupported partition type: ${Fi[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Fi.FIRST_DIM_SIZE:return e[0];case Fi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Fi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Fi[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*r[l+1];const i=m4(r,!1),o=jn(this.valuesDType,fe(i));if(s[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(t,s[0],r[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,s[u],r[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,r,s){if(r.length===0)return;const i=this.values,o=r;let a=s.slice();a=a.slice(e+1);const l=fe(a),u=t.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const p=this.defaultValueShape;se(()=>{const m=ee(c,p);c=ag(m,a).dataSync()})}let h=0,d=0,f=0;for(let p=0;p<=u;++p){let m=p<u?t[p]:-1;if(m===f){++f;continue}if(d<f){const g=i.subarray(h*l),v=o.subarray(d*l),y=(f-d)*l;p4(v,g,y)}if(p>=u){const g=r.length;m=Math.floor(g/l)}if(m>f)if(this.defaultValue.length===1)o.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const g=o.slice(f*l);p4(g,c,l),++f}m<0?(h=p+1,d=f):(h=p,d=f,f=d+1)}}}function p4(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function m4(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function J8(n,e,t,r,s,i,o,a,l,u){return new Ow(n,e,t,r,s,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z8(n,e,t,r){const s=n===e,i=n<e&&t<0,o=e<n&&t>1;if(s||i||o)return Jr(0,r);const a=Math.abs(Math.ceil((e-n)/t)),l=Jr(a,r);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9=Ma(n=>1/Math.sqrt(n)),GIe=yc(yy,e9),qIe={kernelName:yy,backendName:"cpu",kernelFunc:GIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nh(n,e,t,r,s,i,o,a,l,u){const c=[r/s,s],h=n.values,d=e.values;if(r===0)return gt(t,e.dtype);const f=l instanceof Or?l:gt(c,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<i;p++){const m=[];let g=0;for(let v=0;v<o;v++){const y=h[p*o+v];m.push(y),g+=y*a[v]}if(g<0||g>=r/s)throw new Error(`Invalid indices: ${m} does not index into ${t}`);for(let v=0;v<s;v++)u?f.values[g*s+v]+=d[p*s+v]:f.values[g*s+v]=e.rank===0?d[0]:d[p*s+v]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KIe=Ma(n=>1/(1+Math.exp(-n))),t9=Xt(ky,n=>1/(1+Math.exp(-n))),XIe={kernelName:ky,backendName:"cpu",kernelFunc:t9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9(n,e,t,r,s){const i=jR(r,e,t),o=fe(t),a=Ke(r);if(i){const h=WR(e,a);return s==="string"?n.slice(h,h+o):n.subarray(h,h+o)}const l=s==="string"?Sl(n):n,u=gt(r,s,l),c=gt(t,s);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),f=d.map((p,m)=>p+e[m]);c.set(u.get(...f),...d)}return s==="string"?sG(c.values):c.values}function Bh(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r;Le(s,"slice");const[a,l]=hk(s,i,o);zR(s,a,l);const u=t.data.get(s.dataId).values,c=n9(u,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,c)}const YIe={kernelName:K_,backendName:"cpu",kernelFunc:Bh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r9(n,e,t,r,s,i,o){const a=e[0],l=i[0],u=new Array(l),c=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(HH(a));const g=jn(t,0),v=jn(s,0);return[g,[0,h],v,u,c]}let d=!0,f=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const v=n[g*h];if(v<0)throw new Error(GH(g,v));if(v>=l)throw new Error(qH(g,v,l));++p[v],d=d&&v>=f,f=v}let m=!0;for(let g=0;g<l;++g){const v=p[g]===0;u[g]=v,m=m&&!v,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&d){const g=n,v=r;for(let y=0;y<a;++y)c[y]=y;return[g,[a,h],v,u,c]}else{const g=p[l-1],v=jn(t,g*h),y=jn(s,g),x=new Array(l).fill(0);for(let b=0;b<a;++b){const _=n[b*h],E=x[_],I=(_===0?0:p[_-1])+E;x[_]++;for(let C=0;C<h;++C)v[I*h+C]=n[b*h+C];y[I]=r[b],c[b]=I}for(let b=0;b<l;++b)if(x[b]===0){const E=b===0?0:p[b-1];v[E*h+0]=b;for(let I=1;I<h;++I)v[E*h+I]=0;y[E]=o}return[v,[g,h],y,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9(n,e,t,r,s){const i=fe(r),o=e[0],a=s.length,l=[];let u=1,c=-1;for(let g=0;g<a;++g){const v=s[g];if(v===-1){if(c!==-1)throw new Error(KH(c,g));c=g,l.push(1)}else{if(v<0)throw new Error(XH(g,v));u*=v,l.push(v)}}if(c!==-1){if(u<=0)throw new Error(YH());const g=Math.trunc(i/u);if(u*g!==i)throw new Error(QH(r,l));l[c]=g}if(fe(l)!==i)throw new Error(JH(r,l));const d=r.length,f=[];if(d>0){f[d-1]=1;for(let g=d-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=jn(t,o*a);for(let g=0;g<o;++g){let v=0;for(let y=0;y<d;++y)v+=n[g*d+y]*f[y];for(let y=0;y<a;++y)m[g*a+y]=Math.trunc(v/p[y]),v%=p[y]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e,t,r,s,i=!1,o=0){const a=r.length,l=[e[0],n.length/e[0]],u=l[1],h=a>0?s[a-1]+1:0;if(h<0)throw new Error(tE());const d=e.slice();d[0]=h;const f=d.reduce((x,b)=>x*b,1),p=jn(t,f);if(a===0)return h>0&&p.fill(o),[p,d];if(h<=0)throw new Error(tE());let m=0,g=1,v=0,y=s[m];for(;;){let x=0;if(g<a){if(x=s[g],y===x){++g;continue}if(y>=x)throw new Error(ZH())}if(y<0||y>=h)throw new Error(eG(y,h));y>v&&p.fill(o,v*u,y*u);for(let b=m;b<g;++b){const _=r[b];if(_<0||_>=l[0])throw new Error(tG(b,r[b],l[0]));for(let E=0;E<u;E++)p[y*u+E]+=n[_*u+E]}if(i)for(let b=0;b<u;b++)p[y*u+b]/=g-m;if(m=g,++g,v=y+1,y=x,g>a)break}return v<h&&p.fill(o,v*u,h*u),[p,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QIe=Ma(n=>Math.sqrt(n)),JIe=Xt(Iy,n=>Math.sqrt(n)),ZIe={kernelName:Iy,backendName:"cpu",kernelFunc:JIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9=Kn((n,e)=>{const t=n-e;return t*t}),eSe=pr(Sy,i9),tSe={kernelName:Sy,backendName:"cpu",kernelFunc:eSe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=Ma((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),nSe=yc(XA,o9),rSe={kernelName:XA,backendName:"cpu",kernelFunc:nSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a9(n,e,t,r){const s=gt(n,e.dtype);for(let i=0;i<s.size;i++){const o=s.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+r[l];s.set(e.get(...a),...o)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sSe{constructor(e,t,r,s,i,o){this.separator=Bu(e),this.nGramWidths=t,this.leftPad=Bu(r),this.rightPad=Bu(s),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=o-(u+c),d=t+(u>0?0:a-l);let f=0;f+=u*this.leftPad.length;for(let y=0;y<h;++y)f+=e[d+y].length;f+=c*this.rightPad.length;const p=u+c+h-1;f+=p*this.separator.length,r[s+a]=new Uint8Array(f);const m=r[s+a];let g=0;const v=y=>y.forEach(x=>m[g++]=x);for(let y=0;y<u;++y)v(this.leftPad),v(this.separator);for(let y=0;y<h-1;++y)v(e[d+y]),v(this.separator);if(h>0){v(e[d+h-1]);for(let y=0;y<c;++y)v(this.separator),v(this.rightPad)}else{for(let y=0;y<c-1;++y)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<s;++u){let c=t[u]>=l;if(c=c&&t[u]<=r,!c)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${r}]`);l=t[u]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const i=s-1,o=jn("int32",s);if(r===0||s===0){const l=new Array(r);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&c===0&&(c=1),o[l]=o[l-1]+c}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let c=o[l];if(this.nGramWidths.forEach(h=>{const d=t[l+1]-t[l],f=this.getNumNGrams(d,h);this.createNGrams(e,u,a,c,f,h),c+=f}),this.preserveShort&&c===o[l]){const h=t[l+1]-t[l];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,u,a,c,1,d)}}return[a,o]}}function l9(n,e,t,r,s,i,o,a){return new sSe(t,r,s,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(n,e,t,r){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)r.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&r.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(s,i);(!t||o.length!==0)&&r.push(o),s=i+1}}function u9(n,e,t){const r=n.length,s=[];let i=0,o=0;const a=new Array(r);for(let d=0;d<r;++d){const f=s.length;iSe(n[d],e,t,s);const p=s.length-f;a[d]=p,i+=p,o=Math.max(o,p)}const l=jn("int32",i*2),u=new Array(i),c=[r,o];let h=0;for(let d=0;d<r;++d)for(let f=0;f<a[d];++f)l[h*2]=d,l[h*2+1]=f,u[h]=s[h],++h;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(n,e){const t=jn("int32",n.length);for(let r=0;r<n.length;++r)t[r]=zve(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9=Kn((n,e)=>n-e),oSe=$D((n,e,t,r)=>({real:n-t,imag:e-r})),LD=pr(Ey,h9,oSe),aSe={kernelName:Ey,backendName:"cpu",kernelFunc:LD};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=gt(t,n.dtype);for(let s=0;s<r.values.length;++s){const i=r.indexToLoc(s),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);r.values[s]=n.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bm=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function f9(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const a=r-t+1,l=e-t+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),d=Math.max(t,Math.floor(e-l*c/a+h)),f=Math.min(r,Math.floor(e+(a-l)*c/a+h));f9(n,e,d,f)}const s=n[e];let i=t,o=r;for(Pd(n,t,e),Bm(n[r],s)>0&&Pd(n,t,r);i<o;){for(Pd(n,i,o),i++,o--;Bm(n[i],s)<0;)i=i+1;for(;Bm(n[o],s)>0;)o=o-1}Bm(n[t],s)===0?Pd(n,t,o):(o=o+1,Pd(n,o,r)),o<=e&&(t=o+1),e<=o&&(r=o-1)}}function p9(n,e,t,r,s){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Qr(t,o*r),u=Qr("int32",o*r);for(let h=0;h<o;h++){const d=h*a,f=n.subarray(d,d+a);let p=new Array(f.length);f.forEach((y,x)=>p[x]={value:y,index:x}),r<p.length&&(f9(p,r),p=p.slice(0,r)),s&&p.sort(Bm);const m=h*r,g=l.subarray(m,m+r),v=u.subarray(m,m+r);for(let y=0;y<r;y++)g[y]=p[y].value,v[y]=p[y].index}const c=e.slice();return c[c.length-1]=r,[gt(c,t,l),gt(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(n,e,t,r){const s=vt(e,t)[0],i=[1,t[0],1];for(let p=0;p<s;p++)i[0]*=t[p];i[1]=t[s];for(let p=s+1;p<t.length;p++)i[2]*=t[p];const o=new Map,a=new Int32Array(t[s]),l=new Or(i,r,n),u=[],c=i[0]===1&&i[2]===1;for(let p=0;p<t[s];p++){let m;if(c)m=n[p].toString();else{const v=[];for(let y=0;y<i[0];y++)for(let x=0;x<i[2];x++)v.push(l.get(y,p,x));m=v.join(",")}const g=o.get(m);if(g!=null)a[p]=g;else{const v=o.size;o.set(m,v),a[p]=v,u.push(p)}}const h=i.slice();h[1]=o.size;const d=new Or(h,r);u.forEach((p,m)=>{for(let g=0;g<i[0];g++)for(let v=0;v<i[2];v++)d.set(l.get(g,p,v),g,m,v)});const f=t.slice();return f[s]=h[1],{outputValues:d.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lSe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:C8,bincountImpl:PD,bincountReduceImpl:I8,bitwiseAndImpl:S8,castImpl:k8,ceilImpl:E8,concatImpl:T8,equalImpl:N8,expImpl:R8,expm1Impl:$8,floorDivImpl:O8,floorImpl:P8,gatherNdImpl:F8,gatherV2Impl:M8,greaterEqualImpl:B8,greaterImpl:L8,lessEqualImpl:z8,lessImpl:V8,linSpaceImpl:U8,logImpl:j8,maxImpl:W8,maximumImpl:H8,minimumImpl:G8,multiplyImpl:OD,negImpl:q8,notEqualImpl:K8,prodImpl:X8,raggedGatherImpl:Y8,raggedRangeImpl:Q8,raggedTensorToTensorImpl:J8,rangeImpl:Z8,rsqrtImpl:e9,scatterImpl:nh,sigmoidImpl:KIe,simpleAbsImpl:_8,sliceImpl:n9,sparseFillEmptyRowsImpl:r9,sparseReshapeImpl:s9,sparseSegmentReductionImpl:MD,sqrtImpl:QIe,squaredDifferenceImpl:i9,staticRegexReplaceImpl:o9,stridedSliceImpl:a9,stringNGramsImpl:l9,stringSplitImpl:u9,stringToHashBucketFastImpl:c9,subImpl:h9,tileImpl:d9,topKImpl:p9,transposeImpl:FD,uniqueImpl:m9},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */$5("cpu",()=>new Ik,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9=Xt(Yv,n=>n>=0?n:Math.exp(n)-1),uSe={kernelName:Yv,backendName:"cpu",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r;Le([s],"leakyRelu");const o=fe(s.shape),a=t.data.get(s.dataId).values,l=Qr("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(s.shape,"float32",l)}const cSe={kernelName:__,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hSe=Kn((n,e)=>n<0?e*n:n);function y9(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;Le([r,s],"prelu");const i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,[a,l]=hSe(r.shape,s.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const dSe={kernelName:z_,backendName:"cpu",kernelFunc:y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x9=Xt(my,n=>Math.max(0,n)),fSe={kernelName:my,backendName:"cpu",kernelFunc:x9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9=Xt(gy,n=>Math.min(Math.max(0,n),6)),pSe={kernelName:gy,backendName:"cpu",kernelFunc:b9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fw(n,e,t,r,s){if(t==="linear")return $a({inputs:{x:e},backend:n});if(t==="relu")return x9({inputs:{x:e},backend:n});if(t==="elu")return g9({inputs:{x:e},backend:n});if(t==="relu6")return b9({inputs:{x:e},backend:n});if(t==="prelu")return y9({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return v9({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return t9({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function an(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=fe(s.shape),a=L6(i,o),l=fe(a);M(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const u=t.data.get(s.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const mSe={kernelName:j_,backendName:"cpu",kernelFunc:an};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;Le([s,i],"matMul");const l=s.shape.length,u=i.shape.length,c=o?s.shape[l-2]:s.shape[l-1],h=a?i.shape[u-1]:i.shape[u-2],d=o?s.shape[l-1]:s.shape[l-2],f=a?i.shape[u-2]:i.shape[u-1],p=s.shape.slice(0,-2),m=i.shape.slice(0,-2),g=fe(p),v=fe(m),x=ct(s.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);M(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${s.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const b=o?[g,c,d]:[g,d,c],_=a?[v,f,h]:[v,h,f],E=an({inputs:{x:s},backend:t,attrs:{shape:b}}),I=an({inputs:{x:i},backend:t,attrs:{shape:_}}),C=o?E.shape[1]:E.shape[2],S=o?E.shape[2]:E.shape[1],T=a?I.shape[1]:I.shape[2],N=Math.max(g,v),R=t.data.get(E.dataId).values,D=t.data.get(I.dataId).values,z=Ke(E.shape),L=Ke(I.shape),[O,F,P]=o?[z[0],1,z[1]]:[z[0],z[1],1],[U,W,X]=a?[1,L[1],L[0]]:[L[1],1,L[0]],Z=S*T,ne=gt([N,S,T],E.dtype),he=ne.values,le=t.blockSize;for(let pe=0;pe<N;pe++){const be=pe%g,Ce=pe%v;for(let ke=0;ke<S;ke+=le){const $e=Math.min(ke+le,S);for(let Se=0;Se<T;Se+=le){const Ue=Math.min(Se+le,T);for(let je=0;je<C;je+=le){const tt=Math.min(je+le,C);for(let Qe=ke;Qe<$e;Qe++)for(let Xe=Se;Xe<Ue;Xe++){let Ct=0;for(let _t=je;_t<tt;_t++){const ln=R[be*O+Qe*F+_t*P],Yt=D[_t*U+Xe*W+Ce*X];Ct+=ln*Yt}he[pe*Z+(Qe*T+Xe)]+=Ct}}}}}return t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(I),t.makeTensorInfo(x,ne.dtype,ne.values)}const gSe={kernelName:a_,backendName:"cpu",kernelFunc:w9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;let d,f,p;const m=[];d=w9({inputs:{a:s,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(f=Qf({inputs:{a:d,b:o},backend:t}),m.push(d),d=f),c&&(p=Fw(t,d,c,a,h),m.push(d),d=p);for(const v of m)t.disposeIntermediateTensorInfo(v);return d}const ySe={kernelName:mw,backendName:"cpu",kernelFunc:vSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xSe=Xt(Mv,n=>Math.acos(n)),bSe={kernelName:Mv,backendName:"cpu",kernelFunc:xSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSe=Xt(Lv,n=>Math.acosh(n)),_Se={kernelName:Lv,backendName:"cpu",kernelFunc:wSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(n){const{inputs:e,backend:t}=n,r=e;Le(e,"addN");const s=r.map(a=>t.data.get(a.dataId).values),i=gt(r[0].shape,r[0].dtype),o=i.values;for(let a=0;a<r.length;a++){const l=s[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const CSe={kernelName:pA,backendName:"cpu",kernelFunc:kSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Le(s,"all");const a=vt(i,s.shape);let l=a;const u=Tn(l,s.shape.length);let c=s;u!=null&&(c=Ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=Gn(l.length,s.shape.length)),Br("all",l,c.shape.length);const[h,d]=Sr(c.shape,l),f=fe(d),p=Jr(fe(h),c.dtype),m=t.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const y=v*f;let x=m[y];for(let b=0;b<f;++b){const _=m[y+b];x=x&&_}p[v]=x}u!=null&&t.disposeIntermediateTensorInfo(c);const g=t.makeTensorInfo(h,c.dtype,p);if(o){const v=rr(h,a),y=an({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),y}return g}const SSe={kernelName:mA,backendName:"cpu",kernelFunc:ISe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Le(s,"any");const a=vt(i,s.shape);let l=a;const u=Tn(l,s.shape.length);let c=s;u!=null&&(c=Ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=Gn(l.length,s.shape.length)),Br("any",l,c.shape.length);const[h,d]=Sr(c.shape,l),f=fe(d),p=Jr(fe(h),c.dtype),m=t.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const y=v*f;let x=m[y];for(let b=0;b<f;++b){const _=m[y+b];x=x||_}p[v]=x}u!=null&&t.disposeIntermediateTensorInfo(c);const g=t.makeTensorInfo(h,c.dtype,p);if(o){const v=rr(h,a),y=an({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),y}return g}const TSe={kernelName:gA,backendName:"cpu",kernelFunc:ESe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Le(s,"argMax");let o=vt(i,s.shape);const a=Tn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Ls({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=Gn(o.length,l.shape.length)),o=[o[0]],Br("argMax",o,l.shape.length);const[c,h]=Sr(l.shape,o),d=fe(c),f=Jr(d,"int32"),p=fe(h),m=t.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const v=g*p;let y=m[v],x=0;for(let b=0;b<p;++b){const _=m[v+b];_>y&&(y=_,x=b)}f[g]=x}return u.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(c,"int32",f)}const ASe={kernelName:r_,backendName:"cpu",kernelFunc:NSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Le(s,"argMin");let o=vt(i,s.shape);const a=Tn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Ls({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=Gn(o.length,l.shape.length)),o=[o[0]],Br("argMin",o,l.shape.length);const[c,h]=Sr(l.shape,o),d=fe(c),f=Jr(d,"int32"),p=fe(h),m=t.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const v=g*p;let y=m[v],x=0;for(let b=0;b<p;++b){const _=m[v+b];_<y&&(y=_,x=b)}f[g]=x}return u.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(c,"int32",f)}const DSe={kernelName:s_,backendName:"cpu",kernelFunc:RSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Se=Xt(Bv,n=>Math.asin(n)),PSe={kernelName:Bv,backendName:"cpu",kernelFunc:$Se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OSe=Xt(Vv,n=>Math.asinh(n)),FSe={kernelName:Vv,backendName:"cpu",kernelFunc:OSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MSe=Xt(zv,n=>Math.atan(n)),LSe={kernelName:zv,backendName:"cpu",kernelFunc:MSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BSe=Kn((n,e)=>Math.atan2(n,e)),VSe=pr(jv,BSe),zSe={kernelName:jv,backendName:"cpu",kernelFunc:VSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const USe=Xt(Uv,n=>Math.atanh(n)),jSe={kernelName:Uv,backendName:"cpu",kernelFunc:USe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(n,e,t,r,s,i){const o=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,u=s.dilationWidth,c=s.effectiveFilterHeight,h=s.effectiveFilterWidth,d=s.padInfo.top,f=s.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=gt(s.outShape,t),g=m.values,v=s.outShape[1]*s.outShape[2]*s.outShape[3],y=s.outShape[2]*s.outShape[3],x=s.outShape[3];for(let b=0;b<s.batchSize;++b){const _=b*v,E=b*r[0];for(let I=0;I<s.inChannels;++I)for(let C=0;C<s.outHeight;++C){const S=C*o-d,T=Math.max(0,S),N=Math.min(s.inHeight,c+S),R=_+C*y;for(let D=0;D<s.outWidth;++D){const z=D*a-f,L=Math.max(0,z),O=Math.min(s.inWidth,h+z);let F=p,P=0,U=0;for(let X=T;X<N;X+=l){const Z=E+X*r[1];for(let ne=L;ne<O;ne+=u){const he=Z+ne*r[2],le=n[he+I];i==="max"&&le>F?F=le:i==="avg"&&(P+=le,U++)}if(isNaN(F))break}const W=R+D*x+I;g[W]=i==="avg"?P/U:F}}}return m}function _9(n,e,t,r,s=!1,i=!1){const o=gt(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=gt(e,t,n);for(let g=0;g<r.batchSize;++g)for(let v=0;v<r.inChannels;++v)for(let y=0;y<r.outHeight;++y){const x=y*a-f;let b=x;for(;b<0;)b+=u;const _=Math.min(r.inHeight,h+x);for(let E=0;E<r.outWidth;++E){const I=E*l-p;let C=I;for(;C<0;)C+=c;const S=Math.min(r.inWidth,d+I);let T=Number.NEGATIVE_INFINITY,N=-1;for(let R=b;R<_;R+=u){const D=R-x;for(let z=C;z<S;z+=c){const L=z-I,O=m.get(g,R,z,v);O>T&&(T=O,s?N=i?((g*r.inHeight+R)*r.inWidth+z)*r.inChannels+v:(R*r.inWidth+z)*r.inChannels+v:N=D*d+L)}}o.set(N,g,y,E,v)}}return o}function k9(n,e,t,r,s,i){const o=s.strideDepth,a=s.strideHeight,l=s.strideWidth,u=s.dilationDepth,c=s.dilationHeight,h=s.dilationWidth,d=s.effectiveFilterDepth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,m=s.padInfo.front,g=s.padInfo.top,v=s.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=gt(s.outShape,t),b=x.values,_=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],E=s.outShape[2]*s.outShape[3]*s.outShape[4],I=s.outShape[3]*s.outShape[4],C=s.outShape[4];for(let S=0;S<s.batchSize;++S){const T=S*_,N=S*r[0];for(let R=0;R<s.inChannels;++R)for(let D=0;D<s.outDepth;++D){const z=D*o-m;let L=z;for(;L<0;)L+=u;const O=Math.min(s.inDepth,d+z),F=T+D*E;for(let P=0;P<s.outHeight;++P){const U=P*a-g;let W=U;for(;W<0;)W+=c;const X=Math.min(s.inHeight,f+U),Z=F+P*I;for(let ne=0;ne<s.outWidth;++ne){const he=ne*l-v;let le=he;for(;le<0;)le+=h;const pe=Math.min(s.inWidth,p+he),be=Z+ne*C;let Ce=y,ke=0,$e=0;for(let Ue=L;Ue<O;Ue+=u){const je=N+Ue*r[1];for(let tt=W;tt<X;tt+=c){const Qe=je+tt*r[2];for(let Xe=le;Xe<pe;Xe+=h){const Ct=Qe+Xe*r[3],_t=n[Ct+R];if(i==="max"&&_t>Ce?Ce=_t:i==="avg"&&(ke+=_t,$e++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}const Se=be+R;b[Se]=i==="avg"?ke/Math.max($e,1):Ce}}}}return x}function WSe(n,e){const t=gt(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let v=0;v<e.outDepth;++v){const y=v*r-d;let x=y;for(;x<0;)x+=o;const b=Math.min(e.inDepth,u+y);for(let _=0;_<e.outHeight;++_){const E=_*s-f;let I=E;for(;I<0;)I+=a;const C=Math.min(e.inHeight,c+E);for(let S=0;S<e.outWidth;++S){const T=S*i-p;let N=T;for(;N<0;)N+=l;const R=Math.min(e.inWidth,h+T);let D=Number.NEGATIVE_INFINITY,z=-1;for(let L=x;L<b;L+=o){const O=L-y;for(let F=I;F<C;F+=a){const P=F-E;for(let U=N;U<R;U+=l){const W=U-T,X=n.get(m,L,F,U,g);X>=D&&(D=X,z=O*c*h+P*c+W)}}}t.set(z,m,v,_,S,g)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Le(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;M(es(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=uo(s.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&Ut(c.inShape,c.outShape))h=$a({inputs:{x:s},backend:t});else{const d=t.data.get(s.dataId).values,f=Ke(s.shape),p=BD(d,s.shape,s.dtype,f,c,"avg");h=t.makeTensorInfo(c.outShape,s.dtype,p.values)}return h}const GSe={kernelName:i_,backendName:"cpu",kernelFunc:HSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Le(s,"avgPool3d");const c=Ml(s.shape,i,o,1,a,l,u),h=t.data.get(s.dataId).values,d=k9(h,s.shape,s.dtype,Ke(s.shape),c,"avg");return t.makeTensorInfo(d.shape,"float32",d.values)}const KSe={kernelName:o_,backendName:"cpu",kernelFunc:qSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Le([s,i],"avgPool3DGrad");const c=Ml(i.shape,o,a,1,l,u),h=c.strideDepth,d=c.strideHeight,f=c.strideWidth,p=c.filterDepth,m=c.filterHeight,g=c.filterWidth,v=c.dilationDepth,y=c.dilationHeight,x=c.dilationWidth,b=c.effectiveFilterDepth,_=c.effectiveFilterHeight,E=c.effectiveFilterWidth,I=b-1-c.padInfo.front,C=E-1-c.padInfo.left,S=_-1-c.padInfo.top,T=gt(i.shape,"float32"),N=1/(p*m*g),R=t.bufferSync(s);for(let D=0;D<c.batchSize;++D)for(let z=0;z<c.inChannels;++z)for(let L=0;L<c.inDepth;++L)for(let O=0;O<c.inHeight;++O)for(let F=0;F<c.inWidth;++F){const P=L-I,U=O-S,W=F-C;let X=0;for(let Z=0;Z<b;Z+=v){const ne=(P+Z)/h;if(!(ne<0||ne>=c.outDepth||Math.floor(ne)!==ne))for(let he=0;he<_;he+=y){const le=(U+he)/d;if(!(le<0||le>=c.outHeight||Math.floor(le)!==le))for(let pe=0;pe<E;pe+=x){const be=(W+pe)/f;if(be<0||be>=c.outWidth||Math.floor(be)!==be)continue;const Ce=R.get(D,ne,le,be,z);X+=Ce}}}T.set(X*N,D,L,O,F,z)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const YSe={kernelName:yA,backendName:"cpu",kernelFunc:XSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Le([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,c=uo(o.shape,a,l,1,u),h=c.strideHeight,d=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,v=c.effectiveFilterHeight,y=c.effectiveFilterWidth,x=y-1-c.padInfo.left,b=v-1-c.padInfo.top,_=gt(o.shape,"float32"),E=1/(f*p),I=t.data.get(s.dataId).values,C=gt(s.shape,"float32",I);for(let S=0;S<c.batchSize;++S)for(let T=0;T<c.inChannels;++T)for(let N=0;N<c.inHeight;++N)for(let R=0;R<c.inWidth;++R){const D=N-b,z=R-x;let L=0;for(let O=0;O<v;O+=m){const F=(D+O)/h;if(!(F<0||F>=c.outHeight||Math.floor(F)!==F))for(let P=0;P<y;P+=g){const U=(z+P)/d;if(U<0||U>=c.outWidth||Math.floor(U)!==U)continue;const W=C.get(S,F,U,T);L+=W}}_.set(L*E,S,N,R,T)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const JSe={kernelName:vA,backendName:"cpu",kernelFunc:QSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:i,offset:o,mean:a,variance:l}=e;M(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Le([s,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=r;u==null&&(u=.001);const c=t.data.get(s.dataId).values,h=t.data.get(a.dataId).values,d=t.data.get(l.dataId).values,f=i?t.data.get(i.dataId).values:new Float32Array([1]),p=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=p.length,v=f.length,y=d.length,x=h.length;let b=0,_=0,E=0,I=0;for(let C=0;C<c.length;++C)m[C]=p[b++]+(c[C]-h[_++])*f[E++]/Math.sqrt(d[I++]+u),b>=g&&(b=0),_>=x&&(_=0),E>=v&&(E=0),I>=y&&(I=0);return t.makeTensorInfo(s.shape,s.dtype,m)}const eEe={kernelName:x_,backendName:"cpu",kernelFunc:ZSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;Le([s],"batchToSpaceND");const a=i.reduce((v,y)=>v*y),l=My(s.shape,i,a),u=Ly(l.length,i.length),c=By(s.shape,i,a),h=XR(o,i.length),d=YR(c,o,i.length),f=an({inputs:{x:s},backend:t,attrs:{shape:l}}),p=Ls({inputs:{x:f},backend:t,attrs:{perm:u}}),m=an({inputs:{x:p},backend:t,attrs:{shape:c}}),g=Bh({inputs:{x:m},backend:t,attrs:{begin:h,size:d}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}const nEe={kernelName:l_,backendName:"cpu",kernelFunc:tEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,u=PD(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const sEe={kernelName:xA,backendName:"cpu",kernelFunc:rEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iEe(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=ct(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const oEe={kernelName:W6,backendName:"cpu",kernelFunc:iEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aEe=Xt(Gv,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),lEe={kernelName:Gv,backendName:"cpu",kernelFunc:aEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uEe=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(fe(e.shape)),s=t.data.get(e.dataId),i=s.complexTensorInfos.real,o=s.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],h=l[u];r[u]=Math.hypot(c,h)}return t.makeOutput(r,e.shape,"float32")},cEe={kernelName:u_,backendName:"cpu",kernelFunc:uEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jf(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const hEe={kernelName:MA,backendName:"cpu",kernelFunc:Jf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zf(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=vt(s,e[0].shape)[0],o=e.map(m=>m.shape);GR(o,i);let a=xa(e.map(m=>m.shape),i);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>fe(m.shape)>0);if(l.length===1)return $a({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const m=l.map(b=>Lh({inputs:{input:b},backend:t})),g=l.map(b=>Jf({inputs:{input:b},backend:t})),v=Zf({inputs:m,backend:t,attrs:{axis:i}}),y=Zf({inputs:g,backend:t,attrs:{axis:i}}),x=Ks({inputs:{real:v,imag:y},backend:t});return m.forEach(b=>t.disposeIntermediateTensorInfo(b)),g.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),x}const u=l.map(m=>{const v=[-1,fe(m.shape.slice(i))];return an({inputs:{x:m},backend:t,attrs:{shape:v}})}),c=u.map(m=>({vals:t.data.get(m.dataId).values,shape:m.shape}));a=xa(u.map(m=>m.shape),1);const h=u[0].shape[0]===1,d=T8(c,a,e[0].dtype,h),f=xa(l.map(m=>m.shape),i),p=t.makeTensorInfo(f,e[0].dtype,d);return u.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const dEe={kernelName:c_,backendName:"cpu",kernelFunc:Zf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r;Le([s,i],"conv2d");const h=Ll(l),d=Lr(s.shape,i.shape,o,u,a,c,!1,h),f=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,v=d.padInfo.left,y=d.padInfo.top,x=d.dataFormat==="channelsLast",b=new Or(d.outShape,s.dtype),_=Ke(s.shape),E=Ke(i.shape),I=_[0],C=x?_[1]:_[2],S=x?_[2]:1,T=x?1:_[1],N=b.strides[0],R=x?b.strides[1]:b.strides[2],D=x?b.strides[2]:1,z=x?1:b.strides[1],L=t.data.get(s.dataId).values,O=t.data.get(i.dataId).values,F=b.values;for(let P=0;P<d.batchSize;++P){const U=P*I,W=P*N;for(let X=0;X<d.outHeight;++X){const Z=W+X*R,ne=X*d.strideHeight-y;for(let he=0;he<f;++he){const le=ne+he*m;if(le<0||le>=d.inHeight)continue;const pe=he*E[0],be=U+le*C;for(let Ce=0;Ce<d.outWidth;++Ce){const ke=Z+Ce*D,$e=Ce*d.strideWidth-v;for(let Se=0;Se<p;++Se){const Ue=$e+Se*g;if(Ue<0||Ue>=d.inWidth)continue;const je=pe+Se*E[1],tt=be+Ue*S;let Qe=je;for(let Xe=0;Xe<d.inChannels;++Xe){const Ct=L[tt+Xe*T];for(let _t=0;_t<d.outChannels;++_t)F[ke+_t*z]+=Ct*O[Qe+_t];Qe+=d.outChannels}}}}}}return t.makeTensorInfo(b.shape,b.dtype,F)}const fEe={kernelName:h_,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;Le([s,i],"conv2dBackpropFilter");const h=Ll(l),d=Lr(s.shape,c,o,1,a,u,!1,h),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=d,v=d.dataFormat==="channelsLast",y=new Or(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,_=t.data.get(s.dataId).values,E=t.data.get(i.dataId).values,I=new Or(s.shape,s.dtype,_),C=new Or(i.shape,i.dtype,E);for(let S=0;S<m;++S){const T=Math.max(0,Math.ceil((b-S)/f)),N=Math.min(d.outHeight,(d.inHeight+b-S)/f);for(let R=0;R<g;++R){const D=Math.max(0,Math.ceil((x-R)/p)),z=Math.min(d.outWidth,(d.inWidth+x-R)/p);for(let L=0;L<d.inChannels;++L)for(let O=0;O<d.outChannels;++O){let F=0;for(let P=0;P<d.batchSize;++P)for(let U=T;U<N;++U){const W=S+U*f-b;for(let X=D;X<z;++X){const Z=R+X*p-x;v?F+=I.get(P,W,Z,L)*C.get(P,U,X,O):F+=I.get(P,L,W,Z)*C.get(P,O,U,X)}}y.set(F,S,R,L,O)}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const mEe={kernelName:_A,backendName:"cpu",kernelFunc:pEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r;Le([s,i],"conv2dBackpropInput");const h=Ke(i.shape),d=Ke(s.shape);let f=Ll(u);const p=Lr(o,i.shape,a,1,l,c,!1,f),m=new Or(p.inShape,"float32"),g=m.values,v=t.data.get(s.dataId).values,y=t.data.get(i.dataId).values,[x,b,_]=h,{batchSize:E,filterHeight:I,filterWidth:C,inChannels:S,inHeight:T,inWidth:N,outChannels:R,outHeight:D,outWidth:z,strideHeight:L,strideWidth:O}=p;f=p.dataFormat;const F=I-1-p.padInfo.top,P=C-1-p.padInfo.left,U=f==="channelsLast",W=m.strides[0],X=U?m.strides[1]:m.strides[2],Z=U?m.strides[2]:1,ne=U?1:m.strides[1],he=d[0],le=U?d[1]:d[2],pe=U?d[2]:1,be=U?1:d[1];for(let Ce=0;Ce<E;++Ce)for(let ke=0;ke<S;++ke)for(let $e=0;$e<T;++$e){const Se=$e-F,Ue=Math.max(0,Math.ceil(Se/L)),je=Math.min(D,(I+Se)/L);for(let tt=0;tt<N;++tt){const Qe=tt-P,Xe=Math.max(0,Math.ceil(Qe/O)),Ct=Math.min(z,(C+Qe)/O);let _t=0;for(let Yt=Ue;Yt<je;++Yt){const Xn=Yt*L-Se;for(let kn=Xe;kn<Ct;++kn){const Yn=kn*O-Qe,Ln=he*Ce+le*Yt+pe*kn,Bn=x*(I-1-Xn)+b*(C-1-Yn)+_*ke;for(let Qt=0;Qt<R;++Qt){const jt=v[Ln+be*Qt],Cn=y[Bn+Qt];_t+=jt*Cn}}}const ln=W*Ce+X*$e+Z*tt+ne*ke;g[ln]=_t}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const vEe={kernelName:d_,backendName:"cpu",kernelFunc:gEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r;Le([s,i],"conv3d");const u=dc(s.shape,i.shape,o,l,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=u,v=g.front,y=g.left,x=g.top,b=new Or(u.outShape,s.dtype),_=t.data.get(s.dataId).values,E=t.data.get(i.dataId).values,I=b.values,C=Ke(s.shape),S=Ke(i.shape);for(let T=0;T<u.batchSize;++T){const N=T*C[0],R=T*b.strides[0];for(let D=0;D<u.outDepth;++D){const z=R+D*b.strides[1],L=D*u.strideDepth-v;for(let O=0;O<c;++O){const F=L+O*f;if(F<0||F>=u.inDepth)continue;const P=O*S[0],U=N+F*C[1];for(let W=0;W<u.outHeight;++W){const X=z+W*b.strides[2],Z=W*u.strideHeight-x;for(let ne=0;ne<h;++ne){const he=Z+ne*p;if(he<0||he>=u.inHeight)continue;const le=P+ne*S[1],pe=U+he*C[2];for(let be=0;be<u.outWidth;++be){const Ce=X+be*u.outChannels,ke=be*u.strideWidth-y;for(let $e=0;$e<d;++$e){const Se=ke+$e*m;if(Se<0||Se>=u.inWidth)continue;const Ue=le+$e*S[2],je=pe+Se*u.inChannels;let tt=Ue;for(let Qe=0;Qe<u.inChannels;++Qe){const Xe=_[je+Qe];for(let Ct=0;Ct<u.outChannels;++Ct)I[Ce+Ct]+=Xe*E[tt+Ct];tt+=u.outChannels}}}}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const xEe={kernelName:f_,backendName:"cpu",kernelFunc:yEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r;Le([s,i],"conv3dBackpropFilterV2");const u=Ke(s.shape),c=Ke(i.shape),h=dc(s.shape,l,o,1,a),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,m=h.filterDepth,g=h.filterHeight,v=h.filterWidth,y=new Or(h.filterShape,"float32"),x=y.values,[b,_,E,I]=y.strides,C=t.data.get(i.dataId).values,[S,T,N,R]=c,D=t.data.get(s.dataId).values,[z,L,O,F]=u,P=h.padInfo.front,U=h.padInfo.left,W=h.padInfo.top;for(let X=0;X<m;++X){const Z=Math.max(0,Math.ceil((P-X)/d)),ne=Math.min(h.outDepth,(h.inDepth+P-X)/d),he=X*b;for(let le=0;le<g;++le){const pe=Math.max(0,Math.ceil((W-le)/f)),be=Math.min(h.outHeight,(h.inHeight+W-le)/f),Ce=le*_+he;for(let ke=0;ke<v;++ke){const $e=Math.max(0,Math.ceil((U-ke)/p)),Se=Math.min(h.outWidth,(h.inWidth+U-ke)/p),Ue=ke*E+Ce;for(let je=0;je<h.inChannels;++je){const tt=je*I+Ue;for(let Qe=0;Qe<h.outChannels;++Qe){let Xe=0;for(let Ct=0;Ct<h.batchSize;++Ct){const _t=Ct*z,ln=Ct*S;for(let Yt=Z;Yt<ne;++Yt){const kn=(X+Yt*d-P)*L+_t,Yn=Yt*T+ln;for(let Ln=pe;Ln<be;++Ln){const Qt=(le+Ln*f-W)*O+kn,jt=Ln*N+Yn;for(let Cn=$e;Cn<Se;++Cn){const Gl=(ke+Cn*p-U)*F+Qt,kc=Cn*R+jt;Xe+=D[Gl+je]*C[kc+Qe]}}}}x[tt+Qe]=Xe}}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const wEe={kernelName:kA,backendName:"cpu",kernelFunc:bEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r;Le([s],"conv3dBackpropInputV2");const u=Ke(s.shape),c=Ke(i.shape),h=dc(l,i.shape,a,1,o),d=new Or(h.inShape,"float32"),f=d.values,[p,m,g,v]=d.strides,y=t.data.get(s.dataId).values,[x,b,_,E]=u,I=t.data.get(i.dataId).values,[C,S,T,N]=c,{batchSize:R,filterDepth:D,filterHeight:z,filterWidth:L,inChannels:O,inDepth:F,inHeight:P,inWidth:U,outChannels:W,outDepth:X,outHeight:Z,outWidth:ne,strideDepth:he,strideHeight:le,strideWidth:pe}=h,be=D-1-h.padInfo.front,Ce=z-1-h.padInfo.top,ke=L-1-h.padInfo.left;for(let $e=0;$e<R;++$e)for(let Se=0;Se<O;++Se)for(let Ue=0;Ue<F;++Ue){const je=Ue-be,tt=Math.max(0,Math.ceil(je/he)),Qe=Math.min(X,(D+je)/he);for(let Xe=0;Xe<P;++Xe){const Ct=Xe-Ce,_t=Math.max(0,Math.ceil(Ct/le)),ln=Math.min(Z,(z+Ct)/le);for(let Yt=0;Yt<U;++Yt){const Xn=Yt-ke,kn=Math.max(0,Math.ceil(Xn/pe)),Yn=Math.min(ne,(L+Xn)/pe);let Ln=0;for(let Bn=tt;Bn<Qe;++Bn){const Qt=Bn*he-je;for(let jt=_t;jt<ln;++jt){const Cn=jt*le-Ct;for(let $i=kn;$i<Yn;++$i){const Gl=$i*pe-Xn,kc=x*$e+b*Bn+_*jt+E*$i,za=C*(D-1-Qt)+S*(z-1-Cn)+T*(L-1-Gl)+N*Se;for(let po=0;po<W;++po){const ql=y[kc+po],Ua=I[za+po];Ln+=ql*Ua}}}}f[p*$e+m*Ue+g*Xe+v*Yt+Se]=Ln}}}return t.makeTensorInfo(d.shape,d.dtype,d.values)}const kEe={kernelName:CA,backendName:"cpu",kernelFunc:_Ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CEe=Xt(qv,n=>Math.cos(n)),IEe={kernelName:qv,backendName:"cpu",kernelFunc:CEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SEe=Xt(Kv,n=>Math.cosh(n)),EEe={kernelName:Kv,backendName:"cpu",kernelFunc:SEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,[c,h,d,f]=s.shape,p=i.shape[0],[m,g]=a,v=gt([p,m,g,f],"float32"),y=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,b=t.data.get(s.dataId).values,_=Ke(s.shape),E=Ke(v.shape);for(let I=0;I<p;I++){const C=I*4,S=y[C],T=y[C+1],N=y[C+2],R=y[C+3],D=x[I];if(D>=c)continue;const z=m>1?(N-S)*(h-1)/(m-1):0,L=g>1?(R-T)*(d-1)/(g-1):0;for(let O=0;O<m;O++){const F=m>1?S*(h-1)+O*z:.5*(S+N)*(h-1);if(F<0||F>h-1){for(let P=0;P<g;P++)for(let U=0;U<f;U++){const W=U+P*E[2]+O*E[1]+I*E[0];v.values[W]=u}continue}if(l==="bilinear"){const P=Math.floor(F),U=Math.ceil(F),W=F-P;for(let X=0;X<g;X++){const Z=g>1?T*(d-1)+X*L:.5*(T+R)*(d-1);if(Z<0||Z>d-1){for(let pe=0;pe<f;pe++){const be=pe+X*E[2]+O*E[1]+I*E[0];v.values[be]=u}continue}const ne=Math.floor(Z),he=Math.ceil(Z),le=Z-ne;for(let pe=0;pe<f;pe++){let be=pe+ne*_[2]+P*_[1]+D*_[0];const Ce=b[be];be=pe+he*_[2]+P*_[1]+D*_[0];const ke=b[be];be=pe+ne*_[2]+U*_[1]+D*_[0];const $e=b[be];be=pe+he*_[2]+U*_[1]+D*_[0];const Se=b[be],Ue=Ce+(ke-Ce)*le,je=$e+(Se-$e)*le;be=pe+X*E[2]+O*E[1]+I*E[0],v.values[be]=Ue+(je-Ue)*W}}}else for(let P=0;P<g;++P){const U=g>1?T*(d-1)+P*L:.5*(T+R)*(d-1);if(U<0||U>d-1){for(let Z=0;Z<f;Z++){const ne=Z+P*E[2]+O*E[1]+I*E[0];v.values[ne]=u}continue}const W=Math.round(U),X=Math.round(F);for(let Z=0;Z<f;Z++){const ne=Z+W*_[2]+X*_[1]+D*_[0],he=Z+P*E[2]+O*E[1]+I*E[0];v.values[he]=b[ne]}}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const NEe={kernelName:SA,backendName:"cpu",kernelFunc:TEe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Le(s,"cumprod");const l=Tn([i],s.shape.length);let u=s;l!=null&&(u=Ls({inputs:{x:s},backend:t,attrs:{perm:l}}));const c=Gn(1,s.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=ri(u.dtype,"int32"),d=hA(fe(u.shape),h),f=t.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(v,y)=>v+p-y-1:(v,y)=>v+y;for(let v=0;v<f.length;v+=p)for(let y=0;y<p;y++){const x=m(v,y);if(y===0)d[x]=o?1:f[x];else{const b=m(v,y-1);d[x]=o?f[b]*d[b]:f[x]*d[b]}}const g=t.makeTensorInfo(u.shape,h,d);if(l!=null){const v=fc(l),y=Ls({inputs:{x:g},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(u),y}return g}const REe={kernelName:IA,backendName:"cpu",kernelFunc:AEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Le(s,"cumsum");const l=Tn([i],s.shape.length);let u=s;l!=null&&(u=Ls({inputs:{x:s},backend:t,attrs:{perm:l}}));const c=Gn(1,s.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=ri(u.dtype,"int32"),d=Jr(fe(u.shape),h),f=t.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(v,y)=>v+p-y-1:(v,y)=>v+y;for(let v=0;v<f.length;v+=p)for(let y=0;y<p;y++){const x=m(v,y);if(y===0)d[x]=o?0:f[x];else{const b=m(v,y-1);d[x]=o?f[b]+d[b]:f[x]+d[b]}}const g=t.makeTensorInfo(u.shape,h,d);if(l!=null){const v=fc(l),y=Ls({inputs:{x:g},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(u),y}return g}const $Ee={kernelName:p_,backendName:"cpu",kernelFunc:DEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,c=PD(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(s.shape.length===2){const l=t.bufferSync(s),u=t.bufferSync(i),c=I8(l,u,o,a);return t.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const OEe={kernelName:EA,backendName:"cpu",kernelFunc:PEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r;M(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=s.shape[0],l=s.shape[1],u=s.shape[2],c=s.shape[3],h=l*i,d=u*i,f=c/(i*i),p=t.data.get(s.dataId).values,m=new Float32Array(a*h*d*f);let g=0;for(let v=0;v<a;++v)for(let y=0;y<h;++y){const x=Math.floor(y/i),b=y%i;for(let _=0;_<d;++_){const E=Math.floor(_/i),I=_%i,C=(b*i+I)*f;for(let S=0;S<f;++S){const N=S+C+c*(E+u*(x+l*v));m[g++]=p[N]}}}return t.makeTensorInfo([a,h,d,f],s.dtype,m)}const MEe={kernelName:TA,backendName:"cpu",kernelFunc:FEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;Le([s,i],"depthwiseConv2DNative");const c=Ke(s.shape),h=Ke(i.shape);let d=l;d==null&&(d=[1,1]),M(es(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Lr(s.shape,i.shape,o,d,a,u,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:y}=f,x=y.left,b=y.top,_=f.outChannels/f.inChannels,E=new Or(f.outShape,s.dtype),I=t.data.get(s.dataId).values,C=t.data.get(i.dataId).values,S=E.values;for(let T=0;T<f.batchSize;++T){const N=T*c[0],R=T*E.strides[0];for(let D=0;D<f.outHeight;++D){const z=R+D*E.strides[1],L=D*f.strideHeight-b;for(let O=0;O<p;++O){const F=L+O*g;if(F<0||F>=f.inHeight)continue;const P=O*h[0],U=N+F*c[1];for(let W=0;W<f.outWidth;++W){const X=z+W*E.strides[2],Z=W*f.strideWidth-x;for(let ne=0;ne<m;++ne){const he=Z+ne*v;if(he<0||he>=f.inWidth)continue;const le=P+ne*h[1],pe=U+he*f.inChannels;let be=X,Ce=le;for(let ke=0;ke<f.inChannels;++ke){const $e=I[pe+ke];for(let Se=0;Se<_;++Se)S[be+Se]+=$e*C[Ce+Se];be+=_,Ce+=_}}}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const LEe={kernelName:m_,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r;Le([s,i],"depthwiseConv2dNativeBackpropFilter");const h=Lr(s.shape,c,o,a,l,u,!0),{strideHeight:d,strideWidth:f,filterHeight:p,filterWidth:m}=h,g=new Or(h.filterShape,"float32"),v=h.padInfo.left,y=h.padInfo.top,x=h.outChannels/h.inChannels,b=t.data.get(s.dataId).values,_=new Or(s.shape,s.dtype,b),E=t.data.get(i.dataId).values,I=new Or(i.shape,i.dtype,E);for(let C=0;C<p;++C){const S=Math.max(0,Math.ceil((y-C)/d)),T=Math.min(h.outHeight,(h.inHeight+y-C)/d);for(let N=0;N<m;++N){const R=Math.max(0,Math.ceil((v-N)/f)),D=Math.min(h.outWidth,(h.inWidth+v-N)/f);for(let z=0;z<h.outChannels;++z){const L=Math.trunc(z/x),O=z%x;let F=0;for(let P=0;P<h.batchSize;++P)for(let U=S;U<T;++U){const W=C+U*d-y;for(let X=R;X<D;++X){const Z=N+X*f-v;F+=_.get(P,W,Z,L)*I.get(P,U,X,z)}}g.set(F,C,N,L,O)}}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const VEe={kernelName:NA,backendName:"cpu",kernelFunc:BEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r;Le([s,i],"depthwiseConv2DNativeBackpropInput");const h=Ke(s.shape),d=Ke(i.shape),f=Lr(c,i.shape,o,a,l,u,!0),p=new Or(f.inShape,"float32"),m=p.values,[g,v,y]=p.strides,x=t.data.get(s.dataId).values,[b,_,E]=h,I=t.data.get(i.dataId).values,[C,S,T]=d,{batchSize:N,filterHeight:R,filterWidth:D,inChannels:z,inHeight:L,inWidth:O,outChannels:F,outHeight:P,outWidth:U,strideHeight:W,strideWidth:X}=f,Z=R-1-f.padInfo.top,ne=D-1-f.padInfo.left,he=F/z;for(let le=0;le<N;++le)for(let pe=0;pe<z;++pe)for(let be=0;be<L;++be){const Ce=be-Z,ke=Math.max(0,Math.ceil(Ce/W)),$e=Math.min(P,(R+Ce)/W);for(let Se=0;Se<O;++Se){const Ue=Se-ne,je=Math.max(0,Math.ceil(Ue/X)),tt=Math.min(U,(D+Ue)/X);let Qe=0;for(let Xe=ke;Xe<$e;++Xe){const Ct=Xe*W-Ce;for(let _t=je;_t<tt;++_t){const ln=_t*X-Ue,Yt=b*le+_*Xe+E*_t,Xn=C*(R-1-Ct)+S*(D-1-ln)+T*pe;for(let kn=0;kn<he;++kn){const Yn=pe*he+kn,Ln=x[Yt+Yn],Bn=I[Xn+kn];Qe+=Ln*Bn}}}m[g*le+v*be+y*Se+pe]=Qe}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const UEe={kernelName:AA,backendName:"cpu",kernelFunc:zEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jEe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=fe(r.shape),i=t.data.get(r.dataId).values,o=gt([s,s],r.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*s+u]=i[u];const l=[...r.shape,...r.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const WEe={kernelName:H6,backendName:"cpu",kernelFunc:jEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HEe={kernelName:g_,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(r.dataId).values,c=r.shape.length,h=l.data.get(s.dataId).values,d=s.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:y,padInfo:x,strideHeight:b,strideWidth:_,filterHeight:E,filterWidth:I,dilationHeight:C,dilationWidth:S,outShape:T}=Dy(r.shape,s.shape,i,o,"NHWC",a),N=fe(T),R=T.length,D=jn(r.dtype,N);for(let L=0;L<f;++L)for(let O=0;O<v;++O){const F=O*b-x.top;for(let P=0;P<y;++P){const U=P*_-x.left;for(let W=0;W<g;++W){let X=Number.MIN_SAFE_INTEGER;for(let ne=0;ne<E;++ne){const he=F+ne*C;if(he>=0&&he<p)for(let le=0;le<I;++le){const pe=U+le*S;if(pe>=0&&pe<m){const be=va([L,he,pe,W],c,Ke(r.shape)),Ce=va([ne,le,W],d,Ke(s.shape)),ke=u[be]+h[Ce];ke>X&&(X=ke)}}}const Z=va([L,O,P,W],R,Ke(T));D[Z]=X}}}return{dataId:l.write(Zh(D,r.dtype),T,r.dtype),shape:T,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GEe={kernelName:BS,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,c=Ro(r.shape,u.data.get(r.dataId).values),h=Ro(s.shape,u.data.get(s.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:y,strideHeight:x,strideWidth:b,filterHeight:_,filterWidth:E,dilationHeight:I,dilationWidth:C,outShape:S}=Dy(r.shape,s.shape,o,a,"NHWC",l);M(i.rank===S.length,()=>`Error in ${BS}, dy must have the same rank as output ${S.length}, but got ${i.rank}`);const T=Ro(S,u.data.get(i.dataId).values),N=z6(s.shape,s.dtype);for(let D=0;D<d;++D)for(let z=0;z<g;++z){const L=z*x-y.top;for(let O=0;O<v;++O){const F=O*b-y.left;for(let P=0;P<m;++P){let U=Number.MIN_SAFE_INTEGER,W=0,X=0;for(let Z=0;Z<_;++Z){const ne=L+Z*I;if(ne>=0&&ne<f)for(let he=0;he<E;++he){const le=F+he*C;if(le>=0&&le<p){const pe=c[D][ne][le][P]+h[Z][he][P];pe>U&&(U=pe,W=Z,X=he)}}}N[W][X][P]+=T[D][z][O][P]}}}return{dataId:u.write(Zh(N,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe={kernelName:LS,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,c=Ro(r.shape,u.data.get(r.dataId).values),h=Ro(s.shape,u.data.get(s.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:y,strideHeight:x,strideWidth:b,filterHeight:_,filterWidth:E,dilationHeight:I,dilationWidth:C,outShape:S}=Dy(r.shape,s.shape,o,a,"NHWC",l);M(i.rank===S.length,()=>`Error in ${LS}, dy must have the same rank as output ${S.length}, but got ${i.rank}`);const T=Ro(S,u.data.get(i.dataId).values),N=z6(r.shape,r.dtype);for(let D=0;D<d;++D)for(let z=0;z<g;++z){const L=z*x-y.top;for(let O=0;O<v;++O){const F=O*b-y.left;for(let P=0;P<m;++P){let U=Number.MIN_SAFE_INTEGER,W=L<0?0:L,X=F<0?0:F;for(let Z=0;Z<_;++Z){const ne=L+Z*I;if(ne>=0&&ne<f)for(let he=0;he<E;++he){const le=F+he*C;if(le>=0&&le<p){const pe=c[D][ne][le][P]+h[Z][he][P];pe>U&&(U=pe,W=ne,X=le)}}}N[D][W][X][P]+=T[D][z][O][P]}}}return{dataId:u.write(Zh(N,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:i,options:o}=r,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,f]=s.shape.slice(0,2),p=s.shape.length===2?1:s.shape[2],m=t.data.get(s.dataId).values,g=s.dtype==="float32"?255:1,v=new Uint8ClampedArray(f*d*4);for(let x=0;x<d*f;++x){const b=[0,0,0,255*u];for(let E=0;E<p;E++){const I=m[x*p+E];if(s.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(s.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);p===1?(b[0]=I*g,b[1]=I*g,b[2]=I*g):b[E]=I*g}const _=x*4;v[_+0]=Math.round(b[0]),v[_+1]=Math.round(b[1]),v[_+2]=Math.round(b[2]),v[_+3]=Math.round(b[3])}i.width=f,i.height=d;const y=new ImageData(v,f,d);return h.putImageData(y,0,0),s}const XEe={kernelName:Nve,backendName:"cpu",kernelFunc:KEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ky(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Le(s,"sum");let a;s.dtype==="bool"?a=ic({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):a=$a({inputs:{x:s},backend:t});const l=a.shape.length,u=vt(i,a.shape),c=Tn(u,l);let h=u,d=a;c!=null&&(d=Ls({inputs:{x:a},backend:t,attrs:{perm:c}}),h=Gn(h.length,l)),Br("sum",h,d.shape.length);const[f,p]=Sr(d.shape,h),m=ri(d.dtype,"int32");let g=Pw(t,f,m);const v=fe(p),y=t.data.get(g.dataId).values,x=t.data.get(d.dataId).values;for(let b=0;b<y.length;++b){const _=b*v;let E=0;for(let I=0;I<v;++I)E+=x[_+I];y[b]=E}if(o){const b=rr(g.shape,u),_=g;g=an({inputs:{x:g},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(_)}return t.disposeIntermediateTensorInfo(a),c!=null&&t.disposeIntermediateTensorInfo(d),g}const YEe={kernelName:X_,backendName:"cpu",kernelFunc:Ky};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QEe(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=sD(s,i.length);oD(o.length,l,i);const{path:u,steps:c}=aD(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:v,expandDims:y}=iD(f,l[g]);let x;lD(v)?x=i[g]:(x=Ls({inputs:{x:i[g]},backend:t,attrs:{perm:v}}),p.push(x));const b=x.shape.slice();for(let _=0;_<y.length;++_)b.splice(y[_],0,1);Ut(x.shape,b)||(x=an({inputs:{x},backend:t,attrs:{shape:b}}),p.push(x)),d===null?d=x:(d=Sk({inputs:{a:x,b:d},backend:t}),p.push(d))}m<h-1&&(u[m]>=0&&(d=Ky({inputs:{x:d},backend:t,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&t.disposeIntermediateTensorInfo(m);return d}const JEe={kernelName:RA,backendName:"cpu",kernelFunc:QEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEe(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;Le([r,s],"eluGrad");const i=new Float32Array(fe(s.shape)),o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(s.shape,"float32",i)}const eTe={kernelName:DA,backendName:"cpu",kernelFunc:ZEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tTe=QR,nTe=JR,rTe=ZR,sTe=eD,iTe=tD,oTe=nD,aTe=Xt(Qv,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+tTe*t);return e*(1-((((oTe*r+iTe)*r+sTe)*r+rTe)*r+nTe)*r*Math.exp(-t*t))}),lTe={kernelName:Qv,backendName:"cpu",kernelFunc:aTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mw(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:i}=r,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(M(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),an({inputs:{x:s},backend:t,attrs:{shape:a}})}const uTe={kernelName:y_,backendName:"cpu",kernelFunc:Mw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cTe=Kn((n,e)=>n/e),VD=pr(Xv,cTe),dE={kernelName:Xv,backendName:"cpu",kernelFunc:VD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n,e,t){const r=n.shape,s=r[0],i=r[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[s,i],c=fe(u),h=Qr("float32",c),d=Qr("float32",c);for(let g=0;g<s;g++){const v=Bh({inputs:{x:a},backend:t,attrs:{begin:[g,0],size:[1,i]}}),y=Bh({inputs:{x:l},backend:t,attrs:{begin:[g,0],size:[1,i]}}),x=Ks({inputs:{real:v,imag:y},backend:t}),{real:b,imag:_}=hTe(x,e,t),E=Il(b,_);for(let I=0;I<i;I++){const C=rD(E,I);h[g*i+I]=C.real,d[g*i+I]=C.imag}t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(x)}const f=t.makeTensorInfo(u,"float32",h),p=t.makeTensorInfo(u,"float32",d),m=Ks({inputs:{real:f,imag:p},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),m}function hTe(n,e,t){const r=fe(n.shape),s=t.data.get(n.dataId),i=t.data.get(s.complexTensorInfos.real.dataId).values,o=t.data.get(s.complexTensorInfos.imag.dataId).values;if(dTe(r)){const a=fE(i,o,r,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),c=t.makeTensorInfo(l,"float32",a.imag),h=t.makeTensorInfo([],"float32",hc(r,"float32")),d=$a({inputs:{x:h},backend:t}),f=dE.kernelFunc({inputs:{a:u,b:h},backend:t}),p=dE.kernelFunc({inputs:{a:c,b:d},backend:t}),m=t.data.get(f.dataId).values,g=t.data.get(p.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=Il(i,o),l=fTe(a,r,e);return BH(l)}}function dTe(n){return(n&n-1)===0}function fE(n,e,t,r,s){if(t===1)return{real:n,imag:e};const i=Il(n,e),o=t/2,a=VH(i),l=a.real,u=a.imag,c=[l.length],h=s.makeTensorInfo(c,"float32",l),d=s.makeTensorInfo(c,"float32",u),f=Ks({inputs:{real:h,imag:d},backend:s}),p=zH(i),m=p.real,g=p.imag,v=[m.length],y=s.makeTensorInfo(v,"float32",m),x=s.makeTensorInfo(v,"float32",g),b=Ks({inputs:{real:y,imag:x},backend:s}),_=fE(l,u,o,r,s),E=_.real,I=_.imag,C=[E.length],S=s.makeTensorInfo(C,"float32",E),T=s.makeTensorInfo(C,"float32",I),N=Ks({inputs:{real:S,imag:T},backend:s}),R=fE(m,g,o,r,s),D=R.real,z=R.imag,L=[D.length],O=s.makeTensorInfo(L,"float32",D),F=s.makeTensorInfo(L,"float32",z),P=Ks({inputs:{real:O,imag:F},backend:s}),U=jH(t,r),W=[U.real.length],X=s.makeTensorInfo(W,"float32",U.real),Z=s.makeTensorInfo(W,"float32",U.imag),ne=Ks({inputs:{real:X,imag:Z},backend:s}),he=Sk({inputs:{a:ne,b:P},backend:s}),le=Qf({inputs:{a:N,b:he},backend:s}),pe=LD({inputs:{a:N,b:he},backend:s}),be=Lh({inputs:{input:le},backend:s}),Ce=Lh({inputs:{input:pe},backend:s}),ke=Jf({inputs:{input:le},backend:s}),$e=Jf({inputs:{input:pe},backend:s}),Se=Zf({inputs:[be,Ce],backend:s,attrs:{axis:0}}),Ue=Zf({inputs:[ke,$e],backend:s,attrs:{axis:0}}),je=s.data.get(Se.dataId).values,tt=s.data.get(Ue.dataId).values;return s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(T),s.disposeIntermediateTensorInfo(N),s.disposeIntermediateTensorInfo(O),s.disposeIntermediateTensorInfo(F),s.disposeIntermediateTensorInfo(P),s.disposeIntermediateTensorInfo(X),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(ne),s.disposeIntermediateTensorInfo(he),s.disposeIntermediateTensorInfo(le),s.disposeIntermediateTensorInfo(pe),s.disposeIntermediateTensorInfo(be),s.disposeIntermediateTensorInfo(ke),s.disposeIntermediateTensorInfo(Ce),s.disposeIntermediateTensorInfo($e),s.disposeIntermediateTensorInfo(Se),s.disposeIntermediateTensorInfo(Ue),{real:je,imag:tt}}function fTe(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let i=0,o=0;for(let a=0;a<e;a++){const l=WH(s*a,e,t),u=rD(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),UH(r,i,o,s)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pTe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=fe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=an({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=S9(a,!1,t),u=an({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const mTe={kernelName:$A,backendName:"cpu",kernelFunc:pTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:i}=t,o=i||wp(s),a=jn(o,fe(r));return vTe(a,s,o),e.makeTensorInfo(r,o,a)}const gTe={kernelName:PA,backendName:"cpu",kernelFunc:zD};function vTe(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yTe={kernelName:OA,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,i=Qr(r.dtype,fe(r.shape)),[o,a,l,u]=r.shape,c=s.data.get(r.dataId).values;for(let d=0;d<o;d++){const f=d*l*a*u;for(let p=0;p<a;p++){const m=p*(l*u);for(let g=0;g<l;g++){const v=g*u;for(let y=0;y<u;y++){const x=Math.round(l-g-1),b=f+m+v+y;let _=c[b];if(x>=0&&x<l){const E=x*u,I=f+m+E+y;_=c[I]}i[b]=_}}}}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r;let m=C9({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const v=an({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=Qf({inputs:{a:m,b:v},backend:t}),t.disposeIntermediateTensorInfo(v)}else m=Qf({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(g)}if(f){const g=m;if(c==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const v=an({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});m=Fw(t,m,f,v,p),t.disposeIntermediateTensorInfo(v)}else m=Fw(t,m,f,a,p);t.disposeIntermediateTensorInfo(g)}return m}const bTe={kernelName:gw,backendName:"cpu",kernelFunc:xTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r;let m=I9({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;m=Qf({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(g)}if(f){const g=m;m=Fw(t,m,f,a,p),t.disposeIntermediateTensorInfo(g)}return m}const _Te={kernelName:c5,backendName:"cpu",kernelFunc:wTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kTe(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=fe(r.shape),o=s.shape,a=o[o.length-1],[l,u,c,h]=VR(r,s);if(u===0)return t.makeTensorInfo(l,r.dtype,[]);const d=t.data.get(s.dataId).values,f=t.bufferSync(r),p=F8(d,f,r.dtype,u,a,c,h,r.shape,i);return t.makeTensorInfo(l,r.dtype,p.values)}const CTe={kernelName:G6,backendName:"cpu",kernelFunc:kTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ITe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r;Le([s,i],"gatherV2");const l=vt(o,s.shape)[0],u=t.data.get(i.dataId).values,c=s.shape[l];for(let b=0;b<u.length;++b){const _=u[b];M(_<=c-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const d=fe(i.shape),f=cD(s,i,l,h),p=an({inputs:{x:s},backend:t,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=an({inputs:{x:i},backend:t,attrs:{shape:[f.batchSize,d/f.batchSize]}}),g=[f.batchSize,f.outerSize,d/f.batchSize,f.sliceSize],v=t.bufferSync(m),y=t.bufferSync(p),x=M8(y,v,g);return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.makeTensorInfo(f.outputShape,x.dtype,x.values)}const STe={kernelName:b_,backendName:"cpu",kernelFunc:ITe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ETe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=fe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=an({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=S9(a,!0,t),u=an({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const TTe={kernelName:FA,backendName:"cpu",kernelFunc:ETe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe=Xt(sy,n=>Number.isFinite(n)?1:0,"bool"),ATe={kernelName:sy,backendName:"cpu",kernelFunc:NTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RTe=Xt(iy,n=>Math.abs(n)===1/0?1:0,"bool"),DTe={kernelName:iy,backendName:"cpu",kernelFunc:RTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Te=Xt(oy,n=>Number.isNaN(n)?1:0,"bool"),PTe={kernelName:oy,backendName:"cpu",kernelFunc:$Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OTe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=U8(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const FTe={kernelName:q6,backendName:"cpu",kernelFunc:OTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MTe=Xt(ly,n=>Math.log1p(n)),LTe={kernelName:ly,backendName:"cpu",kernelFunc:MTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BTe=Kn((n,e)=>n&&e),VTe=pr(I_,BTe,null,"bool"),zTe={kernelName:I_,backendName:"cpu",kernelFunc:VTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe=Xt(S_,n=>n?0:1,"bool"),jTe={kernelName:S_,backendName:"cpu",kernelFunc:UTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WTe=Kn((n,e)=>n||e),HTe=pr(E_,WTe,null,"bool"),GTe={kernelName:E_,backendName:"cpu",kernelFunc:HTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r;Le(s,"LRN");const u=s.shape[3],c=u-1,h=t.data.get(s.dataId).values,d=fe(s.shape),f=new Float32Array(d);function p(m){const g=m%u;let v=m-g+Math.max(0,g-i);const y=m-g+Math.min(g+i,c);let x=0;for(;v<=y;v++){const b=h[v];x+=b*b}return x}for(let m=0;m<d;m++){const g=p(m),v=h[m]*Math.pow(o+a*g,-l);f[m]=v}return t.makeTensorInfo(s.shape,s.dtype,f)}const KTe={kernelName:T_,backendName:"cpu",kernelFunc:qTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=r;Le(o,"LRNGrad");const h=fe(o.shape),d=o.shape[3],f=t.data.get(o.dataId).values,p=t.data.get(s.dataId).values,m=t.data.get(i.dataId).values,g=new Float32Array(h),v=h;for(let y=0;y<v;y++){const x=y%d,b=y-x+Math.max(0,x-a),_=y-x+Math.min(d,x+a+1);let E=0;for(let I=b;I<_;I++)E+=Math.pow(p[I],2);E=u*E+l;for(let I=b;I<_;I++){let C=-2*u*c*p[I]*m[y]/E;y===I&&(C+=Math.pow(E,-c)),C*=f[y],g[I]+=C}}return t.makeTensorInfo(o.shape,s.dtype,g)}const YTe={kernelName:LA,backendName:"cpu",kernelFunc:XTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=t;let l=s.shape;const u=l.length,c=vt(i,l);let h=c;const d=Tn(h,u);let f=a.data.get(s.dataId).values;if(d!=null){const b=new Array(u);for(let _=0;_<b.length;_++)b[_]=l[d[_]];f=FD(f,l,s.dtype,d,b),h=Gn(h.length,u),l=b}Le(s,"max"),Br("max",h,u);const[p,m]=Sr(l,h),g=fe(m),v=W8(f,g,p,s.dtype),y=a.write(v,p,s.dtype);let x=p;return o&&(x=rr(p,c)),{dataId:y,shape:x,dtype:s.dtype}}const QTe={kernelName:N_,backendName:"cpu",kernelFunc:E9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Le(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;M(es(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=uo(s.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&Ut(c.inShape,c.outShape))h=$a({inputs:{x:s},backend:t});else{const d=t.data.get(s.dataId).values,f=Ke(s.shape),p=BD(d,s.shape,s.dtype,f,c,"max");h=t.makeTensorInfo(c.outShape,s.dtype,p.values)}return h}const ZTe={kernelName:A_,backendName:"cpu",kernelFunc:JTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Le(s,"maxPool3d");const c=Ml(s.shape,i,o,1,a,l,u),h=t.data.get(s.dataId).values,d=k9(h,s.shape,s.dtype,Ke(s.shape),c,"max");return t.makeTensorInfo(d.shape,"float32",d.values)}const tNe={kernelName:R_,backendName:"cpu",kernelFunc:eNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nNe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Le([s,i],"maxPool3DGrad");const c=Ml(i.shape,o,a,1,l,u),h=t.bufferSync(i),d=WSe(h,c),f=c.strideDepth,p=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,v=c.dilationHeight,y=c.dilationWidth,x=c.effectiveFilterDepth,b=c.effectiveFilterHeight,_=c.effectiveFilterWidth,E=x-1-c.padInfo.front,I=_-1-c.padInfo.left,C=b-1-c.padInfo.top,S=gt(i.shape,"float32"),T=t.bufferSync(s);for(let N=0;N<c.batchSize;++N)for(let R=0;R<c.inChannels;++R)for(let D=0;D<c.inDepth;++D)for(let z=0;z<c.inHeight;++z)for(let L=0;L<c.inWidth;++L){const O=D-E,F=z-C,P=L-I;let U=0;for(let W=0;W<x;W+=g){const X=(O+W)/f;if(!(X<0||X>=c.outDepth||Math.floor(X)!==X))for(let Z=0;Z<b;Z+=v){const ne=(F+Z)/p;if(!(ne<0||ne>=c.outHeight||Math.floor(ne)!==ne))for(let he=0;he<_;he+=y){const le=(P+he)/m;if(le<0||le>=c.outWidth||Math.floor(le)!==le)continue;const pe=x*b*_-1-d.get(N,X,ne,le,R),be=W*b*_+Z*_+he,Ce=pe===be?1:0;if(Ce===0)continue;const ke=T.get(N,X,ne,le,R);U+=ke*Ce}}}S.set(U,N,D,z,L,R)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const rNe={kernelName:VA,backendName:"cpu",kernelFunc:nNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sNe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Le([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=uo(a.shape,l,u,1,c,h),f=t.data.get(a.dataId).values,p=gt(d.outShape,a.dtype,_9(f,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,v=d.dilationHeight,y=d.dilationWidth,x=d.effectiveFilterHeight,b=d.effectiveFilterWidth,_=b-1-d.padInfo.left,E=x-1-d.padInfo.top,I=gt(a.shape,"float32"),C=t.data.get(s.dataId).values,S=gt(s.shape,"float32",C);for(let T=0;T<d.batchSize;++T)for(let N=0;N<d.inChannels;++N)for(let R=0;R<d.inHeight;++R)for(let D=0;D<d.inWidth;++D){const z=R-E,L=D-_;let O=0;for(let F=0;F<x;F+=v){const P=(z+F)/m;if(!(P<0||P>=d.outHeight||Math.floor(P)!==P))for(let U=0;U<b;U+=y){const W=(L+U)/g;if(W<0||W>=d.outWidth||Math.floor(W)!==W)continue;const X=x*b-1-p.get(T,P,W,N),Z=F*b+U,ne=X===Z?1:0;if(ne===0)continue;const he=S.get(T,P,W,N);O+=he*ne}}I.set(O,T,R,D,N)}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const iNe={kernelName:BA,backendName:"cpu",kernelFunc:sNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oNe(n,e,t,r,s){const i=Ke(e),o=BD(n,e,t,i,s,"max"),a=_9(n,e,t,s,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aNe={kernelName:K6,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Le(r,"MaxPoolWithArgmax");const u=l.data.get(r.dataId).values,c=uo(r.shape,s,i,[1,1],o),[h,d]=oNe(u,r.shape,r.dtype,a,c),f=l.write(h,c.outShape,r.dtype),p=l.write(d,c.outShape,r.dtype);return[{dataId:f,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=vt(i,s.shape),u=Sr(s.shape,a)[1],c=fe(u),h=[],d=t.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const f=ic({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});h.push(f);const p=VD({inputs:{a:f,b:d},backend:t});h.push(p);const m=Ky({inputs:{x:p},backend:t,attrs:{axis:i,keepDims:o}});return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const uNe={kernelName:D_,backendName:"cpu",kernelFunc:lNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Le(s,"min");const a=vt(i,s.shape);let l=a;const u=Tn(l,s.shape.length);let c=s;u!=null&&(c=Ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=Gn(l.length,s.shape.length)),Br("min",l,c.shape.length);const[h,d]=Sr(c.shape,l),f=fe(d),p=Jr(fe(h),c.dtype),m=t.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const y=v*f;let x=m[y];for(let b=0;b<f;++b){const _=m[y+b];(Number.isNaN(_)||_<x)&&(x=_)}p[v]=x}u!=null&&t.disposeIntermediateTensorInfo(c);const g=t.makeTensorInfo(h,c.dtype,p);if(o){const v=rr(h,a),y=an({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),y}return g}const hNe={kernelName:$_,backendName:"cpu",kernelFunc:cNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,mode:o}=r;Le(s,"mirrorPad");const a=i.map((x,b)=>x[0]+s.shape[b]+x[1]),l=i.map(x=>x[0]),u=i.map((x,b)=>x[0]+s.shape[b]),c=o==="reflect"?0:1,h=t.data.get(s.dataId).values,d=s.shape.length,f=Ke(s.shape),p=fe(a),m=a.length,g=Ke(a),v=Qr(s.dtype,p);for(let x=0;x<p;x++){let b=_p(x,m,g);for(let E=0;E<m;E++)b[E]<l[E]?b[E]=l[E]*2-b[E]-c:b[E]>=u[E]&&(b[E]=(u[E]-1)*2-b[E]+c);b=b.map((E,I)=>E-l[I]);const _=va(b,d,f);v[x]=h[_]}return{dataId:t.write(v,a,s.dtype),shape:a,dtype:s.dtype}}const fNe={kernelName:P_,backendName:"cpu",kernelFunc:dNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pNe=Kn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),mNe=pr(hy,pNe),gNe={kernelName:hy,backendName:"cpu",kernelFunc:mNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=s.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=vt([a],s.shape),u=E9({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),c=rr(u.shape,l),h=an({inputs:{x:u},backend:t,attrs:{shape:c}}),d=LD({inputs:{a:s,b:h},backend:t}),f=D8({inputs:{x:d},backend:t}),p=Ky({inputs:{x:f},backend:t,attrs:{axis:l,keepDims:!1}}),m=an({inputs:{x:p},backend:t,attrs:{shape:c}}),g=VD({inputs:{a:f,b:m},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}const vNe={kernelName:J_,backendName:"cpu",kernelFunc:T9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yNe(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r;Le(s,"multinomial");const l=a?s:T9({inputs:{logits:s},backend:t,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=t.data.get(l.dataId).values,d=[u,i],f=Jr(fe(d),"int32");for(let p=0;p<u;++p){const m=p*c,g=new Float32Array(c-1);g[0]=h[m];for(let x=1;x<g.length;++x)g[x]=g[x-1]+h[m+x];const v=SR.alea(o.toString()),y=p*i;for(let x=0;x<i;++x){const b=v();f[y+x]=g.length;for(let _=0;_<g.length;_++)if(b<g[_]){f[y+x]=_;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(d,"int32",f)}const xNe={kernelName:X6,backendName:"cpu",kernelFunc:yNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bNe=OR;function wNe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;Le(s,"NonMaxSuppression");const u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,{selectedIndices:h}=bNe(u,c,o,a,l);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const _Ne={kernelName:zA,backendName:"cpu",kernelFunc:wNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kNe=FR;function CNe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r;Le(s,"NonMaxSuppressionPadded");const c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=kNe(c,h,o,a,l,u);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const INe={kernelName:UA,backendName:"cpu",kernelFunc:CNe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SNe=MR;function ENe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r;Le(s,"NonMaxSuppressionWithScore");const c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,d=o,f=a,p=l,m=u,{selectedIndices:g,selectedScores:v}=SNe(c,h,d,f,p,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const TNe={kernelName:jA,backendName:"cpu",kernelFunc:ENe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NNe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r;Le(s,"oneHot");const u=fe(s.shape),c=new Float32Array(u*o);c.fill(l);const h=t.data.get(s.dataId).values;for(let d=0;d<u;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return t.makeTensorInfo([...s.shape,o],i,c)}const ANe={kernelName:L_,backendName:"cpu",kernelFunc:NNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lw(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=Lh({inputs:{input:r},backend:t}),i=Lw({inputs:{x:s},backend:t}),o=Jf({inputs:{input:r},backend:t}),a=Lw({inputs:{x:o},backend:t}),l=Ks({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return zD({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const RNe={kernelName:tk,backendName:"cpu",kernelFunc:Lw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=Lh({inputs:{input:r},backend:t}),i=N9({inputs:{x:s},backend:t}),o=Jf({inputs:{input:r},backend:t}),a=Lw({inputs:{x:o},backend:t}),l=Ks({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return zD({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const DNe={kernelName:M_,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return Mw({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{cA(i,c.shape,"All tensors passed to stack must have matching shapes"),M(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=Mw({inputs:{input:c},backend:t,attrs:{dim:s}});return a.push(h),h}),u=Zf({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(c=>t.disposeIntermediateTensorInfo(c)),u}const $Ne={kernelName:B_,backendName:"cpu",kernelFunc:A9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;Le(s,"pad");const a=i.map((y,x)=>y[0]+s.shape[x]+y[1]),l=i.map(y=>y[0]),u=t.data.get(s.dataId).values,c=fe(s.shape),h=s.shape.length,d=Ke(s.shape),f=fe(a),p=a.length,m=Ke(a),g=Qr(s.dtype,f);o!==0&&g.fill(o);for(let y=0;y<c;y++){const b=_p(y,h,d).map((E,I)=>E+l[I]),_=va(b,p,m);g[_]=u[y]}return{dataId:t.write(g,a,s.dtype),shape:a,dtype:s.dtype}}const R9={kernelName:V_,backendName:"cpu",kernelFunc:PNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ONe=Kn((n,e)=>Math.pow(n,e)),FNe=pr(fy,ONe),MNe={kernelName:fy,backendName:"cpu",kernelFunc:FNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LNe(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(v=>t.data.get(v.dataId).values),u=s.map(v=>v.shape),c=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values,[d,f,p]=Y8(l,u,c,i.shape,i.dtype,h,o.shape),m=d.map(v=>t.makeTensorInfo([v.length],"int32",v)),g=t.makeTensorInfo(p,i.dtype,f);return m.concat([g])}const BNe={kernelName:Y6,backendName:"cpu",kernelFunc:LNe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VNe(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,c]=Q8(o,r.shape,r.dtype,a,s.shape,l,i.shape),h=t.makeTensorInfo([u.length],"int32",u),d=t.makeTensorInfo([c.length],r.dtype,c);return[h,d]}const zNe={kernelName:Q6,backendName:"cpu",kernelFunc:VNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UNe(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values,d=a.map(g=>t.data.get(g.dataId).values),f=a.map(g=>g.shape),[p,m]=J8(u,s.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return t.makeTensorInfo(p,i.dtype,m)}const jNe={kernelName:J6,backendName:"cpu",kernelFunc:UNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WNe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:i,step:o}=t,a=Z8(r,s,o,i);return e.makeTensorInfo([a.length],i,a)}const HNe={kernelName:WA,backendName:"cpu",kernelFunc:WNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GNe=Xt(py,n=>1/n),qNe={kernelName:py,backendName:"cpu",kernelFunc:GNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KNe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Le(s,"resizeBilinear");const l=Ke(s.shape),[u,c]=a,[h,d,f,p]=s.shape,m=t.data.get(s.dataId).values,g=new Float32Array(fe([h,u,c,p])),v=[i&&u>1?d-1:d,i&&c>1?f-1:f],y=[i&&u>1?u-1:u,i&&c>1?c-1:c];let x=0;const b=v[0]/y[0],_=v[1]/y[1];for(let E=0;E<h;E++)for(let I=0;I<u;I++){let C;o?C=b*(I+.5)-.5:C=b*I;const S=Math.max(0,Math.floor(C)),T=C-S,N=Math.min(d-1,Math.ceil(C)),R=E*l[0]+S*l[1],D=E*l[0]+N*l[1];for(let z=0;z<c;z++){let L;o?L=_*(z+.5)-.5:L=_*z;const O=Math.max(0,Math.floor(L)),F=L-O,P=Math.min(f-1,Math.ceil(L)),U=R+O*l[2],W=D+O*l[2],X=R+P*l[2],Z=D+P*l[2];for(let ne=0;ne<p;ne++){const he=m[U+ne],le=m[W+ne],pe=m[X+ne],be=m[Z+ne],Ce=he+(pe-he)*F,ke=le+(be-le)*F,$e=Ce+(ke-Ce)*T;g[x++]=$e}}}return t.makeTensorInfo([h,u,c,p],"float32",g)}const XNe={kernelName:H_,backendName:"cpu",kernelFunc:KNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YNe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Le([i,s],"resizeBilinearGrad");const a=Ke(s.shape),[l,u,c,h]=s.shape,[,d,f]=i.shape,p=new Float32Array(l*u*c*h),m=[o&&d>1?u-1:u,o&&f>1?c-1:c],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=m[0]/g[0],y=m[1]/g[1],x=t.data.get(i.dataId).values;let b=0;for(let _=0;_<l;_++){const E=_*a[0];for(let I=0;I<d;I++){const C=I*v,S=Math.floor(C),T=Math.min(Math.ceil(C),u-1),N=E+S*a[1],R=E+T*a[1],D=C-S,z=1-D;for(let L=0;L<f;L++){const O=L*y,F=Math.floor(O),P=Math.min(Math.ceil(O),c-1),U=O-F,W=1-U,X=N+F*a[2],Z=N+P*a[2],ne=R+F*a[2],he=R+P*a[2],le=z*W,pe=z*U,be=D*W,Ce=D*U;for(let ke=0;ke<h;ke++){const $e=x[b++];p[X+ke]+=$e*le,p[Z+ke]+=$e*pe,p[ne+ke]+=$e*be,p[he+ke]+=$e*Ce}}}}return t.makeTensorInfo([l,c,u,h],"float32",p)}const QNe={kernelName:qA,backendName:"cpu",kernelFunc:YNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JNe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Le(s,"resizeNearestNeighbor");const l=Ke(s.shape),[u,c]=a,[h,d,f,p]=s.shape,m=t.data.get(s.dataId).values,g=new Float32Array(h*u*c*p),v=[i&&u>1?d-1:d,i&&c>1?f-1:f],y=[i&&u>1?u-1:u,i&&c>1?c-1:c],x=v[0]/y[0],b=v[1]/y[1];let _=0;for(let E=0;E<h;E++){const I=E*l[0];for(let C=0;C<u;C++){const S=o?x*(C+.5):x*C;let T=Math.min(d-1,i?Math.round(S):Math.floor(S));o&&(T=Math.max(0,T));const N=I+T*l[1];for(let R=0;R<c;R++){const D=o?b*(R+.5):b*R;let z=Math.min(f-1,i?Math.round(D):Math.floor(D));o&&(z=Math.max(0,z));const L=N+z*l[2];for(let O=0;O<p;O++){const F=m[L+O];g[_++]=F}}}}return t.makeTensorInfo([h,u,c,p],s.dtype,g)}const ZNe={kernelName:W_,backendName:"cpu",kernelFunc:JNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eAe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Le([i,s],"resizeNearestNeighborGrad");const a=Ke(s.shape),l=Ke(i.shape),[u,c,h,d]=s.shape,[,f,p]=i.shape,m=new Float32Array(u*c*h*d),g=t.data.get(i.dataId).values,v=[o&&f>1?c-1:c,o&&p>1?h-1:h],y=[o&&f>1?f-1:f,o&&p>1?p-1:p],x=v[0]/y[0],b=v[1]/y[1],_=1/x,E=1/b,I=Math.ceil(_)*2+2,C=Math.ceil(E)*2+2;for(let S=0;S<u;S++){const T=S*a[0];for(let N=0;N<c;N++){const R=T+N*a[1],D=Math.floor(N*_),z=Math.floor(D-I/2);for(let L=0;L<h;L++){const O=R+L*a[2],F=Math.floor(L*E),P=Math.floor(F-C/2);for(let U=0;U<d;U++){let W=0;for(let X=0;X<I;X++){const Z=X+z;if(Z<0||Z>=f)continue;const ne=T+Z*l[1],he=Z*x,le=Math.min(c-1,o?Math.round(he):Math.floor(he));if(N===le)for(let pe=0;pe<C;pe++){const be=pe+P;if(be<0||be>=p)continue;const Ce=ne+be*l[2],ke=be*b,$e=Math.min(h-1,o?Math.round(ke):Math.floor(ke));L===$e&&(W+=g[Ce+U])}}m[O+U]=W}}}}return t.makeTensorInfo(s.shape,s.dtype,m)}const tAe={kernelName:GA,backendName:"cpu",kernelFunc:eAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nAe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r;Le(s,"reverse");const o=s.shape.length,a=vt(i,s.shape);if(o===0)return $a({inputs:{x:s},backend:t});const l=new Or(s.shape,s.dtype),u=t.bufferSync(s);for(let c=0;c<l.size;c++){const h=l.indexToLoc(c),d=h.slice();a.forEach(f=>d[f]=s.shape[f]-1-d[f]),l.set(u.get(...d),...h)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const rAe={kernelName:G_,backendName:"cpu",kernelFunc:nAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sAe={kernelName:eR,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=Qr(r.dtype,fe(r.shape)),[u,c,h,d]=r.shape,[f,p]=KR(o,c,h),m=255,g=Math.sin(s),v=Math.cos(s),y=a.data.get(r.dataId).values;for(let b=0;b<u;b++){const _=b*h*c*d;for(let E=0;E<c;E++){const I=E*(h*d);for(let C=0;C<h;C++){const S=C*d;for(let T=0;T<d;T++){const N=[u,E,C,T],R=N[2],D=N[1];let z=(R-f)*v-(D-p)*g,L=(R-f)*g+(D-p)*v;z=Math.round(z+f),L=Math.round(L+p);let O=i;if(typeof i!="number"&&(T===3?O=m:O=i[T]),z>=0&&z<h&&L>=0&&L<c){const P=L*(h*d),U=z*d,W=_+P+U+T;O=y[W]}const F=_+I+S+T;l[F]=O}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iAe=Xt(vy,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),oAe={kernelName:vy,backendName:"cpu",kernelFunc:iAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aAe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rd(i,s,o),d=!0,f=t.bufferSync(s),p=t.bufferSync(i),m=nh(f,p,o,h,u,l,a,c,0,d);return t.makeTensorInfo(o,m.dtype,m.values)}const lAe={kernelName:Z6,backendName:"cpu",kernelFunc:aAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uAe(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function cAe(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function hAe(n,e,t,r,s,i){const o=jn("int32",t*s);for(let a=0;a<t;++a){const l=n.slice(a*r,(a+1)*r),u=a*s;for(let c=0;c<s;++c)o[u+c]=i==="left"?uAe(l,e[c+u]):cAe(l,e[c+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAe(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,u=hAe(a,l,s.shape[0],s.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const fAe={kernelName:t5,backendName:"cpu",kernelFunc:dAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pAe(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e;Le([r,s,i],"select");const o=r.shape.length,a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,c=ri(s.dtype,i.dtype),h=Jr(fe(s.shape),c);let d=0;const f=o===0||o>1||s.shape.length===1?1:fe(s.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?h[d++]=l[p]:h[d++]=u[p];return t.makeTensorInfo(s.shape,c,h)}const mAe={kernelName:q_,backendName:"cpu",kernelFunc:pAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gAe=fk,vAe=pk,yAe=Xt(xy,n=>n>=0?vAe*n:gAe*(Math.exp(n)-1)),xAe={kernelName:xy,backendName:"cpu",kernelFunc:yAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bAe=Xt(_y,n=>n<0?-1:n>0?1:0),wAe={kernelName:_y,backendName:"cpu",kernelFunc:bAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ae=Xt(by,n=>Math.sin(n)),kAe={kernelName:by,backendName:"cpu",kernelFunc:_Ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CAe=Xt(wy,n=>Math.sinh(n)),IAe={kernelName:wy,backendName:"cpu",kernelFunc:CAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SAe=11920928955078125e-23,g4=Math.log(SAe)+2,EAe=Xt(Cy,n=>{const e=n>-g4,t=n<g4,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),TAe={kernelName:Cy,backendName:"cpu",kernelFunc:EAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NAe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;Le([s],"spaceToBatchND");const a=fe(i),l=[[0,0]];l.push(...o);for(let E=1+i.length;E<s.shape.length;++E)l.push([0,0]);const u=R9.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),c=My(u.shape,i,a,!1),h=Ly(c.length,i.length,!1),d=By(u.shape,i,a,!1),m=an({inputs:{x:u},backend:t,attrs:{shape:c}}),y=Ls({inputs:{x:m},backend:t,attrs:{perm:h}}),_=an({inputs:{x:y},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),_}const AAe={kernelName:Y_,backendName:"cpu",kernelFunc:NAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAe(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,c=t.data.get(o.dataId).values[0],[h,d,f,p,m]=r9(a,r.shape,r.dtype,l,s.dtype,u,c);return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],s.dtype,f),t.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const DAe={kernelName:n5,backendName:"cpu",kernelFunc:RAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ae(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(s.dataId).values),a=t.data.get(r.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,c,h]=s9(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(c,r.dtype,u),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const PAe={kernelName:r5,backendName:"cpu",kernelFunc:$Ae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OAe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,c]=MD(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(c,r.dtype,u)}const FAe={kernelName:s5,backendName:"cpu",kernelFunc:OAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MAe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,c]=MD(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(c,r.dtype,u)}const LAe={kernelName:i5,backendName:"cpu",kernelFunc:MAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BAe(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=rd(i,s,a),f=!1,p=t.bufferSync(s);let m;switch(i.dtype){case"bool":{const g=t.bufferSync(i),v=!!t.data.get(o.dataId).values[0];m=nh(p,g,a,d,c,u,l,h,v,f);break}case"float32":{const g=t.bufferSync(i),v=t.data.get(o.dataId).values[0];m=nh(p,g,a,d,c,u,l,h,v,f);break}case"int32":{const g=t.bufferSync(i),v=t.data.get(o.dataId).values[0];m=nh(p,g,a,d,c,u,l,h,v,f);break}case"string":{const g=t.bufferSync(i),v=ec(t.data.get(o.dataId).values[0]);m=nh(p,g,a,d,c,u,l,h,v,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,m.dtype,m.values)}const VAe={kernelName:o5,backendName:"cpu",kernelFunc:BAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zAe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=vt(o,s.shape)[0],l=uD(s,i,a),u=new Array(s.shape.length).fill(0),c=s.shape.slice();return l.map(h=>{const d=[...c];d[a]=h;const f=Bh({inputs:{x:s},backend:t,attrs:{begin:u,size:d}});return u[a]+=h,f})}const UAe={kernelName:Q_,backendName:"cpu",kernelFunc:zAe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jAe={kernelName:KA,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;Le(t,"square");const s=r.data.get(t.dataId).values,i=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];i[a]=l*l}return{dataId:r.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WAe=Xt(Ry,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),HAe={kernelName:Ry,backendName:"cpu",kernelFunc:WAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GAe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r;Le(s,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:y,end:x,strides:b}=HR(s.shape,i,o,a,l,u,c,h,d);let _;if(m)_=an({inputs:{x:s},backend:t,attrs:{shape:p}});else if(g||v){M(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const E=UR(y,x,b),I=Bh({inputs:{x:s},backend:t,attrs:{begin:y,size:E}});_=an({inputs:{x:I},backend:t,attrs:{shape:p}}),t.disposeIntermediateTensorInfo(I)}else{const E=t.bufferSync(s),I=a9(f,E,b,y);_=t.makeTensorInfo(p,I.dtype,I.values)}return _}const qAe={kernelName:YA,backendName:"cpu",kernelFunc:GAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KAe(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=e,d=t.data.get(c.dataId).values,f=t.data.get(h.dataId).values,[p,m]=l9(d,f,s,i,o,a,l,u);return[t.makeTensorInfo([p.length],"string",p),t.makeTensorInfo(h.shape,"int32",m)]}const XAe={kernelName:a5,backendName:"cpu",kernelFunc:KAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAe(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,c,h]=u9(a,l,s),d=c.length;return[t.makeTensorInfo([d,2],"int32",u),t.makeTensorInfo([d],"string",c),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const QAe={kernelName:l5,backendName:"cpu",kernelFunc:YAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JAe(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=c9(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const ZAe={kernelName:u5,backendName:"cpu",kernelFunc:JAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eRe=Xt(Ty,n=>Math.tan(n)),tRe={kernelName:Ty,backendName:"cpu",kernelFunc:eRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nRe=Xt(Ny,n=>Math.tanh(n)),rRe={kernelName:Ny,backendName:"cpu",kernelFunc:nRe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sRe(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=rd(i,s,r.shape),h=!1,d=t.bufferSync(s),f=t.bufferSync(i),p=t.bufferSync(r),m=nh(d,f,r.shape,c,l,a,o,u,p,h);return t.makeTensorInfo(r.shape,m.dtype,m.values)}const iRe={kernelName:e5,backendName:"cpu",kernelFunc:sRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oRe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;Le(s,"tile");const o=d9(t.bufferSync(s),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const aRe={kernelName:Ay,backendName:"cpu",kernelFunc:oRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lRe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r;Le(s,"topk");const a=t.data.get(s.dataId).values,[l,u]=p9(a,s.shape,s.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const uRe={kernelName:QA,backendName:"cpu",kernelFunc:lRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cRe(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[c,h,d,f]=s.shape,[p,m]=u??[h,d],g=[c,p,m,f],v=Ke(s.shape),y=v[0],x=v[1],b=v[2],_=Ke(g),E=_[0],I=_[1],C=_[2],S=Qr(s.dtype,fe(g));S.fill(l);const T=r.data.get(s.dataId).values,N=r.data.get(i.dataId).values;for(let D=0;D<c;++D){const z=i.shape[0]===1?N:N.subarray(D*8,D*8+8);for(let L=0;L<p;++L)for(let O=0;O<m;++O)for(let F=0;F<f;++F){let P;const U=z[6]*O+z[7]*L+1;if(U===0)continue;const W=(z[0]*O+z[1]*L+z[2])/U,X=(z[3]*O+z[4]*L+z[5])/U,Z=v4(W,d,a),ne=v4(X,h,a);switch(o){case"nearest":P=gRe(T,h,d,y,x,b,D,ne,Z,F,l);break;case"bilinear":P=vRe(T,h,d,y,x,b,D,ne,Z,F,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const he=D*E+L*I+O*C+F;S[he]=P}return r.makeTensorInfo(g,s.dtype,S)}return{dataId:r.write(S,g,s.dtype),shape:s.shape,dtype:s.dtype}}const hRe={kernelName:JA,backendName:"cpu",kernelFunc:cRe};function v4(n,e,t){switch(t){case"reflect":return dRe(n,e);case"wrap":return fRe(n,e);case"nearest":return mRe(n,e);case"constant":default:return pRe(n)}}function dRe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return Eh(0,t,e-1)}function fRe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return Eh(0,t,e-1)}function pRe(n,e){return n}function mRe(n,e){return Eh(0,n,e-1)}function Vm(n,e,t,r,s,i,o,a,l,u,c){const h=o*r+a*s+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[h]:c}function gRe(n,e,t,r,s,i,o,a,l,u,c){const h=Math.round(a),d=Math.round(l);return Vm(n,e,t,r,s,i,o,h,d,u,c)}function vRe(n,e,t,r,s,i,o,a,l,u,c){const h=Math.floor(a),d=Math.floor(l),f=h+1,p=d+1,m=(p-l)*Vm(n,e,t,r,s,i,o,h,d,u,c)+(l-d)*Vm(n,e,t,r,s,i,o,h,p,u,c),g=(p-l)*Vm(n,e,t,r,s,i,o,f,d,u,c)+(l-d)*Vm(n,e,t,r,s,i,o,f,p,u,c);return(f-a)*m+(a-h)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yRe(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Le(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=m9(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const xRe={kernelName:ZA,backendName:"cpu",kernelFunc:yRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bRe(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s.shape.length,a=s.shape[i],l=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==i&&(l[u++]=s.shape[f]);const c=new Array(o).fill(0),h=s.shape.slice();h[i]=1;const d=new Array(a);for(let f=0;f<d.length;f++){c[i]=f;const p=Bh({inputs:{x:s},backend:t,attrs:{begin:c,size:h}});d[f]=an({inputs:{x:p},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(p)}return d}const wRe={kernelName:Z_,backendName:"cpu",kernelFunc:bRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Re(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r;Le(s,"unsortedSegmentSum");const a=s.shape.length,l=i.shape.length,u=[],c=[],h=a-l;let d=i;for(let p=0;p<h;++p){const m=Mw({inputs:{input:d},backend:t,attrs:{dim:p+1}});d=m,c.push(m)}for(let p=0;p<o;++p){const m=hc(p,"int32"),g=t.makeTensorInfo([],"int32",m),v=A8({inputs:{a:g,b:d},backend:t}),y=ic({inputs:{x:v},backend:t,attrs:{dtype:"float32"}}),x=Sk({inputs:{a:y,b:s},backend:t}),b=Ky({inputs:{x},backend:t,attrs:{axis:0,keepDims:!1}});u.push(b),c.push(g),c.push(v),c.push(y),c.push(x),c.push(b)}const f=A9({inputs:u,backend:t,attrs:{axis:0}});return c.forEach(p=>t.disposeIntermediateTensorInfo(p)),f}const kRe={kernelName:ek,backendName:"cpu",kernelFunc:_Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CRe=[ySe,J2e,bSe,_Se,sIe,CSe,SSe,TSe,ASe,DSe,PSe,FSe,LSe,zSe,jSe,GSe,KSe,YSe,JSe,gSe,eEe,nEe,sEe,oIe,oEe,nIe,lIe,lEe,Z2e,cEe,dEe,fEe,mEe,vEe,xEe,wEe,kEe,IEe,EEe,NEe,REe,$Ee,OEe,MEe,LEe,VEe,UEe,WEe,HEe,GEe,qEe,XEe,JEe,uSe,eTe,uIe,lTe,cIe,uTe,dIe,mTe,gTe,yTe,pIe,gIe,bTe,_Te,CTe,STe,yIe,bIe,eIe,TTe,hEe,ATe,DTe,PTe,cSe,_Ie,CIe,FTe,SIe,LTe,zTe,jTe,GTe,KTe,YTe,QTe,TIe,ZTe,tNe,rNe,iNe,aNe,uNe,hNe,AIe,fNe,gNe,xNe,DIe,PIe,_Ne,INe,TNe,FIe,ANe,DNe,$Ne,R9,MNe,dSe,BIe,BNe,zNe,jNe,HNe,tIe,dE,qNe,fSe,pSe,mSe,XNe,QNe,ZNe,tAe,rAe,sAe,oAe,qIe,lAe,fAe,mAe,xAe,XIe,wAe,kAe,IAe,YIe,vNe,TAe,AAe,DAe,PAe,FAe,LAe,VAe,UAe,ZIe,jAe,tSe,rSe,HAe,qAe,XAe,QAe,ZAe,aSe,YEe,tRe,rRe,iRe,aRe,uRe,hRe,MIe,xRe,wRe,kRe,RNe];for(const n of CRe)h5(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gc={},v0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function IRe(n,e){Gc[n]=e}function Vo(n,e){if(!(n in Gc)||e!=null){const r=ERe(n,e);if(r!==null)Gc[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=Gc[n];return t==null||t.isContextLost()?(delete Gc[n],Vo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Gc[n])}function SRe(n){if(!oe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function ERe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??SRe(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Gc[n]},!1),oe().getBool("SOFTWARE_WEBGL_ENABLED")&&(v0.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",v0)||t.getContext("experimental-webgl",v0):t.getContext("webgl2",v0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rv;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(rv||(rv={}));var vi;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(vi||(vi={}));var Dr;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Dr||(Dr={}));function Xy(n,e){return[e,n]}function TRe(n,e){return n*e}function y0(n){const e=fe(n),t=Math.ceil(e/4);return PS(t)}function Ap(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function NRe(n,e){const[t,r]=Ap(n,e);return t*r*4}function UD(n,e){const t=n;let r,s,i,o,a,l,u,c,h,d;return oe().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,c=1,h=t.HALF_FLOAT,d=t.FLOAT,l=t.RGBA8):(r=n.RGBA,s=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(n,e){const t=e();return oe().getBool("DEBUG")&&ARe(n),t}function ARe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+PRe(n,e))}const RRe=596e-10,DRe=65504;function $Re(n){return!!(oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||RRe<Math.abs(n)&&Math.abs(n)<DRe)}function PRe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function x0(n,e){return Bl(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function ORe(n,e){const t=Bl(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Re(n,()=>n.shaderSource(t,e)),Re(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function FRe(n,e){const t=Bl(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Re(n,()=>n.shaderSource(t,e)),Re(n,()=>n.compileShader(t)),oe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw D9(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const MRe=/ERROR: [0-9]+:([0-9]+):/g;function D9(n,e){const t=MRe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),i=s.length.toString().length+2,o=s.map((h,d)=>cf((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,r-1),u=o.slice(r-1,r),c=o.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${cf(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function LRe(n){return Bl(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function BRe(n,e){if(Re(n,()=>n.linkProgram(e)),!oe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function w2(n,e){if(Re(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function VRe(n,e){const t=Bl(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Re(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function zRe(n,e){const t=Bl(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Re(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Re(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function URe(n){return Bl(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function jRe(n,e){const t=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function WRe(n){return Bl(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function y4(n,e,t,r,s,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),Re(n,()=>n.vertexAttribPointer(a,s,n.FLOAT,!1,i,o)),Re(n,()=>n.enableVertexAttribArray(a)),!0)}function HRe(n,e,t){YRe(n,t),Re(n,()=>n.activeTexture(n.TEXTURE0+t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function GRe(n,e,t){return Bl(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function qRe(n,e,t){return n.getUniformLocation(e,t)}function KRe(n,e,t,r){Re(n,()=>HRe(n,e,r)),Re(n,()=>n.uniform1i(t,r))}function _2(n,e,t){Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function x4(n,e){Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function b0(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+XRe(n,e))}function XRe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Bl(n,e,t){const r=Re(n,()=>e());if(r==null)throw new Error(t);return r}function YRe(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function ep(n,e=2){return fe(n.slice(0,n.length-e))}function tp(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function w0(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[ep(n),...tp(n)]),e}function QRe(n,e=!1){let t=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=oe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&oe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?uA(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=cc(n).newShape);let s=fe(n),i=null;n.length<=1&&s<=t?i=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=ep(n);let l=2,u=2;n.length&&([l,u]=tp(n)),s=a*(l/2)*(u/2),i=PS(s).map(c=>c*2)}else i=PS(s);return i}function _0(n){return n%2===0}function Bw(n,e){if(n=n.slice(-2),e=e.slice(-2),Ut(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||_0(t)&&_0(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&_0(n[0])&&_0(e[0])}let k2,C2;function JRe(n){if(k2==null){const e=Vo(n);k2=e.getParameter(e.MAX_TEXTURE_SIZE)}return k2}function ZRe(n){if(C2==null){const e=Vo(n);C2=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,C2)}function eDe(n){if(n===0)return 0;let e;const t=Vo(n);return eo(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:eo(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function eo(n,e){return n.getExtension(e)!=null}function b4(n){try{if(Vo(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function tDe(n){if(n===0)return!1;const e=Vo(n);if(n===1){if(!eo(e,"OES_texture_float"))return!1}else if(!eo(e,"EXT_color_buffer_float"))return!1;return pE(e)}function nDe(n){if(n===0)return!1;const e=Vo(n);if(n===1){if(!eo(e,"OES_texture_float")||!eo(e,"WEBGL_color_buffer_float"))return!1}else{if(eo(e,"EXT_color_buffer_float"))return pE(e);const r="EXT_color_buffer_half_float";if(eo(e,r)){const s=e.getExtension(r);return rDe(e,s)}return!1}return pE(e)}function pE(n){const e=UD(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function rDe(n,e){const t=UD(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),a}function sDe(n){return n!==2?!1:Vo(n).fenceSync!=null}function Yy(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&M(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ze=oe();ze.registerFlag("HAS_WEBGL",()=>ze.getNumber("WEBGL_VERSION")>0);ze.registerFlag("WEBGL_VERSION",()=>b4(2)?2:b4(1)?1:0);ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ze.get("WEBGL_VERSION")===2);ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ze.registerFlag("WEBGL_PACK",()=>ze.getBool("HAS_WEBGL"));ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CLIP",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_REDUCE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_CONV_IM2COL",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>JRe(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>ZRe(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=ze.getNumber("WEBGL_VERSION");return n===0?0:eDe(n)});ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!T5());ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>tDe(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>nDe(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>sDe(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>T5()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ze.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ze.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ze.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ze.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ze.registerFlag("WEBGL_EXP_CONV",()=>!1);ze.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ze.getBool("IS_TEST"));ze.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ze.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ze.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ze.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(){let n,e,t,r,s,i,o,a,l,u;return oe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",i="outputColor",o="out vec4 outputColor;",a=oe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function od(n,e,t="index"){const r=Ke(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / ${s}`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${s}`:`index -= ${n[i]} * ${s}`;return`${o}; ${a};`}).join("")}function Ek(n,e,t="index"){const r=Ke(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function iDe(n,e){const t=n.length,r=n.map(i=>`${e}[${i}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let i=t-3;i>=0;--i)s[i]=`(${s[i+1]} * ${r[i+1]})`;return s}function oDe(n,e,t="index"){const r=n.map((i,o)=>o),s=iDe(r,e);return s.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${s[o]}`,l=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${s[o]}`:`index -= ${n[o]} * ${s[o]}`;return`${a}; ${l};`}).join("")}function jD(n){const e=Ke(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function WD(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const $9=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:P9}=Y1e;function aDe(n,e,t){const r=[];if(n.forEach(f=>{const p=fe(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?r.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${f.name};`),r.push(`uniform int offset${f.name};`)),t.enableShapeUniforms){const{uniformShape:m}=HD(t.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${f.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${f.name}Shape;`);break}r.push(`uniform ivec2 ${f.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(f=>{r.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const s=r.join(`
`),i=n.map(f=>lDe(f,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=Ts(),l=hDe(a);let u,c,h=pDe(a);return e.isPacked?(u=uDe(e.logicalShape,o,t.enableShapeUniforms),c=fDe(a)):(u=cDe(e.logicalShape,o,t.enableShapeUniforms),c=dDe(a)),t.packedInputs&&(h+=yDe),[h,l,c,s,u,i,t.userCode].join(`
`)}function Rp(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return ADe(n,e);case 1:return DDe(n,e);case 2:return PDe(n,e);case 3:return FDe(n,e);case 4:return LDe(n,e);case 5:return BDe(n);case 6:return VDe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function O9(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return NDe(n);case 1:return RDe(n,e);case 2:return $De(n,e);case 3:return ODe(n,e);default:return MDe(n,e)}}function lDe(n,e,t=!1,r){let s="";t?s+=O9(n,r):s+=Rp(n,r);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?s+=zDe(n,e):s+=UDe(n,e)),s}function uDe(n,e,t){switch(n.length){case 0:return F9();case 1:return xDe(n,e,t);case 2:return EDe(n,e,t);case 3:return wDe(n,e,t);default:return kDe(n,e,t)}}function cDe(n,e,t){switch(n.length){case 0:return F9();case 1:return bDe(n,e,t);case 2:return TDe(n,e,t);case 3:return _De(n,e,t);case 4:return CDe(n,e,t);case 5:return IDe(n,e);case 6:return SDe(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function hDe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function dDe(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function fDe(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function pDe(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${mDe}
    ${gDe}
    ${vDe}
  `}const mDe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gDe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,vDe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yDe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function F9(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function xDe(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function bDe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function wDe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),i=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function _De(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ek(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=od(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function kDe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),i=s*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${l});
    }
  `}function CDe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ek(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=od(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function IDe(n,e){const t=od(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function SDe(n,e){const t=od(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function EDe(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ut(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function TDe(n,e,t){return Ut(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function ad(n){return`offset${n}`}function NDe(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Ts();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function ADe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,i]=n.shapeInfo.texShape;if(s===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=ad(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function RDe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,i=Ts();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function DDe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Dp(n)}
      }
    `;const s=n.shapeInfo.texShape,i=s[0],o=s[1];if(o===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=ad(t);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function $De(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=Ts();if(i!=null&&Ut(t,i))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function PDe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Ut(t,i)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const d=i[0],f=i[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=cc(t),l=o;if(l.length<t.length){const d=$p(n,l),f=["row","col"];return`
      ${Rp(d,e)}
      float ${s}(int row, int col) {
        return ${s}(${Pp(f,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Dp(n)}
      }
    `;const u=i[0],c=i[1],h=ad(r);return c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${r}, uv);
    }
  `:u===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function ODe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const d=t.slice(1),f=[1,2],p=$p(n,d),m=["b","row","col"];return`
        ${O9(p,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${Pp(m,f)});
        }
      `}const a=Ts();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=o[0],u=o[1],c=Math.ceil(t[2]/2),h=c*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function FDe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=cc(t),u=a;if(u.length<t.length){const m=$p(n,u),g=["row","col","depth"];return`
        ${Rp(m,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${Pp(g,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Dp(n)}
      }
    `;const c=n.shapeInfo.texShape,h=c[0],d=c[1],f=n.shapeInfo.flatOffset;if(d===i&&f==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(d===o&&f==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=ad(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${r}, uv);
      }
  `}function MDe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Ts();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)f=`int b${m}, `+f,d*=i[o-m-1],p=`b${m} * ${d} + `+p;return`
    vec4 ${r}(${f}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${s.texture2D}(${t}, uv);
    }
  `}function LDe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=cc(t);if(l.length<t.length){const y=$p(n,l),x=["row","col","depth","depth2"];return`
      ${Rp(y,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${Pp(x,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Dp(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],f=h[1],p=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(f===a&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(f===i&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;const v=ad(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${v});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${f}, index + ${v});
      return sampleTexture(${r}, uv);
    }
  `}function BDe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],i=e[3]*s,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=cc(e);if(l.length<e.length){const m=$p(n,l),g=["row","col","depth","depth2","depth3"];return`
      ${Rp(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Pp(g,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${s})) +
          depth3;
        ${Dp(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],f=h[1];if(f===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(f===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;const p=ad(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${s} + depth3 + ${p};
      vec2 uv = uvFromFlat(${d}, ${f}, index);
      return sampleTexture(${t}, uv);
    }
  `}function VDe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:i}=cc(e);if(s.length<e.length){const g=$p(n,s),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${Rp(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Pp(v,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Dp(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],p=d[1];if(p===c&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=ad(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Dp(n){const e=n.name,t=fe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function zDe(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=P9(n.shapeInfo.logicalShape,e.logicalShape),l=tn(o),u=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(y=>`coords.${h[y+u]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=n.shapeInfo.logicalShape.map((y,x)=>`coords.${h[x+u]}`).join(", ");let f="return outputValue;";const m=fe(n.shapeInfo.logicalShape)===1,v=fe(e.logicalShape)===1;if(i===1&&!m&&!v)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!v)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=i-2,x=i-1;a.indexOf(y)>-1&&a.indexOf(x)>-1?f="return vec4(outputValue.x);":a.indexOf(y)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(x)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${d});
      ${f}
    }
  `}function UDe(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&Ut(o,i))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=tn(l),c=P9(n.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const f=["x","y","z","w","u","v"];a===0?d="":l<2&&c.length>=1?d="coords = 0;":d=c.map(m=>`coords.${f[m+h]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=n.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+h]}`).join(", "),`
    float ${s}() {
      ${u} coords = getOutputCoords();
      ${d}
      return get${r}(${p});
    }
  `}function tn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function HD(n,e,t){const{newShape:r,keptDims:s}=cc(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):r,l=!n&&i>1&&!Ut(e,t)&&r.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function $p(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Pp(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jDe(n,e,t,r){const s=t.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),i=s.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=aDe(s,o,e),l=FRe(n.gl,a),u=n.createProgram(l);return oe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},M9(n,e,u)))}function M9(n,e,t){const r=[],s=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),oe().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const d={name:h,uniform:n.getUniformLocation(t,h,c),offset:n.getUniformLocation(t,`offset${h}`,c)};e.enableShapeUniforms&&(d.shape=n.getUniformLocation(t,`${h}Shape`,c),d.texShape=n.getUniformLocation(t,`${h}TexShape`,c)),r.push(d)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",c),a=n.getUniformLocation(t,"outShapeStrides",c),o=n.getUniformLocation(t,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)s.push(n.getUniformLocation(t,h.name,c));return{variablesLocations:r,customUniformLocations:s,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function w4(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,i=e[r],o=i.shape;if(!Ut(s,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!Ut(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function WDe(n,e,t,r,s){e.program.enableShapeUniforms||(w4(e.inShapeInfos,t),w4([e.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),oe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:c,offset:h,shape:d,texShape:f}=e.variablesLocations[l];if(d){const{uniformShape:p}=HD(e.program.packedInputs,u.shape,u.texData.texShape);switch(p.length){case 1:n.gl.uniform1iv(d,new Int32Array(p));break;case 2:n.gl.uniform2iv(d,new Int32Array(p));break;case 3:n.gl.uniform3iv(d,new Int32Array(p));break;case 4:n.gl.uniform4iv(d,new Int32Array(p));break}}if(f&&n.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(fe(u.shape)<2)n.gl.uniform1f(c,u.uniformValues[0]);else{let p=u.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),n.gl.uniform1fv(c,p)}continue}u.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=Ke(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],h=s[l];if(u.type==="float")n.gl.uniform1fv(c,h);else if(u.type==="vec2")n.gl.uniform2fv(c,h);else if(u.type==="vec3")n.gl.uniform3fv(c,h);else if(u.type==="vec4")n.gl.uniform4fv(c,h);else if(u.type==="int")n.gl.uniform1iv(c,h);else if(u.type==="ivec2")n.gl.uniform2iv(c,h);else if(u.type==="ivec3")n.gl.uniform3iv(c,h);else if(u.type==="ivec4")n.gl.uniform4iv(c,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function HDe(n,e,t){let r="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:h}=HD(n.packedInputs,o.shape,l);let d="",f="",p="";if(c.length===1&&n.packedInputs){const _=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${_[0]>1}_${_[1]>1}`}else if(c.length===2&&!n.packedInputs)f=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!n.packedInputs){const _=Ke(c);p=`${_[0]===l[1]}_${_[_.length-1]===l[1]}`}const m=o.shape.length,g=c.length===2&&Ut(o.shape,l),v=fe(o.shape)===1,y=Kf(o.shape,t.shape),x=!n.packedInputs&&m===t.shape.length&&Ut(l,t.texData.texShape),b=n.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${m}_${x}_${u?h:""}_${c.length}_${v}_${y}_${g}_${d}_${f}_${p}_${b}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${l}_${a}`}});const s=n.userCode;let i=n.constructor.name;return i+="_"+r+"_"+s+`${oe().getNumber("WEBGL_VERSION")}`,i}function ns(n){return oe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GDe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Ts();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ek(["r","c","d"],e):od(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qDe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Ts();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ek(["r","c","d"],e):od(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KDe{constructor(e){this.variableNames=["A"],this.outTexUsage=vi.DOWNLOAD;const t=Ts();this.outputShape=e,this.userCode=`
      ${$9}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XDe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=vi.DOWNLOAD;const t=Ts();this.outputShape=e,this.userCode=`
      ${$9}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YDe={R:0,G:1,B:2,A:3};class _4{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ts();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const l=r[a];o+=`
          if(offset == ${a}) {
            result = values[${YDe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?WD():jD(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${o}
        }
        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QDe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Ts();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let s="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?WD():jD(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDe(n){const e=Ts(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return ORe(n,t)}function ZDe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return VRe(n,e)}function e$e(n){const e=new Uint16Array([0,1,2,2,1,3]);return zRe(n,e)}function Qy(n,e,t,r,s,i){jRe(e,t);const o=URe(n),a=n.TEXTURE_2D;return Re(n,()=>n.bindTexture(a,o)),Re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Re(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Re(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),oe().getNumber("WEBGL_VERSION")===1?Re(n,()=>n.texImage2D(a,0,r,e,t,0,s,i,null)):Re(n,()=>n.texStorage2D(a,1,r,e,t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function L9(n){return n.internalFormatFloat}function t$e(n,e,t,r){const[s,i]=Xy(e,t);return Qy(n,s,i,L9(r),r.textureFormatFloat,n.FLOAT)}function B9(n){return n.internalFormatHalfFloat}function n$e(n,e,t,r){const[s,i]=Xy(e,t);return Qy(n,s,i,B9(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function V9(n){return n.downloadTextureFormat}function r$e(n,e,t,r){const[s,i]=Xy(e,t);return Qy(n,s,i,V9(r),n.RGBA,n.UNSIGNED_BYTE)}function z9(n){return n.internalFormatPackedFloat}function s$e(n,e,t,r){const[s,i]=Ap(e,t);return Qy(n,s,i,z9(r),n.RGBA,n.FLOAT)}function U9(n){return n.internalFormatPackedHalfFloat}function i$e(n,e,t,r){const[s,i]=Ap(e,t);return Qy(n,s,i,U9(r),n.RGBA,r.textureTypeHalfFloat)}function o$e(n,e,t){return Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),y4(n,e,"clipSpacePos",t,3,20,0)&&y4(n,e,"uv",t,2,20,12)}function a$e(n,e,t,r,s,i){Re(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;s instanceof Uint8Array?(o=new Uint8Array(t*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*r*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(s),oe().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,a,o)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,r,0,n.RGBA,a,o)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function l$e(n,e,t){Re(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?oe().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):oe().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function u$e(n,e,t,r){const s=n.createBuffer();Re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const a=4*4*e*t;return Re(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Re(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function c$e(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function h$e(n,e,t,r){const[s,i]=Xy(e,t),o=4,a=new Uint8Array(TRe(e*t,o));return Re(n,()=>n.readPixels(0,0,s,i,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function d$e(n,e,t,r,s,i,o,a){const l=n,u=new Float32Array(NRe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function f$e(n,e,t){const r=new Float32Array(e*t*4);return Re(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I2{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=oe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,IRe(t,e)):this.gl=Vo(t),e=this.gl,oe().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Re(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Re(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Re(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Re(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Re(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Re(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Re(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Re(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),oe().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=x0(this.gl,i),eo(this.gl,o))this.textureHalfFloatExtension=x0(this.gl,o);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),eo(this.gl,s))this.colorBufferHalfFloatExtension=x0(this.gl,s);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",eo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(eo(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ZDe(this.gl),this.indexBuffer=e$e(this.gl),this.framebuffer=WRe(this.gl),this.textureConfig=UD(this.gl,this.textureHalfFloatExtension)}get debug(){return oe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Re(e,()=>e.finish()),Re(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Re(e,()=>e.deleteFramebuffer(this.framebuffer)),Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Re(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Re(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),t$e(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),n$e(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),r$e(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),l$e(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),a$e(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),i$e(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),s$e(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(x4(this.gl,this.framebuffer),this.outputTexture=null),Re(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>h$e(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,i,o){return d$e(this.gl,e,t,r,s,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return c$e(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=u$e(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(oe().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=s.clientWaitSync(i,0,0);return o===s.ALREADY_SIGNALED||o===s.CONDITION_SATISFIED},t=i}else oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>f$e(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=JDe(t));const r=LRe(t);Re(t,()=>t.attachShader(r,this.vertexShader)),Re(t,()=>t.attachShader(r,e)),BRe(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&w2(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Re(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),o$e(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Re(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&w2(this.gl,this.program),Re(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?GRe(this.gl,e,t):qRe(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Re(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),KRe(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,i]=Ap(t,r);this.setOutputMatrixTextureDriver(e,s,i)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&w2(this.gl,this.program),b0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Re(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=x0(this.gl,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await u3(()=>this.disposed||this.isQueryAvailable(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=p$e(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in oe().platform&&(r=oe().platform.setTimeoutCustom.bind(oe().platform)),u3(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),_2(this.gl,e,this.framebuffer),this.debug&&b0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(_2(this.gl,this.outputTexture,this.framebuffer),this.debug&&b0(this.gl)):x4(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;_2(s,e,this.framebuffer),this.debug&&b0(s),this.outputTexture=e,Re(s,()=>s.viewport(0,0,t,r)),Re(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Re(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function p$e(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:m$e,bincountImpl:j9,bincountReduceImpl:g$e,bitwiseAndImpl:v$e,castImpl:y$e,ceilImpl:x$e,concatImpl:b$e,equalImpl:w$e,expImpl:_$e,expm1Impl:k$e,floorImpl:C$e,gatherNdImpl:I$e,gatherV2Impl:S$e,greaterImpl:E$e,greaterEqualImpl:T$e,lessImpl:N$e,lessEqualImpl:A$e,linSpaceImpl:R$e,logImpl:D$e,maxImpl:$$e,maximumImpl:P$e,minimumImpl:O$e,multiplyImpl:F$e,negImpl:M$e,notEqualImpl:L$e,prodImpl:B$e,raggedGatherImpl:V$e,raggedRangeImpl:z$e,raggedTensorToTensorImpl:U$e,rangeImpl:j$e,rsqrtImpl:W$e,scatterImpl:H$e,sigmoidImpl:G$e,simpleAbsImpl:W9,sliceImpl:q$e,sparseFillEmptyRowsImpl:K$e,sparseReshapeImpl:X$e,sparseSegmentReductionImpl:H9,sqrtImpl:Y$e,staticRegexReplaceImpl:Q$e,stridedSliceImpl:J$e,stringNGramsImpl:Z$e,stringSplitImpl:ePe,stringToHashBucketFastImpl:tPe,subImpl:nPe,tileImpl:rPe,topKImpl:sPe,transposeImpl:GD,uniqueImpl:iPe}=lSe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function ys(n,e){return e===1?[n]:G9(n,e)}function oPe(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aPe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ns(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=ys("rc",this.rank),r=tn(this.rank),s=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let i=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q9{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let r="";for(let s=0;s<4;s++){let i="thisRC = rc;";s%2===1&&(i+="thisRC.z += 1;"),s>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${lPe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?WD():jD(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function lPe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?oDe(["r","c","d"],"inputShape"):od(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uPe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=C4(t,r),i=I4(e,s,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=k4(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return s===Dr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Dr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Dr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Dr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Dr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const i=C4(r,s),o=I4(t,i,s);o in this.freeTextures||(this.freeTextures[o]=[]);const a=k4(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=oe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function cPe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function k4(n,e,t,r,s){const i=hPe(e,r);let o;if(s){const[l,u]=Ap(n[0],n[1]);o=l*u}else{const[l,u]=Xy(n[0],n[1]);o=l*u}const a=cPe(t,i);return o*a}function hPe(n,e){switch(n){case Dr.PACKED_2X2_FLOAT32:return z9(e);case Dr.PACKED_2X2_FLOAT16:return U9(e);case Dr.UNPACKED_FLOAT32:return L9(e);case Dr.UNPACKED_FLOAT16:return B9(e);case Dr.PACKED_4X1_UNSIGNED_BYTE:return V9(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function dPe(n){return oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Dr.PACKED_2X2_FLOAT32:Dr.UNPACKED_FLOAT32:n?Dr.PACKED_2X2_FLOAT16:Dr.UNPACKED_FLOAT16}function C4(n,e){if(n===vi.UPLOAD)return Dr.PACKED_2X2_FLOAT32;if(n===vi.RENDER||n==null)return dPe(e);if(n===vi.DOWNLOAD||n===vi.PIXELS)return Dr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function I4(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ca{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ho="if (isnan(x)) return x;",fPe="return x;",S4="return abs(x);",pPe="return (x >= 0.0) ? x : (exp(x) - 1.0);",mPe=ho+`
  return (x < 0.0) ? 0.0 : x;
`,gPe=ho+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,iu="return x;",vPe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yPe="return x;",xPe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,bPe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wPe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_Pe="return 1.0 / (1.0 + exp(-1.0 * x));";class xu{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kPe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);const t=e.length,r=ys("rc",t),s=tn(t),i=oPe(t,r),o=r.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CPe=vH,IPe=1e-7,SPe=1e-4,k0={};function EPe(n){return n in k0||(k0[n]={}),k0[n]}const TPe=oe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),NPe=600;function APe(){return oe().global.screen==null?1024:oe().global.screen.height*oe().global.screen.width*window.devicePixelRatio*NPe/1024/1024}class Tk extends lA{nextDataId(){return Tk.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!oe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof I2)t=e;else{const r=Vo(oe().getNumber("WEBGL_VERSION"),e);t=new I2(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Vo(oe().getNumber("WEBGL_VERSION"));t=new I2(r),this.binaryCache=EPe(oe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new uPe(this.gpgpu),this.numMBBeforeWarning=APe(),this.texData=new F6(this,Jo())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,i,o){const a=this.makeTensorInfo(t,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,i]},l.texShape=[s,i];const u=w0(t),c=new _4(u,!1,o),h=this.runWebGLProgram(c,[a],r,[[s,i]]);return h.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,r){if((oe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||oe().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:vi.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,i){if(oe().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:vi.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let d;l?d=new xu(a,iu):d=new ca(a,iu);const f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:s}],s),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const u=this.activeTimers!=null;let c;u&&(c=Rs());let h;if(s==="complex64"){const d=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);h=Il(d,f)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Rs()-c),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const t=this.texData.get(e),{values:r,shape:s,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let p;l?p=new xu(s,iu):p=new ca(s,iu);const m=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:o}],o),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(r!=null)return this.convertAndCacheOnCPU(e);if(oe().getBool("DEBUG")&&!oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&oe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(o!=="complex64"&&oe().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const p=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(p.texture.texture,...y0(s))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];h=Il(m,g)}else if(u==null)h=this.getValuesFromTexture(e);else{const p=fe(s);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const p=this.gpgpu.gl;Re(p,()=>p.deleteBuffer(u))}const d=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Jo().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;l?f=new xu(i,iu):f=new ca(i,iu);const p=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:a}],a),m=this.readToGPU(p,t);return this.disposeIntermediateTensorInfo(p),m}if(u==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),h=Jo().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ec(s));return gt(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return gt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!$Re(r))throw oe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),i=fe(t);if(oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),f=this.texData.get(d.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...y0(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),p}const o=oe().getBool("WEBGL_PACK")&&s===!0,a=o?w0(t):t,l=o?new XDe(a):new KDe(a),u=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const i=Th(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Th(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=gve(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:o[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Rs(),endMs:null}}endTimer(e){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Rs(),e)}async getQueryTime(e){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,i,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=TPe){return oe().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&fe(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){mi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return CPe(e.shape,t)}packedUnaryOp(e,t,r){const s=new xu(e.shape,t),i=this.compileAndRun(s,[e],r);return Jo().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=W9(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(oe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,S4,e.dtype);const t=new ca(e.shape,S4),r=this.compileAndRun(t,[e]);return Jo().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Fv(r[0])){const i=r.map(o=>Bu(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new kPe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new aPe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[ep(e.shape),...tp(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},i=[ep(t),...tp(t)],o=new q9(i,r),a=!0,l=[r],u=this.runWebGLProgram(o,[s],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:i,dtype:o}=r;if(t!=null){const d=fe(i),f=t[0]*t[1]*4;M(d<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=w0(i);let l;s?l=new qDe(a):l=new GDe(a);const u=!0,c=[t??y0(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,c,u,t);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,t,r,s,i=!1,o){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===rv.DENSE){const v=o??y0(e.outputShape);l.texShape=v.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),fe(a.shape)===0)return l.values=Qr(a.dtype,0),a;const u=[],c=t.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(v.dataId);if(y.texture==null){if(!e.packedInputs&&fe(v.shape)<=oe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!y.isPacked!=!!e.packedInputs)v=y.isPacked?this.unpackTensor(v):this.packTensor(v),u.push(v),y=this.texData.get(v.dataId);else if(y.isPacked&&!Bw(y.shape,v.shape)){const x=v,b=v.shape;v.shape=y.shape,v=this.packedReshape(v,b),u.push(v),y=this.texData.get(v.dataId),x.shape=b}return{shape:v.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=HDe(e,c,h),f=this.getAndSaveBinary(d,()=>jDe(this.gpgpu,e,c,h)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),oe().get("ENGINE_COMPILE_ONLY")||WDe(this.gpgpu,f,c,h,s),u.forEach(v=>this.disposeIntermediateTensorInfo(v)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=oe().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const v=Rs();v-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!oe().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const v=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),v}return a}compileAndRun(e,t,r,s,i=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(oe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=se(()=>{if(!oe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=oe().getBool("DEBUG");oe().set("DEBUG",!1);const t=this.abs(Vt(1e-8)).dataSync()[0];if(oe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?IPe:SPe}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let c;u&&(c=Rs());let h=t.texShape;if(h==null&&(h=QRe(r,l),t.texShape=h),i!=null){const d=w0(r);let f,p=h[1],m=h[0];const g=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!g)&&([p,m]=Ap(h[0],h[1])),l?f=new QDe(d,g):f=new _4(d,g);const v=g?[m,p]:h,y=this.makeTensorInfo(v,s),x=this.texData.get(y.dataId);g?x.usage=vi.PIXELS:x.usage=vi.UPLOAD,x.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,m,i);const b=[[m,p]],E=this.runWebGLProgram(f,[y],s,b,!0),I=this.texData.get(E.dataId);t.texShape=I.texShape,t.isPacked=I.isPacked,t.usage=I.usage,oe().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(t.texture=I.texture,t.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(y),u&&(this.uploadWaitMs+=Rs()-c)}else{const d=this.acquireTexture(h,a,s,l);t.texture=d}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=RPe(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*pw(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(i){throw i}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await PH(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(D9(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=M9(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:i,width:o,channels:a}=e,l=Jo().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(s,t,r,i,o,a);return Jo().makeTensorFromDataId(u,t,r,l)}}Tk.nextDataId=0;function RPe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */N5()&&$5("webgl",()=>new Tk,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Vh{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=ct(t,r),this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ld=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Op{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ct(t,r);const i=this.outputShape.length;this.enableShapeUniforms=ns(i);let o="";if(s)if(i===0||fe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${tn(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ys("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ii(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const DPe={kernelName:ry,backendName:"webgl",kernelFunc:ii};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),a=ii({inputs:{x:r},backend:t}),l=ii({inputs:{x:s},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const $Pe={kernelName:wA,backendName:"webgl",kernelFunc:xc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9="return (a < 0.) ? b * a : a;",X9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function PPe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r,o=t.makeTensorInfo([],"float32",hc(i,"float32")),a=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Op(X9,s.shape,o.shape):new Vh(K9,s.shape,o.shape),l=t.runWebGLProgram(a,[s,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const OPe={kernelName:__,backendName:"webgl",kernelFunc:PPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9="return (a < 0.) ? b * a : a;",Q9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function FPe(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Op(Q9,r.shape,s.shape):new Vh(Y9,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],"float32")}const MPe={kernelName:z_,backendName:"webgl",kernelFunc:FPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fp="if (isnan(x)) return x;";function Rt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:i})=>{const{x:o}=s,a=i,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const h=a.texData.get(o.dataId),d=t(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const u=oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new xu(o.shape,e):c=new ca(o.shape,n),a.runWebGLProgram(c,[o],l)}}function Vr({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,c=a;if(r&&l.dtype==="complex64"){const p=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[g,v]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(x=>{const[b,_]=x,E={dataId:b.dataId,dtype:b.dtype,shape:l.shape},I={dataId:_.dataId,dtype:_.dtype,shape:u.shape},C=new Vh(n,l.shape,u.shape);return c.runWebGLProgram(C,[E,I],ri(b.dtype,_.dtype))}),y=xc({inputs:{real:g,imag:v},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(v),y}const h=i||ri(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&s!=null){const p=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,g=l.dtype==="string"?Sl(p):p,v=l.dtype==="string"?Sl(m):m,[y,x]=s(l.shape,u.shape,g,v,h),b=c.makeTensorInfo(x,h),_=c.texData.get(b.dataId);return _.values=y,b}const d=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return d?f=new Op(e,l.shape,u.shape,t):f=new Vh(n,l.shape,u.shape),c.runWebGLProgram(f,[l,u],h)}}function sv(n,e=!1){if(n==="linear")return e?yPe:fPe;if(n==="relu")return e?bPe:mPe;if(n==="elu")return e?xPe:pPe;if(n==="relu6")return e?wPe:gPe;if(n==="prelu")return e?Q9:Y9;if(n==="leakyrelu")return e?X9:K9;if(n==="sigmoid")return e?_Pe:vPe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J9{constructor(e,t,r,s=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=ns(this.outputShape.length);const c=s?e[1]:e[2],h=Math.ceil(c/2),d=s?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",v="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let x="rc.x",b="rc.x";e[0]<t[0]?x=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(b=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${x};
        int batchB = ${b};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E4={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class T4{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ct(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4="return a * b;";function KD(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=ri(r.dtype,s.dtype);if(r.dtype==="complex64"){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),u=new T4(E4.REAL,r.shape,s.shape),c=new T4(E4.IMAG,r.shape,s.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],d=t.runWebGLProgram(u,h,"float32"),f=t.runWebGLProgram(c,h,"float32"),p=xc({inputs:{real:d,imag:f},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(t.shouldExecuteOnCPU([r,s])){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),[u,c]=F$e(r.shape,s.shape,a.values,l.values,i),h=t.makeTensorInfo(c,i),d=t.texData.get(h.dataId);return d.values=u,h}let o;return oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Op(N4,r.shape,s.shape):o=new Vh(N4,r.shape,s.shape),t.runWebGLProgram(o,[r,s],i)}const LPe={kernelName:dy,backendName:"webgl",kernelFunc:KD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BPe(n,e,t){const r=[ep(n.shape),...tp(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},i=[ep(e),...tp(e)],o=new q9(i,r),a=!0,l=[r],u=t.runWebGLProgram(o,[s],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=t,a=fe(s.shape),l=L6(i,a),u=fe(l);M(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(s.dataId);return c.isPacked&&!Bw(s.shape,l)&&!(c.texture!==null&&Bw(c.shape,l))?BPe(s,l,o):(o.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const VPe={kernelName:j_,backendName:"webgl",kernelFunc:Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A4{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];const a=Math.floor(r/4)*4,l=r%4;let u="sumValue += dot(values, ones);";if(t!=null){const h=1/t;u=`sumValue += dot(values * ${Wf(h)?h.toPrecision(2):h}, ones);`}let c="";i%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zPe{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const c=Math.floor(r/4)*4,h=r%4;let d=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";t==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UPe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=dk(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function ud(n,e,t,r){const s=UPe(n.shape);let i=n;for(let o=0;o<s.length;o++){const{inSize:a,windowSize:l,outSize:u}=s[o];let c,h;t==="mean"?c=o===0?new A4({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new A4({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):c=new zPe({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),h=i,i=r.runWebGLProgram(c,[i],e),h.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jPe{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[t[o]];this.outputShape=r,this.rank=r.length;const s=tn(this.rank),i=WPe(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function WPe(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HPe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let c=0;c<r.length;c++)r[c]=e[t[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=tn(this.rank),i=G9("rc",this.rank),o=new Array(this.rank);for(let c=0;c<t.length;c++)o[t[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nk(n,e,t){const r=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HPe(n.shape,e):new jPe(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GPe(n,e,t,r){const s=e,i=n.shape.length,o=vt(s,n.shape);let a=o;const l=Tn(a,i),u=l!=null;let c=n;u&&(c=Nk(n,l,r),a=Gn(a.length,i)),Br("sum",a,i);const[h,d]=Sr(c.shape,a);let f=h;t&&(f=rr(h,o));const p=fe(d),g=fe(n.shape)/p,v=Te({inputs:{x:c},attrs:{shape:[g,p]},backend:r}),y=nR(n.dtype),x=ud(v,y,"sum",r),b=Te({inputs:{x},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(x),u&&r.disposeIntermediateTensorInfo(c),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ak(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;return GPe(s,i,o,t)}const qPe={kernelName:X_,backendName:"webgl",kernelFunc:Ak};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ss(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:i}=r,o=t,a=s.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=s.shape[i[c]];let u;if(o.shouldExecuteOnCPU([s])){const h=o.texData.get(s.dataId).values,d=GD(h,s.shape,s.dtype,i,l);u=o.makeTensorInfo(l,s.dtype);const f=o.texData.get(u.dataId);f.values=d}else u=Nk(s,i,o);return u}const KPe={kernelName:hf,backendName:"webgl",kernelFunc:Ss};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z9=1e3;function Vw({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,c=e.shape.length,h=t?n.shape[u-2]:n.shape[u-1],d=r?e.shape[c-1]:e.shape[c-2],f=t?n.shape[u-1]:n.shape[u-2],p=r?e.shape[c-2]:e.shape[c-1],m=n.shape.slice(0,-2),g=e.shape.slice(0,-2),v=fe(m),y=fe(g),b=ct(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);M(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const _=t?[v,h,f]:[v,f,h],E=r?[y,p,d]:[y,d,p],I=Te({inputs:{x:n},backend:s,attrs:{shape:_}}),C=Te({inputs:{x:e},backend:s,attrs:{shape:E}}),S=[I,C],T=Math.max(v,y),N=t?I.shape[1]:I.shape[2],R=i!=null,D=o!=null,z=l==="leakyrelu",L=l!=null?sv(l,!0):null,O=R||D||z||L!=null;let F;if((f===1||p===1)&&N>Z9&&O===!1){let U=I,W=C;t&&(U=Ss({inputs:{x:I},backend:s,attrs:{perm:[0,2,1]}}),S.push(U)),r&&(W=Ss({inputs:{x:C},backend:s,attrs:{perm:[0,2,1]}}),S.push(W));const X=p!==1,Z=p===1;let ne=U;X&&(ne=Te({inputs:{x:U},backend:s,attrs:{shape:[T,N,1]}}),S.push(ne));const he=p===1?2:1;let le=W;Z&&(le=Te({inputs:{x:W},backend:s,attrs:{shape:[T,1,N]}}),S.push(le));const pe=KD({inputs:{a:ne,b:le},backend:s});F=Ak({inputs:{x:pe},backend:s,attrs:{axis:he,keepDims:!0}}),S.push(pe)}else{const U=ri(n.dtype,e.dtype),W=new J9(_,E,[T,f,p],t,r,R,L,D,z),X=[I,C];if(i!=null&&X.push(i),D&&X.push(o),z){const Z=s.makeTensorInfo([],"float32",hc(a,"float32"));X.push(Z),S.push(Z)}F=s.runWebGLProgram(W,X,U)}const P=Te({inputs:{x:F},backend:s,attrs:{shape:b}});S.push(F);for(const U of S)s.disposeIntermediateTensorInfo(U);return P}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XPe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;return Vw({a:s,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const YPe={kernelName:mw,backendName:"webgl",kernelFunc:XPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4="return abs(x);";function QPe(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const i=t.texData.get(r.dataId),o=W9(i.values);return t.makeTensorInfo(r.shape,r.dtype,o)}let s;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new xu(r.shape,R4):s=new ca(r.shape,R4),t.runWebGLProgram(s,[r],r.dtype)}const JPe={kernelName:n_,backendName:"webgl",kernelFunc:QPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZPe=ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,eOe=Rt({opSnippet:ZPe}),tOe={kernelName:Mv,backendName:"webgl",kernelFunc:eOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nOe=ho+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,rOe=Rt({opSnippet:nOe}),sOe={kernelName:Lv,backendName:"webgl",kernelFunc:rOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D4="return a + b;",iOe=Vr({opSnippet:D4,packedOpSnippet:D4,supportsComplex:!0,cpuKernelImpl:m$e}),oOe={kernelName:kp,backendName:"webgl",kernelFunc:iOe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aOe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lOe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pb(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return ii({inputs:{x:r[0]},backend:t});if(r.length>oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),u=pb({inputs:r.slice(0,l),backend:t}),c=pb({inputs:r.slice(l),backend:t});return pb({inputs:[u,c],backend:t})}const s=r.map(l=>l.dtype).reduce((l,u)=>ri(l,u)),i=r.map(l=>l.shape),a=oe().getBool("WEBGL_PACK")?new lOe(r[0].shape,i):new aOe(r[0].shape,i);return t.runWebGLProgram(a,r,s)}const uOe={kernelName:pA,backendName:"webgl",kernelFunc:pb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=vt(i,s.shape);let u=l;const c=Tn(u,a);let h=s;c!=null&&(h=Ss({inputs:{x:s},backend:t,attrs:{perm:c}}),u=Gn(u.length,a)),Br("all",u,a);const[d,f]=Sr(h.shape,u),p=fe(f),m=Te({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}}),g=ud(m,m.dtype,"all",t);let v;if(o){const y=rr(d,l);v=Te({inputs:{x:g},backend:t,attrs:{shape:y}})}else v=Te({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(h),v}const hOe={kernelName:mA,backendName:"webgl",kernelFunc:cOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=vt(i,s.shape);let u=l;const c=Tn(u,a);let h=s;c!=null&&(h=Ss({inputs:{x:s},backend:t,attrs:{perm:c}}),u=Gn(u.length,a)),Br("any",u,a);const[d,f]=Sr(h.shape,u),p=fe(f),m=Te({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}}),g=ud(m,m.dtype,"any",t);let v;if(o){const y=rr(d,l);v=Te({inputs:{x:g},backend:t,attrs:{shape:y}})}else v=Te({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(h),v}const fOe={kernelName:gA,backendName:"webgl",kernelFunc:dOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pOe{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mOe{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,M(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=tn(l),c=ys("coords",l);let h,d;if(o===1){d=l+1;const C=tn(d);h=`
        ${C} sourceLocR = ${C}(${c.join()}, 0);
        ++${c[l-1]};
        ${C} sourceLocG = ${C}(${c.join()}, 0);
        ++${c[l-2]};
        ${C} sourceLocA = ${C}(${c.join()}, 0);
        --${c[l-1]};
        ${C} sourceLocB = ${C}(${c.join()}, 0);
        --${c[l-2]};`}else d=l,h=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,d),p="."+f[d-1],m=f.map(C=>"int "+C),g=ys("sourceLocR",d-1).concat("inIdx.r"),v=ys("sourceLocG",d-1).concat("inIdx.g"),y=ys("sourceLocB",d-1).concat("inIdx.b"),x=ys("sourceLocA",d-1).concat("inIdx.a"),b=r==="max"?"greaterThan":"lessThan",_=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()})));`,E=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${x.join()}) : 0.)`,I=s?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n,e,t,r=null){let s=e.shape[0],i=e.shape[1];r!=null&&(s=r.shape[0],i=r.shape[1]);const o=dk(i),a={windowSize:o,inSize:i,batchSize:s,outSize:Math.ceil(i/o)},l=new pOe(a,t,r==null),u=[e];r!=null&&u.push(r);const c=n.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const h=e7(n,e,t,c);return n.disposeIntermediateTensorInfo(c),h}function t7(n,e,t,r=null){const s=r!=null?r.shape:e.shape,i=s[s.length-1],o=dk(i),a=new mOe(s,o,t,r==null),l=r==null?[e]:[e,r],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=t7(n,e,t,u);return n.disposeIntermediateTensorInfo(u),c}return u}function n7(n,e,t,r){const s=[t];if(Br("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!oe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,c]=Sr(l.shape,s),h=fe(c),d=Te({inputs:{x:l},backend:n,attrs:{shape:[-1,h]}});i.push(d);const f=e7(n,d,r);i.push(f);const p=Te({inputs:{x:f},backend:n,attrs:{shape:u}});return i.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}return t7(n,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=vt(i,s.shape);const a=Tn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Ss({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=Gn(o.length,l.shape.length)),Br("argMax",[o[0]],l.shape.length);const c=n7(t,l,o[0],"max");return u.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const vOe={kernelName:r_,backendName:"webgl",kernelFunc:gOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=vt(i,s.shape);const a=Tn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Ss({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=Gn(o.length,l.shape.length)),Br("argMin",[o[0]],l.shape.length);const c=n7(t,l,o[0],"min");return u.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const xOe={kernelName:s_,backendName:"webgl",kernelFunc:yOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bOe=ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,wOe=Rt({opSnippet:bOe}),_Oe={kernelName:Bv,backendName:"webgl",kernelFunc:wOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kOe=ho+"return log(x + sqrt(x * x + 1.0));",COe=Rt({opSnippet:kOe}),IOe={kernelName:Vv,backendName:"webgl",kernelFunc:COe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SOe=ho+`
  return atan(x);
`,EOe=Rt({opSnippet:SOe}),TOe={kernelName:zv,backendName:"webgl",kernelFunc:EOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NOe=qD+`
  return atan(a, b);
`,AOe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ld+`
  return result;
`,ROe=Vr({opSnippet:NOe,packedOpSnippet:AOe}),DOe={kernelName:jv,backendName:"webgl",kernelFunc:ROe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Oe=ho+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,POe=Rt({opSnippet:$Oe}),OOe={kernelName:Uv,backendName:"webgl",kernelFunc:POe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iv{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=t==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(m||(y="-1.0 / 1e-20"),r){const C=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?i?g:v:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const x="max";let b=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(b="avgValue / max(count, 1.0)");const _=Math.floor(o/4)*4,E=o%4,I=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${x}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${_};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${b});
      }
    `}}class XD{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,v=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const x=t==="avg";let b="0.0";if(x||(b="-1.0 / 1e-20"),r){const T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${v}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let E=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(E="avgValue / max(count, 1.0)");const I=Math.floor(o/4)*4,C=o%4,S=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${v}, ${y});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${S}
            }

            int xC = xCCorner + ${I};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${S}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${S}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${S}
            }
          }
        }
        setOutput(${E});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Yy(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;M(es(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=uo(s.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&Ut(c.inShape,c.outShape))return ii({inputs:{x:s},backend:t});const h=new iv(c,"avg",!1);return t.runWebGLProgram(h,[s],"float32")}const MOe={kernelName:i_,backendName:"webgl",kernelFunc:FOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LOe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r,c=[1,1,1],h=Ml(s.shape,i,o,c,a,l,u),d=new XD(h,"avg",!1);return t.runWebGLProgram(d,[s],"float32")}const BOe={kernelName:o_,backendName:"webgl",kernelFunc:LOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VOe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,d=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class zOe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=h-1-e.padInfo.front,m=d-1-e.padInfo.top,g=f-1-e.padInfo.left,v=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UOe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],d=Ml(o.shape,a,l,h,u,c),f=new zOe(d);return t.runWebGLProgram(f,[s],o.dtype)}const jOe={kernelName:yA,backendName:"webgl",kernelFunc:UOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WOe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Yy([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,c=uo(o.shape,a,l,1,u),h=new VOe(c);return t.runWebGLProgram(h,[s],o.dtype)}const HOe={kernelName:vA,backendName:"webgl",kernelFunc:WOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GOe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;return Vw({a:s,b:i,transposeA:o,transposeB:a,backend:t})}const qOe={kernelName:a_,backendName:"webgl",kernelFunc:GOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KOe{constructor(e,t,r,s,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ct(e,t),ct(e,r);let a="0.0";s!=null&&(ct(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(ct(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XOe{constructor(e,t,r,s,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ct(e,t),ct(e,r);let a="vec4(0.0)";s!=null&&(ct(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(ct(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YOe=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:i,offset:o,scale:a}=n;M(s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(o==null||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[r,s,i];let c=null;o!=null&&(c=o.shape,u.push(o));let h=null;a!=null&&(h=a.shape,u.push(a));const d=oe().getBool("WEBGL_PACK_NORMALIZATION")?new XOe(r.shape,s.shape,i.shape,c,h,l):new KOe(r.shape,s.shape,i.shape,c,h,l);return e.runWebGLProgram(d,u,u[0].dtype)},QOe={kernelName:x_,backendName:"webgl",kernelFunc:YOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JOe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=tn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=ZOe(this.rank);let s;const i=e.map((o,a)=>`sourceLoc.${mE[a]} = start[${a}] + coords.${mE[a]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const mE=["x","y","z","w","u","v"];function ZOe(n){if(n===1)return"sourceLoc";if(n<=6)return mE.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eFe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=tn(this.rank),r=ys("coords",this.rank),s=ys("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,o=`getChannel(getSource(${s.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${o};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((c,h)=>`start[${h}]`).join()});`:e.map((c,h)=>`${s[h]} = ${r[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tFe(n,e,t,r){const s=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,s),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=WR(e,Ke(n.shape));s.slice&&(a+=s.slice.flatOffset),o.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||n.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),i}function Mp(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r,[a,l]=hk(s,i,o);if(zR(s,a,l),fe(l)===0)return t.makeTensorInfo(l,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const h=t.texData.get(s.dataId),d=q$e(h.values,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,d)}const{isPacked:u}=t.texData.get(s.dataId),c=jR(s.shape,a,l);if(u||!c){const h=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eFe(l):new JOe(l),d=[a];return t.runWebGLProgram(h,[s],s.dtype,d)}return t.uploadToGPU(s.dataId),tFe(s,a,l,t)}const nFe={kernelName:K_,backendName:"webgl",kernelFunc:Mp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rFe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;M(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,x)=>y*x),l=My(s.shape,i,a),u=Ly(l.length,i.length),c=By(s.shape,i,a),h=XR(o,i.length),d=YR(c,o,i.length),f=[],p=Te({inputs:{x:s},backend:t,attrs:{shape:l}}),m=Ss({inputs:{x:p},backend:t,attrs:{perm:u}}),g=Te({inputs:{x:m},backend:t,attrs:{shape:c}}),v=Mp({inputs:{x:g},backend:t,attrs:{begin:h,size:d}});return f.push(p),f.push(m),f.push(g),f.forEach(y=>t.disposeIntermediateTensorInfo(y)),v},sFe={kernelName:l_,backendName:"webgl",kernelFunc:rFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.readSync(s.dataId),l=t.readSync(i.dataId),u=j9(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const oFe={kernelName:xA,backendName:"webgl",kernelFunc:iFe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aFe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,lFe=`
  return float(int(a.r) & int(b.r));
`;function uFe(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=oe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||o===1){const l=t.texData.get(r.dataId).values,u=t.texData.get(s.dataId).values,[c,h]=v$e(r.shape,s.shape,l,u,r.dtype),d=t.makeTensorInfo(h,r.dtype),f=t.texData.get(d.dataId);return f.values=c,d}let a;return i?a=new Op(aFe,r.shape,s.shape,!1):a=new Vh(lFe,r.shape,s.shape),t.runWebGLProgram(a,[r,s],r.dtype)}const cFe={kernelName:bA,backendName:"webgl",kernelFunc:uFe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hFe(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.readSync(r.dataId),o=t.readSync(s.dataId),a=ct(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const dFe={kernelName:W6,backendName:"webgl",kernelFunc:hFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fFe="return float(a != b);",r7=Vr({opSnippet:fFe,cpuKernelImpl:L$e,dtype:"bool"}),pFe={kernelName:F_,backendName:"webgl",kernelFunc:r7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jy(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return ii({inputs:{x:s.complexTensorInfos.real},backend:t})}const mFe={kernelName:HA,backendName:"webgl",kernelFunc:Jy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gFe="return float(int(x));";function vFe(n,e){const t=new ca(n.shape,gFe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return ii({inputs:{x:s},backend:t});const o=yr(s.shape),a=gE({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),l=xc({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const o=Jy({inputs:{input:s},backend:t}),a=gE({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!B6(s.dtype,i)){const o=ii({inputs:{x:s},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId).values,[a,l,u]=y$e(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return vFe(s,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Qr("bool",1)),l=r7({inputs:{a:s,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${i}`)}const yFe={kernelName:Wv,backendName:"webgl",kernelFunc:gE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4="return ceil(x);",xFe=Rt({opSnippet:$4,packedOpSnippet:$4,cpuKernelImpl:x$e}),bFe={kernelName:Hv,backendName:"webgl",kernelFunc:xFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wFe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Fe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:i,clipValueMax:o}=r;let a;oe().getBool("WEBGL_PACK_CLIP")?a=new _Fe(s.shape):a=new wFe(s.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[s],s.dtype,l)}const CFe={kernelName:Gv,backendName:"webgl",kernelFunc:kFe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IFe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function SFe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),i=new IFe(r.shape),o=[P4(r,s.complexTensorInfos.real),P4(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const EFe={kernelName:u_,backendName:"webgl",kernelFunc:SFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TFe{constructor(e){this.outputShape=[],this.outputShape=xa(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];r.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const s=t.length,i=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NFe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=xa(e,t);const r=this.outputShape,s=r.length,i=tn(s),o=ys("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][t];const u=a[t],c=a.slice(-2),h=a.join();let d=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];d+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${C0(a,u,g)}),
            vec2(${C0(c,u,g)}));
        }`}const f=l.length,p=l[l.length-1];d+=`
        return getChannel(
          getT${f}(${C0(a,u,p)}),
          vec2(${C0(c,u,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[s-1]} = ${o[s-1]} + 1;
        if (${o[s-1]} < ${r[s-1]}) {
          result.g = getValue(${o});
        }

        ${o[s-2]} = ${o[s-2]} + 1;
        if (${o[s-2]} < ${r[s-2]}) {
          result.a = getValue(${o});
        }

        ${o[s-1]} = ${o[s-1]} - 1;
        if (${o[s-2]} < ${r[s-2]} &&
            ${o[s-1]} < ${r[s-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function C0(n,e,t){const r=n.indexOf(e);return n.map((i,o)=>o===r?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rk(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return ii({inputs:{x:s.complexTensorInfos.imag},backend:t})}const AFe={kernelName:MA,backendName:"webgl",kernelFunc:Rk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zm(n,e,t){const r=n[0].dtype;if(r==="complex64"){const f=n.map(y=>Jy({inputs:{input:y},backend:t})),p=n.map(y=>Rk({inputs:{input:y},backend:t})),m=zm(f,e,t),g=zm(p,e,t),v=xc({inputs:{real:m,imag:g},backend:t});return f.forEach(y=>t.disposeIntermediateTensorInfo(y)),p.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),v}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const f=n.map(b=>{const E=[-1,fe(b.shape.slice(e))];return Te({inputs:{x:b},backend:t,attrs:{shape:E}})}),p=f.map(b=>({vals:t.readSync(b.dataId),shape:b.shape})),m=xa(f.map(b=>b.shape),1),g=f[0].shape[0]===1,v=b$e(p,m,r,g),y=xa(n.map(b=>b.shape),e),x=t.makeTensorInfo(y,r,v);return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),x}const i=n.filter(f=>fe(f.shape)>0),o=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new ca(n[0].shape,iu):new xu(n[0].shape,iu);return t.runWebGLProgram(f,n,r)}const a=oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const f=[];for(let m=0;m<i.length;m+=a){const g=i.slice(m,m+a);f.push(zm(g,e,t))}const p=zm(f,e,t);for(const m of f)t.disposeIntermediateTensorInfo(m);return p}if(o){const f=new NFe(i.map(p=>p.shape),e);return t.runWebGLProgram(f,i,r)}const{tensors2D:l,outShape:u}=RFe(i,e,t),c=new TFe(l.map(f=>f.shape)),h=t.runWebGLProgram(c,l,r);l.forEach(f=>t.disposeIntermediateTensorInfo(f));const d=Te({inputs:{x:h},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(h),d}function RFe(n,e,t){const r=xa(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Te({inputs:{x:i},attrs:{shape:[-1,fe(i.shape.slice(e))]},backend:t})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=vt(s,e[0].shape)[0],o=e.map(u=>u.shape);GR(o,i);const a=xa(e.map(u=>u.shape),i);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>fe(u.shape)>0);return l.length===1?ii({inputs:{x:l[0]},backend:t}):zm(l,i,t)}const DFe={kernelName:c_,backendName:"webgl",kernelFunc:s7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i7{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",v=g?1:2,y=g?2:3,x=g?3:1;let b="",_="";r&&(s?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:b=`
          float activation(float x) {
            ${r}
          }
        `,_="result = activation(result);");const E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${x}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${_}
        setOutput(result);
      }
    `}}class $Fe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o7{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const v=g*2;if(d+=`
           xC = xCCorner + ${v*l};
           `,a===1){if(v<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?d+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<c)){const y=o%2===0?uA(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:d+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):y===1?d+=`
                     xC${v+1} = xTexelC${v};
                     `:d+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<c&&(d+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<c&&(d+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<c&&(d+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let f="",p="";r&&(s?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:f=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PFe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);const{dataFormat:r}=t,s=Ts(),i=r==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zw(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function a7({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=r.texData.get(n.dataId),c=t.inChannels,h=l[0]*l[1]*l[2],d=t.outChannels,f=t.dataFormat==="channelsLast",p=!1,m=!1;let g;const v=[];if(i!=null){const b=zw(i.shape,f);b!=null&&(i=Te({inputs:{x:i},backend:r,attrs:{shape:b}}),v.push(i))}if(s!=null){const b=zw(s.shape,f);b!=null&&(s=Te({inputs:{x:s},backend:r,attrs:{shape:b}}),v.push(s))}if(!((h===1||d===1)&&c>Z9)&&u.isPacked&&f&&u.texture!=null&&l[2]%2!==0&&Ut(u.shape.slice(-3),l.slice(-3))){const b=l[0]*l[1]*(l[2]+1),_={dataId:n.dataId,shape:[1,b,t.inChannels],dtype:n.dtype},E=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,M(Bw(u.shape,_.shape),()=>`packed reshape ${u.shape} to ${_.shape} isn't free`);const I=Te({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});v.push(I);const C=Vw({a:_,b:I,backend:r,transposeA:p,transposeB:m,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),S=r.texData.get(C.dataId);M(S.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=E,S.shape=t.outShape,g=ii({inputs:{x:C},backend:r}),g.shape=t.outShape,v.push(C)}else{const b=t.outHeight*t.outWidth,_=Te({inputs:{x:n},backend:r,attrs:{shape:f?[t.batchSize,b,t.inChannels]:[t.batchSize,t.inChannels,b]}}),E=Te({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),I=Vw({a:f?_:E,b:f?E:_,transposeA:!f,transposeB:m,backend:r,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o});g=Te({inputs:{x:I},backend:r,attrs:{shape:t.outShape}}),v.push(_),v.push(E),v.push(I)}for(const b of v)r.disposeIntermediateTensorInfo(b);return g}function l7({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:f}=t,p=f==="channelsLast",m=l*u*c,g=d*h,v=[t.batchSize,m,g],y=!0,x=!1,b=[];if(i!=null){const P=zw(i.shape,p);P!=null&&(i=Te({inputs:{x:i},backend:r,attrs:{shape:P}}),b.push(i))}if(s!=null){const P=zw(s.shape,p);P!=null&&(s=Te({inputs:{x:s},backend:r,attrs:{shape:P}}),b.push(s))}const _=Te({inputs:{x:e},backend:r,attrs:{shape:[1,m,fe(e.shape)/m]}});b.push(_);const E=new PFe(v,t),I=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],C=r.runWebGLProgram(E,[n],"float32",I),S=Te({inputs:{x:C},backend:r,attrs:{shape:v}});b.push(C),b.push(S);const T=s!=null,N=i!=null,R=a==="leakyrelu",D=a?sv(a,!0):null,z=new J9(p?S.shape:_.shape,p?_.shape:S.shape,p?[t.batchSize,g,t.outChannels]:[t.batchSize,t.outChannels,g],y,x,T,D,N,R),L=p?[S,_]:[_,S];if(s&&L.push(s),N&&L.push(i),R){const P=r.makeTensorInfo([],"float32",hc(o,"float32"));L.push(P),b.push(P)}const O=r.runWebGLProgram(z,L,"float32"),F=Te({inputs:{x:O},backend:r,attrs:{shape:t.outShape}});b.push(O);for(const P of b)r.disposeIntermediateTensorInfo(P);return F}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r,h=Ll(l),d=Lr(s.shape,i.shape,o,u,a,c,!1,h);let f;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))f=a7({x:s,filter:i,convInfo:d,backend:t});else if(d.strideWidth<=2&&h==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const m=new o7(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];f=t.runWebGLProgram(m,[s,i],"float32",g)}else if(oe().getBool("WEBGL_CONV_IM2COL"))f=l7({x:s,filter:i,convInfo:d,backend:t});else{const m=new i7(d);f=t.runWebGLProgram(m,[s,i],"float32")}const p=Te({inputs:{x:f},backend:t,attrs:{shape:d.outShape}});return t.disposeIntermediateTensorInfo(f),p}const FFe={kernelName:h_,backendName:"webgl",kernelFunc:OFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MFe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class LFe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=r-1-e.padInfo.left,u=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class BFe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class VFe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=r-1-e.padInfo.top,c=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,h=Ll(l),d=Lr(s.shape,c,o,1,a,u,!1,h),f=new MFe(d);return t.runWebGLProgram(f,[s,i],"float32")}const UFe={kernelName:_A,backendName:"webgl",kernelFunc:zFe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jFe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ns(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,i=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WFe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r,h=Ll(u),d=Lr(o,i.shape,a,1,l,c,!1,h);if(oe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[d.strideHeight,d.strideWidth]],p=new jFe(d);return t.runWebGLProgram(p,[s,i],"float32",f)}else{const f=new LFe(d);return t.runWebGLProgram(f,[s,i],"float32")}}const HFe={kernelName:d_,backendName:"webgl",kernelFunc:WFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=dc(s.shape,i.shape,o,l,a),c=new $Fe(u);return t.runWebGLProgram(c,[s,i],"float32")}const qFe={kernelName:f_,backendName:"webgl",kernelFunc:GFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KFe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r,u=dc(s.shape,l,o,1,a),c=new BFe(u);return t.runWebGLProgram(c,[s,i],"float32")}const XFe={kernelName:kA,backendName:"webgl",kernelFunc:KFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YFe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r,u=dc(l,i.shape,a,1,o),c=new VFe(u);return t.runWebGLProgram(c,[s,i],"float32")}const QFe={kernelName:CA,backendName:"webgl",kernelFunc:YFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JFe=Fp+`
  return cos(x);
`,ZFe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ld}
  return result;
`,eMe=Rt({opSnippet:JFe,packedOpSnippet:ZFe}),tMe={kernelName:qv,backendName:"webgl",kernelFunc:eMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nMe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,rMe=Rt({opSnippet:nMe}),sMe={kernelName:Kv,backendName:"webgl",kernelFunc:rMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iMe{constructor(e,t,r,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[c]=t,[h,d]=r;this.outputShape=[c,h,d,u];const f=s==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,v,y]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[x,b,_]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${x});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${b};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oMe=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,c=new iMe(s.shape,i.shape,a,l,u);return t.runWebGLProgram(c,[s,i,o],"float32")},aMe={kernelName:SA,backendName:"webgl",kernelFunc:oMe};var ov;(function(n){n.Prod="*",n.Sum="+"})(ov||(ov={}));class O4{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===ov.Prod?"1.0":"0.0",a=r?o:`getX(${F4(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";r?(u=s?`end != ${l-1}`:"end != 0",c=s?"end + 1":"end - 1"):(u=s?`end + pow2 < ${l}`:"end >= pow2",c=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${tn(i)} coords = getOutputCoords();
        int end = ${M4(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${M4(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${F4(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function F4(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function M4(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(n,e,t,r,s,i){const o=e.shape.length,a=Tn([r],o);let l=e;a!=null&&(l=Ss({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=Gn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const c=l.shape[u];let h=ii({inputs:{x:l},backend:t});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const f=new O4(n,l.shape,!1,i),p=[[d]],m=h;h=t.runWebGLProgram(f,[h],h.dtype,p),t.disposeIntermediateTensorInfo(m)}if(s){const d=new O4(n,l.shape,s,i),f=h;h=t.runWebGLProgram(d,[h],h.dtype),t.disposeIntermediateTensorInfo(f)}if(a!=null){const d=fc(a),f=Ss({inputs:{x:h},backend:t,attrs:{perm:d}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(l),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return u7(ov.Prod,s,t,i,o,a)}const uMe={kernelName:IA,backendName:"webgl",kernelFunc:lMe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return u7(ov.Sum,s,t,i,o,a)}const hMe={kernelName:p_,backendName:"webgl",kernelFunc:cMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.readSync(s.dataId),u=t.readSync(i.dataId),c=j9(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(s.shape.length===2){const l=t.bufferSync(s),u=t.bufferSync(i),c=g$e(l,u,o,a);return t.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const fMe={kernelName:EA,backendName:"webgl",kernelFunc:dMe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pMe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r,a=s.shape[0],l=o==="NHWC"?s.shape[1]:s.shape[2],u=o==="NHWC"?s.shape[2]:s.shape[3],c=o==="NHWC"?s.shape[3]:s.shape[1],h=l*i,d=u*i,f=c/(i*i),p=o==="NHWC"?[a,h,d,f]:[a,f,h,d],m=new pMe(p,i,o);return t.runWebGLProgram(m,[s],s.dtype)}const gMe={kernelName:TA,backendName:"webgl",kernelFunc:mMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c7{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";r&&(s?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:u=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h7{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<h;v++)f+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;f+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let v=0;v<h;v++)f+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(d+1)/2;v++){const y=v*2;if(f+=`
          xC = xCCorner + ${y*u};
          `,l===1){if(y<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,u===1&&y>0?f+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<h)){const x=a%2===0?uA(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${x};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,u>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:f+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):x===1?f+=`
                    xC${y+1} = xTexelC${y};
                    `:f+=`
                    xCOffset = xC + ${x};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<h&&(f+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<h&&(f+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<h&&(f+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";r&&(s?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;let c=l;c==null&&(c=[1,1]),M(es(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=Lr(s.shape,i.shape,o,c,a,u,!0);let d;oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new h7(h):d=new c7(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(d,[s,i],"float32",f)}const yMe={kernelName:m_,backendName:"webgl",kernelFunc:vMe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xMe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class bMe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r,h=Lr(s.shape,c,o,a,l,u,!0),d=new xMe(h);return t.runWebGLProgram(d,[s,i],"float32")}const _Me={kernelName:NA,backendName:"webgl",kernelFunc:wMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kMe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r,h=Lr(c,i.shape,o,a,l,u,!0),d=new bMe(h);return t.runWebGLProgram(d,[s,i],"float32")}const CMe={kernelName:AA,backendName:"webgl",kernelFunc:kMe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IMe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SMe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],i=fe(r.shape),o=Te({inputs:{x:r},backend:t,attrs:{shape:[i]}}),a=new IMe(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Te({inputs:{x:l},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const EMe={kernelName:H6,backendName:"webgl",kernelFunc:SMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TMe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:h,left:d}=s;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NMe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=Dy(s.shape,i.shape,o,a,"NHWC",l);let c;const h=new TMe(u);c=t.runWebGLProgram(h,[s,i],"float32");const d=Te({inputs:{x:c},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(c),d}const AMe={kernelName:g_,backendName:"webgl",kernelFunc:NMe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RMe(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=sD(s,i.length);oD(o.length,l,i);const{path:u,steps:c}=aD(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:v,expandDims:y}=iD(f,l[g]);let x;lD(v)?x=i[g]:(x=Ss({inputs:{x:i[g]},backend:t,attrs:{perm:v}}),p.push(x));const b=x.shape.slice();for(let _=0;_<y.length;++_)b.splice(y[_],0,1);Ut(x.shape,b)||(x=Te({inputs:{x},backend:t,attrs:{shape:b}}),p.push(x)),d===null?d=x:(d=KD({inputs:{a:x,b:d},backend:t}),p.push(d))}m<h-1&&(u[m]>=0&&(d=Ak({inputs:{x:d},backend:t,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&t.disposeIntermediateTensorInfo(m);return d}const DMe={kernelName:RA,backendName:"webgl",kernelFunc:RMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Me="return (x >= 0.0) ? x : (exp(x) - 1.0);",PMe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,OMe=Rt({opSnippet:$Me,packedOpSnippet:PMe}),FMe={kernelName:Yv,backendName:"webgl",kernelFunc:OMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MMe="return (b >= 0.0) ? a : a * (b + 1.0);",LMe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,BMe=n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Op(LMe,r.shape,s.shape):new Vh(MMe,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],r.dtype)},VMe={kernelName:DA,backendName:"webgl",kernelFunc:BMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zMe=`
  return vec4(equal(a, b));
`,UMe="return float(a == b);",jMe=Vr({opSnippet:UMe,packedOpSnippet:zMe,dtype:"bool",cpuKernelImpl:w$e}),WMe={kernelName:v_,backendName:"webgl",kernelFunc:jMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HMe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${QR};
  float a1 = ${JR};
  float a2 = ${ZR};
  float a3 = ${eD};
  float a4 = ${tD};
  float a5 = ${nD};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,GMe=Rt({opSnippet:HMe}),qMe={kernelName:Qv,backendName:"webgl",kernelFunc:GMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KMe=Fp+`
  return exp(x);
`,XMe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,d7=Rt({opSnippet:KMe,packedOpSnippet:XMe,cpuKernelImpl:_$e,dtype:"float32"}),YMe={kernelName:Jv,backendName:"webgl",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(M(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+s+1),a.splice(l,0,1),Te({inputs:{x:i},backend:r,attrs:{shape:a}})}const QMe={kernelName:y_,backendName:"webgl",kernelFunc:vE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L4="return exp(x) - 1.0;",JMe=Rt({opSnippet:L4,packedOpSnippet:L4,cpuKernelImpl:k$e}),ZMe={kernelName:Zv,backendName:"webgl",kernelFunc:JMe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B4{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(n,e,t){const r=t.texData.get(n.dataId),s=fe(n.shape),i=n.shape[n.shape.length-1],o=s/i,a=Te({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new B4("real",l,e),c=new B4("imag",l,e),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],d=t.runWebGLProgram(u,h,"float32"),f=t.runWebGLProgram(c,h,"float32"),p=xc({inputs:{real:d,imag:f},backend:t});t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f);const m=Te({inputs:{x:p},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eLe(n){const{inputs:e,backend:t}=n,{input:r}=e;return f7(r,!1,t)}const tLe={kernelName:$A,backendName:"webgl",kernelFunc:eLe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nLe{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zy(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:i}=t;if(i=i||wp(s),i==="string"){const o=jn(i,fe(r));return o.fill(s),e.makeTensorInfo(r,i,o)}else{const o=new nLe(r,s),a=[[s]];return e.runWebGLProgram(o,[],i,a)}}const rLe={kernelName:PA,backendName:"webgl",kernelFunc:Zy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sLe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iLe={kernelName:OA,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new sLe(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V4="return floor(x);",oLe=Rt({opSnippet:V4,packedOpSnippet:V4,cpuKernelImpl:C$e}),aLe={kernelName:ey,backendName:"webgl",kernelFunc:oLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lLe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,uLe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,cLe=Vr({opSnippet:lLe,packedOpSnippet:uLe,dtype:"int32"}),hLe={kernelName:ty,backendName:"webgl",kernelFunc:cLe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dLe{constructor(e){this.variableNames=["A"];const t=Ts(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fLe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Ts(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pLe={kernelName:Rve,backendName:"webgl",kernelFunc:mLe};let kd,S2=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function mLe(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:i}=r,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,u]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],c=[u,l],h=[u,l,i];if(a||o){const m=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(kd==null||m!==S2)&&(S2=m,kd=document.createElement("canvas").getContext("2d",{willReadFrequently:S2})),kd.canvas.width=l,kd.canvas.height=u,kd.drawImage(s,0,0,l,u),s=kd.canvas}const d=t.makeTensorInfo(c,"int32");t.texData.get(d.dataId).usage=vi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),s);const f=oe().getBool("WEBGL_PACK")?new fLe(h):new dLe(h),p=t.runWebGLProgram(f,[d],"int32");return t.disposeData(d.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gLe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r,m=Ll(c),g=Lr(s.shape,i.shape,l,h,u,d,!1,m);let v;const y=[],x=o!=null,b=a!=null,_=f==="leakyrelu",E=()=>{const C=[s,i],S=(T,N)=>{if(N==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){const R=Te({inputs:{x:T},backend:t,attrs:{shape:[T.shape[0],1,1]}});return y.push(R),R}return T};if(x&&C.push(S(o,c)),b&&C.push(S(a,c)),_){const T=t.makeTensorInfo([],"float32",hc(p,"float32"));C.push(T),y.push(T)}return C};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))v=a7({x:s,filter:i,convInfo:g,backend:t,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const C=f?sv(f,!0):null,S=new o7(g,x,C,b,_),T=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],N=E();v=t.runWebGLProgram(S,N,"float32",T)}else if(oe().getBool("WEBGL_CONV_IM2COL"))v=l7({x:s,filter:i,convInfo:g,backend:t,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const C=f?sv(f,!1):null,S=new i7(g,x,C,b,_),T=E();v=t.runWebGLProgram(S,T,"float32")}const I=Te({inputs:{x:v},backend:t,attrs:{shape:g.outShape}});return y.push(v),y.forEach(C=>t.disposeIntermediateTensorInfo(C)),I}const vLe={kernelName:gw,backendName:"webgl",kernelFunc:gLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yLe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:f}=r,p=[];let m=c;m==null&&(m=[1,1]),M(es(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=Lr(s.shape,i.shape,l,m,u,h,!0),v=oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=d?sv(d,v):null,x=[s,i],b=o!=null,_=a!=null,E=d==="leakyrelu";if(b&&x.push(o),_&&x.push(a),E){const T=t.makeTensorInfo([],"float32",hc(f,"float32"));x.push(T),p.push(T)}let I;v?I=new h7(g,b,y,_,E):I=new c7(g,b,y,_,E);const C=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],S=t.runWebGLProgram(I,x,"float32",C);return p.forEach(T=>t.disposeIntermediateTensorInfo(T)),S}const xLe={kernelName:c5,backendName:"webgl",kernelFunc:yLe};class bLe{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const i=tn(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wLe(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=s.shape,o=i[i.length-1],a=fe(r.shape),[l,u,c,h]=VR(r,s),d=Te({inputs:{x:s},backend:t,attrs:{shape:[u,o]}}),f=Te({inputs:{x:r},backend:t,attrs:{shape:[fe(r.shape)/c,c]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const v=t.readSync(s.dataId),y=t.bufferSync(r),x=I$e(v,y,r.dtype,u,o,c,h,r.shape,a);return t.makeTensorInfo(l,r.dtype,x.values)}const p=new bLe(o,h,[u,c],r.shape),m=t.runWebGLProgram(p,[f,d],f.dtype),g=Te({inputs:{x:m},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),g}const _Le={kernelName:G6,backendName:"webgl",kernelFunc:wLe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kLe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=tn(this.rank),s=CLe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function CLe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r,l=vt(o,s.shape)[0];if(oe().get("DEBUG")){const y=t.readSync(i.dataId),x=s.shape[l];for(let b=0;b<y.length;++b){const _=y[b];M(_<=x-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${x-1}]`)}}const u=cD(s,i,l,a),c=fe(i.shape),h=[],d=Te({inputs:{x:s},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=Te({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(f);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const y=t.bufferSync(f),x=t.bufferSync(d),b=S$e(x,y,p);return h.forEach(_=>t.disposeIntermediateTensorInfo(_)),t.makeTensorInfo(u.outputShape,b.dtype,b.values)}const m=new kLe(d.shape,p),g=t.runWebGLProgram(m,[d,f],d.dtype);h.push(g);const v=Te({inputs:{x:g},backend:t,attrs:{shape:u.outputShape}});return h.forEach(y=>t.disposeIntermediateTensorInfo(y)),v}const ILe={kernelName:b_,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SLe="return float(a > b);",ELe=`
  return vec4(greaterThan(a, b));
`,TLe=Vr({opSnippet:SLe,packedOpSnippet:ELe,cpuKernelImpl:E$e,dtype:"bool"}),NLe={kernelName:w_,backendName:"webgl",kernelFunc:TLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ALe="return float(a >= b);",RLe=`
  return vec4(greaterThanEqual(a, b));
`,DLe=Vr({opSnippet:ALe,packedOpSnippet:RLe,dtype:"bool",cpuKernelImpl:T$e}),$Le={kernelName:ny,backendName:"webgl",kernelFunc:DLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PLe(n){const{inputs:e,backend:t}=n,{input:r}=e;return f7(r,!0,t)}const OLe={kernelName:FA,backendName:"webgl",kernelFunc:PLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FLe="return float(!isnan(x) && !isinf(x));",MLe=Rt({opSnippet:FLe,dtype:"bool"}),LLe={kernelName:sy,backendName:"webgl",kernelFunc:MLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BLe="return float(isinf(x));",VLe=Rt({opSnippet:BLe,dtype:"bool"}),zLe={kernelName:iy,backendName:"webgl",kernelFunc:VLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ULe="return float(isnan(x));",jLe=Rt({opSnippet:ULe,dtype:"bool"}),WLe={kernelName:oy,backendName:"webgl",kernelFunc:jLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HLe="return float(a < b);",GLe=`
  return vec4(lessThan(a, b));
`,qLe=Vr({opSnippet:HLe,packedOpSnippet:GLe,cpuKernelImpl:N$e,dtype:"bool"}),KLe={kernelName:k_,backendName:"webgl",kernelFunc:qLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XLe="return float(a <= b);",YLe=`
  return vec4(lessThanEqual(a, b));
`,QLe=Vr({opSnippet:XLe,packedOpSnippet:YLe,cpuKernelImpl:A$e,dtype:"bool"}),JLe={kernelName:C_,backendName:"webgl",kernelFunc:QLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZLe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=R$e(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const e3e={kernelName:q6,backendName:"webgl",kernelFunc:ZLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t3e=Fp+`
  return x < 0.0 ? 0./0. : log(x);
`,n3e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,r3e=Rt({opSnippet:t3e,packedOpSnippet:n3e,cpuKernelImpl:D$e}),s3e={kernelName:ay,backendName:"webgl",kernelFunc:r3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3e=Fp+`
  return log(1.0 + x);
`,o3e=Rt({opSnippet:i3e}),a3e={kernelName:ly,backendName:"webgl",kernelFunc:o3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3e="return float(a >= 1.0 && b >= 1.0);",u3e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,c3e=Vr({opSnippet:l3e,packedOpSnippet:u3e,dtype:"bool"}),h3e={kernelName:I_,backendName:"webgl",kernelFunc:c3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d3e="return float(!(x >= 1.0));",f3e=Rt({opSnippet:d3e}),p3e={kernelName:S_,backendName:"webgl",kernelFunc:f3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3e="return float(a >= 1.0 || b >= 1.0);",g3e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,v3e=Vr({opSnippet:m3e,packedOpSnippet:g3e,dtype:"bool"}),y3e={kernelName:E_,backendName:"webgl",kernelFunc:v3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x3e{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b3e{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w3e=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r,u=oe().getBool("WEBGL_PACK_NORMALIZATION")?new b3e(s.shape,i,o,a,l):new x3e(s.shape,i,o,a,l);return t.runWebGLProgram(u,[s],s.dtype)},_3e={kernelName:T_,backendName:"webgl",kernelFunc:w3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k3e{constructor(e,t,r,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3e=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=r,h=new k3e(s.shape,a,l,u,c);return t.runWebGLProgram(h,[s,i,o],s.dtype)},I3e={kernelName:LA,backendName:"webgl",kernelFunc:C3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3e(n,e,t,r){const s=fe(e),o=fe(n.shape)/s,a=Te({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=ud(a,n.dtype,"max",r),u=Te({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=s.shape.length,l=vt(i,s.shape);let u=l;const c=Tn(u,a),h=c!=null,d=t.shouldExecuteOnCPU([s]);let f=s;if(h){if(d){const x=t.texData.get(f.dataId).values,b=new Array(a);for(let I=0;I<b.length;I++)b[I]=s.shape[c[I]];const _=GD(x,s.shape,s.dtype,c,b);f=t.makeTensorInfo(b,s.dtype);const E=t.texData.get(f.dataId);E.values=_}else f=Nk(s,c,t);u=Gn(u.length,a)}Br("max",u,a);const[p,m]=Sr(f.shape,u);let g=p;o&&(g=rr(p,l));let v;if(d){const x=t.texData.get(f.dataId).values,b=$$e(x,fe(m),g,s.dtype);v=t.makeTensorInfo(g,s.dtype);const _=t.texData.get(v.dataId);_.values=b}else v=S3e(f,m,g,t);return h&&t.disposeIntermediateTensorInfo(f),v}const E3e={kernelName:N_,backendName:"webgl",kernelFunc:m7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3e=qD+`
  return max(a, b);
`,N3e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ld+`
  return result;
`,A3e=Vr({opSnippet:T3e,packedOpSnippet:N3e,cpuKernelImpl:P$e}),R3e={kernelName:uy,backendName:"webgl",kernelFunc:A3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Yy(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;M(es(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=uo(s.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&Ut(c.inShape,c.outShape))return ii({inputs:{x:s},backend:t});const h=new iv(c,"max",!1);return t.runWebGLProgram(h,[s],s.dtype)}const $3e={kernelName:A_,backendName:"webgl",kernelFunc:D3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=r,c=[1,1,1],h=Ml(s.shape,i,o,c,a,u,l),d=new XD(h,"max",!1);return t.runWebGLProgram(d,[s],s.dtype)}const O3e={kernelName:R_,backendName:"webgl",kernelFunc:P3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F3e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class M3e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=u-1-e.padInfo.top,f=c-1-e.padInfo.left,p=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],d=Ml(o.shape,a,l,h,u,c),f=new XD(d,"max",!0),p=t.runWebGLProgram(f,[o],o.dtype),m=new M3e(d),g=t.runWebGLProgram(m,[s,p],o.dtype);return t.disposeIntermediateTensorInfo(p),g}const B3e={kernelName:VA,backendName:"webgl",kernelFunc:L3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Yy([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=uo(a.shape,l,u,1,c,h),f=!0,p=new iv(d,"max",f),m=t.runWebGLProgram(p,[a],a.dtype),g=new F3e(d),v=t.runWebGLProgram(g,[s,m],a.dtype);return t.disposeIntermediateTensorInfo(m),v}const z3e={kernelName:BA,backendName:"webgl",kernelFunc:V3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3e(n,e,t,r){let s=new iv(t,"max",!1);const i=r.runWebGLProgram(s,[n],"float32");s=new iv(t,"max",!0,!0,e);const o=r.runWebGLProgram(s,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3e={kernelName:K6,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;M(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const u=[1,1];M(es(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=uo(r.shape,s,i,u,o),[h,d]=U3e(r,a,c,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W3e(n,e,t,r){const s=fe(e),o=fe(n.shape)/s,a=Te({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=ud(a,"float32","mean",r),u=Te({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3e={kernelName:D_,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:i}=e,o=t,a=r.shape.length,l=vt(i,r.shape);let u=l;const c=Tn(u,a),h=c!=null,d=o.shouldExecuteOnCPU([r]),f=[];let p=r;if(h){if(d){const b=o.texData.get(p.dataId).values,_=new Array(a);for(let C=0;C<_.length;C++)_[C]=r.shape[c[C]];const E=GD(b,r.shape,r.dtype,c,_);p=o.makeTensorInfo(_,r.dtype);const I=o.texData.get(p.dataId);I.values=E}else p=Nk(r,c,o);f.push(p),u=Gn(u.length,a)}Br("sum",u,a);const[m,g]=Sr(p.shape,u);let v=m;s&&(v=rr(m,l));const y=W3e(p,g,v,o);for(const x of f)o.disposeIntermediateTensorInfo(x);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=vt(i,s.shape);let u=l;const c=Tn(u,a);let h=s;c!=null&&(h=Ss({inputs:{x:s},backend:t,attrs:{perm:c}}),u=Gn(u.length,s.shape.length)),Br("min",u,a);const[d,f]=Sr(h.shape,u),p=fe(f),m=Te({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}}),g=ud(m,m.dtype,"min",t);let v;if(o){const y=rr(d,l);v=Te({inputs:{x:g},backend:t,attrs:{shape:y}})}else v=Te({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(h),v}const q3e={kernelName:$_,backendName:"webgl",kernelFunc:G3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3e=qD+`
  return min(a, b);
`,X3e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ld+`
  return result;
`,Y3e=Vr({opSnippet:K3e,packedOpSnippet:X3e,cpuKernelImpl:O$e}),Q3e={kernelName:cy,backendName:"webgl",kernelFunc:Y3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J3e{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((c,h)=>c[0]+e[h]+c[1]);const s=e.length,i=tn(s),o=t.map(c=>c[0]).join(","),a=t.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),u=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z3e{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((p,m)=>p[0]+e[m]+p[1]);const s=e.length,i=tn(s),o=t.map(p=>p[0]).join(","),a=t.map((p,m)=>p[0]+e[m]).join(","),l=ys("rc",s),u=ys("source",s),c=`${l[s-1]} < ${this.outputShape[s-1]}`,h=s===1?"source":`vec2(${u.slice(-2).join()})`,d=r==="reflect"?0:1;let f="";if(s===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[s-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[s-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${p}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[s-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e4e=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:i}=t,o=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z3e(r.shape,s,i):new J3e(r.shape,s,i);return e.runWebGLProgram(o,[r],r.dtype)},t4e={kernelName:P_,backendName:"webgl",kernelFunc:e4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4e=`if (b == 0.0) return NAN;
  return mod(a, b);`,r4e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ld+`
  return result;
`,s4e=Vr({opSnippet:n4e,packedOpSnippet:r4e}),i4e={kernelName:hy,backendName:"webgl",kernelFunc:s4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o4e{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a4e=`
if (a == b) {
  return 1.0;
};
return a / b;`,l4e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,g7=Vr({opSnippet:a4e,packedOpSnippet:l4e,checkOutOfBounds:!0}),u4e={kernelName:Xv,backendName:"webgl",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z4="return a - b;",v7=Vr({opSnippet:z4,packedOpSnippet:z4,supportsComplex:!0,cpuKernelImpl:nPe}),c4e={kernelName:Ey,backendName:"webgl",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=vt([i],s.shape),a=m7({inputs:{x:s},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=rr(a.shape,o),u=Te({inputs:{x:a},backend:t,attrs:{shape:l}}),c=v7({inputs:{a:s,b:u},backend:t}),h=d7({inputs:{x:c},backend:t}),d=Ak({inputs:{x:h},backend:t,attrs:{axis:o,keepDims:!1}}),f=Te({inputs:{x:d},backend:t,attrs:{shape:l}}),p=g7({inputs:{a:h,b:f},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}const h4e={kernelName:J_,backendName:"webgl",kernelFunc:y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4e(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r,l=a?s:y7({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new o4e(u,c,i),d=[[o]],f=t.runWebGLProgram(h,[l],"int32",d);return a||t.disposeIntermediateTensorInfo(l),f}const f4e={kernelName:X6,backendName:"webgl",kernelFunc:d4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p4e=ho+`
  return -x;
`,m4e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function g4e(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId),[o,a]=M$e(i.values,r.shape,r.dtype);return t.makeTensorInfo(a,r.dtype,o)}let s;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new xu(r.shape,m4e):s=new ca(r.shape,p4e),t.runWebGLProgram(s,[r],r.dtype)}const v4e={kernelName:O_,backendName:"webgl",kernelFunc:g4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4e=OR;function x4e(n){mi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,u=t.readSync(s.dataId),c=t.readSync(i.dataId),{selectedIndices:h}=y4e(u,c,o,a,l);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const b4e={kernelName:zA,backendName:"webgl",kernelFunc:x4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4e=FR;function _4e(n){mi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r,c=t.readSync(s.dataId),h=t.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=w4e(c,h,o,a,l,u);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const k4e={kernelName:UA,backendName:"webgl",kernelFunc:_4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C4e=MR;function I4e(n){mi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r,c=t.readSync(s.dataId),h=t.readSync(i.dataId),d=o,f=a,p=l,m=u,{selectedIndices:g,selectedScores:v}=C4e(c,h,d,f,p,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const S4e={kernelName:jA,backendName:"webgl",kernelFunc:I4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E4e{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4e=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r,u=fe(s.shape),c=new E4e(u,o,a,l),h=Te({inputs:{x:s},backend:t,attrs:{shape:[u]}}),d=t.runWebGLProgram(c,[h],i);t.disposeIntermediateTensorInfo(h);const f=[...s.shape,o],p=Te({inputs:{x:d},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(d),p},N4e={kernelName:L_,backendName:"webgl",kernelFunc:T4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uw(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=Jy({inputs:{input:r},backend:t}),i=Uw({inputs:{x:s},backend:t}),o=Rk({inputs:{input:r},backend:t}),a=Uw({inputs:{x:o},backend:t}),l=xc({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Zy({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const A4e={kernelName:tk,backendName:"webgl",kernelFunc:Uw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=Jy({inputs:{input:r},backend:t}),i=x7({inputs:{x:s},backend:t}),o=Rk({inputs:{input:r},backend:t}),a=Uw({inputs:{x:o},backend:t}),l=xc({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Zy({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const R4e={kernelName:M_,backendName:"webgl",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4e(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return vE({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{cA(i,c.shape,"All tensors passed to stack must have matching shapes"),M(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=vE({inputs:{input:c},backend:t,attrs:{dim:s}});return a.push(h),h}),u=s7({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(c=>t.disposeIntermediateTensorInfo(c)),u}const $4e={kernelName:B_,backendName:"webgl",kernelFunc:D4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P4e{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,c)=>u[0]+e[c]+u[1]);const s=e.length,i=tn(s),o=t.map(u=>u[0]).join(","),a=t.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O4e{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const s=e.length,i=tn(s),o=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),l=ys("rc",s),u=ys("source",s),c=`${l[s-1]} < ${this.outputShape[s-1]}`,h=s===1?"source":`vec2(${u.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${c}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${c}) {`],f=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=s===1?2:4;m<g;m++)p+=`
        ${d[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${h});
        }
      `;p+=s===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;if(fe(s.shape)===0){const u=i.map((c,h)=>c[0]+s.shape[h]+c[1]);return Zy({backend:t,attrs:{shape:u,value:o,dtype:s.dtype}})}const a=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new O4e(s.shape,i,o):new P4e(s.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[s],s.dtype,l)},F4e={kernelName:V_,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,L4e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ld+`
  return result;
`,B4e=Vr({opSnippet:M4e,packedOpSnippet:L4e}),V4e={kernelName:fy,backendName:"webgl",kernelFunc:B4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=[],u=vt(i,s.shape);let c=u;const h=Tn(c,a);let d=s;h!=null&&(d=Ss({inputs:{x:s},backend:t,attrs:{perm:h}}),c=Gn(c.length,a),l.push(d)),Br("prod",c,a);let f;if(t.shouldExecuteOnCPU([d])){const p=t.texData.get(d.dataId).values,{outVals:m,outShape:g,outDtype:v}=B$e(d.shape,d.dtype,p,c);f=t.makeTensorInfo(g,v,m)}else{const[p,m]=Sr(d.shape,c),g=fe(m),v=Te({inputs:{x:d},backend:t,attrs:{shape:[-1,g]}}),y=nR(s.dtype),x=ud(v,y,"prod",t);f=Te({inputs:{x},backend:t,attrs:{shape:p}}),l.push(v),l.push(x)}if(o){l.push(f);const p=rr(f.shape,u);f=Te({inputs:{x:f},backend:t,attrs:{shape:p}})}return l.forEach(p=>t.disposeIntermediateTensorInfo(p)),f}const U4e={kernelName:U_,backendName:"webgl",kernelFunc:z4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4e(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(v=>t.readSync(v.dataId)),u=s.map(v=>v.shape),c=t.readSync(i.dataId),h=t.readSync(o.dataId),[d,f,p]=V$e(l,u,c,i.shape,i.dtype,h,o.shape,a),m=d.map(v=>t.makeTensorInfo([v.length],"int32",v)),g=t.makeTensorInfo(p,i.dtype,f);return m.concat([g])}const W4e={kernelName:Y6,backendName:"webgl",kernelFunc:j4e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4e(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,c]=z$e(o,r.shape,r.dtype,a,s.shape,l,i.shape),h=t.makeTensorInfo([u.length],"int32",u),d=t.makeTensorInfo([c.length],r.dtype,c);return[h,d]}const G4e={kernelName:Q6,backendName:"webgl",kernelFunc:H4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4e(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=t.readSync(s.dataId),c=t.readSync(i.dataId),h=t.readSync(o.dataId),d=a.map(g=>t.readSync(g.dataId)),f=a.map(g=>g.shape),[p,m]=U$e(u,s.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return t.makeTensorInfo(p,i.dtype,m)}const K4e={kernelName:J6,backendName:"webgl",kernelFunc:q4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:i,dtype:o}=t,a=j$e(r,s,i,o);return e.makeTensorInfo([a.length],o,a)},X4e={kernelName:WA,backendName:"webgl",kernelFunc:w7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y4e="return 1.0 / x;",Q4e=Rt({opSnippet:Y4e}),J4e={kernelName:py,backendName:"webgl",kernelFunc:Q4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4e=ho+`
  return (x < 0.0) ? 0.0 : x;
`,eBe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tBe=Rt({opSnippet:Z4e,packedOpSnippet:eBe}),nBe={kernelName:my,backendName:"webgl",kernelFunc:tBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rBe=ho+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,sBe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iBe=Rt({opSnippet:rBe,packedOpSnippet:sBe}),oBe={kernelName:gy,backendName:"webgl",kernelFunc:iBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aBe{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const c=[s&&t>1?a-1:a,s&&r>1?l-1:l],h=[s&&t>1?t-1:t,s&&r>1?r-1:r];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lBe{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const c=[s&&t>1?a-1:a,s&&r>1?l-1:l],h=[s&&t>1?t-1:t,s&&r>1?r-1:r];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uBe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,c=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new lBe(s.shape,l,u,i,o):new aBe(s.shape,l,u,i,o);return t.runWebGLProgram(c,[s],"float32")}const cBe={kernelName:H_,backendName:"webgl",kernelFunc:uBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hBe{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dBe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new hBe(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const fBe={kernelName:qA,backendName:"webgl",kernelFunc:dBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pBe{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const c=[s&&t>1?a-1:a,s&&r>1?l-1:l],h=[s&&t>1?t-1:t,s&&r>1?r-1:r],d=s?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mBe{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const c=[s&&t>1?a-1:a,s&&r>1?l-1:l],h=[s&&t>1?t-1:t,s&&r>1?r-1:r],d=s?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gBe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,c=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mBe(s.shape,l,u,i,o):new pBe(s.shape,l,u,i,o);return t.runWebGLProgram(c,[s],s.dtype)}const vBe={kernelName:W_,backendName:"webgl",kernelFunc:gBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yBe{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xBe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new yBe(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const bBe={kernelName:GA,backendName:"webgl",kernelFunc:xBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wBe{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>s(l)).join(","),o=tn(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Be{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=ys("rc",r),i=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,a=tn(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${i}){
            result.g = ${u(s.slice())};
          }
          if(${o}) {
            result.b = ${c(s.slice())};
            if(${i}) {
              result.a = ${h(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return d(p)}function u(p){return p[r-1]="("+p[r-1]+" + 1)",d(p)}function c(p){return p[r-2]="("+p[r-2]+" + 1)",d(p)}function h(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",d(p)}function d(p){const m=e.map((y,x)=>f(x,p)),g=m.join(","),v=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${v}))`}function f(p,m){return t.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kBe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r,o=s.shape.length,a=vt(i,s.shape);if(o===0)return ii({inputs:{x:s},backend:t});const l=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _Be(s.shape,a):new wBe(s.shape,a);return t.runWebGLProgram(l,[s],s.dtype)}const CBe={kernelName:G_,backendName:"webgl",kernelFunc:kBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IBe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SBe={kernelName:eR,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=new IBe(r.shape,i),[u,c]=KR(o,r.shape[1],r.shape[2]),h=[[u,c,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[r],r.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EBe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,TBe=Rt({opSnippet:EBe}),NBe={kernelName:vy,backendName:"webgl",kernelFunc:TBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ABe="return inversesqrt(x);",RBe=Rt({opSnippet:ABe,cpuKernelImpl:W$e}),DBe={kernelName:yy,backendName:"webgl",kernelFunc:RBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YD{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=tn(i.length),c=tn(o.length);let h="";r===1?h="i":r===2&&(h="i, j");const d=`getIndices(${h})`;let f="";s===1?f="i":s===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Be{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=tn(i.length),c=tn(o.length);let h="";r===1?h="i":r===2&&(h="i, j");const d=`getIndices(${h})`;let f="";s===1?f="i":s===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PBe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rd(i,s,o),d=[h/u,u];if(h===0)return t.makeTensorInfo(o,s.dtype);const f=Te({inputs:{x:s},backend:t,attrs:{shape:[l,a]}}),p=Te({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0]));let g;oe().getBool("WEBGL_PACK")?g=new $Be(l,a,f.shape.length,p.shape.length,c,d):g=new YD(l,a,f.shape.length,p.shape.length,c,d);const v=t.runWebGLProgram(g,[p,f,m],p.dtype),y=Te({inputs:{x:v},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m),y}const OBe={kernelName:Z6,backendName:"webgl",kernelFunc:PBe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FBe{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=oe().getNumber("WEBGL_VERSION")===2?i:o,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MBe(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=new FBe(s.shape[0],s.shape[1],i.shape[1],o),l=[[s.shape[1]]];return t.runWebGLProgram(a,[s,i],"int32",l)}const LBe={kernelName:t5,backendName:"webgl",kernelFunc:MBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BBe{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<t.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);s=l.join(),i=u.join()}const o=tn(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VBe(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e,o=new BBe(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(o,[r,s,i],ri(s.dtype,i.dtype))}const zBe={kernelName:q_,backendName:"webgl",kernelFunc:VBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UBe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${fk};
  float scale = ${pk};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,jBe=Rt({opSnippet:UBe}),WBe={kernelName:xy,backendName:"webgl",kernelFunc:jBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HBe=Fp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,GBe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qBe=Rt({opSnippet:HBe,packedOpSnippet:GBe,cpuKernelImpl:G$e}),KBe={kernelName:ky,backendName:"webgl",kernelFunc:qBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XBe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,YBe=Rt({opSnippet:XBe}),QBe={kernelName:_y,backendName:"webgl",kernelFunc:YBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JBe=Fp+`
  return sin(x);
`,ZBe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ld}
  return result;
`,eVe=Rt({opSnippet:JBe,packedOpSnippet:ZBe}),tVe={kernelName:by,backendName:"webgl",kernelFunc:eVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nVe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,rVe=Rt({opSnippet:nVe}),sVe={kernelName:wy,backendName:"webgl",kernelFunc:rVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iVe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,oVe=Rt({opSnippet:iVe}),aVe={kernelName:Cy,backendName:"webgl",kernelFunc:oVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lVe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;M(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((v,y)=>v*y),l=[[0,0]];l.push(...o);for(let v=1+i.length;v<s.shape.length;++v)l.push([0,0]);const u=[],c=b7({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),h=My(c.shape,i,a,!1),d=Ly(h.length,i.length,!1),f=By(c.shape,i,a,!1),p=Te({inputs:{x:c},backend:t,attrs:{shape:h}}),m=Ss({inputs:{x:p},backend:t,attrs:{perm:d}}),g=Te({inputs:{x:m},backend:t,attrs:{shape:f}});return u.push(c),u.push(p),u.push(m),u.forEach(v=>t.disposeIntermediateTensorInfo(v)),g},uVe={kernelName:Y_,backendName:"webgl",kernelFunc:lVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cVe(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(r.dataId),l=t.readSync(s.dataId),u=t.readSync(i.dataId),c=t.readSync(o.dataId)[0],[h,d,f,p,m]=K$e(a,r.shape,r.dtype,l,s.dtype,u,c);return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],s.dtype,f),t.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const hVe={kernelName:n5,backendName:"webgl",kernelFunc:cVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dVe(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(s.dataId)),a=t.readSync(r.dataId),l=Array.from(t.readSync(i.dataId)),[u,c,h]=X$e(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(c,r.dtype,u),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const fVe={kernelName:r5,backendName:"webgl",kernelFunc:dVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pVe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,c]=H9(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(c,r.dtype,u)}const mVe={kernelName:s5,backendName:"webgl",kernelFunc:pVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gVe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,c]=H9(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(c,r.dtype,u)}const vVe={kernelName:i5,backendName:"webgl",kernelFunc:gVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yVe(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=rd(i,s,a),f=!1;if(i.dtype==="string"){const v=t.bufferSync(s),y=t.bufferSync(i),x=ec(t.readSync(o.dataId)[0]),b=H$e(v,y,a,d,c,u,l,h,x,f);return t.makeTensorInfo(a,b.dtype,b.values)}const p=new YD(u,l,s.shape.length,i.shape.length,h,[d,1],f),m=t.runWebGLProgram(p,[i,s,o],i.dtype),g=Te({inputs:{x:m},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(m),g}const xVe={kernelName:o5,backendName:"webgl",kernelFunc:yVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bVe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=vt(o,s.shape)[0],l=uD(s,i,a),u=s.shape.length,c=new Array(u).fill(0),h=s.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const p=Mp({inputs:{x:s},backend:t,attrs:{begin:c,size:f}});return c[a]+=d,p})}const wVe={kernelName:Q_,backendName:"webgl",kernelFunc:bVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U4="return sqrt(x);",_Ve=Rt({opSnippet:U4,packedOpSnippet:U4,cpuKernelImpl:Y$e}),kVe={kernelName:Iy,backendName:"webgl",kernelFunc:_Ve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CVe="return x * x;",IVe=Rt({opSnippet:CVe}),SVe={kernelName:KA,backendName:"webgl",kernelFunc:IVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j4="return (a - b) * (a - b);",EVe=Vr({opSnippet:j4,packedOpSnippet:j4}),TVe={kernelName:Sy,backendName:"webgl",kernelFunc:EVe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NVe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(s.dataId),o=Sl(i),a=Q$e(o,"string",r);return t.makeTensorInfo(s.shape,"string",a)}const AVe={kernelName:XA,backendName:"webgl",kernelFunc:NVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RVe({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=ho+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new ca(r.shape,s);return t.runWebGLProgram(i,[r],r.dtype)}const DVe={kernelName:Ry,backendName:"webgl",kernelFunc:RVe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Ve{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,i=tn(r.length),o=tn(r.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=r.map((u,c)=>(l++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PVe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:y,end:x,strides:b}=HR(s.shape,i,o,a,l,u,c,h,d);let _;if(m)_=Te({inputs:{x:s},backend:t,attrs:{shape:p}});else if(g||v){M(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const I=UR(y,x,b),C=Mp({inputs:{x:s},backend:t,attrs:{begin:y,size:I}});_=Te({inputs:{x:C},backend:t,attrs:{shape:p}}),t.disposeIntermediateTensorInfo(C)}else if(t.shouldExecuteOnCPU([s])){const C=t.readSync(s.dataId),S=gt(s.shape,s.dtype,C),T=J$e(f,S,b,y);_=t.makeTensorInfo(p,s.dtype,T.values)}else{const C=new $Ve(y,b,f);_=t.runWebGLProgram(C,[s],s.dtype)}const E=Te({inputs:{x:_},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(_),E}const OVe={kernelName:YA,backendName:"webgl",kernelFunc:PVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FVe(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=e,d=t.readSync(c.dataId),f=t.readSync(h.dataId),[p,m]=Z$e(d,f,s,i,o,a,l,u);return[t.makeTensorInfo([p.length],"string",p),t.makeTensorInfo(h.shape,"int32",m)]}const MVe={kernelName:a5,backendName:"webgl",kernelFunc:FVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LVe(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,c,h]=ePe(a,l,s),d=c.length;return[t.makeTensorInfo([d,2],"int32",u),t.makeTensorInfo([d],"string",c),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const BVe={kernelName:l5,backendName:"webgl",kernelFunc:LVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VVe(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=tPe(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const zVe={kernelName:u5,backendName:"webgl",kernelFunc:VVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UVe="return tan(x);",jVe=Rt({opSnippet:UVe}),WVe={kernelName:Ty,backendName:"webgl",kernelFunc:jVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HVe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,GVe=Rt({opSnippet:HVe}),qVe={kernelName:Ny,backendName:"webgl",kernelFunc:GVe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KVe(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rd(o,i,s.shape),d=[h/u,u];if(h===0)return t.makeTensorInfo(s.shape,i.dtype);const f=Te({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),p=Te({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),m=Te({inputs:{x:s},backend:t,attrs:{shape:d}}),g=new YD(l,a,f.shape.length,p.shape.length,c,d,!1,!0),v=t.runWebGLProgram(g,[p,f,m],m.dtype),y=Te({inputs:{x:v},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),y}const XVe={kernelName:e5,backendName:"webgl",kernelFunc:KVe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YVe{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*t[o];this.outputShape=r,this.rank=r.length;const s=tn(this.rank),i=QVe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function QVe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;if(s.dtype==="string"||s.shape.length>5){const l=t.readSync(s.dataId),u=s.dtype==="string"?l.map(d=>ec(d)):l,c=gt(s.shape,s.dtype,u),h=rPe(c,i);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new YVe(s.shape,i);return t.runWebGLProgram(o,[s],s.dtype)}const JVe={kernelName:Ay,backendName:"webgl",kernelFunc:_7};class ZVe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class eze{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pc(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function W4(n){let e=1;for(;e<n;)e*=2;return e}function tze(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r,a=oe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=oe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=s.shape,c=u[u.length-1];if(t.shouldExecuteOnCPU([s])||c<a||i>l){const T=t.readSync(s.dataId),[N,R]=sPe(T,u,s.dtype,i,o);return[t.makeTensorInfo(N.shape,N.dtype,N.values),t.makeTensorInfo(R.shape,R.dtype,R.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,s.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(c===1)return[s,Zy({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const h=t.texData.get(s.dataId),d=h!==null&&h.isPacked,f=d?t.unpackTensor(s):s,m=fe(u)/c,g=Te({inputs:{x:f},attrs:{shape:[m,c]},backend:t});d&&Pc(t,f);const v=W4(i),y=W4(c);let x=null;const b=()=>x===null?[g,g]:[g,x],_=(T,N,R)=>{const D=b(),z=new ZVe(R),O=[[c],[x===null?1:0],[Number.NEGATIVE_INFINITY],[T],[N]],F=x;x=t.runWebGLProgram(z,D,"int32",O),Pc(t,F)};for(let T=1;T<v;T*=2){const N=T*2;for(let R=T;R>=1;R/=2)_(N,R,[m,y])}for(let T=y;T>v;T/=2){const N=b(),R=new eze([m,T/2]),z=[[c],[x===null?1:0],[v]],L=x;x=t.runWebGLProgram(R,N,"int32",z),Pc(t,L);const O=v/2,F=O*2;for(let P=O;P>=1;P/=2)_(F,P,x.shape)}let E=x;x=Mp({inputs:{x},backend:t,attrs:{begin:0,size:[m,i]}}),Pc(t,E);let I=p7({inputs:{x:g,indices:x},backend:t,attrs:{axis:1,batchDims:1}});Pc(t,g);const C=u.slice(0,-1);C.push(i),E=x,x=Te({inputs:{x},attrs:{shape:C},backend:t}),Pc(t,E);const S=I;return I=Te({inputs:{x:I},attrs:{shape:C},backend:t}),Pc(t,S),[I,x]}const nze={kernelName:QA,backendName:"webgl",kernelFunc:tze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rze{constructor(e,t,r,s,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sze(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=r,[c,h,d,f]=s.shape,[p,m]=u??[h,d],g=[c,p,m,f],v=new rze(h,d,o,a,l,g);return t.runWebGLProgram(v,[s,i],"float32")}const ize={kernelName:JA,backendName:"webgl",kernelFunc:sze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oze(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Yy(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=iPe(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const aze={kernelName:ZA,backendName:"webgl",kernelFunc:oze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lze(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s,a=o.shape.length,l=s.shape[i],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==i&&(u[c++]=o.shape[m]);const h=[],d=new Array(a).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(l);for(let m=0;m<p.length;m++){d[i]=m;const g=Mp({inputs:{x:o},backend:t,attrs:{begin:d,size:f}}),v=Te({inputs:{x:g},backend:t,attrs:{shape:u}});p[m]=v,h.push(g)}return h.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const uze={kernelName:Z_,backendName:"webgl",kernelFunc:lze};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cze{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/r);this.outputShape=[s,a];const l="0.0",u="sumValue",c=Math.floor(r/4)*4,h=r%4,d=`
        sumValue += dot(values, segFilter);
    `;let f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hze(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r,a=s.shape.length,l=[];let u=0;const c=Tn([u],a);let h=s;c!=null&&(h=Ss({inputs:{x:s},backend:t,attrs:{perm:c}}),l.push(h),u=Gn(1,a)[0]);const d=rG(h.shape,u,o),f=fe([h.shape[u]]),p=Te({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}});l.push(p);const m=nR(s.dtype),g=(b,_,E,I,C)=>{const S=b.shape[0],T=b.shape[1],N=nG(T,C),R={windowSize:N,inSize:T,batchSize:S,numSegments:C},D=new cze(R,_),z=t.compileAndRun(D,[b,E],I);if(l.push(z),z.shape[1]===C)return z;const L=w7({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),O=_7({inputs:{x:L},backend:t,attrs:{reps:[T/N]}});return l.push(L),l.push(O),g(z,_,O,I,C)},v=g(p,"unsortedSegmentSum",i,m,o),y=Te({inputs:{x:v},backend:t,attrs:{shape:d}});let x=y;if(c!=null){l.push(y);const b=fc(c);x=Ss({inputs:{x},backend:t,attrs:{perm:b}})}return l.forEach(b=>t.disposeIntermediateTensorInfo(b)),x}const dze={kernelName:ek,backendName:"webgl",kernelFunc:hze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fze=[YPe,JPe,tOe,sOe,oOe,uOe,hOe,fOe,vOe,xOe,_Oe,IOe,TOe,DOe,OOe,MOe,BOe,jOe,HOe,qOe,QOe,sFe,oFe,cFe,dFe,yFe,bFe,CFe,$Pe,EFe,DFe,FFe,UFe,HFe,qFe,XFe,QFe,tMe,sMe,aMe,uMe,hMe,fMe,gMe,yMe,_Me,CMe,EMe,AMe,DMe,FMe,VMe,WMe,qMe,YMe,QMe,ZMe,tLe,rLe,iLe,aLe,hLe,pLe,vLe,xLe,_Le,ILe,NLe,$Le,DPe,OLe,AFe,LLe,zLe,WLe,OPe,KLe,JLe,e3e,s3e,a3e,h3e,p3e,y3e,_3e,I3e,E3e,R3e,$3e,O3e,B3e,z3e,j3e,H3e,q3e,Q3e,t4e,i4e,f4e,LPe,v4e,b4e,k4e,S4e,pFe,N4e,R4e,$4e,F4e,V4e,MPe,U4e,W4e,G4e,K4e,X4e,mFe,u4e,J4e,nBe,oBe,VPe,cBe,fBe,vBe,bBe,CBe,SBe,NBe,DBe,OBe,LBe,zBe,WBe,KBe,QBe,tVe,sVe,nFe,h4e,aVe,uVe,hVe,fVe,mVe,vVe,xVe,wVe,kVe,SVe,TVe,AVe,DVe,OVe,MVe,BVe,zVe,c4e,qPe,WVe,qVe,XVe,JVe,nze,ize,KPe,aze,uze,dze,A4e];for(const n of fze)h5(n);const pze=(n,e)=>{if(!n||!e)return 0;const[t,r]=n.split(":").map(Number),[s,i]=e.split(":").map(Number);let o=s-t+(i-r)/60;return o<0&&(o+=24),o},mze=async(n,e,t)=>{let r=100;n<6&&(r-=20),n>9&&(r-=15),r-=e*5;const s=t.reduce((l,u)=>l+u.duration,0)/t.length,i=[];n<s?i.push("Your sleep duration was shorter than your average"):n>s&&i.push("Your sleep duration was longer than your average"),e>5&&i.push("You experienced significant restlessness during sleep");const o=[];n<7&&o.push("Try to get at least 7-8 hours of sleep"),e>5&&(o.push("Consider reducing screen time before bed"),o.push("Try relaxation exercises before sleep"));let a;return r>=80?a="Good":r>=60?a="Average":a="Poor",{score:Math.max(0,Math.min(100,r)),quality:a,duration:n,insights:i,recommendations:o}},gze=n=>{const e=[{icon:"moon",title:"Consistent Bedtime",description:"Go to bed and wake up at the same time every day to regulate your sleep cycle."},{icon:"coffee",title:"Limit Caffeine",description:"Avoid caffeine in the afternoon and evening to improve sleep quality."},{icon:"exercise",title:"Regular Exercise",description:"Engage in physical activity during the day, but avoid intense workouts close to bedtime."},{icon:"meditation",title:"Relaxation Techniques",description:"Practice meditation or deep breathing exercises before bed to reduce stress."},{icon:"book",title:"Reading",description:"Read a physical book instead of using electronic devices before sleep."},{icon:"phone",title:"Digital Detox",description:"Avoid screens at least 1 hour before bedtime to improve sleep quality."}];return n<60&&(e.push({icon:"bed",title:"Sleep Environment",description:"Create a dark, quiet, and cool sleeping environment (65-67°F/18-19°C)."}),e.push({icon:"alarm",title:"Morning Routine",description:"Expose yourself to natural light in the morning to help regulate your circadian rhythm."})),e};function vze(){var v,y;const[n,e]=q.useState(85),[t,r]=q.useState(7.5),[s,i]=q.useState(null),[o,a]=q.useState([]),[l,u]=q.useState({bedtime:"",wakeTime:"",restlessness:0}),[c,h]=q.useState(null),[d,f]=q.useState(!1);q.useEffect(()=>{const x=JN(Sh(l3,"sleepRecords"),nA("timestamp","desc"),Kge(7)),b=oA(x,_=>{const E=_.docs.map(I=>({...I.data(),timestamp:I.data().timestamp.toDate().toISOString()}));a(E)},_=>{console.error("Error fetching sleep data:",_)});return()=>b()},[]);const p=x=>{const{name:b,value:_}=x.target;u(E=>({...E,[b]:_}))},m=async()=>{try{f(!0);const x=pze(l.bedtime||"",l.wakeTime||""),b=Math.max(0,100-Number(l.restlessness)*10),_={bedtime:l.bedtime||"",wakeTime:l.wakeTime||"",restlessness:l.restlessness||0,timestamp:new Date().toISOString(),sleepHours:x,quality:b};await iA(Sh(l3,"sleepRecords"),_),a(C=>[_,...C].slice(0,7)),u({bedtime:"",wakeTime:"",restlessness:0});const E=o.map(C=>({duration:C.sleepHours,restlessness:C.restlessness})),I=await mze(x,_.restlessness,E);h(I),e(I.score),r(x)}catch(x){console.error("Error saving sleep data:",x),alert("Error saving sleep data. Please try again.")}finally{f(!1)}},g=x=>{switch(x){case"moon":return k.jsx(ah,{className:"h-5 w-5 text-purple-300"});case"sun":return k.jsx(QZ,{className:"h-5 w-5 text-purple-300"});case"coffee":return k.jsx(zZ,{className:"h-5 w-5 text-purple-300"});case"exercise":return k.jsx(UZ,{className:"h-5 w-5 text-purple-300"});case"meditation":return k.jsx(LT,{className:"h-5 w-5 text-purple-300"});case"book":return k.jsx(BZ,{className:"h-5 w-5 text-purple-300"});case"phone":return k.jsx(EU,{className:"h-5 w-5 text-purple-300"});case"bed":return k.jsx(FZ,{className:"h-5 w-5 text-purple-300"});case"alarm":return k.jsx(JZ,{className:"h-5 w-5 text-purple-300"});case"food":return k.jsx(ZZ,{className:"h-5 w-5 text-purple-300"});default:return k.jsx(ah,{className:"h-5 w-5 text-purple-300"})}};return k.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900",children:k.jsxs("div",{className:"container mx-auto px-4 py-8",children:[k.jsxs("header",{className:"flex justify-between items-center mb-8",children:[k.jsxs("div",{className:"flex items-center space-x-2",children:[k.jsx(ah,{className:"h-8 w-8 text-purple-300"}),k.jsx("h1",{className:"text-2xl font-bold text-white",children:"DreamTrack"})]}),k.jsxs("div",{className:"flex items-center space-x-4",children:[k.jsx(MZ,{className:"h-6 w-6 text-purple-300 cursor-pointer hover:text-purple-200"}),k.jsx(YZ,{className:"h-6 w-6 text-purple-300 cursor-pointer hover:text-purple-200"})]})]}),k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white mb-6",children:[k.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Record Your Sleep"}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[k.jsxs("div",{children:[k.jsx("label",{className:"block text-sm mb-2",children:"Bedtime"}),k.jsx("input",{type:"time",name:"bedtime",value:l.bedtime,onChange:p,className:"w-full bg-white/5 border border-purple-300/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-300"})]}),k.jsxs("div",{children:[k.jsx("label",{className:"block text-sm mb-2",children:"Wake Time"}),k.jsx("input",{type:"time",name:"wakeTime",value:l.wakeTime,onChange:p,className:"w-full bg-white/5 border border-purple-300/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-300"})]}),k.jsxs("div",{children:[k.jsx("label",{className:"block text-sm mb-2",children:"Restlessness (0-10)"}),k.jsx("input",{type:"number",name:"restlessness",value:l.restlessness,onChange:p,min:"0",max:"10",className:"w-full bg-white/5 border border-purple-300/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-300"})]})]}),k.jsx("button",{onClick:m,disabled:!l.bedtime||!l.wakeTime||d,className:`mt-4 bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition-colors duration-200 ${d?"opacity-50 cursor-not-allowed":""}`,children:d?"Analyzing...":"Save & Analyze"})]}),c&&k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white mb-6 transform transition-all duration-500 ",children:[k.jsxs("div",{className:"flex items-center justify-between mb-6",children:[k.jsxs("h2",{className:"text-xl font-semibold flex items-center space-x-2",children:[k.jsx(zT,{className:"h-6 w-6 text-yellow-400"}),k.jsx("span",{children:"Sleep Analysis"})]}),k.jsx("div",{className:"text-sm text-purple-300",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[k.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-purple-300/20",children:[k.jsxs("h3",{className:"text-md font-medium mb-4 flex items-center space-x-2",children:[k.jsx(cl,{className:"h-5 w-5 text-purple-300"}),k.jsx("span",{children:"Quality Assessment"})]}),k.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[k.jsx("div",{className:`w-4 h-4 rounded-full ${c.quality==="Good"?"bg-green-400 animate-pulse":c.quality==="Average"?"bg-yellow-400 animate-pulse":"bg-red-400 animate-pulse"}`}),k.jsxs("span",{className:"text-lg font-medium",children:[c.quality," Quality"]})]}),k.jsxs("div",{className:"relative",children:[k.jsx("div",{className:"text-4xl font-bold mb-1",children:c.score}),k.jsx("div",{className:"text-purple-300",children:"Sleep Score"}),k.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 opacity-10",children:k.jsx(cl,{className:"w-full h-full"})})]})]}),k.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-purple-300/20",children:[k.jsxs("h3",{className:"text-md font-medium mb-4 flex items-center space-x-2",children:[k.jsx(dF,{className:"h-5 w-5 text-purple-300"}),k.jsx("span",{children:"Key Insights"})]}),k.jsx("ul",{className:"space-y-3",children:c.insights.map((x,b)=>k.jsxs("li",{className:"flex items-start space-x-3 group",children:[k.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-300 mt-2 group-hover:bg-purple-400 transition-colors"}),k.jsx("span",{className:"text-sm leading-relaxed",children:x})]},b))})]}),k.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-purple-300/20 md:col-span-2",children:[k.jsxs("h3",{className:"text-md font-medium mb-4 flex items-center space-x-2",children:[k.jsx(YI,{className:"h-5 w-5 text-purple-300"}),k.jsx("span",{children:"Personalized Recommendations"})]}),k.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.recommendations.map((x,b)=>k.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[k.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500/20 flex items-center justify-center",children:k.jsx(YI,{className:"h-4 w-4 text-purple-300"})}),k.jsx("span",{className:"text-sm leading-relaxed",children:x})]},b))})]})]}),k.jsx("div",{className:"mt-6 pt-6 border-t border-purple-300/20",children:k.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[k.jsxs("div",{className:"text-center",children:[k.jsxs("div",{className:"text-2xl font-bold",children:[c.duration.toFixed(1),"h"]}),k.jsx("div",{className:"text-sm text-purple-300",children:"Sleep Duration"})]}),k.jsxs("div",{className:"text-center",children:[k.jsx("div",{className:"text-2xl font-bold",children:o.length}),k.jsx("div",{className:"text-sm text-purple-300",children:"Days Recorded"})]}),k.jsxs("div",{className:"text-center",children:[k.jsxs("div",{className:"text-2xl font-bold",children:[(o.reduce((x,b)=>x+b.sleepHours,0)/o.length||0).toFixed(1),"h"]}),k.jsx("div",{className:"text-sm text-purple-300",children:"Weekly Average"})]}),k.jsxs("div",{className:"text-center",children:[k.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(o.reduce((x,b)=>x+b.quality,0)/o.length||0),"%"]}),k.jsx("div",{className:"text-sm text-purple-300",children:"Avg Quality"})]})]})})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white",children:[k.jsxs("div",{className:"flex justify-between items-center mb-4",children:[k.jsx("h2",{className:"text-lg font-semibold",children:"Sleep Score"}),k.jsx(cl,{className:"h-5 w-5 text-purple-300"})]}),k.jsx("div",{className:"text-4xl font-bold mb-2",children:n}),k.jsx("div",{className:"text-purple-300",children:"Good sleep quality"})]}),k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white",children:[k.jsxs("div",{className:"flex justify-between items-center mb-4",children:[k.jsx("h2",{className:"text-lg font-semibold",children:"Last Night"}),k.jsx(cp,{className:"h-5 w-5 text-purple-300"})]}),k.jsxs("div",{className:"text-4xl font-bold mb-2",children:[t.toFixed(1),"h"]}),k.jsxs("div",{className:"text-purple-300",children:[(v=o[0])==null?void 0:v.bedtime," - ",(y=o[0])==null?void 0:y.wakeTime]})]}),k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white",children:[k.jsxs("div",{className:"flex justify-between items-center mb-4",children:[k.jsx("h2",{className:"text-lg font-semibold",children:"Weekly Average"}),k.jsx(OZ,{className:"h-5 w-5 text-purple-300"})]}),k.jsxs("div",{className:"text-4xl font-bold mb-2",children:[(o.reduce((x,b)=>x+b.sleepHours,0)/o.length||0).toFixed(1),"h"]}),k.jsxs("div",{className:"text-purple-300",children:[o.length," days recorded"]})]}),k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white col-span-full",children:[k.jsxs("div",{className:"flex justify-between items-center mb-6",children:[k.jsx("h2",{className:"text-lg font-semibold",children:"Sleep Pattern Analysis"}),k.jsx(BT,{className:"h-5 w-5 text-purple-300"})]}),k.jsxs("div",{className:"relative",children:[k.jsx("div",{className:"h-48 flex items-end justify-between space-x-2",children:o.map((x,b)=>k.jsxs("div",{className:"flex-1 relative group",onMouseEnter:()=>i(b),onMouseLeave:()=>i(null),children:[k.jsx("div",{className:`${s===b?"bg-purple-400/80":"bg-purple-400/50"} rounded-t-sm transition-all duration-300 cursor-pointer`,style:{height:`${x.quality}%`}}),k.jsxs("div",{className:`
                      absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2
                      bg-white/90 text-purple-900 p-2 rounded-lg shadow-lg
                      transition-opacity duration-200 text-sm whitespace-nowrap
                      ${s===b?"opacity-100":"opacity-0 pointer-events-none"}
                    `,children:[k.jsx("div",{className:"font-semibold",children:new Date(x.timestamp).toLocaleDateString("en-US",{weekday:"short"})}),k.jsxs("div",{children:["Sleep: ",x.sleepHours.toFixed(1),"h"]}),k.jsxs("div",{children:["Quality: ",x.quality,"%"]}),k.jsxs("div",{className:"text-xs",children:[x.bedtime," - ",x.wakeTime]})]})]},b))}),k.jsxs("div",{className:"absolute left-0 top-0 h-full flex flex-col justify-between -ml-6 text-xs text-purple-300",children:[k.jsx("span",{children:"100%"}),k.jsx("span",{children:"75%"}),k.jsx("span",{children:"50%"}),k.jsx("span",{children:"25%"}),k.jsx("span",{children:"0%"})]})]}),k.jsx("div",{className:"flex justify-between mt-2 text-purple-300 text-sm",children:o.map((x,b)=>k.jsx("span",{className:`${s===b?"text-white":"text-purple-300"} transition-colors duration-300`,children:new Date(x.timestamp).toLocaleDateString("en-US",{weekday:"short"})},b))})]}),k.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 text-white col-span-full",children:[k.jsxs("div",{className:"flex items-center justify-between mb-6",children:[k.jsxs("h2",{className:"text-lg font-semibold flex items-center space-x-2",children:[k.jsx(dF,{className:"h-5 w-5 text-yellow-400"}),k.jsx("span",{children:"Personalized Sleep Tips"})]}),k.jsxs("div",{className:"text-sm text-purple-300",children:["Based on your sleep score: ",n]})]}),k.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:gze(n).map((x,b)=>k.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-300 transform hover:scale-[1.02]",children:[k.jsx("div",{className:"flex-shrink-0",children:g(x.icon)}),k.jsxs("div",{children:[k.jsx("h3",{className:"font-semibold mb-1",children:x.title}),k.jsx("p",{className:"text-purple-300 text-sm leading-relaxed",children:x.description})]})]},b))})]})]})]})})}const k7=()=>{const[n,e]=q.useState(!1),[t,r]=q.useState(!1),[s,i]=q.useState("inhale"),[o,a]=q.useState(0),[l,u]=q.useState(0),c=q.useRef(null),h=q.useRef(null);q.useEffect(()=>()=>{c.current&&clearTimeout(c.current),h.current&&cancelAnimationFrame(h.current)},[]);const d=y=>{const x=performance.now(),b=_=>{const E=_-x,I=E/y*100;a(Math.min(I,100)),E<y&&(h.current=requestAnimationFrame(b))};h.current=requestAnimationFrame(b)},f=()=>{e(!0),r(!0),u(y=>y+1),i("inhale"),d(4e3),c.current=setTimeout(()=>{i("hold"),d(7e3),c.current=setTimeout(()=>{i("exhale"),d(8e3),c.current=setTimeout(()=>{a(0),t?f():e(!1)},8e3)},7e3)},4e3)},p=()=>{r(!1),e(!1),c.current&&clearTimeout(c.current),h.current&&cancelAnimationFrame(h.current),a(0)},m=()=>{p(),u(0),i("inhale")},v=(()=>{switch(s){case"inhale":return{duration:4,text:"Inhale",color:"text-blue-600",bgColor:"bg-blue-600",instruction:"Breathe in slowly through your nose"};case"hold":return{duration:7,text:"Hold",color:"text-green-600",bgColor:"bg-green-600",instruction:"Hold your breath"};case"exhale":return{duration:8,text:"Exhale",color:"text-purple-600",bgColor:"bg-purple-600",instruction:"Breathe out slowly through your mouth"};default:return{duration:4,text:"Inhale",color:"text-blue-600",bgColor:"bg-blue-600",instruction:"Breathe in slowly through your nose"}}})();return k.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[k.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"4-7-8 Breathing Technique"}),k.jsx("p",{className:"text-gray-600 mb-4",children:"This breathing pattern can help reduce anxiety and help you sleep better. Inhale for 4 seconds, hold for 7 seconds, and exhale for 8 seconds."})]}),k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[k.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-8",children:[k.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),k.jsx("div",{className:`absolute inset-0 rounded-full border-4 ${v.bgColor} transition-all duration-300`,style:{clipPath:`polygon(50% 50%, 50% 0%, ${o}% 0%, ${o}% 100%, 50% 100%, 50% 50%)`,transform:`rotate(${o*3.6}deg)`}}),k.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:k.jsxs("div",{children:[k.jsx("p",{className:`text-3xl font-bold ${v.color}`,children:v.text}),k.jsxs("p",{className:"text-gray-500 text-sm mt-2",children:[v.duration," seconds"]}),k.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v.instruction})]})})]}),k.jsxs("div",{className:"flex justify-center space-x-4",children:[n?k.jsxs("button",{onClick:p,className:"flex items-center px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[k.jsx(SU,{className:"h-5 w-5 mr-2"})," Stop"]}):k.jsxs("button",{onClick:f,className:"flex items-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[k.jsx(XI,{className:"h-5 w-5 mr-2"})," Start Breathing"]}),k.jsxs("button",{onClick:m,className:"flex items-center px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[k.jsx(TU,{className:"h-5 w-5 mr-2"})," Reset"]})]}),l>0&&k.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Completed cycles: ",l]})]})]})};function yze(){return k.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:k.jsxs("div",{className:"max-w-7xl mx-auto",children:[k.jsxs("div",{className:"text-center",children:[k.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-8",children:"Welcome to Your AI Meditation Coach"}),k.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Begin your journey to mindfulness and inner peace"}),k.jsx(Ui,{to:"/features/guided-wellness/session",className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors",children:"Start Session"})]}),k.jsxs("div",{className:"mt-16",children:[k.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6 text-center",children:"Quick Breathing Exercise"}),k.jsx("div",{className:"max-w-md mx-auto",children:k.jsx(k7,{})})]})]})})}const xze=({duration:n,onComplete:e})=>{const[t,r]=q.useState(n*60),[s,i]=q.useState(!1),[o,a]=q.useState(!1),l=q.useRef(null),u=q.useRef(null),c=q.useRef(null);q.useEffect(()=>()=>{l.current&&clearInterval(l.current)},[]);const h=()=>{i(!0),a(!1),u.current=Date.now(),c.current=null,l.current=setInterval(()=>{r(g=>g<=1?(l.current&&clearInterval(l.current),i(!1),e(),0):g-1)},1e3)},d=()=>{a(!0),l.current&&clearInterval(l.current),c.current=Date.now()},f=()=>{if(a(!1),u.current&&c.current){const g=c.current-u.current;u.current=Date.now()-g}l.current=setInterval(()=>{r(g=>g<=1?(l.current&&clearInterval(l.current),i(!1),e(),0):g-1)},1e3)},p=()=>{l.current&&clearInterval(l.current),i(!1),a(!1),r(n*60),u.current=null,c.current=null},m=g=>{const v=Math.floor(g/60),y=g%60;return`${v}:${y.toString().padStart(2,"0")}`};return k.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[k.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Silent Meditation"}),k.jsx("p",{className:"text-gray-600 mb-4",children:"Find a quiet space and focus on your breath. Let thoughts come and go without judgment."})]}),k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[k.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-8",children:[k.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),k.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-indigo-600 transition-all duration-300",style:{clipPath:`polygon(50% 50%, 50% 0%, ${(n*60-t)/(n*60)*100}% 0%, ${(n*60-t)/(n*60)*100}% 100%, 50% 100%, 50% 50%)`,transform:`rotate(${(n*60-t)/(n*60)*360}deg)`}}),k.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:k.jsxs("div",{children:[k.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:m(t)}),k.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Time Remaining"})]})})]}),k.jsxs("div",{className:"flex justify-center space-x-4",children:[s?o?k.jsxs("button",{onClick:f,className:"flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[k.jsx(XI,{className:"h-5 w-5 mr-2"})," Resume"]}):k.jsxs("button",{onClick:d,className:"flex items-center px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:[k.jsx(SU,{className:"h-5 w-5 mr-2"})," Pause"]}):k.jsxs("button",{onClick:h,className:"flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[k.jsx(XI,{className:"h-5 w-5 mr-2"})," Start Meditation"]}),k.jsxs("button",{onClick:p,className:"flex items-center px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[k.jsx(TU,{className:"h-5 w-5 mr-2"})," Reset"]})]}),k.jsx("div",{className:"mt-4",children:k.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:k.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${(n*60-t)/(n*60)*100}%`}})})})]})]})};function C7({recommendation:n,onComplete:e}){const[t,r]=q.useState(!1),[s,i]=q.useState(n.duration*60),o=q.useRef(null),a=q.useRef(null);q.useEffect(()=>(o.current=window.speechSynthesis,()=>{var f;a.current&&clearInterval(a.current),(f=o.current)==null||f.cancel()}),[]);const l=f=>{if(!o.current)return;const p=new SpeechSynthesisUtterance(f);p.rate=.8,p.pitch=1,p.volume=1,o.current.speak(p)},u=()=>{r(!0),l(`Let's begin ${n.title}. ${n.description}`),a.current=setInterval(()=>{i(f=>f<=1?(a.current&&clearInterval(a.current),r(!1),l("Session complete. Great job!"),e(),0):f-1)},1e3)},c=()=>{var f;r(!1),a.current&&clearInterval(a.current),(f=o.current)==null||f.pause()},h=()=>{var f;r(!0),a.current=setInterval(()=>{i(p=>p<=1?(a.current&&clearInterval(a.current),r(!1),l("Session complete. Great job!"),e(),0):p-1)},1e3),(f=o.current)==null||f.resume()},d=f=>{const p=Math.floor(f/60),m=f%60;return`${p}:${m.toString().padStart(2,"0")}`};return k.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 space-y-6",children:[k.jsxs("div",{className:"text-center",children:[k.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:n.title}),k.jsx("p",{className:"mt-2 text-gray-600",children:n.description}),k.jsx("div",{className:"mt-4 text-4xl font-mono text-indigo-600",children:d(s)})]}),k.jsx("div",{className:"flex justify-center space-x-4",children:t?k.jsx("button",{onClick:c,className:"px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:"Pause Session"}):s===n.duration*60?k.jsx("button",{onClick:u,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Start Session"}):k.jsx("button",{onClick:h,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Resume Session"})}),k.jsx("div",{className:"mt-4",children:k.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:k.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${(n.duration*60-s)/(n.duration*60)*100}%`}})})})]})}function QD(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function I7(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bze=I7,S7=new Nv("auth","Firebase",I7());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw=new mN("@firebase/auth");function wze(n,...e){jw.logLevel<=Et.WARN&&jw.warn(`Auth (${mp}): ${n}`,...e)}function mb(n,...e){jw.logLevel<=Et.ERROR&&jw.error(`Auth (${mp}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(n,...e){throw JD(n,...e)}function _a(n,...e){return JD(n,...e)}function E7(n,e,t){const r=Object.assign(Object.assign({},bze()),{[e]:t});return new Nv("auth","Firebase",r).create(e,{appName:n.name})}function fh(n){return E7(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function JD(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return S7.create(n,...e)}function ot(n,e,...t){if(!n)throw JD(e,...t)}function ol(n){const e="INTERNAL ASSERTION FAILED: "+n;throw mb(e),new Error(e)}function Tl(n,e){n||ol(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function _ze(){return H4()==="http:"||H4()==="https:"}function H4(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kze(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_ze()||kde()||"connection"in navigator)?navigator.onLine:!0}function Cze(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t){this.shortDelay=e,this.longDelay=t,Tl(t>e,"Short delay should be less than long delay!"),this.isMobile=bde()||Cde()}get(){return kze()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(n,e){Tl(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T7{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ol("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ol("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ol("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ize={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sze=new ex(3e4,6e4);function e$(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Lp(n,e,t,r,s={}){return N7(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Av(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u=Object.assign({method:e,headers:l},i);return _de()||(u.referrerPolicy="no-referrer"),T7.fetch()(A7(n,n.config.apiHost,t,a),u)})}async function N7(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Ize),e);try{const s=new Tze(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw I0(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw I0(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw I0(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw I0(n,"user-disabled",o);const c=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw E7(n,c,u);El(n,c)}}catch(s){if(s instanceof Pl)throw s;El(n,"network-request-failed",{message:String(s)})}}async function Eze(n,e,t,r,s={}){const i=await Lp(n,e,t,r,s);return"mfaPendingCredential"in i&&El(n,"multi-factor-auth-required",{_serverResponse:i}),i}function A7(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?ZD(n.config,s):`${n.config.apiScheme}://${s}`}class Tze{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(_a(this.auth,"network-request-failed")),Sze.get())})}}function I0(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=_a(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nze(n,e){return Lp(n,"POST","/v1/accounts:delete",e)}async function R7(n,e){return Lp(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Aze(n,e=!1){const t=Si(n),r=await t.getIdToken(e),s=t$(r);ot(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ug(E2(s.auth_time)),issuedAtTime:ug(E2(s.iat)),expirationTime:ug(E2(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function E2(n){return Number(n)*1e3}function t$(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return mb("JWT malformed, contained fewer than 3 sections"),null;try{const s=qj(t);return s?JSON.parse(s):(mb("Failed to decode base64 JWT payload"),null)}catch(s){return mb("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function G4(n){const e=t$(n);return ot(e,"internal-error"),ot(typeof e.exp<"u","internal-error"),ot(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function av(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Pl&&Rze(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Rze({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dze{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ug(this.lastLoginAt),this.creationTime=ug(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ww(n){var e;const t=n.auth,r=await n.getIdToken(),s=await av(n,R7(t,{idToken:r}));ot(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?D7(i.providerUserInfo):[],a=Pze(n.providerData,o),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),c=l?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new xE(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(n,h)}async function $ze(n){const e=Si(n);await Ww(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Pze(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function D7(n){return n.map(e=>{var{providerId:t}=e,r=QD(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oze(n,e){const t=await N7(n,{},async()=>{const r=Av({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=A7(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",T7.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Fze(n,e){return Lp(n,"POST","/v2/accounts:revokeToken",e$(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ot(e.idToken,"internal-error"),ot(typeof e.idToken<"u","internal-error"),ot(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):G4(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ot(e.length!==0,"internal-error");const t=G4(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ot(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Oze(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new mf;return r&&(ot(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ot(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ot(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mf,this.toJSON())}_performRefresh(){return ol("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jl(n,e){ot(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class al{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=QD(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Dze(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new xE(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await av(this,this.stsTokenManager.getToken(this.auth,e));return ot(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Aze(this,e)}reload(){return $ze(this)}_assign(e){this!==e&&(ot(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new al(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ot(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ww(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(aa(this.auth.app))return Promise.reject(fh(this.auth));const e=await this.getIdToken();return await av(this,Nze(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,u,c;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,d=(s=t.email)!==null&&s!==void 0?s:void 0,f=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,m=(a=t.tenantId)!==null&&a!==void 0?a:void 0,g=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,v=(u=t.createdAt)!==null&&u!==void 0?u:void 0,y=(c=t.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:x,emailVerified:b,isAnonymous:_,providerData:E,stsTokenManager:I}=t;ot(x&&I,e,"internal-error");const C=mf.fromJSON(this.name,I);ot(typeof x=="string",e,"internal-error"),Jl(h,e.name),Jl(d,e.name),ot(typeof b=="boolean",e,"internal-error"),ot(typeof _=="boolean",e,"internal-error"),Jl(f,e.name),Jl(p,e.name),Jl(m,e.name),Jl(g,e.name),Jl(v,e.name),Jl(y,e.name);const S=new al({uid:x,auth:e,email:d,emailVerified:b,displayName:h,isAnonymous:_,photoURL:p,phoneNumber:f,tenantId:m,stsTokenManager:C,createdAt:v,lastLoginAt:y});return E&&Array.isArray(E)&&(S.providerData=E.map(T=>Object.assign({},T))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,r=!1){const s=new mf;s.updateFromServerResponse(t);const i=new al({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ww(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ot(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?D7(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new mf;a.updateFromIdToken(r);const l=new al({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new xE(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q4=new Map;function ll(n){Tl(n instanceof Function,"Expected a class definition");let e=q4.get(n);return e?(Tl(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,q4.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $7{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$7.type="NONE";const K4=$7;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gb(n,e,t){return`firebase:${n}:${e}:${t}`}class gf{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=gb(this.userKey,s.apiKey,i),this.fullPersistenceKey=gb("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?al._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new gf(ll(K4),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||ll(K4);const o=gb(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const c=await u._get(o);if(c){const h=al._fromJSON(e,c);u!==i&&(a=h),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new gf(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new gf(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(M7(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(P7(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(B7(e))return"Blackberry";if(V7(e))return"Webos";if(O7(e))return"Safari";if((e.includes("chrome/")||F7(e))&&!e.includes("edge/"))return"Chrome";if(L7(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function P7(n=Is()){return/firefox\//i.test(n)}function O7(n=Is()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function F7(n=Is()){return/crios\//i.test(n)}function M7(n=Is()){return/iemobile/i.test(n)}function L7(n=Is()){return/android/i.test(n)}function B7(n=Is()){return/blackberry/i.test(n)}function V7(n=Is()){return/webos/i.test(n)}function n$(n=Is()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Mze(n=Is()){var e;return n$(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Lze(){return Ide()&&document.documentMode===10}function z7(n=Is()){return n$(n)||L7(n)||V7(n)||B7(n)||/windows phone/i.test(n)||M7(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U7(n,e=[]){let t;switch(n){case"Browser":t=X4(Is());break;case"Worker":t=`${X4(Is())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${mp}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bze{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vze(n,e={}){return Lp(n,"GET","/v2/passwordPolicy",e$(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zze=6;class Uze{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:zze,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jze{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Y4(this),this.idTokenSubscription=new Y4(this),this.beforeStateQueue=new Bze(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=S7,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ll(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await gf.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await R7(this,{idToken:e}),r=await al._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(aa(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ot(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ww(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Cze()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(aa(this.app))return Promise.reject(fh(this));const t=e?Si(e):null;return t&&ot(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ot(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return aa(this.app)?Promise.reject(fh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return aa(this.app)?Promise.reject(fh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ll(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Vze(this),t=new Uze(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Nv("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Fze(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ll(e)||this._popupRedirectResolver;ot(t,this,"argument-error"),this.redirectPersistenceManager=await gf.create(this,[ll(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ot(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ot(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=U7(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;if(aa(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&wze(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function r$(n){return Si(n)}class Y4{constructor(e){this.auth=e,this.observer=null,this.addObserver=$de(t=>this.observer=t)}get next(){return ot(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s$={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Wze(n){s$=n}function Hze(n){return s$.loadJS(n)}function Gze(){return s$.gapiScript}function qze(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kze(n,e){const t=vN(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(_h(i,e??{}))return s;El(s,"already-initialized")}return t.initialize({options:e})}function Xze(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ll);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Yze(n,e,t){const r=r$(n);ot(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=j7(e),{host:o,port:a}=Qze(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},c=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ot(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ot(_h(u,r.config.emulator)&&_h(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Jze()}function j7(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Qze(n){const e=j7(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Q4(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Q4(o)}}}function Q4(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Jze(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W7{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ol("not implemented")}_getIdTokenResponse(e){return ol("not implemented")}_linkToIdToken(e,t){return ol("not implemented")}_getReauthenticationResolver(e){return ol("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vf(n,e){return Eze(n,"POST","/v1/accounts:signInWithIdp",e$(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zze="http://localhost";class zh extends W7{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new zh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):El("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=QD(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new zh(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return vf(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,vf(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vf(e,t)}buildRequest(){const e={requestUri:Zze,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Av(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H7{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx extends H7{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu extends tx{constructor(){super("facebook.com")}static credential(e){return zh._fromParams({providerId:lu.PROVIDER_ID,signInMethod:lu.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lu.credentialFromTaggedObject(e)}static credentialFromError(e){return lu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lu.credential(e.oauthAccessToken)}catch{return null}}}lu.FACEBOOK_SIGN_IN_METHOD="facebook.com";lu.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu extends tx{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return zh._fromParams({providerId:uu.PROVIDER_ID,signInMethod:uu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return uu.credentialFromTaggedObject(e)}static credentialFromError(e){return uu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return uu.credential(t,r)}catch{return null}}}uu.GOOGLE_SIGN_IN_METHOD="google.com";uu.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu extends tx{constructor(){super("github.com")}static credential(e){return zh._fromParams({providerId:cu.PROVIDER_ID,signInMethod:cu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cu.credentialFromTaggedObject(e)}static credentialFromError(e){return cu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cu.credential(e.oauthAccessToken)}catch{return null}}}cu.GITHUB_SIGN_IN_METHOD="github.com";cu.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu extends tx{constructor(){super("twitter.com")}static credential(e,t){return zh._fromParams({providerId:hu.PROVIDER_ID,signInMethod:hu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return hu.credentialFromTaggedObject(e)}static credentialFromError(e){return hu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return hu.credential(t,r)}catch{return null}}}hu.TWITTER_SIGN_IN_METHOD="twitter.com";hu.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await al._fromIdTokenResponse(e,r,s),o=J4(r);return new np({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=J4(r);return new np({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function J4(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw extends Pl{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Hw.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Hw(e,t,r,s)}}function G7(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Hw._fromErrorAndOperation(n,i,e,r):i})}async function eUe(n,e,t=!1){const r=await av(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return np._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tUe(n,e,t=!1){const{auth:r}=n;if(aa(r.app))return Promise.reject(fh(r));const s="reauthenticate";try{const i=await av(n,G7(r,s,e,n),t);ot(i.idToken,r,"internal-error");const o=t$(i.idToken);ot(o,r,"internal-error");const{sub:a}=o;return ot(n.uid===a,r,"user-mismatch"),np._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&El(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nUe(n,e,t=!1){if(aa(n.app))return Promise.reject(fh(n));const r="signIn",s=await G7(n,r,e),i=await np._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function rUe(n,e,t,r){return Si(n).onIdTokenChanged(e,t,r)}function sUe(n,e,t){return Si(n).beforeAuthStateChanged(e,t)}const Gw="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q7{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gw,"1"),this.storage.removeItem(Gw),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iUe=1e3,oUe=10;class K7 extends q7{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=z7(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Lze()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,oUe):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},iUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}K7.type="LOCAL";const aUe=K7;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X7 extends q7{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}X7.type="SESSION";const Y7=X7;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lUe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Dk(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await lUe(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Dk.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i$(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uUe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=i$("",20);s.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(){return window}function cUe(n){ka().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q7(){return typeof ka().WorkerGlobalScope<"u"&&typeof ka().importScripts=="function"}async function hUe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dUe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function fUe(){return Q7()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J7="firebaseLocalStorageDb",pUe=1,qw="firebaseLocalStorage",Z7="fbase_key";class nx{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function $k(n,e){return n.transaction([qw],e?"readwrite":"readonly").objectStore(qw)}function mUe(){const n=indexedDB.deleteDatabase(J7);return new nx(n).toPromise()}function bE(){const n=indexedDB.open(J7,pUe);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(qw,{keyPath:Z7})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(qw)?e(r):(r.close(),await mUe(),e(await bE()))})})}async function Z4(n,e,t){const r=$k(n,!0).put({[Z7]:e,value:t});return new nx(r).toPromise()}async function gUe(n,e){const t=$k(n,!1).get(e),r=await new nx(t).toPromise();return r===void 0?null:r.value}function eB(n,e){const t=$k(n,!0).delete(e);return new nx(t).toPromise()}const vUe=800,yUe=3;class eK{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await bE(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>yUe)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Q7()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Dk._getInstance(fUe()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await hUe(),!this.activeServiceWorker)return;this.sender=new uUe(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dUe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bE();return await Z4(e,Gw,"1"),await eB(e,Gw),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Z4(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>gUe(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>eB(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=$k(s,!1).getAll();return new nx(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),vUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}eK.type="LOCAL";const xUe=eK;new ex(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bUe(n,e){return e?ll(e):(ot(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o$ extends W7{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return vf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return vf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function wUe(n){return nUe(n.auth,new o$(n),n.bypassAuthState)}function _Ue(n){const{auth:e,user:t}=n;return ot(t,e,"internal-error"),tUe(t,new o$(n),n.bypassAuthState)}async function kUe(n){const{auth:e,user:t}=n;return ot(t,e,"internal-error"),eUe(t,new o$(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tK{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return wUe;case"linkViaPopup":case"linkViaRedirect":return kUe;case"reauthViaPopup":case"reauthViaRedirect":return _Ue;default:El(this.auth,"internal-error")}}resolve(e){Tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CUe=new ex(2e3,1e4);class ef extends tK{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ef.currentPopupAction&&ef.currentPopupAction.cancel(),ef.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ot(e,this.auth,"internal-error"),e}async onExecution(){Tl(this.filter.length===1,"Popup operations only handle one event");const e=i$();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(_a(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_a(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ef.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_a(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,CUe.get())};e()}}ef.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IUe="pendingRedirect",vb=new Map;class SUe extends tK{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=vb.get(this.auth._key());if(!e){try{const r=await EUe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}vb.set(this.auth._key(),e)}return this.bypassAuthState||vb.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function EUe(n,e){const t=AUe(e),r=NUe(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function TUe(n,e){vb.set(n._key(),e)}function NUe(n){return ll(n._redirectPersistence)}function AUe(n){return gb(IUe,n.config.apiKey,n.name)}async function RUe(n,e,t=!1){if(aa(n.app))return Promise.reject(fh(n));const r=r$(n),s=bUe(r,e),o=await new SUe(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DUe=10*60*1e3;class $Ue{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!PUe(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!nK(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(_a(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DUe&&this.cachedEventUids.clear(),this.cachedEventUids.has(tB(e))}saveEventToCache(e){this.cachedEventUids.add(tB(e)),this.lastProcessedEventTime=Date.now()}}function tB(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function nK({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function PUe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nK(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OUe(n,e={}){return Lp(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FUe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,MUe=/^https?/;async function LUe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await OUe(n);for(const t of e)try{if(BUe(t))return}catch{}El(n,"unauthorized-domain")}function BUe(n){const e=yE(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!MUe.test(t))return!1;if(FUe.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VUe=new ex(3e4,6e4);function nB(){const n=ka().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function zUe(n){return new Promise((e,t)=>{var r,s,i;function o(){nB(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nB(),t(_a(n,"network-request-failed"))},timeout:VUe.get()})}if(!((s=(r=ka().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=ka().gapi)===null||i===void 0)&&i.load)o();else{const a=qze("iframefcb");return ka()[a]=()=>{gapi.load?o():t(_a(n,"network-request-failed"))},Hze(`${Gze()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw yb=null,e})}let yb=null;function UUe(n){return yb=yb||zUe(n),yb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jUe=new ex(5e3,15e3),WUe="__/auth/iframe",HUe="emulator/auth/iframe",GUe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qUe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function KUe(n){const e=n.config;ot(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ZD(e,HUe):`https://${n.config.authDomain}/${WUe}`,r={apiKey:e.apiKey,appName:n.name,v:mp},s=qUe.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Av(r).slice(1)}`}async function XUe(n){const e=await UUe(n),t=ka().gapi;return ot(t,n,"internal-error"),e.open({where:document.body,url:KUe(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GUe,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=_a(n,"network-request-failed"),a=ka().setTimeout(()=>{i(o)},jUe.get());function l(){ka().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YUe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},QUe=500,JUe=600,ZUe="_blank",eje="http://localhost";class rB{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function tje(n,e,t,r=QUe,s=JUe){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},YUe),{width:r.toString(),height:s.toString(),top:i,left:o}),u=Is().toLowerCase();t&&(a=F7(u)?ZUe:t),P7(u)&&(e=e||eje,l.scrollbars="yes");const c=Object.entries(l).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(Mze(u)&&a!=="_self")return nje(e||"",a),new rB(null);const h=window.open(e||"",a,c);ot(h,n,"popup-blocked");try{h.focus()}catch{}return new rB(h)}function nje(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rje="__/auth/handler",sje="emulator/auth/handler",ije=encodeURIComponent("fac");async function sB(n,e,t,r,s,i){ot(n.config.authDomain,n,"auth-domain-config-required"),ot(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:mp,eventId:s};if(e instanceof H7){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Dde(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))o[c]=h}if(e instanceof tx){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await n._getAppCheckToken(),u=l?`#${ije}=${encodeURIComponent(l)}`:"";return`${oje(n)}?${Av(a).slice(1)}${u}`}function oje({config:n}){return n.emulator?ZD(n,sje):`https://${n.authDomain}/${rje}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2="webStorageSupport";class aje{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Y7,this._completeRedirectFn=RUe,this._overrideRedirectResult=TUe}async _openPopup(e,t,r,s){var i;Tl((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await sB(e,t,r,yE(),s);return tje(e,o,i$())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await sB(e,t,r,yE(),s);return cUe(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Tl(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await XUe(e),r=new $Ue(e);return t.register("authEvent",s=>(ot(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(T2,{type:T2},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[T2];o!==void 0&&t(!!o),El(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=LUe(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return z7()||O7()||n$()}}const lje=aje;var iB="@firebase/auth",oB="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ot(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function hje(n){Ff(new kh("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ot(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:U7(n)},u=new jze(r,s,i,l);return Xze(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ff(new kh("auth-internal",e=>{const t=r$(e.getProvider("auth").getImmediate());return(r=>new uje(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Pu(iB,oB,cje(n)),Pu(iB,oB,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dje=5*60,fje=Yj("authIdTokenMaxAge")||dje;let aB=null;const pje=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>fje)return;const s=t==null?void 0:t.token;aB!==s&&(aB=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function rK(n=yN()){const e=vN(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Kze(n,{popupRedirectResolver:lje,persistence:[xUe,aUe,Y7]}),r=Yj("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=pje(i.toString());sUe(t,o,()=>o(t.currentUser)),rUe(t,a=>o(a))}}const s=Kj("auth");return s&&Yze(t,`http://${s}`),t}function mje(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Wze({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=_a("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",mje().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});hje("Browser");const gje={apiKey:"AIzaSyChGT1uTyeSEefHgEzZLY0qhLdZpATt6HI",authDomain:"meditation-coach-d4c9b.firebaseapp.com",projectId:"meditation-coach-d4c9b",storageBucket:"meditation-coach-d4c9b.firebasestorage.app",messagingSenderId:"169916790708",appId:"1:169916790708:web:004d95dd2b0e46805264e1"},sK=Lg().length===0?Rv(gje):Lg()[0],vje=t_(sK);rK(sK);const yje=async n=>{try{return(await iA(Sh(vje,"meditationSessions"),{...n,timestamp:tr.fromDate(n.timestamp)})).id}catch(e){throw console.error("Error saving session:",e),e}},xje={apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"},iK=Lg().length?yN():Rv(xje),bje=t_(iK),wje=rK(iK);function _je(){const[n,e]=q.useState(null),[t,r]=q.useState(5),[s,i]=q.useState(!1),[o,a]=q.useState(null),l=Iv(),u=()=>{n&&(i(!0),a(null))},c=async()=>{var d;try{const f=(d=wje.currentUser)==null?void 0:d.uid;if(!f)throw new Error("User not authenticated");await yje({userId:f,type:n,duration:t,completed:!0,timestamp:new Date}),i(!1),l("/reports")}catch(f){console.error("Error saving session:",f),a(f instanceof Error?f.message:"Failed to save session")}},h=()=>{if(!s)return null;switch(n){case"guided":const d={type:"meditation",title:"Guided Meditation",description:"Follow along with guided instructions for a mindful meditation session.",duration:t,intensity:"low"};return k.jsx(C7,{recommendation:d,onComplete:c});case"silent":return k.jsx(xze,{duration:t,onComplete:c});case"breathing":return k.jsx(k7,{});default:return null}};return k.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:k.jsxs("div",{className:"max-w-3xl mx-auto",children:[k.jsxs("div",{className:"text-center mb-8",children:[k.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meditation Session"}),k.jsx("p",{className:"mt-2 text-gray-600",children:"Choose your session type and duration"})]}),o&&k.jsxs("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[k.jsx("span",{className:"block sm:inline",children:o}),k.jsxs("button",{onClick:()=>a(null),className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:[k.jsx("span",{className:"sr-only",children:"Dismiss"}),k.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),s?h():k.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:k.jsxs("div",{className:"space-y-6",children:[k.jsxs("div",{children:[k.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Session Type"}),k.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[k.jsx("button",{onClick:()=>e("guided"),className:`p-4 rounded-lg border ${n==="guided"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:"Guided Meditation"}),k.jsx("button",{onClick:()=>e("silent"),className:`p-4 rounded-lg border ${n==="silent"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:"Silent Meditation"}),k.jsx("button",{onClick:()=>e("breathing"),className:`p-4 rounded-lg border ${n==="breathing"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300"}`,children:"Breathing Exercise"})]})]}),n!=="breathing"&&k.jsxs("div",{children:[k.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Duration (minutes)"}),k.jsx("select",{value:t,onChange:d=>r(Number(d.target.value)),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[5,10,15,20,30].map(d=>k.jsxs("option",{value:d,children:[d," minutes"]},d))})]}),k.jsxs("div",{className:"flex justify-end space-x-4",children:[k.jsx(Ui,{to:"/",className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),k.jsx("button",{onClick:u,disabled:!n,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Start Session"})]})]})})]})})}function kje(){const[n,e]=q.useState("week"),[t,r]=q.useState(null),[s,i]=q.useState([]),[o,a]=q.useState(!0),[l,u]=q.useState(null);q.useEffect(()=>{const h=JN(Sh(bje,"meditationSessions"),nA("timestamp","desc")),d=oA(h,f=>{const p=f.docs.map(x=>({id:x.id,...x.data(),timestamp:x.data().timestamp.toDate()}));i(p.slice(0,5)),a(!1);const m=new Date;let g=new Date;switch(n){case"week":g.setDate(m.getDate()-7);break;case"month":g.setMonth(m.getMonth()-1);break;case"year":g.setFullYear(m.getFullYear()-1);break}const v=p.filter(x=>x.timestamp>=g),y={totalSessions:v.length,totalDuration:v.reduce((x,b)=>x+b.duration,0),averageDuration:v.length>0?v.reduce((x,b)=>x+b.duration,0)/v.length:0,streak:c(v),lastSessionDate:v.length>0?v[0].timestamp:null,sessionTypes:{guided:v.filter(x=>x.type==="guided").length,silent:v.filter(x=>x.type==="silent").length,breathing:v.filter(x=>x.type==="breathing").length},averageStressLevel:v.length>0?v.reduce((x,b)=>x+b.stressLevel,0)/v.length:0};r(y)},f=>{console.error("Error listening to sessions:",f),u("Failed to load meditation data"),a(!1)});return()=>{d()}},[n]);const c=h=>{if(h.length===0)return 0;let d=1,f=new Date(h[0].timestamp);f.setHours(0,0,0,0);for(let p=1;p<h.length;p++){const m=new Date(h[p].timestamp);m.setHours(0,0,0,0);const g=Math.floor((f.getTime()-m.getTime())/(1e3*60*60*24));if(g===1)d++,f=m;else if(g>1)break}return d};return o?k.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):l?k.jsx("div",{className:"text-red-500 text-center p-4",children:l}):k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[k.jsxs("div",{className:"mb-8",children:[k.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Meditation Statistics"}),k.jsxs("div",{className:"flex space-x-4 mb-4",children:[k.jsx("button",{onClick:()=>e("week"),className:`px-4 py-2 rounded ${n==="week"?"bg-indigo-600 text-white":"bg-gray-200"}`,children:"Week"}),k.jsx("button",{onClick:()=>e("month"),className:`px-4 py-2 rounded ${n==="month"?"bg-indigo-600 text-white":"bg-gray-200"}`,children:"Month"}),k.jsx("button",{onClick:()=>e("year"),className:`px-4 py-2 rounded ${n==="year"?"bg-indigo-600 text-white":"bg-gray-200"}`,children:"Year"})]})]}),t&&k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[k.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:k.jsxs("div",{className:"flex items-center",children:[k.jsx(cp,{className:"h-8 w-8 text-indigo-600"}),k.jsxs("div",{className:"ml-4",children:[k.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Time"}),k.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[Math.round(t.totalDuration)," min"]})]})]})}),k.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:k.jsxs("div",{className:"flex items-center",children:[k.jsx(cl,{className:"h-8 w-8 text-indigo-600"}),k.jsxs("div",{className:"ml-4",children:[k.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Sessions"}),k.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.totalSessions})]})]})}),k.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:k.jsxs("div",{className:"flex items-center",children:[k.jsx(jZ,{className:"h-8 w-8 text-indigo-600"}),k.jsxs("div",{className:"ml-4",children:[k.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Current Streak"}),k.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[t.streak," days"]})]})]})}),k.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:k.jsxs("div",{className:"flex items-center",children:[k.jsx(BT,{className:"h-8 w-8 text-indigo-600"}),k.jsxs("div",{className:"ml-4",children:[k.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg. Stress Level"}),k.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[Math.round(t.averageStressLevel),"%"]})]})]})})]}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Recent Sessions"}),k.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:k.jsx("ul",{className:"divide-y divide-gray-200",children:s.map(h=>k.jsx("li",{className:"px-6 py-4",children:k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsxs("div",{children:[k.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[h.type.charAt(0).toUpperCase()+h.type.slice(1)," Meditation"]}),k.jsxs("p",{className:"text-sm text-gray-500",children:[h.timestamp.toLocaleDateString()," - ",h.duration," minutes"]})]}),k.jsxs("div",{className:"text-sm text-gray-500",children:["Stress Level: ",h.stressLevel,"%"]})]})},h.id))})})]})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var oK=function(n,e){return(oK=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])})(n,e)};function Wo(n,e){function t(){this.constructor=n}oK(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Be(n,e,t,r){return new(t||(t=Promise))(function(s,i){function o(u){try{l(r.next(u))}catch(c){i(c)}}function a(u){try{l(r.throw(u))}catch(c){i(c)}}function l(u){u.done?s(u.value):new t(function(c){c(u.value)}).then(o,a)}l((r=r.apply(n,[])).next())})}function Ve(n,e){var t,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(s=2&c[0]?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[2&c[0],s.value]),c[0]){case 0:case 1:s=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){o=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){o.label=c[1];break}if(c[0]===6&&o.label<s[1]){o.label=s[1],s=c;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(c);break}s[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(n,o)}catch(h){c=[6,h],r=0}finally{t=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([l,u])}}}var Cje=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var s=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+s+"."),this.set(e,s)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,s=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];return Ije(r,o[0],o[1]),o.join("=")}),r);"tfjsflags"in s&&s.tfjsflags.split(",").forEach(function(i){var o=i.split(":"),a=o[0],l=o[1];e.urlFlags[a]=function(u,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+u+".")}(a,l)})}},n}();function Ije(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function me(){return aK}var aK=null,Kw=new Map,wE=new Map;function lK(n,e){var t=cK(n,e);return Kw.get(t)}function Sje(n){return wE.get(n)}function lB(n){for(var e=Kw.entries(),t=[];;){var r=e.next(),s=r.done,i=r.value;if(s)break;var o=i[0],a=i[1];o.split("_")[0]===n&&t.push(a)}return t}function uK(n){var e=n.kernelName,t=n.backendName,r=cK(e,t);if(Kw.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Kw.set(r,n)}function Eje(n){var e=n.kernelName;wE.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),wE.set(e,n)}function cK(n,e){return e+"_"+n}function _E(n,e,t){return Math.max(n,Math.min(e,t))}function hK(n){return n%2==0?n:n+1}function Tje(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function j(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Kt(n,e,t){t===void 0&&(t=""),j(Fr(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function Bp(n){j(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function rp(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Ca(n)&&!t)for(var r=0;r<n.length;++r)rp(n[r],e,t);else e.push(n);return e}function We(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Fr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function nr(n){return n%1==0}function Nje(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function kE(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function yf(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function uB(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,s){var i=0,o=function(){if(n())r();else{i++;var a=e(i);t!=null&&i>=t?s():setTimeout(o,a)}};o()})}function Aje(n,e){for(var t=1,r=-1,s=0;s<n.length;++s)if(n[s]>=0)t*=n[s];else if(n[s]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+s);r=s}else if(n[s]<0)throw Error("Shapes can not be < 0. Found "+n[s]+" at dim "+s);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var i=n.slice();return i[r]=e/t,i}function Er(n,e){var t=e.length;return j((n=n==null?e.map(function(r,s){return s}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),j(n.every(function(r){return nr(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function qc(n,e){for(var t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:Er(e,n).sort(),o=0,a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function lv(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Xw(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function Rje(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function Dje(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function $je(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Ca(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function dK(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function Pje(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function a$(n){return typeof n=="string"||n instanceof String}function Oje(n){return typeof n=="boolean"}function Fje(n){return typeof n=="number"}function rx(n){return Array.isArray(n)?rx(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":Fje(n)?"float32":a$(n)?"string":Oje(n)?"bool":"float32"}function CE(n){return!!(n&&n.constructor&&n.call&&n.apply)}function IE(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Ia(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function fK(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=rp(n)),t&&Rje(n,e),function(i,o){return i instanceof Float32Array&&o==="float32"||i instanceof Int32Array&&o==="int32"||i instanceof Uint8Array&&o==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),s=0;s<r.length;++s)Math.round(n[s])!==0&&(r[s]=1);return r}throw new Error("Unknown data type "+e)}function cB(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,s){return r*s});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(s,i,o){var a=new Array;if(i.length===1)for(var l=i[0],u=0;u<l;u++)a[u]=o[s+u];else{l=i[0];var c=i.slice(1),h=c.reduce(function(d,f){return d*f});for(u=0;u<l;u++)a[u]=r(s+u*h,c,o)}return a}(0,n,e)}function pK(n,e){for(var t=sx(n,e),r=0;r<t.length;r++)t[r]=1;return t}function sx(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function ia(){return me().platform.now()}function mK(n){n.forEach(function(e){j(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function Mje(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.encode(n,e)}function Yw(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.decode(n,e)}function hB(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function Lje(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}var Bje=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Vje)}return n.prototype.profileKernel=function(e,t,r){var s,i=this,o=this.backendTimer.time(function(){s=r()});return s.forEach(function(a){a.data().then(function(l){(function(u,c,h){if(c!=="float32")return!1;for(var d=0;d<u.length;d++){var f=u[d];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+h+"'"),!0}})(l,a.dtype,e),o.then(function(u){var c="";u.getExtraProfileInfo!=null&&(c=u.getExtraProfileInfo()),i.logger.logKernelProfile(e,a,l,u.kernelMs,t,c)})})}),s},n}(),Vje=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,s,i,o){var a=typeof s=="number"?yf(s+"ms",9):s.error,l=yf(e,25),u=t.rank,c=t.size,h=yf(t.shape.toString(),14),d="";for(var f in i){var p=i[f].shape||t.shape,m=p.length;d+=f+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+l+"	%c"+a+"	%c"+u+"D "+h+"	%c"+c+"	%c"+d+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),dB=20,ym=3,N2=7;function zje(n,e,t,r){var s=Ia(e),i=function(u,c,h,d){var f=We(c),p=d[d.length-1],m=new Array(p).fill(0),g=c.length,v=h==="complex64"?bm(u):u;if(g>1)for(var y=0;y<f/p;y++)for(var x=y*p,b=0;b<p;b++)m[b]=Math.max(m[b],xm(v[x+b],0,h).length);return m}(n,e,t,s),o=e.length,a=function u(c,h,d,f,p,m){m===void 0&&(m=!0);var g=d==="complex64"?2:1,v=h[0],y=h.length;if(y===0)return d==="complex64"?[xm(bm(c)[0],0,d)]:d==="bool"?[gK(c[0])]:[c[0].toString()];if(y===1){if(v>dB){var x=ym*g,b=Array.from(c.slice(0,x)),_=Array.from(c.slice((v-ym)*g,v*g));return d==="complex64"&&(b=bm(b),_=bm(_)),["["+b.map(function(L,O){return xm(L,p[O],d)}).join(", ")+", ..., "+_.map(function(L,O){return xm(L,p[v-ym+O],d)}).join(", ")+"]"]}return["["+(d==="complex64"?bm(c):Array.from(c)).map(function(L,O){return xm(L,p[O],d)}).join(", ")+"]"]}var E=h.slice(1),I=f.slice(1),C=f[0]*g,S=[];if(v>dB){for(var T=0;T<ym;T++){var N=(R=T*C)+C;S.push.apply(S,u(c.slice(R,N),E,d,I,p,!1))}for(S.push("..."),T=v-ym;T<v;T++)N=(R=T*C)+C,S.push.apply(S,u(c.slice(R,N),E,d,I,p,T===v-1))}else for(T=0;T<v;T++){var R;N=(R=T*C)+C,S.push.apply(S,u(c.slice(R,N),E,d,I,p,T===v-1))}var D=y===2?",":"";for(S[0]="["+S[0]+D,T=1;T<S.length-1;T++)S[T]=" "+S[T]+D;var z=`,
`;for(T=2;T<y;T++)z+=`
`;return S[S.length-1]=" "+S[S.length-1]+"]"+(m?"":z),S}(n,e,t,s,i),l=["Tensor"];return r&&(l.push("  dtype: "+t),l.push("  rank: "+o),l.push("  shape: ["+e+"]"),l.push("  values:")),l.push(a.map(function(u){return"    "+u}).join(`
`)),l.join(`
`)}function xm(n,e,t){return yf(Array.isArray(n)?parseFloat(n[0].toFixed(N2))+" + "+parseFloat(n[1].toFixed(N2))+"j":a$(n)?"'"+n+"'":t==="bool"?gK(n):parseFloat(n.toFixed(N2)).toString(),e)}function gK(n){return n===0?"false":"true"}function bm(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var uv=function(){function n(e,t,r){var s=this;if(this.dtype=t,this.shape=e.slice(),this.size=We(e),r!=null){var i=r.length;j(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+s.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Xw(t,this.size),this.strides=Ia(e)}return n.prototype.set=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];r.length===0&&(r=[0]),j(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,s=0,i=e;s<i.length;s++){var o=i[s];if(o<0||o>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var l=e[e.length-1],u=0;u<e.length-1;++u)l+=this.strides[u]*e[u];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return la().makeTensor(this.values,this.shape,this.dtype)},n}(),la=null,ue=null,vK=null,Rn=function(){function n(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=We(e),this.strides=Ia(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),j(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,s){return this.throwIfDisposed(),this.reshape([e,t,r,s])},n.prototype.as5D=function(e,t,r,s,i){return this.throwIfDisposed(),this.reshape([e,t,r,s,i])},n.prototype.asType=function(e){return this.throwIfDisposed(),ue.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Be(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ue.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return ue.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Be(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,cB(this.shape,e)]}})})},n.prototype.arraySync=function(){return cB(this.shape,this.dataSync())},n.prototype.data=function(){return Be(this,void 0,void 0,function(){var e,t;return Ve(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=la().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(s){return Yw(s)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=la().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Yw(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Be(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,la().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(la().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),ue.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),ue.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),ue.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),ue.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),ue.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),ue.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),ue.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),zje(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),ue.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),ue.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),ue.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),ue.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),ue.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),ue.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),ue.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),ue.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),ue.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),ue.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),ue.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),ue.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,s,i){return r===void 0&&(r=.001),vK("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,s,r)},n.prototype.batchNorm=function(e,t,r,s,i){return i===void 0&&(i=.001),this.throwIfDisposed(),ue.batchNorm(this,e,t,r,s,i)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),ue.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),ue.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),ue.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),ue.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),ue.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),ue.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),ue.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),ue.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),ue.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),ue.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),ue.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),ue.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),ue.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),ue.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),ue.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),ue.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),ue.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),ue.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ue.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),ue.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ue.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),ue.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),ue.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ue.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),ue.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),ue.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ue.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),ue.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),ue.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),ue.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),ue.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),ue.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ue.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),ue.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ue.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ue.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ue.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ue.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),ue.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),ue.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),ue.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),ue.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),ue.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),ue.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),ue.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),ue.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),ue.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),ue.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),ue.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),ue.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),ue.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),ue.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),ue.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),ue.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),ue.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),ue.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),ue.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),ue.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ue.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),ue.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),ue.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),ue.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),ue.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),ue.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),ue.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),ue.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),ue.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),ue.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),ue.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),ue.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),ue.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),ue.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),ue.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),ue.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),ue.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),ue.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),ue.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),ue.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),ue.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),ue.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),ue.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),ue.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),ue.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),ue.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),ue.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),ue.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),ue.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),ue.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),ue.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,s,i,o){return s===void 0&&(s="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),ue.conv1d(this,e,t,r,s,i,o)},n.prototype.conv2d=function(e,t,r,s,i,o){return s===void 0&&(s="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),ue.conv2d(this,e,t,r,s,i,o)},n.prototype.conv2dTranspose=function(e,t,r,s,i){return this.throwIfDisposed(),ue.conv2dTranspose(this,e,t,r,s,i)},n.prototype.depthwiseConv2D=function(e,t,r,s,i,o){return s===void 0&&(s="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),ue.depthwiseConv2d(this,e,t,r,s,i,o)},n.prototype.separableConv2d=function(e,t,r,s,i,o){return i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),ue.separableConv2d(this,e,t,r,s,i,o)},n.prototype.avgPool=function(e,t,r,s){return this.throwIfDisposed(),ue.avgPool(this,e,t,r,s)},n.prototype.maxPool=function(e,t,r,s){return this.throwIfDisposed(),ue.maxPool(this,e,t,r,s)},n.prototype.localResponseNormalization=function(e,t,r,s){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5),ue.localResponseNormalization(this,e,t,r,s)},n.prototype.pool=function(e,t,r,s,i){return this.throwIfDisposed(),ue.pool(this,e,t,r,s,i)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),la().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ue.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ue.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ue.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),ue.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,s,i,o,a,l){return s===void 0&&(s=0),i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),l===void 0&&(l=0),this.throwIfDisposed(),ue.stridedSlice(this,e,t,r,s,i,o,a,l)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ue.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),ue.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),ue.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),ue.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),ue.spectral.irfft(this)},n}();Object.defineProperty(Rn,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var fB,SE,EE,TE,NE,sp=function(n){function e(t,r,s,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=s,o}return Wo(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Fr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");la().disposeTensor(this),this.dataId=t.dataId,la().incRef(this,null)},e.prototype.dispose=function(){la().disposeVariable(this),this.isDisposedInternal=!0},e}(Rn);Object.defineProperty(sp,Symbol.hasInstance,{value:function(n){return n instanceof Rn&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(fB||(fB={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(SE||(SE={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(EE||(EE={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(TE||(TE={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(NE||(NE={}));var Uje={float32:TE,int32:SE,bool:EE,complex64:NE};function Hr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return Uje[n][e]}function A2(n){return Hr(n,"int32")}function Mn(n,e){if(n.dtype===e.dtype)return[n,e];var t=Hr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function jje(n,e){j(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function yK(n){var e=[];return function t(r,s,i){if(r!=null){if(r instanceof Rn)return void s.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,a=r;for(var l in a){var u=a[l];i.has(u)||(i.add(u),t(u,s,i))}}}}(n,e,new Set),e}var R2,pB=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Wje=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pB}return n.prototype.ready=function(){return Be(this,void 0,void 0,function(){var e,t,r;return Ve(this,function(s){switch(s.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,s.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return s.sent()?[4,this.setBackend(r)]:[3,4];case 3:return s.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Be(this,void 0,void 0,function(){var t,r,s;return Ve(this,function(i){switch(i.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return s=i.sent(),[3,3];case 2:s=r,i.label=3;case 3:if(!s)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Bje(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;lB(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;lB(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var s=r.factory();if(Promise.resolve(s)===s){var i=++this.pendingBackendInitId,o=s.then(function(a){return!(i<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)}).catch(function(a){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],s=this.initializeBackend(r),i=s.success,o=s.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),s=r.backend,i=this.readSync(t);s.disposeData(t),r.backend=e,e.move(t,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,s=this,i=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(function(){return s.startScope(i)},function(){return s.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var s=r();return t(),s}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(s){return{x:function(){return s.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,s,i){return this.runKernelFunc(null,t,null,e,r,s,i)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var s=this.backend.numDataIds(),i=0;r.forEach(function(l){i+=l.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-i-o;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,s,i,o,a){var l,u=this;o===void 0&&(o=[]),a===void 0&&(a=[]);var c=[],h=this.isTapeOn();s==null&&(s=this.state.activeScope!=null?this.state.activeScope.name:"");var d,f=function(y){h&&(c=y.map(function(x){return u.keep(u.clone(x))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=lK(s,this.backendName);return d=v!=null?function(){var y=u.backend.numDataIds();g=v.kernelFunc({inputs:t,attrs:i,backend:u.backend});var x=Array.isArray(g)?g:[g];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(s,y,x);var b=x.map(function(E){var I=E.dataId,C=E.shape,S=E.dtype;return u.makeTensorFromDataId(I,C,S)}),_=b.filter(function(E,I){return a[I]});return f((o||[]).slice().concat(_)),b}:function(){var y=u.backend.numDataIds();g=u.tidy(function(){return e(u.backend,f)});var x=Array.isArray(g)?g:[g];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(s,y,x),x},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){l=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(s,t,function(){return d()}):d()}),h&&this.addTapeNode(s,t,l,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(y){return t[y].shape}),outputShapes:l.map(function(y){return y.shape})}),Array.isArray(g)?l:l[0]},n.prototype.makeTensor=function(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;var i=e;r==="string"&&a$(e[0])&&(i=e.map(function(c){return Mje(c)}));var o=s.write(i,t,r),a=new Rn(t,r,o,this.nextTensorId());if(this.incRef(a,s),r==="string"){var l=this.state.tensorInfo.get(o),u=Pje(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a},n.prototype.makeTensorFromDataId=function(e,t,r,s){var i=new Rn(t,r=r||"float32",e,this.nextTensorId());return this.incRef(i,s),i},n.prototype.makeVariable=function(e,t,r,s){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.asType(s));var i=new sp(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*dK(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s,refCount:0}),this.state.numBytes+=s}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof sp||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Be(this,void 0,void 0,function(){var t,r;return Ve(this,function(s){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,s,i){var o=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},l=Sje(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=function(u){return u=u.map(function(c,h){if(c==null){var d=r[h],f=sx(d.size,d.dtype);return o.makeTensor(f,d.shape,d.dtype)}return c}),s(u.length>1?u:u[0],i)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=yK(e),s=new Set(r.map(function(l){return l.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||s.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(l){l.kept||l.scopeId!==a.id||t.track(l)})},n.prototype.gradients=function(e,t,r,s){var i=this;if(s===void 0&&(s=!1),j(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});j(o instanceof Rn,function(){return"The result y returned by f() must be a tensor."});var a=function(l,u,c){for(var h={},d={},f=0;f<u.length;f++)h[u[f].id]=!0;for(f=0;f<l.length;f++){var p=(E=l[f]).inputs;for(var m in p){for(var g=p[m],v=!1,y=0;y<u.length;y++)if(h[g.id]){E.outputs.forEach(function(T){return h[T.id]=!0}),v=!0,d[E.id]=!0;break}if(v)break}}var x={};x[c.id]=!0;var b={};for(f=l.length-1;f>=0;f--)for(p=(E=l[f]).inputs,y=0;y<E.outputs.length;y++)if(x[E.outputs[y].id]){for(var m in p)x[p[m].id]=!0,b[E.id]=!0;break}var _=[];for(f=0;f<l.length;f++){var E;if(d[(E=l[f]).id]&&b[E.id]){var I={};for(var m in E.inputs){var C=E.inputs[m];h[C.id]&&(I[m]=C)}var S=Object.assign({},E);S.inputs=I,S.outputs=E.outputs,_.push(S)}}return _}(this.state.activeTape,t,o);if(!s&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var l,u,c={};c[o.id]=r??(l=o.shape,u=pK(We(l),"float32"),Q.makeTensor(u,l,"float32")),function(d,f,p){for(var m=function(v){var y=f[v],x=[];if(y.outputs.forEach(function(I){var C=d[I.id];C!=null?x.push(C):x.push(null)}),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var b=y.gradient(x),_=function(I){if(!(I in b))throw new Error("Cannot backprop through input "+I+". Available gradients found: "+Object.keys(b)+".");var C=p(function(){return b[I]()});if(C.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+I+" must have 'float32' dtype, but has '"+C.dtype+"'");var S=y.inputs[I];if(!Fr(C.shape,S.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+I+"' has shape '"+C.shape+"', which does not match the shape of the input '"+S.shape+"'");if(d[S.id]==null)d[S.id]=C;else{var T=d[S.id];d[S.id]=T.add(C),T.dispose()}};for(var E in y.inputs)_(E)},g=f.length-1;g>=0;g--)m(g)}(c,a,function(d){return i.tidy(d)});var h=t.map(function(d){return c[d.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(d){for(var f=0,p=d.saved;f<p.length;f++)p[f].dispose()}),i.state.activeTape=null),{value:o,grads:h}})},n.prototype.customGrad=function(e){var t=this;return j(CE(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];j(s.every(function(a){return a instanceof Rn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return s.forEach(function(a,l){o[l]=a}),t.runKernelFunc(function(a,l){return j((r=e.apply(void 0,s.concat([l]))).value instanceof Rn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),j(CE(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(a,l){var u=r.gradFunc(a,l),c=Array.isArray(u)?u:[u];j(c.length===s.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),j(c.every(function(d){return d instanceof Rn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,f){h[f]=function(){return d}}),h})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Be(this,void 0,void 0,function(){var t,r;return Ve(this,function(s){switch(s.label){case 0:return t=ia(),[4,this.backend.time(e)];case 1:return(r=s.sent()).wallMs=ia()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pB,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),Q=function(){var n=function(){if(R2==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}R2=t}return R2}();if(n._tfengine==null){var e=new Cje(n);n._tfengine=new Wje(e)}return function(t){aK=t}(n._tfengine.ENV),la=function(){return n._tfengine},n._tfengine}();function xK(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ga=me();Ga.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ga.registerFlag("IS_BROWSER",function(){return xK()}),Ga.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Ga.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ga.registerFlag("PROD",function(){return!1}),Ga.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ga.getBool("DEBUG")}),Ga.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ga.registerFlag("IS_TEST",function(){return!1});var cv,yi,pi,Uc={},D2={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Hje(n,e){Uc[n]=e}function La(n){n in Uc||(Uc[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(s){if(typeof OffscreenCanvas<"u"&&s===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(s){s.preventDefault(),delete Uc[t]},!1),t===1?r.getContext("webgl",D2)||r.getContext("experimental-webgl",D2):r.getContext("webgl2",D2)}(n));var e=Uc[n];return e.isContextLost()?(delete Uc[n],La(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Uc[n])}function Pk(n,e){return[e,n]}function cg(n){var e=We(n);return kE(Math.ceil(e/4))}function ix(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function l$(n,e){var t,r,s,i,o,a,l,u,c,h=n;return me().getNumber("WEBGL_VERSION")===2?(t=h.R32F,r=h.R16F,s=h.RGBA16F,i=h.RGBA32F,o=h.RED,a=4,l=1,u=h.HALF_FLOAT,c=h.FLOAT):(t=n.RGBA,r=n.RGBA,s=n.RGBA,i=h.RGBA,o=n.RGBA,a=4,l=4,u=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:l,textureTypeHalfFloat:u,textureTypeFloat:c}}function He(n,e,t){var r=t();return e&&function(s){var i=s.getError();if(i!==s.NO_ERROR)throw new Error("WebGL Error: "+Xje(s,i))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(cv||(cv={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(yi||(yi={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(pi||(pi={}));var Gje=596e-10,qje=65504;function Kje(n){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Gje<Math.abs(n)&&Math.abs(n)<qje)}function Xje(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function S0(n,e,t){return Vl(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function Yje(n,e,t){var r=Vl(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(He(n,e,function(){return n.shaderSource(r,t)}),He(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Qje(n,e,t){var r=Vl(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(He(n,e,function(){return n.shaderSource(r,t)}),He(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(s,i){var o=Jje.exec(i);if(o==null)return console.log("Couldn't parse line number in error: "+i),void console.log(s);for(var a=+o[1],l=s.split(`
`),u=l.length.toString().length+2,c=l.map(function(g,v){return yf((v+1).toString(),u)+g}),h=0,d=0;d<c.length;d++)h=Math.max(c[d].length,h);var f=c.slice(0,a-1),p=c.slice(a-1,a),m=c.slice(a);console.log(f.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+yf(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var $2,P2,Jje=/ERROR: [0-9]+:([0-9]+):/g;function Zje(n,e){return Vl(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function eWe(n,e,t){if(He(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function O2(n,e,t){if(He(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function tWe(n,e,t){var r=Vl(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return He(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),He(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function nWe(n,e,t){var r=Vl(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return He(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),He(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function rWe(n,e){return Vl(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function sWe(n,e){var t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function iWe(n,e){return Vl(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function mB(n,e,t,r,s,i,o,a){var l=n.getAttribLocation(t,r);return l!==-1&&(He(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,s)}),He(n,e,function(){return n.vertexAttribPointer(l,i,n.FLOAT,!1,o,a)}),He(n,e,function(){return n.enableVertexAttribArray(l)}),!0)}function oWe(n,e,t,r){hWe(n,r),He(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function aWe(n,e,t,r){return Vl(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function lWe(n,e,t){return n.getUniformLocation(e,t)}function uWe(n,e,t,r,s,i){He(n,e,function(){return oWe(n,e,r,i)}),He(n,e,function(){return n.uniform1i(s,i)})}function F2(n,e,t,r){He(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),He(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function gB(n,e,t){He(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),He(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function E0(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+cWe(n,e))}function cWe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Vl(n,e,t,r){var s=He(n,e,function(){return t()});if(s==null)throw new Error(r);return s}function hWe(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Qw(n,e){return e===void 0&&(e=2),We(n.slice(0,n.length-e))}function Jw(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function M2(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Qw(n)].concat(Jw(n))),e}function dWe(n,e){var t;e===void 0&&(e=!1);var r=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(u,c){return c>=n.length-2?hK(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var s=qc(n);n=s.newShape}var i=We(n);if(n.length<=1&&i<=r)return[1,i];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var o=Qw(n),a=2,l=2;return n.length&&(a=(t=Jw(n))[0],l=t[1]),kE(i=o*(a/2)*(l/2)).map(function(u){return 2*u})}return kE(i)}function T0(n){return n%2==0}function N0(n,e){if(Fr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||T0(t)&&T0(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&T0(n[0])&&T0(e[0])}function fWe(n){if($2==null){var e=La(n);$2=e.getParameter(e.MAX_TEXTURE_SIZE)}return $2}function pWe(n){if(P2==null){var e=La(n);P2=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,P2)}function mWe(n){if(n===0)return 0;var e=La(n);return to(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:to(e,"EXT_disjoint_timer_query")?1:0}function to(n,e){return n.getExtension(e)!=null}function vB(n){try{if(La(n)!=null)return!0}catch{return!1}return!1}function gWe(n){if(n===0)return!1;var e=La(n);if(n===1){if(!to(e,"OES_texture_float"))return!1}else if(!to(e,"EXT_color_buffer_float"))return!1;return AE(e)}function vWe(n){if(n===0)return!1;var e=La(n);if(n!==1){if(to(e,"EXT_color_buffer_float"))return AE(e);if(to(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,s){var i=l$(r,s),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var l=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(a),l}(e,t)}return!1}return!!to(e,"OES_texture_float")&&!!to(e,"WEBGL_color_buffer_float")&&AE(e)}function AE(n){var e=l$(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),s}function yWe(n){return n===2&&La(n).fenceSync!=null}var it=me();function bK(n){me().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Oe(n,e){return Q.tidy(n,e)}function ni(n){yK(n).forEach(function(e){return e.dispose()})}function xWe(n){return Q.keep(n)}function Zw(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];me().getBool("IS_TEST")||console.warn.apply(console,n)}function bc(n,e){var t=n;if(Ca(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Ca(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function s(i,o,a){if(a=a||[],!Array.isArray(i)&&!Ca(i))return void j(o.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});j(o.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),j(i.length===o[0],function(){return"Element arr["+a.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"});for(var l=o.slice(1),u=0;u<i.length;++u)s(i[u],l,a.concat(u))}(n,r,[]),r}function yB(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function V(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Rn)return yB(r,n.dtype,e,t),n;var s=rx(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),yB(r,s,e,t),n==null||!Ca(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=bc(n,s);Ca(n)||Array.isArray(n)||(n=[n]);var a=s!=="string"?fK(n,s,me().getBool("DEBUG")):rp(n,[],!0);return Q.makeTensor(a,o,s)}function e1(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(s,i){return V(s,e+"["+i+"]",t)},r)}function wK(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function bWe(n,e,t){for(var r=n.length+e.length,s=[],i=0,o=0,a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[i++]):s.push(e[o++]);return s}function fs(n,e){for(var t=[],r=n.length,s=0;s<r;s++)e.indexOf(s)===-1&&t.push(n[s]);return[t,e.map(function(i){return n[i]})]}function oi(n,e){return bWe(n,e.map(function(t){return 1}),e)}function fi(n,e,t){j(wK(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Ba(n,e){if(wK(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(s){return t.push(s)}),t}function u$(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Va(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function wWe(n,e){var t=n[0].length;n.forEach(function(s,i){j(s.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"})}),j(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(s,i){for(var o=0;o<t;o++)j(o===e||s[o]===r[o],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+s+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function ip(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function G(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var s=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var a=r.apply(void 0,i);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(a),a}catch(l){throw Q.endScope(null),l}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}it.registerFlag("HAS_WEBGL",function(){return it.getNumber("WEBGL_VERSION")>0}),it.registerFlag("WEBGL_VERSION",function(){return vB(2)?2:vB(1)?1:0}),it.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return it.get("WEBGL_VERSION")===2}),it.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),it.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),it.registerFlag("WEBGL_PACK",function(){return it.getBool("HAS_WEBGL")}),it.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_CLIP",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),it.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_PACK_REDUCE",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_LAZILY_UNPACK",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_CONV_IM2COL",function(){return it.getBool("WEBGL_PACK")}),it.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return fWe(it.getNumber("WEBGL_VERSION"))}),it.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return pWe(it.getNumber("WEBGL_VERSION"))}),it.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=it.getNumber("WEBGL_VERSION");return n===0?0:mWe(n)}),it.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return it.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),it.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return gWe(it.getNumber("WEBGL_VERSION"))}),it.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!it.getBool("WEBGL_FORCE_F16_TEXTURES")&&it.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),it.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return vWe(it.getNumber("WEBGL_VERSION"))}),it.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return yWe(it.getNumber("WEBGL_VERSION"))}),it.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return it.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),vK=bK;var jr=G({complex_:function(n,e){var t=V(n,"real","complex"),r=V(e,"imag","complex");return Kt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),Q.runKernelFunc(function(s){return s.complex(t,r)},{$real:t,$imag:r})}}),Gi=G({real_:function(n){var e=V(n,"input","real");return Q.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),ua=G({imag_:function(n){var e=V(n,"input","imag");return Q.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Gr(n,e,t){return wc(n,e,bc(n,t),t)}function wc(n,e,t,r){if(r==null&&(r=rx(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ca(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){mK(e);var s=We(e),i=We(t);j(s===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+s+" values but has "+i});for(var o=0;o<t.length;++o){var a=t[o],l=o!==t.length-1||a!==We(e.slice(o));j(t[o]===e[o]||!l,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Ca(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?fK(n,r,me().getBool("DEBUG")):rp(n,[],!0),Q.makeTensor(n,e,r)}function Ae(n,e){if((Ca(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ca(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return wc(n,[],[],e)}function lr(n,e){Bp(n);var t=bc(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return wc(n,null,t,e)}function Uu(n,e,t){if(Bp(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=bc(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return wc(n,e,r,t)}function c$(n,e,t){if(Bp(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=bc(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return wc(n,e,r,t)}function Gs(n,e,t){if(Bp(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=bc(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return wc(n,e,r,t)}function _We(n,e,t){if(Bp(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=bc(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return wc(n,e,r,t)}function kWe(n,e,t){if(Bp(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=bc(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return wc(n,e=e||r,r,t)}function CWe(n,e,t,r){return e===void 0&&(e=!0),Q.makeVariable(n,e,t,r)}function Vp(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Vp(n,"float32"),r=vn(n,"float32");return jr(t,r)}var s=pK(We(n),e);return Q.makeTensor(s,n,e)}function vn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=vn(n,"float32"),r=vn(n,"float32");return jr(t,r)}var s=sx(We(n),e);return Q.makeTensor(s,n,e)}function Sa(n,e,t){return Q.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function IWe(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return Q.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function t1(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return vn([0],r);var s=sx(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),s[0]=n;for(var i=1;i<s.length;i++)s[i]=s[i-1]+t;return lr(s,r)}var _K=G({onesLike_:function(n){var e=V(n,"x","onesLike");if(e.dtype==="complex64"){var t=_K(Gi(e)),r=Pt(ua(e));return jr(t,r)}return Q.runKernelFunc(function(s){return s.onesLike(e)},{$x:e},function(s,i){return{$x:function(){return Pt(s)}}})}}),Pt=G({zerosLike_:function(n){var e=V(n,"x","zerosLike");return Q.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return Pt(t)}}})}}),_r=G({concat_:function(n,e){e===void 0&&(e=0),j(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=e1(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),e=Er(e,t[0].shape)[0];var r=ip(t.map(function(a){return a.shape}),e);if(We(r)===0)return Gr([],r);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var s=t.map(function(a){return a.shape});wWe(s,e);var i=t,o={axis:e};return Q.runKernelFunc(function(a){return a.concat(t,e)},i,function(a){var l=s.map(function(u){return u[e]});return h$(a,l,e).map(function(u){return function(){return u}})},"Concat",o)}}),SWe=G({concat1d_:function(n){return _r(n,0)}}),EWe=G({concat2d_:function(n,e){return _r(n,e)}}),TWe=G({concat3d_:function(n,e){return _r(n,e)}}),NWe=G({concat4d_:function(n,e){return _r(n,e)}}),h$=G({split_:function(n,e,t){t===void 0&&(t=0);var r,s=V(n,"x","split");return t=Er(t,s.shape)[0],typeof e=="number"?(j(s.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(s.shape[t]/e)):(j(s.shape[t]===e.reduce(function(i,o){return i+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),Q.runKernelFunc(function(i){return i.split(s,r,t)},{$x:s},function(i){return{$x:function(){return _r(i,t)}}})}});function cd(n,e){return n(e={exports:{}},e.exports),e.exports}var AWe=cd(function(n){(function(e,t,r){function s(a){var l,u=this,c=(l=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var f=.02519603282416938*(l+=h.charCodeAt(d));f-=l=f>>>0,l=(f*=l)>>>0,l+=4294967296*(f-=l)}return 23283064365386963e-26*(l>>>0)});u.next=function(){var h=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=0|h)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function i(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function o(a,l){var u=new s(a),c=l&&l.state,h=u.next;return h.int32=function(){return 4294967296*u.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.alea=o})(0,n)}),RWe=cd(function(n){(function(e,t,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(0|a)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=0|u.charCodeAt(c),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xor128=o})(0,n)}),DWe=cd(function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^h^h<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(0|a)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=0|u.charCodeAt(c),c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xorwow=o})(0,n)}),$We=cd(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var u,c,h=l.x,d=l.i;return u=h[d],c=(u^=u>>>7)^u<<24,c^=(u=h[d+1&7])^u>>>10,c^=(u=h[d+3&7])^u>>>3,c^=(u=h[d+4&7])^u<<7,u=h[d+7&7],c^=(u^=u<<13)^u<<9,h[d]=c,l.i=d+1&7,c},function(u,c){var h,d=[];if(c===(0|c))d[0]=c;else for(c=""+c,h=0;h<c.length;++h)d[7&h]=d[7&h]<<15^c.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],u.x=d,u.i=0,h=256;h>0;--h)u.next()}(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xorshift7=o})(0,n)}),PWe=cd(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var u,c,h=l.w,d=l.X,f=l.i;return l.w=h=h+1640531527|0,c=d[f+34&127],u=d[f=f+1&127],c^=c<<13,u^=u<<17,c^=c>>>15,u^=u>>>12,c=d[f]=c^u,l.i=f,c+(h^h>>>16)|0},function(u,c){var h,d,f,p,m,g=[],v=128;for(c===(0|c)?(d=c,c=null):(c+="\0",d=0,v=Math.max(v,c.length)),f=0,p=-32;p<v;++p)c&&(d^=c.charCodeAt((p+32)%c.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,f=(h=g[127&p]^=d+m)==0?f+1:0);for(f>=128&&(g[127&(c&&c.length||0)]=-1),f=127,p=512;p>0;--p)d=g[f+34&127],h=g[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[f]=d^h;u.w=m,u.X=g,u.i=f}(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.xor4096=o})(0,n)}),OWe=cd(function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=0|a):u+=a;for(var c=0;c<u.length+20;c++)l.b^=0|u.charCodeAt(c),l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}t&&t.exports?t.exports=o:this.tychei=o})(0,n)}),jc=cd(function(n){(function(e,t){var r,s=this,i=256,o=6,a="random",l=t.pow(i,o),u=t.pow(2,52),c=2*u,h=i-1;function d(v,y,x){var b=[],_=m(function C(S,T){var N,R=[],D=typeof S;if(T&&D=="object")for(N in S)try{R.push(C(S[N],T-1))}catch{}return R.length?R:D=="string"?S:S+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[v,g(e)]:v??function(){try{var C;return r&&(C=r.randomBytes)?C=C(i):(C=new Uint8Array(i),(s.crypto||s.msCrypto).getRandomValues(C)),g(C)}catch{var S=s.navigator,T=S&&S.plugins;return[+new Date,s,T,s.screen,g(e)]}}(),3),b),E=new f(b),I=function(){for(var C=E.g(o),S=l,T=0;C<u;)C=(C+T)*i,S*=i,T=E.g(1);for(;C>=c;)C/=2,S/=2,T>>>=1;return(C+T)/S};return I.int32=function(){return 0|E.g(4)},I.quick=function(){return E.g(4)/4294967296},I.double=I,m(g(E.S),e),(y.pass||x||function(C,S,T,N){return N&&(N.S&&p(N,E),C.state=function(){return p(E,{})}),T?(t[a]=C,S):C})(I,_,"global"in y?y.global:this==t,y.state)}function f(v){var y,x=v.length,b=this,_=0,E=b.i=b.j=0,I=b.S=[];for(x||(v=[x++]);_<i;)I[_]=_++;for(_=0;_<i;_++)I[_]=I[E=h&E+v[_%x]+(y=I[_])],I[E]=y;(b.g=function(C){for(var S,T=0,N=b.i,R=b.j,D=b.S;C--;)S=D[N=h&N+1],T=T*i+D[h&(D[N]=D[R=h&R+S])+(D[R]=S)];return b.i=N,b.j=R,T})(i)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function m(v,y){for(var x,b=v+"",_=0;_<b.length;)y[h&_]=h&(x^=19*y[h&_])+b.charCodeAt(_++);return g(y)}function g(v){return String.fromCharCode.apply(0,v)}if(t["seed"+a]=d,m(t.random(),e),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});jc.alea=AWe,jc.xor128=RWe,jc.xorwow=DWe,jc.xorshift7=$We,jc.xor4096=PWe,jc.tychei=OWe;var Ok=jc.alea,d$=function(){function n(e,t,r,s,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Ok(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,s=!1;!s;){var i=void 0,o=void 0,a=void 0;do a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o;while(a>=1||a===0);var l=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*i*l,r=this.mean+this.stdDev*o*l,this.truncated&&!this.isValidTruncated(t)||(s=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),FWe=function(){function n(e,t,r,s){this.alpha=e,this.beta=1/t,this.dtype=r;var i=s||Math.random();this.randu=Ok(i.toString()),this.randn=new d$(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,s,i,o;;){do s=this.randn.nextValue(),o=1+this.c*s;while(o<=0);if(o*=o*o,t=1-.331*(e=s*s)*e,r=.5*e+this.d*(1-o+Math.log(o)),(i=this.randu())<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),MWe=function(){function n(e,t,r,s){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Ok(s)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function ut(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",mK(n),new uv(n,e,t)}function LWe(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var kK=G({batchToSpaceND_:function(n,e,t){var r=V(n,"x","batchToSpaceND"),s=e.reduce(function(i,o){return i*o});return j(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),j(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),j(r.shape[0]%s==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+s}),Q.runKernelFunc(function(i){return i.batchToSpaceND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(e,t)}}})}}),BWe=G({broadcastTo_:function(n,e){var t=V(n,"broadcastTo","x"),r=t.shape;if(e.some(function(l){return!(l>0)||l%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var s=t.shape.slice();s.length<e.length;)s.unshift(1);t=t.reshape(s)}for(var i=Array.from(e),o=e.length-1;o>=0;o--)if(t.shape[o]===e[o])i[o]=1;else if(t.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=i.map(function(l,u){return l>1?u:-1}).filter(function(l){return l>=0});return a.length===0?t.clone():Q.runKernelFunc(function(l){return l.tile(t,i)},{input:t},function(l){return{input:function(){return l.sum(a,!0)}}})}}),VWe=G({cast_:function(n,e){var t=V(n,"x","cast");if(!Dje(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return Q.runKernelFunc(function(s){return s.cast(t,e)},{x:t},function(s){return{x:function(){return s.clone()}}},"Cast",r)}}),zWe=G({clone_:function(n){var e=V(n,"x","clone",null);return Q.runKernelFunc(function(){return Q.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),UWe=G({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var s=V(n,"x","cumsum"),i=Ba([e|=0],s.rank),o=s;i!=null&&(o=s.transpose(i));var a=Va(1,s.rank)[0],l=Q.runKernelFunc(function(u){return u.cumsum(o,a,t,r)},{permutedX:o},function(u){return{permutedX:function(){return u.cumsum(e,t,!r)}}});return i!=null&&(l=l.transpose(i)),l}}),jWe=G({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=V(n,"x","depthToSpace"),s=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];return j(s*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),j(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+` for depthToSpace with input shape
          `+r.shape}),j(o%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+r.shape}),Q.runKernelFunc(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),ji=G({expandDims_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","expandDims",null);j(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(j(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),To(t,r)}}),CK=G({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var s=ut([n,e],r),i=n<=e?n:e,o=0;o<i;++o)s.set(1,o,o);var a=s.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return xf(ji(a,0),[t[0],1,1]);if(t.length===2)return xf(ji(ji(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return xf(ji(ji(ji(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),WWe=G({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var s=V(n,"logits","multinomial"),i=s.size,o=s.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var a=o===1?s.as2D(1,-1):s,l=Q.runKernelFunc(function(u){return u.multinomial(a,r,e,t)},{logits2D:a});return o===1?l.as1D():l}}),RE=G({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var s=V(n,"indices","oneHot","int32"),i=s.shape.concat([e]);return s=s.flatten(),Q.runKernelFunc(function(o){return o.oneHot(s,e,t,r)},{$indices:s},function(o){return{$indices:function(){return vn(s.shape,"float32")}}}).reshape(i)}}),hd=G({pad_:function(n,e,t){t===void 0&&(t=0);var r=V(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:e,constantValue:t};return Q.runKernelFunc(function(i){return i.pad(r,e,t)},{x:r},function(i){var o=e.map(function(a){return a[0]});return{x:function(){return i.slice(o,r.shape)}}},"PadV2",s)}}),HWe=G({pad1d_:function(n,e,t){return t===void 0&&(t=0),j(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),hd(n,[e],t)}}),GWe=G({pad2d_:function(n,e,t){return t===void 0&&(t=0),j(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hd(n,e,t)}}),qWe=G({pad3d_:function(n,e,t){return t===void 0&&(t=0),j(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hd(n,e,t)}}),KWe=G({pad4d_:function(n,e,t){return t===void 0&&(t=0),j(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hd(n,e,t)}}),XWe=G({rand_:function(n,e,t){var r=We(n),s=null;if(t==null||t==="float32")s=new Float32Array(r);else if(t==="int32")s=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);s=new Uint8Array(r)}for(var i=0;i<r;i++)s[i]=e();return Q.makeTensor(s,n,t)}}),YWe=G({randomNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new d$(e,t,r,!1,s),o=ut(n,r),a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}}),QWe=G({randomGamma_:function(n,e,t,r,s){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new FWe(e,t,r,s),o=ut(n,r),a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}}),IK=G({randomUniform_:function(n,e,t,r,s){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var i=ut(n,r),o=new MWe(e,t,null,s),a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}}),To=G({reshape_:function(n,e){var t=V(n,"x","reshape",null);e=Aje(e,t.size),j(t.size===We(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return Q.runKernelFunc(function(s){return s.reshape(t,e)},{x:t},function(s){return{x:function(){return s.reshape(t.shape)}}},"Reshape",r)}}),SK=G({spaceToBatchND_:function(n,e,t){var r=V(n,"x","spaceToBatchND");return j(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),j(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),j(r.shape.reduce(function(s,i,o){return o>0&&o<=e.length?s&&(i+t[o-1][0]+t[o-1][1])%e[o-1]==0:s},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),Q.runKernelFunc(function(s){return s.spaceToBatchND(r,e,t)},{$x:r},function(s){return{$x:function(){return s.batchToSpaceND(e,t)}}})}}),EK=G({squeeze_:function(n,e){var t=V(n,"x","squeeze");return To(t,qc(t.shape,e).newShape)}}),Ci=G({stack_:function(n,e){e===void 0&&(e=0);var t=e1(n,"tensors","stack");if(j(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,s=t[0].shape,i=t[0].dtype;j(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){Kt(s,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){j(i===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=t.map(function(a){return a.expandDims(e)});return _r(o,e)}}),xf=G({tile_:function(n,e){var t=V(n,"x","tile",null);j(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],s={reps:e};return Q.runKernelFunc(function(i,o){var a=i.tile(t,e);return o([t]),a},{x:t},function(i,o){var a=o[0];return{x:function(){var l=Pt(a);if(a.rank===1)for(var u=0;u<e[0];++u)l=l.add(i.slice([u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(u=0;u<e[0];++u)for(var c=0;c<e[1];++c)l=l.add(i.slice([u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(u=0;u<e[0];++u)for(c=0;c<e[1];++c)for(var h=0;h<e[2];++h)l=l.add(i.slice([u*a.shape[0],c*a.shape[1],h*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(u=0;u<e[0];++u)for(c=0;c<e[1];++c)for(h=0;h<e[2];++h)for(var d=0;d<e[3];++d)l=l.add(i.slice([u*a.shape[0],c*a.shape[1],h*a.shape[2],d*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return l}}},"Tile",s,r)}}),JWe=G({truncatedNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new d$(e,t,r,!0,s),o=ut(n,r),a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}}),kr=G({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=V(n,"x","unstack");j(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return Q.runKernelFunc(function(s){return s.unstack(t,e)},{x:t},function(s){return{x:function(){return Ci(s,e)}}},"Unpack",r)}}),ZWe=function(n,e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a,l,u,c,h;return Ve(this,function(d){switch(d.label){case 0:return t=V(n,"x","setdiff1d"),r=V(e,"y","setdiff1d"),j(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),j(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),j(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return s=d.sent(),[4,r.data()];case 2:for(i=d.sent(),o=new Set(i),a=0,c=0;c<s.length;c++)o.has(s[c])||a++;for(l=new uv([a],t.dtype),u=new uv([a],"int32"),c=0,h=0;c<s.length;c++)o.has(s[c])||(l.values[h]=s[c],u.values[h]=c,h++);return[2,[l.toTensor(),u.toTensor()]]}})})};function n1(n,e,t,r){r===void 0&&(r=!0);var s=[];if(r)(s=s.concat(e.slice(0))).push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);for(var i=e.length,o=0;o<i;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(i+1))}return s}function r1(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{var i=[],o=[];for(s=1;s<n;++s)s>=2*e+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function s1(n,e,t,r){r===void 0&&(r=!0);var s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(var i=1;i<n.length;++i)i<=e.length?r?s.push(e[i-1]*n[i]):s.push(n[i]/e[i-1]):s.push(n[i]);return s}function TK(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function NK(n,e,t){for(var r=n.slice(0,1),s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}function AK(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],s=1,i=0;i<t.length-1;++i)s*=t[i];var o=n.shape,a=t.slice();a.pop();var l=1;for(i=r;i<n.rank;++i)l*=o[i],a.push(o[i]);var u=Ia(n.shape).map(function(c){return c/l}).concat([1]).slice(0,r);return[a,s,l,u]}var RK=30;function L2(n){return n<=RK?n:IE(n,Math.floor(Math.sqrt(n)))}function e6e(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+s+".";if(t.rank<s)throw new Error(i+" update.rank < "+s+". ");if(n.length<r+(t.rank-s))throw new Error(i+" Output shape length < "+(r+(t.rank-s)));if(t.rank!==s+n.length-r)throw new Error(i+" update.rank != "+(s+n.length-r));for(var o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(i+" updates.shape["+(o+s)+"] ("+t.shape[o+s]+") != shape["+(o+s)+"] ("+n[o+s]+")")}function t6e(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}e6e(t,e,n)}function i1(n,e,t){for(var r=e.shape.length,s=r>1?e.shape[r-1]:1,i=t.length,o=1,a=s;a<i;++a)o*=t[a];var l=s<1?1:s;return{sliceRank:s,numUpdates:We(e.shape)/l,sliceSize:o,strides:Ia(t.slice(0,s)).concat([1]),outputSize:We(t)}}function n6e(n,e,t){j(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),j(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(i){j(e[i]+t[i]<=n.shape[i],function(){return"Error in slice"+n.rank+"D: begin["+i+"] + size["+i+"] ("+(e[i]+t[i])+") would overflow input.shape["+i+"] ("+n.shape[i]+")"})},s=0;s<n.rank;++s)r(s)}function xB(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function f$(n,e,t){for(var r=[],s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function r6e(n,e,t,r,s){var i=e[s],o=t[s]||1;(n&1<<s||i==null)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[s];return i<0&&(i+=a),i=_E(0,i,a-1)}function s6e(n,e,t,r,s){var i=e[s],o=t[s]||1;(n&1<<s||i==null)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[s];return i<0&&(i+=a),i=o>0?_E(0,i,a):_E(-1,i,a-1)}function DK(n,e,t){for(var r=t.length,s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function $K(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function i6e(n,e){j(CE(n),function(){return"The f passed in variableGrads(f) must be a function"}),j(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof sp}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],Q.registeredVariables)e.push(Q.registeredVariables[r]);var s=t?e.filter(function(c){return!c.trainable}):null,i=e.length;j((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var o=Q.gradients(n,e,null,!0),a=o.value,l=o.grads;j(l.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),j(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var u={};return e.forEach(function(c,h){l[h]!=null&&(u[c.name]=l[h])}),s!=null&&s.forEach(function(c){return u[c.name]=null}),{value:a,grads:u}}function Fk(n){return Q.customGrad(n)}var zl=G({softmax_:function(n,e){e===void 0&&(e=-1);var t=V(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return Q.runKernelFunc(function(r,s){var i=r.softmax(t,e);return s([i]),i},{logits:t},function(r,s){var i=s[0],o=r.mul(i);return{logits:function(){return o.sub(o.sum([e],!0).mul(i))}}},"Softmax",{dim:e},[],[!0])}}),o6e=G({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=V(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Fk(function(r,s){var i=r.max(e,!0),o=r.sub(i),a=o.toFloat().sub(o.exp().sum(e,!0).log());return s([a]),{value:a,gradFunc:function(l,u){var c=u[0].exp();return l.sub(l.sum(e,!0).mul(c))}}})(t)}}),PK=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),OK=function(){function n(){}return n.prototype.time=function(e){return ae("time")},n.prototype.read=function(e){return ae("read")},n.prototype.readSync=function(e){return ae("readSync")},n.prototype.numDataIds=function(){return ae("numDataIds")},n.prototype.disposeData=function(e){return ae("disposeData")},n.prototype.write=function(e,t,r){return ae("write")},n.prototype.move=function(e,t,r,s){return ae("move")},n.prototype.memory=function(){return ae("memory")},n.prototype.floatPrecision=function(){return ae("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,s){return ae("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,ae("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return ae("slice")},n.prototype.stridedSlice=function(e,t,r,s){return ae("stridedSlice")},n.prototype.unstack=function(e,t){return ae("unstack")},n.prototype.reverse=function(e,t){return ae("reverse")},n.prototype.concat=function(e,t){return ae("concat")},n.prototype.neg=function(e){return ae("neg")},n.prototype.add=function(e,t){return ae("add")},n.prototype.addN=function(e){return ae("addN")},n.prototype.subtract=function(e,t){return ae("subtract")},n.prototype.multiply=function(e,t){return ae("multiply")},n.prototype.realDivide=function(e,t){return ae("realDivide")},n.prototype.floorDiv=function(e,t){return ae("floorDiv")},n.prototype.sum=function(e,t){return ae("sum")},n.prototype.prod=function(e,t){return ae("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return ae("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return ae("argMin")},n.prototype.argMax=function(e,t){return ae("argMax")},n.prototype.equal=function(e,t){return ae("equal")},n.prototype.notEqual=function(e,t){return ae("notEqual")},n.prototype.less=function(e,t){return ae("less")},n.prototype.lessEqual=function(e,t){return ae("lessEqual")},n.prototype.greater=function(e,t){return ae("greater")},n.prototype.greaterEqual=function(e,t){return ae("greaterEqual")},n.prototype.logicalNot=function(e){return ae("logicalNot")},n.prototype.logicalAnd=function(e,t){return ae("logicalAnd")},n.prototype.logicalOr=function(e,t){return ae("logicalOr")},n.prototype.where=function(e){return ae("where")},n.prototype.select=function(e,t,r){return ae("select")},n.prototype.topk=function(e,t,r){return ae("topk")},n.prototype.min=function(e,t){return ae("min")},n.prototype.minimum=function(e,t){return ae("minimum")},n.prototype.mod=function(e,t){return ae("mod")},n.prototype.max=function(e,t){return ae("max")},n.prototype.maximum=function(e,t){return ae("maximum")},n.prototype.all=function(e,t){return ae("all")},n.prototype.any=function(e,t){return ae("any")},n.prototype.squaredDifference=function(e,t){return ae("squaredDifference")},n.prototype.ceil=function(e){return ae("ceil")},n.prototype.floor=function(e){return ae("floor")},n.prototype.round=function(e){return ae("round")},n.prototype.sign=function(e){return ae("sign")},n.prototype.isNaN=function(e){return ae("isNaN")},n.prototype.isInf=function(e){return ae("isInf")},n.prototype.isFinite=function(e){return ae("isFinite")},n.prototype.pow=function(e,t){return ae("pow")},n.prototype.exp=function(e){return ae("exp")},n.prototype.expm1=function(e){return ae("expm1")},n.prototype.softmax=function(e,t){return ae("softmax")},n.prototype.log=function(e){return ae("log")},n.prototype.log1p=function(e){return ae("log1p")},n.prototype.sqrt=function(e){return ae("sqrt")},n.prototype.rsqrt=function(e){return ae("rsqrt")},n.prototype.square=function(e){return ae("square")},n.prototype.reciprocal=function(e){return ae("reciprocal")},n.prototype.relu=function(e){return ae("relu")},n.prototype.relu6=function(e){return ae("relu6")},n.prototype.prelu=function(e,t){return ae("prelu")},n.prototype.elu=function(e){return ae("elu")},n.prototype.eluDer=function(e,t){return ae("eluDer")},n.prototype.selu=function(e){return ae("selu")},n.prototype.int=function(e){return ae("int")},n.prototype.clip=function(e,t,r){return ae("clip")},n.prototype.abs=function(e){return ae("abs")},n.prototype.complexAbs=function(e){return ae("complexAbs")},n.prototype.sigmoid=function(e){return ae("sigmoid")},n.prototype.softplus=function(e){return ae("softplus")},n.prototype.sin=function(e){return ae("sin")},n.prototype.cos=function(e){return ae("cos")},n.prototype.tan=function(e){return ae("tan")},n.prototype.asin=function(e){return ae("asin")},n.prototype.acos=function(e){return ae("acos")},n.prototype.atan=function(e){return ae("atan")},n.prototype.atan2=function(e,t){return ae("atan2")},n.prototype.sinh=function(e){return ae("sinh")},n.prototype.cosh=function(e){return ae("cosh")},n.prototype.tanh=function(e){return ae("tanh")},n.prototype.asinh=function(e){return ae("asinh")},n.prototype.acosh=function(e){return ae("acosh")},n.prototype.atanh=function(e){return ae("atanh")},n.prototype.erf=function(e){return ae("erf")},n.prototype.step=function(e,t){return ae("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,ae("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return ae("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return ae("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return ae("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,ae("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return ae("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return ae("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return ae("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return ae("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return ae("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return ae("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return ae("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,s){return ae("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return ae("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return ae("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return ae("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return ae("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return ae("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,s){return ae("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return ae("reshape")},n.prototype.cast=function(e,t){return ae("cast")},n.prototype.tile=function(e,t){return ae("tile")},n.prototype.pad=function(e,t,r){return ae("pad")},n.prototype.transpose=function(e,t){return ae("transpose")},n.prototype.gather=function(e,t,r){return ae("gather")},n.prototype.gatherND=function(e,t){return ae("gatherND")},n.prototype.scatterND=function(e,t,r){return ae("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return ae("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return ae("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,s){return ae("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return ae("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,s){return ae("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return ae("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,s,i,o){return ae("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,s,i){return ae("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,s,i,o,a){return ae("LRNGrad")},n.prototype.multinomial=function(e,t,r,s){return ae("multinomial")},n.prototype.oneHot=function(e,t,r,s){return ae("oneHot")},n.prototype.cumsum=function(e,t,r,s){return ae("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,s,i){return ae("nonMaxSuppression")},n.prototype.fft=function(e){return ae("fft")},n.prototype.ifft=function(e){return ae("ifft")},n.prototype.complex=function(e,t){return ae("complex")},n.prototype.real=function(e){return ae("real")},n.prototype.imag=function(e){return ae("imag")},n.prototype.cropAndResize=function(e,t,r,s,i,o){return ae("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return ae("depthToSpace")},n.prototype.split=function(e,t,r){return ae("split")},n.prototype.sparseToDense=function(e,t,r,s){return ae("sparseToDense")},n.prototype.diag=function(e){return ae("diag")},n.prototype.fill=function(e,t,r){return ae("fill")},n.prototype.onesLike=function(e){return ae("onesLike")},n.prototype.zerosLike=function(e){return ae("zerosLike")},n.prototype.linspace=function(e,t,r){return ae("linspace")},n.prototype.dispose=function(){return ae("dispose")},n}();function ae(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function bu(n,e){for(var t=n.length,r=[],s=0;s<t;s++){var i=t-1-s,o=n[i]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(i)}return r}function Cr(n,e){for(var t=[],r=0;r<e.length;r++){var s=n[n.length-r-1],i=e.length-r-1,o=e[i];(s==null||s===1&&o>1)&&t.unshift(i)}return t}function It(n,e){for(var t=[],r=Math.max(n.length,e.length),s=0;s<r;s++){var i=n[n.length-s-1];i==null&&(i=1);var o=e[e.length-s-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(i)}}return t}function hv(n,e,t,r,s,i,o){o===void 0&&(o="channelsLast");var a,l=l1(e),u=l[0],c=l[1];if(o==="channelsLast")a=[u,c,n[3],n[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);a=[u,c,n[1],n[1]]}return dd(n,a,t,r,s,i,!1,o)}function o1(n,e,t,r,s,i,o){o===void 0&&(o="NDHWC");var a,l,u=DE(e),c=u[0],h=u[1],d=u[2];if(o==="NDHWC")l="channelsLast",a=[c,h,d,n[4],n[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);l="channelsFirst",a=[c,h,d,n[1],n[1]]}return a1(n,a,t,r,s,!1,l,i)}function dd(n,e,t,r,s,i,o,a){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var l=[-1,-1,-1,-1],u=l[0],c=l[1],h=l[2],d=l[3];if(a==="channelsLast")u=n[0],c=n[1],h=n[2],d=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=n[0],d=n[1],c=n[2],h=n[3]}var f,p=e[0],m=e[1],g=e[3],v=l1(t),y=v[0],x=v[1],b=l1(r),_=b[0],E=b[1],I=bf(p,_),C=bf(m,E),S=function(z,L,O,F,P,U,W,X){var Z,ne,he;if(typeof z=="number"){Z={top:z,bottom:z,left:z,right:z,type:z===0?"VALID":"NUMBER"};var le=function(Se,Ue,je,tt,Qe){tt==null&&(tt=FK(Se,Ue,je));var Xe=Se[0],Ct=Se[1],_t=hg((Xe-Ue+2*tt)/je+1,Qe);j(nr(_t),function(){return"The output # of rows ("+_t+") must be an integer. Change the stride and/or zero pad parameters"});var ln=hg((Ct-Ue+2*tt)/je+1,Qe);return j(nr(ln),function(){return"The output # of columns ("+ln+") must be an integer. Change the stride and/or zero pad parameters"}),[_t,ln]}([L,O],U,F,z,X);ne=le[0],he=le[1]}else if(z==="same"){ne=Math.ceil(L/F),he=Math.ceil(O/P);var pe=Math.max(0,(ne-1)*F+U-L),be=Math.max(0,(he-1)*P+W-O),Ce=Math.floor(pe/2),ke=pe-Ce,$e=Math.floor(be/2);Z={top:Ce,bottom:ke,left:$e,right:be-$e,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);Z={top:0,bottom:0,left:0,right:0,type:"VALID"},ne=Math.ceil((L-U+1)/F),he=Math.ceil((O-W+1)/P)}return{padInfo:Z,outHeight:ne,outWidth:he}}(s,c,h,y,x,I,C,i),T=S.padInfo,N=S.outHeight,R=S.outWidth,D=o?g*d:g;return a==="channelsFirst"?f=[u,D,N,R]:a==="channelsLast"&&(f=[u,N,R,D]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:h,inChannels:d,outHeight:N,outWidth:R,outChannels:D,padInfo:T,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:I,effectiveFilterWidth:C,dilationHeight:_,dilationWidth:E,inShape:n,outShape:f,filterShape:e}}function a1(n,e,t,r,s,i,o,a){i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=[-1,-1,-1,-1,-1],u=l[0],c=l[1],h=l[2],d=l[3],f=l[4];if(o==="channelsLast")u=n[0],c=n[1],h=n[2],d=n[3],f=n[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=n[0],f=n[1],c=n[2],h=n[3],d=n[4]}var p,m=e[0],g=e[1],v=e[2],y=e[4],x=DE(t),b=x[0],_=x[1],E=x[2],I=DE(r),C=I[0],S=I[1],T=I[2],N=bf(m,C),R=bf(g,S),D=bf(v,T),z=function(W,X,Z,ne,he,le,pe,be,Ce,ke,$e){var Se,Ue,je,tt;if(typeof W=="number"){Se={top:W,bottom:W,left:W,right:W,front:W,back:W,type:W===0?"VALID":"NUMBER"};var Qe=function(Ln,Bn,Qt,jt,Cn,$i){Cn==null&&(Cn=FK(Ln,Bn,jt));var Gl=Ln[0],kc=Ln[1],za=Ln[2],po=hg((Gl-Bn+2*Cn)/jt+1,$i);j(nr(po),function(){return"The output # of depths ("+po+") must be an integer. Change the stride and/or zero pad parameters"});var ql=hg((kc-Bn+2*Cn)/jt+1,$i);j(nr(ql),function(){return"The output # of rows ("+ql+") must be an integer. Change the stride and/or zero pad parameters"});var Ua=hg((za-Bn+2*Cn)/jt+1,$i);return j(nr(Ua),function(){return"The output # of columns ("+Ua+") must be an integer. Change the stride and/or zero pad parameters"}),[po,ql,Ua,Qt]}([X,Z,ne,1],be,1,he,W,$e);Ue=Qe[0],je=Qe[1],tt=Qe[2]}else if(W==="same"){Ue=Math.ceil(X/he),je=Math.ceil(Z/le),tt=Math.ceil(ne/pe);var Xe=(Ue-1)*he+be-X,Ct=(je-1)*le+Ce-Z,_t=(tt-1)*pe+ke-ne,ln=Math.floor(Xe/2),Yt=Xe-ln,Xn=Math.floor(Ct/2),kn=Ct-Xn,Yn=Math.floor(_t/2);Se={top:Xn,bottom:kn,left:Yn,right:_t-Yn,front:ln,back:Yt,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Se={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ue=Math.ceil((X-be+1)/he),je=Math.ceil((Z-Ce+1)/le),tt=Math.ceil((ne-ke+1)/pe)}return{padInfo:Se,outDepth:Ue,outHeight:je,outWidth:tt}}(s,c,h,d,b,_,E,N,R,D,a),L=z.padInfo,O=z.outDepth,F=z.outHeight,P=z.outWidth,U=i?y*f:y;return o==="channelsFirst"?p=[u,U,O,F,P]:o==="channelsLast"&&(p=[u,O,F,P,U]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:h,inWidth:d,inChannels:f,outDepth:O,outHeight:F,outWidth:P,outChannels:U,padInfo:L,strideDepth:b,strideHeight:_,strideWidth:E,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:N,effectiveFilterHeight:R,effectiveFilterWidth:D,dilationDepth:C,dilationHeight:S,dilationWidth:T,inShape:n,outShape:p,filterShape:e}}function FK(n,e,t,r){r===void 0&&(r=1);var s=bf(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function l1(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function DE(n){return typeof n=="number"?[n,n,n]:n}function bf(n,e){return e<=1?n:n+(n-1)*(e-1)}function hg(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function op(n){var e=l1(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function ai(n,e){return op(n)||op(e)}function p$(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function MK(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=vn(n.shape),s=n.toFloat(),i=t.complex(s,r);return r.dispose(),s.dispose(),i}if(!$je(n.dtype,e))return Q.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var o=t.real(n);return i=o.cast(e),o.dispose(),i}if(e==="int32")return t.int(n);if(e==="bool"){var a=Ae(0,n.dtype);return i=t.notEqual(n,a),a.dispose(),i}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function $E(n,e){return Q.makeTensorFromDataId(n.dataId,e,n.dtype)}function LK(n,e,t){var r=(e-n)/(t-1),s=sx(t,"float32");s[0]=n;for(var i=1;i<s.length;i++)s[i]=s[i-1]+r;return lr(s,"float32")}function PE(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function bB(n,e){return{real:n[2*e],imag:n[2*e+1]}}function a6e(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function l6e(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function u6e(n,e,t){var r=function(i,o,a){return function(l,u,c){for(var h=0,d=l.length,f=0,p=!1;h<d;){var m=c(u,l[f=h+(d-h>>>1)]);m>0?h=f+1:(d=f,p=!m)}return p?h:-h-1}(i,o,a||c6e)}(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function c6e(n,e){return n>e?1:n<e?-1:0}function m$(n,e,t,r,s){return BK(n,e,t,r,s,0).selectedIndices}function g$(n,e,t,r,s,i){var o=BK(n,e,t,r,s,i);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function BK(n,e,t,r,s,i,o,a){a===void 0&&(a=!1);for(var l=Array.from(e).map(function(b,_){return{score:b,boxIndex:_,suppressBeginIndex:0}}).filter(function(b){return b.score>s}).sort(wB),u=i>0?-.5/i:0,c=[],h=[];c.length<t&&l.length>0;){var d=l.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<s)break;for(var g=!1,v=c.length-1;v>=m;--v){var y=h6e(n,p,c[v]);if(y>=r){g=!0;break}if(d.score=d.score*d6e(r,u,y),d.score<=s)break}d.suppressBeginIndex=c.length,g||(d.score===f?(c.push(p),h.push(d.score)):d.score>s&&u6e(l,d,wB))}var x=c.length;return a&&(c.fill(0,x),h.fill(0,x)),{selectedIndices:lr(c,"int32"),selectedScores:lr(h,"float32"),numValidOutputs:Ae(x,"int32")}}function h6e(n,e,t){var r=n.subarray(4*e,4*e+4),s=n.subarray(4*t,4*t+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),h=Math.max(s[0],s[2]),d=Math.max(s[1],s[3]),f=(a-i)*(l-o),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;var m=Math.max(i,u),g=Math.max(o,c),v=Math.min(a,h),y=Math.min(l,d),x=Math.max(v-m,0)*Math.max(y-g,0);return x/(f+p-x)}function d6e(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function wB(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function VK(n,e,t){var r=new Array(n.rank).fill(0),s=n.shape.slice();return e.map(function(i){s[t]=i;var o=n.slice(r,s);return r[t]+=i,o})}function zK(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var s=ut(t,n.dtype);for(r=0;r<s.values.length;++r){for(var i=s.indexToLoc(r),o=new Array(n.rank),a=0;a<o.length;a++)o[a]=i[a]%n.shape[a];var l=n.locToIndex(o);s.values[r]=n.values[l]}return s.toTensor()}function UK(n,e,t,r,s){for(var i=e[e.length-1],o=[n.length/i,i],a=o[0],l=o[1],u=lv(t,a*r),c=lv("int32",a*r),h=0;h<a;h++){for(var d=h*l,f=n.subarray(d,d+l),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(b,_){return _.value-b.value});var g=h*r,v=u.subarray(g,g+r),y=c.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var x=e.slice();return x[x.length-1]=r,[Gr(u,x,t),Gr(c,x,"int32")]}function v$(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var s=ut(n,"int32"),i=ut([t.length,n.length],"int32");for(r=0;r<t.length;r++){var o=s.indexToLoc(t[r]),a=r*n.length;i.values.set(o,a)}return i.toTensor()}var f6e=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(s,i){return"T"+i});var t=[];this.variableNames.forEach(function(s){t.push("float v"+s+" = get"+s+"AtOutCoords();")});var r=this.variableNames.map(function(s){return"v"+s}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},p6e=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(s,i){return"T"+i});var t=[];this.variableNames.forEach(function(s){t.push("vec4 v"+s+" = get"+s+"AtOutCoords();")});var r=this.variableNames.map(function(s){return"v"+s}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},m6e=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,s=n.batchSize,i=n.inSize,o=Math.ceil(i/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];var a=e==="max"?">":"<",l=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function jK(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function Xs(n,e){return e===1?[n]:jK(n,e)}function xs(){var n,e,t,r,s,i,o,a,l,u;return me().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",i="outputColor",o="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function rh(n,e,t){t===void 0&&(t="index");var r=Ia(e);return r.map(function(s,i){return"int "+n[i]+" = "+t+" / "+s+"; "+(i===r.length-1?"int "+n[i+1]+" = "+t+" - "+n[i]+" * "+s:"index -= "+n[i]+" * "+s)+";"}).join("")}function y$(n){var e=Ia(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var WK=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function g6e(n,e,t,r){var s=[];n.forEach(function(f){var p=We(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?s.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(s.push("uniform sampler2D "+f.name+";"),s.push("uniform int offset"+f.name+";"))});var i,o,a=s.join(`
`),l=n.map(function(f){return function(p,m,g){g===void 0&&(g=!1);var v="";v+=g?HK(p):Md(p);var y=p.shapeInfo.logicalShape,x=m.logicalShape;return y.length<=x.length&&(v+=g?function(b,_){var E,I=b.name,C=I.charAt(0).toUpperCase()+I.slice(1),S="get"+C+"AtOutCoords",T=b.shapeInfo.logicalShape.length,N=_.logicalShape.length,R=bu(b.shapeInfo.logicalShape,_.logicalShape),D=pn(N),z=N-T,L=["x","y","z","w","u","v"];E=T===0?"":N<2&&R.length>=1?"coords = 0;":R.map(function(Z){return"coords."+L[Z+z]+" = 0;"}).join(`
`);var O="";O=N<2&&T>0?"coords":b.shapeInfo.logicalShape.map(function(Z,ne){return"coords."+L[ne+z]}).join(", ");var F="return outputValue;",P=We(b.shapeInfo.logicalShape)===1,U=We(_.logicalShape)===1;if(T!==1||P||U){if(P&&!U)F=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(R.length){var W=T-2,X=T-1;R.indexOf(W)>-1&&R.indexOf(X)>-1?F="return vec4(outputValue.x);":R.indexOf(W)>-1?F="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":R.indexOf(X)>-1&&(F="return vec4(outputValue.xx, outputValue.zz);")}}else F=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+S+`() {
      `+D+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+C+"("+O+`);
      `+F+`
    }
  `}(p,m):function(b,_){var E=b.name,I=E.charAt(0).toUpperCase()+E.slice(1),C="get"+I+"AtOutCoords",S=_.texShape,T=b.shapeInfo.texShape,N=b.shapeInfo.logicalShape.length,R=_.logicalShape.length;if(!b.shapeInfo.isUniform&&N===R&&b.shapeInfo.flatOffset==null&&Fr(T,S))return`
      float `+C+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var D,z=pn(R),L=bu(b.shapeInfo.logicalShape,_.logicalShape),O=R-N,F=["x","y","z","w","u","v"];D=N===0?"":R<2&&L.length>=1?"coords = 0;":L.map(function(U){return"coords."+F[U+O]+" = 0;"}).join(`
`);var P="";return P=R<2&&N>0?"coords":b.shapeInfo.logicalShape.map(function(U,W){return"coords."+F[W+O]}).join(", "),`
    float `+C+`() {
      `+z+` coords = getOutputCoords();
      `+D+`
      return get`+I+"("+P+`);
    }
  `}(p,m)),v}(f,e,r)}).join(`
`),u=e.texShape,c=xs(),h=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(c),d=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+v6e+`
    `+y6e+`
    `+x6e+`
  `}(c);return e.isPacked?(i=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,_){var E=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,_){var E=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];if(Fr(b,_))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var I=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+I+`);
      int c = imod(index, `+I+`) * 2;

      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=f,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],y=Math.ceil(m[2]/2),x=y*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,_){for(var E=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],I=Math.ceil(b[b.length-1]/2),C=I*Math.ceil(b[b.length-2]/2),S=C,T="",N="b, r, c",R=2;R<b.length-1;R++)S*=b[b.length-R-1],T=`
      int b`+R+" = index / "+S+`;
      index -= b`+R+" * "+S+`;
    `+T,N="b"+R+", "+N;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+T+`

      int b = index / `+C+`;
      index -= b * `+C+`;

      int r = 2 * (index / `+I+`);
      int c = imod(index, `+I+`) * 2;

      return ivec`+b.length+"("+N+`);
    }
  `}(f,p)}var m,g,v,y,x}(e.logicalShape,u),o=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(c)):(i=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,y){return Fr(v,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=p,g=rh(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,y){var x=rh(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(f,p);case 5:return function(v,y){var x=rh(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,p);case 6:return function(v,y){var x=rh(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var m,g}(e.logicalShape,u),o=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(d+=b6e),[d,h,o,a,i,l,t].join(`
`)}function Md(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+s+"() {return "+r+";}";var i=t.shapeInfo.texShape,o=i[0],a=i[1];if(o===1&&a===1)return`
      float `+s+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=t.shapeInfo.texShape,u=l[0],c=l[1],h=Oc(r);return`
    float `+s+`() {
      vec2 uv = uvFromFlat(`+u+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+s+`(int index) {
        `+Cd(t)+`
      }
    `;var i=t.shapeInfo.texShape,o=i[0],a=i[1];if(a===1&&o===1)return`
      float `+s+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=Oc(r);return a===1?`
      float `+s+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+o+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:o===1?`
      float `+s+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+s+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+a+", index + "+l+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape;if(o!=null&&Fr(r,o)){var a=o[0],l=o[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+a+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `}var u=qc(r),c=u.newShape,h=u.keptDims,d=c;if(d.length<r.length){var f=Ld(t,d);return`
      `+Md(f)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Bd(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Cd(t)+`
      }
    `;var p=o[0],m=o[1],g=Oc(s);return m===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+s+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+s+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[1]*r[2],a=r[2],l=qc(r),u=l.newShape,c=l.keptDims,h=u;if(h.length<r.length){var d=Ld(t,h);return`
        `+Md(d)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Bd(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+a+`, 1)));
        `+Cd(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],m=f[1],g=t.shapeInfo.flatOffset;if(m===o&&g==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+s+`, uv);
        }
      `;if(m===a&&g==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `;var v=Oc(s);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+a+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+s+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[3],a=r[2]*o,l=r[1]*a,u=qc(r),c=u.newShape,h=u.keptDims;if(c.length<r.length){var d=Ld(t,c);return`
      `+Md(d)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Bd(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+a+", "+o+`, 1)));
        `+Cd(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],g=p[1];if(g===l&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(g===o&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var v=Oc(s);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+v+`);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=r[4],a=r[3]*o,l=r[2]*a,u=r[1]*l,c=qc(r),h=c.newShape,d=c.keptDims;if(h.length<r.length){var f=Ld(t,h);return`
      `+Md(f)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Bd(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+l+", "+a+", "+o+`)) +
          depth3;
        `+Cd(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],v=m[1];if(v===u&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(v===o&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var y=Oc(s);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+l+" + depth * "+a+` +
          depth2 * `+o+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=qc(r),a=o.newShape,l=o.keptDims;if(a.length<r.length){var u=Ld(t,a);return`
      `+Md(u)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Bd(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var c=r[5],h=r[4]*c,d=r[3]*h,f=r[2]*d,p=r[1]*f;if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Cd(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,v=g[0],y=g[1];if(y===p&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+d+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(y===c&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var x=Oc(s);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function HK(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=xs(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(s){var i=s.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=s.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=xs();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+u.texture2D+"("+i+`, uv);
    }
  `}(n);case 2:return function(s){var i=s.shapeInfo.logicalShape,o=s.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),l=s.shapeInfo.texShape,u=l[0],c=l[1],h=xs();if(l!=null&&Fr(i,l))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);

        return `+h.texture2D+"("+o+`, uv);
      }
    `;var d=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],f=Math.ceil(i[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+o+`, uv);
    }
  `}(n);case 3:return function(s){var i=s.shapeInfo.logicalShape,o=s.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),l=s.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(i[0]===1){var c=i.slice(1),h=Ld(s,c);return`
        `+HK(h)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Bd(["b","row","col"],[1,2])+`);
        }
      `}var d=u[0],f=u[1],p=Math.ceil(i[2]/2),m=p*Math.ceil(i[1]/2),g=xs();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+f+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+o+`, uv);
    }
  `}(n);default:return function(s){for(var i=s.shapeInfo.logicalShape,o=i.length,a=s.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),u=s.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=c[0],d=c[1],f=Math.ceil(i[o-1]/2),p=f*Math.ceil(i[o-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+f+" + (col / 2)",v=2;v<o-1;v++)m="int b"+v+", "+m,p*=i[o-v-1],g="b"+v+" * "+p+" + "+g;var y=xs();return`
    vec4 `+l+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+y.texture2D+"("+a+`, uv);
    }
  `}(n)}}var v6e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,y6e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,x6e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,b6e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Oc(n){return"offset"+n}function Cd(n){var e=n.name,t=We(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function pn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Ld(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Bd(n,e){return e.map(function(t){return n[t]}).join(", ")}var w6e=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,j(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var s=n[n.length-1],i=Math.ceil(s/e);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var o,a,l=this.outputShape,u=l.length,c=pn(u),h=Xs("coords",u);if(i===1){var d=pn(a=u+1);o=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[u-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[u-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[u-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[u-2]+";"}else a=u,o=`
        `+c+` sourceLocR = coords;
        ++`+h[u-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[u-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[u-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[u-2]+";";var f=["x","y","z","w","u","v"].slice(0,a),p="."+f[a-1],m=f.map(function(C){return"int "+C}),g=Xs("sourceLocR",a-1).concat("inIdx.r"),v=Xs("sourceLocG",a-1).concat("inIdx.g"),y=Xs("sourceLocB",a-1).concat("inIdx.b"),x=Xs("sourceLocA",a-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",_=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",E=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",I=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+I+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[u-1]+" < "+(l[u-1]-1)+`;
        bool hasNextRow = `+h[u-2]+" < "+(l[u-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+_+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},_6e=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,i=n.dilationHeight,o=n.dilationWidth,a=n.effectiveFilterHeight,l=n.effectiveFilterWidth,u=a-1-n.padInfo.top,c=l-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},k6e=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,f=c-1-n.padInfo.front,p=h-1-n.padInfo.top,m=d-1-n.padInfo.left,g=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+s+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+u+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},C6e=function(n,e,t,r,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],It(n,e),It(n,t);var o="0.0";r!=null&&(It(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var a="1.0";s!=null&&(It(n,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},I6e=function(n,e,t,r,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],It(n,e),It(n,t);var o="vec4(0.0)";r!=null&&(It(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var a="vec4(1.0)";s!=null&&(It(n,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},S6e="return areal * breal - aimag * bimag;",E6e="return areal * bimag + aimag * breal;",_B=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=It(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},B2="return a + b;",V2="return a - b;",kB="return a * b;",GK="return (a < 0.) ? b * a : a;",zn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=It(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},qK=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ya=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=It(e,t);var s=this.outputShape.length,i="";if(r)if(s===0||We(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+pn(s)+` coords = getOutputCoords();
        `,s===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=Xs("coords",s);i+=`
            bool nextRowOutOfBounds =
              (`+o[s-2]+" + 1) >= "+this.outputShape[s-2]+`;
            bool nextColOutOfBounds =
              (`+o[s-1]+" + 1) >= "+this.outputShape[s-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},T6e=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,i){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(i,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n}(),N6e=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,i){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(i,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n}(),A6e=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},R6e=function(n){this.outputShape=[],this.outputShape=ip(n,1),this.variableNames=n.map(function(a,l){return"T"+l});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var s=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+s+"));")}var i=e.length,o=e[e.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},D6e=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ip(n,e);var t=this.outputShape,r=t.length,s=pn(r),i=Xs("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,v){return"T"+v});var a=new Array(n.length-1);a[0]=n[0][e];for(var l=1;l<a.length;l++)a[l]=a[l-1]+n[l][e];var u=o[e],c=o.slice(-2),h=o.join(),d="if ("+u+" < "+a[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(l=1;l<a.length;l++){var f=a[l-1];d+=`
        if (`+u+" < "+a[l]+"  && "+u+" >= "+a[l-1]+`) {
          return getChannel(
            getT`+l+"("+A0(o,u,f)+`),
            vec2(`+A0(c,u,f)+`));
        }`}var p=a.length,m=a[a.length-1];d+=`
        return getChannel(
          getT`+p+"("+A0(o,u,m)+`),
          vec2(`+A0(c,u,m)+"));",this.userCode=`
      float getValue(`+o.map(function(g){return"int "+g})+`) {
        `+d+`
      }

      void main() {
        `+s+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+t[r-2]+` &&
            `+i[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function A0(n,e,t){var r=n.indexOf(e);return n.map(function(s,i){return i===r?s+" - "+t:s}).join()}var $6e=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,i=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},P6e=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,i=n.dataFormat==="channelsLast",o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,l=i?1:2,u=i?2:3,c=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+u+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},O6e=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.padInfo.front,i=n.padInfo.top,o=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+s+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+i+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+o+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},F6e=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=e-1-n.padInfo.front,l=t-1-n.padInfo.top,u=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+l+", "+u+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+s+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},M6e=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,i=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},L6e=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,i=e-1-n.padInfo.top,o=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},CB=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,l=n.dilationHeight,u=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,d=4*Math.floor(n.inChannels/4),f=n.inChannels%4,p=n.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,v=p?3:1,y="",x="";t&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,x="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+s+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+x+`
        setOutput(result);
      }
    `},B6e=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,s=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+s+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+u+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},IB=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.inHeight,i=n.inWidth,o=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,f=n.filterWidth,p=n.outChannels/n.inChannels,m="",g="";t&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,g="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+l+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+s+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+g+`
        setOutput(result);
      }
    `},SB=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var s=n.inHeight,i=n.inWidth,o=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,f=n.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<f;v++)m+=`
          vec4 xTexelR`+g+"C"+2*v+` = vec4(0.);
          vec4 wR`+g+"C"+v+` = vec4(0.);
          vec4 xR`+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var y=0;y<p;y++){if(m+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(v=2*y)*h+`;
        `,u===1){if(v<f&&(m+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+g+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+`.xy);
                } else {
                  xR`+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+s+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xR`+g+"C"+v+" = xTexelR"+g+"C"+v+`;
              `,v+1<f)){var x=a%2==0?hK(h):h;h%2==0&&a%2==1||h%2!=0&&a%2!=1?(m+=`
                  xCOffset = xC + `+a%2+" + "+x+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+s+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+`;
                `}}else v<f&&(m+=`
              if(xR >= 0 && xR < `+s+`) {
            `,a%2==1?(m+=`
                xCOffset = xC + 1 - `+u+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
              `,v+1<f&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+u+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+u+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+`.xy);
              `,v+1<f&&(m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
                `)),m+="}");v<f&&(m+=`
            vec4 wTexelR`+g+"C"+v+" = getW("+g+", "+v+`, d1, q);
            wR`+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+`.xz);
          `,v+1<f&&(m+=`
              vec4 wTexelR`+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+`, d1, q);
              wR`+g+"C"+(v+1)+` =
                vec4(wTexelR`+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var b="",_="";t&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,_="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+l+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+E+`
        `+_+`
        setOutput(result);
      }
    `},V6e=function(n,e,t,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],l=n[3],u=e[0],c=t[0],h=t[1];this.outputShape=[u,c,h,l];var d=r==="bilinear"?1:0,f=[o-1+".0",a-1+".0"],p=f[0],m=f[1],g=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],x=g[2],b=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],_=b[0],E=b[1],I=b[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+_+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+E+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+s+`));
          return;
        }
        float in_x = `+I+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+s+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},z6e=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,s=n[n.length-1],i=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+s+" -i - 1;":"return i;")+`
      }

      void main() {
        `+pn(r)+` coords = getOutputCoords();
        int end = `+EB(r,"coords")+`;
        float val = 0.0;
        for (int i = `+s+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+EB(r,"coords")+` = idx;
          val += getX(`+function(o,a){if(o===1)return""+a;if(o===2)return a+".x, "+a+".y";if(o===3)return a+".x, "+a+".y, "+a+".z";if(o===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function EB(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var U6e=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=cv.DENSE;var e=cg(n),t=xs();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+rh(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},j6e=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=cv.DENSE;var e=cg(n),t=xs();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+rh(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},W6e=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),H6e=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},G6e=function(n){this.variableNames=["A"],this.outTexUsage=yi.DOWNLOAD;var e=xs();this.outputShape=n,this.userCode=`
      `+WK+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},q6e=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=yi.DOWNLOAD;var e=xs();this.outputShape=n,this.userCode=`
      `+WK+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},K6e=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=xs(),s=e[0],i=e[1];this.outputShape=n;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+y$(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+s+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},X6e=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=xs(),s=e[0],i=e[1];this.outputShape=n;var o="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var u=0;u<=1;u++){var c=2*l+u;o+=`
          localCoords = coords;
          if(localCoords[2] + `+u+" < "+n[2]+`) {
            localCoords[2] += `+u+`;
            if(localCoords[1] + `+l+" < "+n[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+s+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+y$(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+r.output+" = "+a+`;
      }
    `},Y6e="return real * expR - imag * expI;",Q6e="return real * expI + imag * expR;",TB=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var s=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+s+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},J6e=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(s,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),Z6e=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var s=pn(this.rank),i=function(o,a){var l=o.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<o.length;h++)h===a?c.push("int(getIndices("+u[h]+"))"):c.push(""+u[h]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},e5e=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=pn(e.length),s=pn(t.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+s+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function t5e(n,e){var t=xs();return Yje(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function n5e(n,e){return tWe(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function r5e(n,e){return nWe(n,e,new Uint16Array([0,1,2,2,1,3]))}function ox(n,e,t,r,s,i,o){sWe(t,r);var a=rWe(n,e),l=n.TEXTURE_2D;return He(n,e,function(){return n.bindTexture(l,a)}),He(n,e,function(){return n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),He(n,e,function(){return n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),He(n,e,function(){return n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)}),He(n,e,function(){return n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)}),He(n,e,function(){return n.texImage2D(l,0,s,t,r,0,i,o,null)}),He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function s5e(n,e,t,r,s){var i=Pk(t,r);return ox(n,e,i[0],i[1],s.internalFormatFloat,s.textureFormatFloat,n.FLOAT)}function i5e(n,e,t,r,s){var i=Pk(t,r);return ox(n,e,i[0],i[1],s.internalFormatHalfFloat,s.textureFormatFloat,s.textureTypeHalfFloat)}function o5e(n,e,t,r,s){var i=Pk(t,r);return ox(n,e,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function a5e(n,e,t,r,s){var i=ix(t,r);return ox(n,e,i[0],i[1],s.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function l5e(n,e,t,r,s){var i=ix(t,r);return ox(n,e,i[0],i[1],s.internalFormatPackedHalfFloat,n.RGBA,s.textureTypeHalfFloat)}function u5e(n,e,t,r){return He(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),mB(n,e,t,"clipSpacePos",r,3,20,0)&&mB(n,e,t,"uv",r,2,20,12)}function c5e(n,e,t,r,s,i,o){var a,l,u;He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),i instanceof Uint8Array?(a=new Uint8Array(r*s*4),l=n.UNSIGNED_BYTE,u=n.RGBA):(a=new Float32Array(r*s*4),l=n.FLOAT,u=o.internalFormatPackedFloat),a.set(i),He(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,u,r,s,0,n.RGBA,l,a)}),He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function h5e(n,e,t,r){He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?He(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):He(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),He(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function d5e(n,e,t,r,s){var i=n.createBuffer();He(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,i)});var o=16*t*r;return He(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)}),He(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),He(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),i}function f5e(n,e,t){var r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function p5e(n,e,t,r,s){var i=Pk(t,r),o=i[0],a=i[1],l=new Uint8Array(t*r*4);return He(n,e,function(){return n.readPixels(0,0,o,a,s.downloadTextureFormat,n.UNSIGNED_BYTE,l)}),new Float32Array(l.buffer)}function m5e(n,e,t,r,s,i,o,a){var l=n,u=new Float32Array(function(c,h){var d=ix(c,h);return d[0]*d[1]*4}(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function g5e(n,e,t,r){var s=new Float32Array(t*r*4);return He(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,s)}),s}var v5e=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=me().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,Hje(t,e)):this.gl=La(t);var r="WEBGL_color_buffer_float";if(me().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=S0(this.gl,this.debug,"OES_texture_float"),to(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=S0(this.gl,this.debug,"OES_texture_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),to(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=S0(this.gl,this.debug,"EXT_color_buffer_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",to(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!to(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=n5e(this.gl,this.debug),this.indexBuffer=r5e(this.gl,this.debug),this.framebuffer=iWe(this.gl,this.debug),this.textureConfig=l$(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return me().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;He(t,this.debug,function(){return t.finish()}),He(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),He(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),He(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),He(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),He(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),s5e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),i5e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),o5e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),h5e(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,s){this.throwIfDisposed(),c5e(this.gl,this.debug,e,t,r,s,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),l5e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),a5e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(gB(this.gl,this.debug,this.framebuffer),this.outputTexture=null),He(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,function(){return p5e(s.gl,s.debug,t,r,s.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,s,i,o){return m5e(this.gl,e,0,0,0,i,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return f5e(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var s=d5e(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,s=this;if(me().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=i.clientWaitSync(o,0,0);return a===i.ALREADY_SIGNALED||a===i.CONDITION_SATISFIED},t=o}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return s.isQueryAvailable(t,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,function(){return g5e(s.gl,s.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=Qje(t,this.debug,e),s=t5e(t,this.debug),i=Zje(t,this.debug);return He(t,this.debug,function(){return t.attachShader(i,s)}),He(t,this.debug,function(){return t.attachShader(i,r)}),eWe(t,this.debug,i),this.debug&&O2(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=u5e(t,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&He(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&O2(this.gl,this.debug,this.program),He(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?aWe(this.gl,this.debug,e,t):lWe(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),He(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),uWe(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var s=ix(t,r),i=s[0],o=s[1];this.setOutputMatrixTextureDriver(e,i,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&O2(this.gl,this.debug,this.program),E0(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),He(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),He(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=S0(this.gl,this.debug,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var s=this.getQueryTimerExtensionWebGL1(),i=s.createQueryEXT();return s.beginQueryEXT(s.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Be(this,void 0,void 0,function(){var t=this;return Ve(this,function(r){switch(r.label){case 0:return[4,uB(function(){return t.disposed||t.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(s=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var s=0;s<r.length&&r[s]();++s);return s-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||uB(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),F2(this.gl,this.debug,e,this.framebuffer),this.debug&&E0(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(F2(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&E0(this.gl)):gB(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var s=this.gl;F2(s,this.debug,e,this.framebuffer),this.debug&&E0(s),this.outputTexture=e,He(s,this.debug,function(){return s.viewport(0,0,t,r)}),He(s,this.debug,function(){return s.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,s){var i=this;this.throwIfDisposed(),He(this.gl,this.debug,function(){return i.gl.scissor(e,t,r,s)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function NB(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var s=t.logicalShape,i=e[r],o=i.shape;if(!Fr(s,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+s+" and "+o+" must match");if(!t.isUniform||!i.isUniform){var a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!Fr(a,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+l+" must match")}})}var y5e=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,s=t.inChannels,i=t.strideWidth,o=t.strideHeight,a=t.padInfo,l=t.outWidth,u=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,d=a.left,f=a.top,p=s*r,m=xs(),g=h==="channelsLast",v=g?0:1,y=g?1:2,x="",b=0;b<=1;b++)for(var _=0;_<=1;_++)x+=`
          blockIndex = rc.y + `+_+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+o+" - "+f+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+i+". - "+d+`.);
              d1 = offsetX + `+u+" * (int(mod(float(pos), "+p+".) / "+s+`.));

              if(d1 < `+e[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+s+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+_)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+_)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+m.output+` = result;
      }
    `},x5e=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[];var i,o=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";i=s===.5?"inversesqrt("+l+")":s===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},b5e=function(n,e,t,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+s+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+s+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},w5e=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";i=s===.5?"inversesqrt("+l+")":s===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},_5e=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,s=n.effectiveFilterHeight,i=n.effectiveFilterWidth,o=s-1-n.padInfo.top,a=i-1-n.padInfo.left,l=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},k5e=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.dilationDepth,i=n.dilationHeight,o=n.dilationWidth,a=n.effectiveFilterDepth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,c=a-1-n.padInfo.front,h=l-1-n.padInfo.top,d=u-1-n.padInfo.left,f=a*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+u+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+u+` +
                  wR * `+u+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},z2=function(n,e,t,r,s,i,o){t===void 0&&(t=!1),r===void 0&&(r=!1),s===void 0&&(s=!1),i===void 0&&(i=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],l=Math.ceil(a/2),u=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";i&&(f=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var m=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},C5e=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(s,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),I5e=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},S5e=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Xs("rc",e),r=pn(e),s=function(a,l,u){if(a===1)return"rc > "+l[0];for(var c="",h=a-2;h<a;h++)c+=u[h]+" >= "+l[h],h<a-1&&(c+="||");return c}(e,n,t),i=function(a,l,u,c){if(a===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+u+`;
  `}(e,n[n.length-1],n[n.length-2],t),o=function(a,l){var u=a.length,c=function(h,d){for(var f=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<h;v++)g=d[d.length-1-v]+","+g;f.push(g)}return f}(u,l);return u===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+s+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},E5e=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(l,u){return l[0]+n[u]+l[1]});var r=n.length,s=pn(r),i=e.map(function(l){return l[0]}).join(","),o=e.map(function(l,u){return l[0]+n[u]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+s+" start = "+s+"("+i+`);
      `+s+" end = "+s+"("+o+`);

      void main() {
        `+s+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+s+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},T5e=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(g,v){return g[0]+n[v]+g[1]});for(var r=n.length,s=pn(r),i=e.map(function(g){return g[0]}).join(","),o=e.map(function(g,v){return g[0]+n[v]}).join(","),a=Xs("rc",r),l=Xs("source",r),u=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+l.slice(-2).join()+")",h=[s+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+u+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+u+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=r===1?2:4;p<m;p++)f+=`
        `+h[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+s+` source = rc - start;
          result[`+p+"] = getChannel(getX("+l.join()+"), "+c+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+s+" start = "+s+"("+i+`);
      const `+s+" end = "+s+"("+o+`);

      void main() {
        `+s+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},U2=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var d=e==="avg",f="0.0";if(d||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+i+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+u+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+u+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+i+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},j2=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,f=n.padInfo.front,p=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var g=e==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+i+", "+o+`);
        const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+l+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+u+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(y="avgValue / count");var x=4*Math.floor(r/4),b=r%4,_=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+u+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+u+`, ch)
              );

              `+_+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+_+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                initializationValue,
                initializationValue
              );

              `+_+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                initializationValue
              );

              `+_+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},N5e=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,s=n.inSize,i=Math.ceil(s/t);this.outputShape=[r,i];var o="0.0",a="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",a="min"):e==="max"&&(o="-1.0 / 1e-20",a="max");var l=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");var u=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(o="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(o="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var f="";s%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+l+`);
      }
    `},A5e=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var s="thisRC = rc;";r%2==1&&(s+="thisRC.z += 1;"),r>1&&(s+="thisRC.y += 1;"),t+=`
        `+s+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+rh(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+y$(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},R5e=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],i=r[2],o=n.shape,a=o[1],l=o[2],u=[t&&a>1?s-1:s,t&&l>1?i-1:i],c=[t&&a>1?a-1:a,t&&l>1?l-1:l],h=u[0]/c[0],d=u[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(s-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},D5e=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],i=n[1],o=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?i-1:i,r&&t>1?o-1:o],u=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},$5e=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=n[0],i=n[1],o=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?i-1:i,r&&t>1?o-1:o],u=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`,
          `+l[1]/u[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},P5e=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],i=r[2],o=n.shape,a=o[1],l=o[2],u=[t&&a>1?s-1:s,t&&l>1?i-1:i],c=[t&&a>1?a-1:a,t&&l>1?l-1:l],h=u[0]/c[0],d=u[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+u[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+u[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+s+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},O5e=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],i=n[1],o=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?i-1:i,r&&t>1?o-1:o],u=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},F5e=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(i,o){return function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(o)}).join(","),s=pn(t);this.userCode=`
      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},M5e=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=Xs("rc",t),s=r[t-1]+" + 1 < "+this.outputShape[t-1],i=r[t-2]+" + 1 < "+this.outputShape[t-2],o=pn(t);function a(l){var u=n.map(function(c,h){return function(d,f){return e.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+f[d]+" - 1":""+f[d]}(h,l)});return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+s+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(l){return a(l)}(r.slice())+`;
          if(`+s+`){
            result.g = `+function(l){return l[t-1]="("+l[t-1]+" + 1)",a(l)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(l){return l[t-2]="("+l[t-2]+" + 1)",a(l)}(r.slice())+`;
            if(`+s+`) {
              result.a = `+function(l){return l[t-1]="("+l[t-1]+" + 1)",l[t-2]="("+l[t-2]+" + 1)",a(l)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},AB=function(n,e,t,r,s,i,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var a=pn(s.length),l=pn(i.length),u="";t===1?u="i":t===2&&(u="i, j");var c="getIndices("+u+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+s+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},L5e=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,s=n.inSize,i=n.numSegments,o=i*Math.ceil(s/t);this.outputShape=[r,o];var a=4*Math.floor(t/4),l=t%4,u=`
        sumValue += dot(values, segFilter);
    `,c="";s%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `);var h="";s%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+u+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+u+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+u+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+u+`
        }
        setOutput(sumValue);
      }
    `},B5e=function(n,e,t){var r,s;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)s="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=[],l=0;l<e.length;l++)a.push(""+i[l]),l<n&&o.push(""+i[l]);r=o.join(),s=a.join()}var u=pn(t);this.userCode=`
      void main() {
        `+u+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+s+`));
        } else {
          setOutput(getB(`+s+`));
        }
      }
    `},V5e=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=pn(this.rank),s="uniform int start["+this.rank+"];",i=function(o){if(o===1)return"sourceLoc";if(o<=6)return W2.slice(0,o).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(o,a){return"sourceLoc."+W2[a]+" = start["+a+"] + coords."+W2[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+s+`
      void main() {
        `+t+`
        setOutput(getSource(`+i+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),W2=["x","y","z","w","u","v"],z5e=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=pn(this.rank),r=Xs("coords",this.rank),s=Xs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+s.slice(-2).join()+")",o="getChannel(getSource("+s.join()+"), "+i+")",a=`
      result.x = `+o+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+s[this.rank-1]+`;
        result.y = `+o+`;
        --`+s[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+s[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+s[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return s[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+u+`
        vec4 result = vec4(0.);
        `+a+`
        `+l+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),U5e=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,s=pn(t.length),i=pn(t.length),o="";if(r===1)o="coords * strides + begin";else{var a=0;o=t.map(function(l,u){return a++,t.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(a-1)+"] * strides["+u+"] + begin["+u+"]"}).join(",")}this.userCode=`
      `+s+" begin = "+s+"("+n+`);
      `+s+" strides = "+s+"("+e+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},j5e=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var s,i=RB(t,r),o=DB(e,i,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),i===pi.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===pi.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===pi.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===pi.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===pi.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(s),s},n.prototype.releaseTexture=function(e,t,r,s){if(this.freeTextures!=null){var i=DB(t,RB(r,s),s);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],a=o.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(s){e.gpgpu.deleteMatrixTexture(s)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function RB(n,e){if(n===yi.UPLOAD)return pi.PACKED_2X2_FLOAT32;if(n===yi.RENDER||n==null)return function(t){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?pi.PACKED_2X2_FLOAT32:pi.UNPACKED_FLOAT32:t?pi.PACKED_2X2_FLOAT16:pi.UNPACKED_FLOAT16}(e);if(n===yi.DOWNLOAD||n===yi.PIXELS)return pi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function DB(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var W5e=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var s=pn(this.rank),i=function(o){var a=o.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+o[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],c=0;c<o.length;c++)u.push("imod("+l[c]+", "+o[c]+")");return u.join()}(n);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},H5e=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var s=pn(this.rank),i=function(o){var a=o.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(a),c=0;c<o.length;c++)u[o[c]]=l[c];return u.join()}(e);this.userCode=`
    void main() {
      `+s+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},G5e=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var s=pn(this.rank),i=jK("rc",this.rank),o=new Array(this.rank);for(r=0;r<e.length;r++)o[e[r]]=i[r];var a="vec2("+o.slice(-2).join()+")",l="++"+i[this.rank-1]+" < "+t[this.rank-1],u="getChannel(getA("+o.join()+"), "+a+")";this.userCode=`
    void main() {
      `+s+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+u+`;
      if(`+l+`) {
        result[1] = `+u+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+u+`;
        if(`+l+`) {
          result[3] = `+u+`;
        }
      }
      setOutput(result);
    }
    `},x$=1.7580993408473768,b$=1.0507009873554805,pt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ho="if (isnan(x)) return x;",q5e="return x;",$B="return abs(x);",KK=Ho+`
  return (x < 0.0) ? 0.0 : x;
`,XK=Ho+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,YK="return (x >= 0.0) ? x : (exp(x) - 1.0);",K5e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+x$+`;
  float scale = `+b$+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,PB="return -x;",OB="return ceil(x);",FB="return floor(x);",MB="return exp(x);",LB="return exp(x) - 1.0;",X5e=Ho+`
  return sin(x);
`,Y5e=Ho+`
  return cos(x);
`,Q5e=Ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,J5e=Ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Z5e=Ho+`
  return atan(x);
`,eHe=Ho+"return log(x + sqrt(x * x + 1.0));",tHe=Ho+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,nHe=Ho+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,R0="return x;",rHe="return x;",QK=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JK=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZK=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,wm=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},sHe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=Xs("rc",e),r=pn(e),s=function(a,l){if(a===1)return"rc";for(var u="",c=0;c<a;c++)u+=l[c],c<a-1&&(u+=",");return u}(e,t),i=t.slice(-2),o=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+s+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},D0={};function $0(n,e){if(e===void 0&&(e=!1),n==="linear")return e?rHe:q5e;if(n==="relu")return e?QK:KK;if(n==="elu")return e?ZK:YK;if(n==="relu6")return e?JK:XK;if(n==="prelu")return e?qK:GK;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var iHe=600,oHe=function(n){function e(t){var r,s=n.call(this)||this;if(s.pendingRead=new WeakMap,s.pendingDisposal=new WeakSet,s.dataRefCount=new WeakMap,s.numBytesInGPU=0,s.uploadWaitMs=0,s.downloadWaitMs=0,s.warnedAboutMemory=!1,s.pendingDeletes=0,s.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var i=La(me().getNumber("WEBGL_VERSION"));s.binaryCache=((r=me().getNumber("WEBGL_VERSION"))in D0||(D0[r]={}),D0[r]),s.gpgpu=new v5e(i),s.canvas=i.canvas,s.gpgpuCreatedLocally=!0}else s.gpgpu=t,s.binaryCache={},s.gpgpuCreatedLocally=!1,s.canvas=t.gl.canvas;return s.textureManager=new j5e(s.gpgpu),s.numMBBeforeWarning=me().global.screen==null?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*iHe/1024/1024,s.texData=new PK(s,Q),s}return Wo(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,s){if(me().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:s,values:t,usage:yi.UPLOAD}),i},e.prototype.move=function(t,r,s,i){if(me().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:i,values:r,usage:yi.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),s=r.values,i=r.dtype,o=r.complexTensors,a=r.slice,l=r.shape,u=r.isPacked;if(a!=null){var c=void 0;c=u?new wm(l,R0):new pt(l,R0);var h=this.runWebGLProgram(c,[{dataId:t,shape:l,dtype:i}],i),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(s!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return s;var f,p,m=this.activeTimers!=null;return m&&(f=ia()),i==="complex64"?p=PE(o.real.dataSync(),o.imag.dataSync()):p=this.getValuesFromTexture(t),m&&(this.downloadWaitMs+=ia()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return Be(this,void 0,void 0,function(){var r,s,i,o,a,l,u,c,h,d,f,p,m,g,v,y,x,b,_,E,I,C;return Ve(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(T){return r.push(T)})];if(s=this.texData.get(t),i=s.values,o=s.shape,a=s.slice,l=s.dtype,u=s.complexTensors,c=s.isPacked,a!=null)return h=void 0,h=c?new wm(o,R0):new pt(o,R0),d=this.runWebGLProgram(h,[{dataId:t,shape:o,dtype:l}],l),f=this.read(d.dataId),this.disposeData(d.dataId),[2,f];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&me().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,l!=="complex64"&&me().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,[g.texture].concat(cg(o)))),this.pendingRead.set(t,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return y=S.sent(),x=y[0],b=y[1],v=PE(x,b),[3,5];case 4:p==null?v=this.getValuesFromTexture(t):(_=We(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,_)),S.label=5;case 5:return m!=null&&this.disposeData(m.dataId),E=this.convertAndCacheOnCPU(t,v),I=this.pendingRead.get(t),this.pendingRead.delete(t),I.forEach(function(T){return T(E)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,E]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var s=t[r];if(!Kje(s))throw me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+s+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+s+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,s=this.texData.get(t),i=s.shape,o=s.dtype,a=s.isPacked,l=We(i);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),c=this.texData.get(u.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(cg(i))).subarray(0,l);return this.disposeData(u.dataId),h}var d=me().getBool("WEBGL_PACK")&&a===!0,f=d?M2(i):i,p=d?new q6e(f):new G6e(f),m=this.runWebGLProgram(p,[{shape:f,dtype:o,dataId:t}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,l);return this.disposeData(m.dataId),v},e.prototype.time=function(t){return Be(this,void 0,void 0,function(){var r,s,i,o,a,l,u;return Ve(this,function(c){switch(c.label){case 0:return r=this.activeTimers,s=[],i=!1,this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,t(),o=rp(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),a=rp(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return u=c.sent(),l.kernelMs=Tje(u),l.getExtraProfileInfo=function(){return u.map(function(h,d){return{name:a[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ia(),endMs:null}},e.prototype.endTimer=function(t){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ia(),t)},e.prototype.getQueryTime=function(t){return Be(this,void 0,void 0,function(){var r;return Ve(this,function(s){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),s=r.texture,i=r.dtype,o=r.texShape,a=r.usage,l=r.isPacked,u=r.slice,c=u&&u.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),s!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(s,o,a,l)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return me().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Q.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var s=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(i){return s.texData.get(i.dataId).texture==null&&i.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var s=this.makeOutput(t.shape,"complex64");return this.texData.get(s.dataId).complexTensors={real:Q.keep(t.clone()),imag:Q.keep(r.clone())},s},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,s);if(We(s)===0)return Gr([],s,t.dtype);var i=this.texData.get(t.dataId).isPacked,o=DK(t.shape,r,s);if(i||!o){var a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new z5e(s):new V5e(s),l=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,l)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,s)},e.prototype.shallowSlice=function(t,r,s){var i=this.texData.get(t.dataId),o=this.makeOutput(s,t.dtype),a=this.texData.get(o.dataId);Object.assign(a,i),a.shape=s,a.dtype=t.dtype;var l=$K(r,t.strides);i.slice&&(l+=i.slice.flatOffset),a.slice={flatOffset:l,origDataId:i.slice&&i.slice.origDataId||t.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),o},e.prototype.stridedSlice=function(t,r,s,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,s,i);var o=f$(r,s,i);if(o.some(function(l){return l===0}))return Gr([],o);var a=new U5e(r,i,o);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var s=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new M5e(t.shape,r):new F5e(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var s=t.map(function(f){return Gi(f)}),i=t.map(function(f){return ua(f)});return jr(this.concat(s,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),a=this.concat(t.slice(0,o),r),l=this.concat(t.slice(o),r);return this.concat([a,l],r)}if(me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new D6e(t.map(function(f){return f.shape}),r);return this.compileAndRun(u,t)}var c=ip(t.map(function(f){return f.shape}),r),h=t.map(function(f){return f.as2D(-1,We(f.shape.slice(r)))}),d=new R6e(h.map(function(f){return f.shape}));return this.compileAndRun(d,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,PB,t.dtype);var r=new pt(t.shape,PB);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,s,i){var o=s?t.shape[2]:t.shape[1],a=i?r.shape[1]:r.shape[2],l=s?t.shape[1]:t.shape[2],u=t.shape[0];if((o===1||a===1)&&l>1e3){s&&(t=t.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var c=a===1?t:t.as3D(u,l,1),h=a===1?2:1,d=a===1?r.as3D(u,1,l):r;return this.multiply(c,d).sum(h,!0)}var f=Hr(t.dtype,r.dtype),p=new z2(t.shape,[u,o,a],s,i);return this.compileAndRun(p,[t,r],f)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,i=t.transposeA,o=t.transposeB,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=i?r.shape[2]:r.shape[1],h=o?s.shape[1]:s.shape[2],d=r.shape[0],f=Hr(r.dtype,s.dtype),p=a!=null,m=u!=null,g=l?$0(l,!0):null,v=new z2(r.shape,[d,c,h],i,o,p,g,m),y=[r,s];return a&&y.push(a),u&&y.push(u),this.compileAndRun(v,y,f)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var s=this.texData.get(t.dataId),i=this.texData.get(r.dataId),o=new _B(S6e,t.shape,r.shape),a=new _B(E6e,t.shape,r.shape),l=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],u=this.compileAndRun(o,l),c=this.compileAndRun(a,l),h=this.complex(u,c);return u.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,kB,t.dtype);var d=new zn(kB,t.shape,r.shape);return this.compileAndRun(d,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,s,i,o,a){var l=[t,r,s],u=null;a!=null&&(u=a.shape,l.push(a));var c=null;if(o!=null&&(c=o.shape,l.push(o)),me().getBool("WEBGL_PACK_NORMALIZATION")){var h=new I6e(t.shape,r.shape,s.shape,u,c,i);return this.compileAndRun(h,l)}var d=new C6e(t.shape,r.shape,s.shape,u,c,i);return this.compileAndRun(d,l)},e.prototype.localResponseNormalization4D=function(t,r,s,i,o){var a=me().getBool("WEBGL_PACK_NORMALIZATION")?new w5e(t.shape,r,s,i,o):new x5e(t.shape,r,s,i,o);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,s,i,o,a,l){var u=new b5e(r.shape,i,o,a,l);return this.compileAndRun(u,[r,s,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var s=this.readSync(t.dataId).map(function(o){return Yw(o)});return zK(ut(t.shape,t.dtype,s),r)}var i=new W5e(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.pad=function(t,r,s){var i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T5e(t.shape,r,s):new E5e(t.shape,r,s);return this.compileAndRun(i,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var s=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new G5e(t.shape,r):new H5e(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.gather=function(t,r,s){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,s);var i=new Z6e(t.shape,r.size,s);return this.compileAndRun(i,[t,r])},e.prototype.batchToSpaceND=function(t,r,s){j(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(h,d){return h*d}),o=n1(t.shape,r,i),a=r1(o.length,r.length),l=s1(t.shape,r,i),u=TK(s,r.length),c=NK(l,s,r.length);return t.reshape(o).transpose(a).reshape(l).slice(u,c)},e.prototype.spaceToBatchND=function(t,r,s){j(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),o=[[0,0]];o.push.apply(o,s);for(var a=1+r.length;a<t.shape.length;++a)o.push([0,0]);var l=t.pad(o),u=n1(l.shape,r,i,!1),c=r1(u.length,r.length,!1),h=s1(l.shape,r,i,!1);return l.reshape(u).transpose(c).reshape(h)},e.prototype.reduce=function(t,r,s){var i=t.shape[0],o=t.shape[1],a=L2(o),l=new N5e({windowSize:a,inSize:o,batchSize:i},r),u=this.compileAndRun(l,[t],s);return u.shape[1]===1?u:this.reduce(u,r,s)},e.prototype.argReduce=function(t,r,s){s===void 0&&(s=null);var i=t.shape[0],o=t.shape[1];s!=null&&(i=s.shape[0],o=s.shape[1]);var a=L2(o),l=new m6e({windowSize:a,inSize:o,batchSize:i},r,s==null),u=[t];s!=null&&u.push(s);var c=this.compileAndRun(l,u,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,s){s===void 0&&(s=null);var i=s!=null?s.shape:t.shape,o=L2(i[i.length-1]),a=new w6e(i,o,r,s==null),l=s==null?[t]:[t,s],u=this.compileAndRun(a,l,"int32");return u.rank===t.rank?this.argReducePacked(t,r,u):u},e.prototype.sum=function(t,r){fi("sum",r,t.rank);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o),l=A2(t.dtype);return this.reduce(a,"sum",l).reshape(i)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o),l=A2(t.dtype);return this.reduce(a,"prod",l).reshape(i)},e.prototype.unsortedSegmentSum=function(t,r,s){var i=0,o=Ba([i],t.rank),a=t;o!=null&&(a=t.transpose(o),i=Va(1,t.rank)[0]);var l=function(f,p,m){for(var g=[],v=f.length,y=0;y<v;y++)y!==p?g.push(f[y]):g.push(m);return g}(a.shape,i,s),u=We([a.shape[i]]),c=a.as2D(-1,u),h=A2(t.dtype),d=this.segOpCompute(c,"unsortedSegmentSum",r,h,s).reshape(l);return o!=null&&(d=d.transpose(u$(o))),d},e.prototype.segOpCompute=function(t,r,s,i,o){var a=t.shape[0],l=t.shape[1],u=function(d,f){var p,m=!1;for(d<=RK?(p=d,m=!0):p=IE(d,Math.floor(Math.sqrt(d)));!m;)p>f||p===d?m=!0:p=IE(d,p+1);return p}(l,o),c=new L5e({windowSize:u,inSize:l,batchSize:a,numSegments:o}),h=this.compileAndRun(c,[t,s],i);return h.shape[1]===o?h:(s=t1(0,o).tile([l/u]),this.segOpCompute(h,r,s,i,o))},e.prototype.argMinMaxReduce=function(t,r,s){var i=[r];if(fi("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,t.rank),!me().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=fs(t.shape,i),a=o[0],l=We(o[1]),u=t.as2D(-1,l);return this.argReduce(u,s).reshape(a)}return this.argReducePacked(t,s)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,s,i){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var o=new z6e(t.shape,s,i);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var s=new zn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var s=new zn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var s=new zn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var s=new zn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var s=new zn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var s=new zn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new pt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var s=new zn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var s=new zn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.select=function(t,r,s){var i=new B5e(t.rank,r.shape,r.rank);return this.compileAndRun(i,[t,r,s],Hr(r.dtype,s.dtype))},e.prototype.where=function(t){Zw("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return v$(t.shape,r)},e.prototype.topk=function(t,r,s){return UK(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){fi("min",r,t.rank);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(i)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new zn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.mod=function(t,r){var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new zn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);fi("max",r,t.rank);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(i)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new zn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.all=function(t,r){fi("all",r,t.rank);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(i)},e.prototype.any=function(t,r){fi("any",r,t.rank);var s=fs(t.shape,r),i=s[0],o=We(s[1]),a=t.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(i)},e.prototype.realDivide=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var s=new zn(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var s=new zn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,B2);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var s=Hr(t.dtype,r.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,B2,s);var i=new zn(B2,t.shape,r.shape);return this.compileAndRun(i,[t,r],s)},e.prototype.packedUnaryOp=function(t,r,s){var i=new wm(t.shape,r);return this.compileAndRun(i,[t],s)},e.prototype.packedBinaryOp=function(t,r,s,i,o){o===void 0&&(o=!1);var a=new Ya(s,t.shape,r.shape,o);return this.compileAndRun(a,[t,r],i)},e.prototype.complexSeparableBinaryOp=function(t,r,s){var i=this,o=this.texData.get(t.dataId),a=this.texData.get(r.dataId),l=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(d){var f=d[0],p=d[1],m=i.makeComplexComponentTensorInfo(t,f),g=i.makeComplexComponentTensorInfo(r,p),v=new zn(s,t.shape,r.shape);return i.compileAndRun(v,[m,g],Hr(f.dtype,p.dtype))}),u=l[0],c=l[1],h=this.complex(u,c);return u.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>me().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),s=this.addN(t.slice(0,r)),i=this.addN(t.slice(r));return this.addN([s,i])}var o=t.map(function(u){return u.dtype}).reduce(function(u,c){return Hr(u,c)}),a=t.map(function(u){return u.shape}),l=me().getBool("WEBGL_PACK")?new p6e(t[0].shape,a):new f6e(t[0].shape,a);return this.compileAndRun(l,t,o)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,V2);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var s=Hr(t.dtype,r.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,V2,t.dtype);var i=new zn(V2,t.shape,r.shape);return this.compileAndRun(i,[t,r],s)},e.prototype.pow=function(t,r){var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new zn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),i=Hr(t.dtype,r.dtype);return this.compileAndRun(s,[t,r],i)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,OB,t.dtype);var r=new pt(t.shape,OB);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,FB,t.dtype);var r=new pt(t.shape,FB);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new pt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new pt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new pt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new pt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new pt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,MB,t.dtype);var r=new pt(t.shape,MB);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,LB,t.dtype);var r=new pt(t.shape,LB);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var s=Er([r],t.shape),i=this.max(t,s),o=oi(i.shape,s),a=this.subtract(t,i.reshape(o)),l=this.exp(a),u=this.sum(l,s).reshape(o);return this.realDivide(l,u)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new pt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new pt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new pt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new pt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new pt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=me().getBool("WEBGL_PACK")?new wm(t.shape,QK):new pt(t.shape,KK),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=me().getBool("WEBGL_PACK")?new wm(t.shape,JK):new pt(t.shape,XK),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(qK,t.shape,r.shape):new zn(GK,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.elu=function(t){if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ZK,t.dtype);var r=new pt(t.shape,YK);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new zn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.selu=function(t){var r=new pt(t.shape,K5e);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new pt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,s){var i,o=(i=me().getBool("WEBGL_PACK_CLIP")?new N6e(t.shape):new T6e(t.shape)).getCustomSetupFunc(r,s);return this.compileAndRun(i,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$B,t.dtype);var r=new pt(t.shape,$B);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),s=new A6e(t.shape),i=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(s,i)},e.prototype.sigmoid=function(t){var r=new pt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new pt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new pt(t.shape,X5e);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new pt(t.shape,Y5e);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new pt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new pt(t.shape,Q5e);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new pt(t.shape,J5e);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new pt(t.shape,Z5e);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var s=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new zn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.sinh=function(t){var r=new pt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new pt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new pt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new pt(t.shape,eHe);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new pt(t.shape,tHe);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new pt(t.shape,nHe);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new pt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var s=new pt(t.shape,function(i){return i===void 0&&(i=0),Ho+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(s,[t])},e.prototype.conv2dByMatMul=function(t,r,s,i,o,a){var l=t.shape,u=this.texData.get(t.dataId),c=s.inChannels,h=l[0]*l[1]*l[2],d=s.outChannels,f=s.dataFormat==="channelsLast",p=(h===1||d===1)&&c>1e3,m=l[2]%2!=0&&!!u.isPacked;if(p||!me().getBool("WEBGL_LAZILY_UNPACK")||!me().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],v=this.reshape(t,[1,g,s.inChannels]),y=this.reshape(r,[1,s.inChannels,s.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:a}),s.outShape)}var x=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),b={dataId:t.dataId,shape:[1,x,s.inChannels],dtype:t.dtype},_=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,j(N0(u.shape,b.shape),function(){return"packed reshape "+u.shape+" to "+b.shape+" isn't free"});var E=this.reshape(r,[1,s.inChannels,s.outChannels]),I=this.fusedBatchMatMul({a:b,b:E,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:a}),C=this.texData.get(I.dataId);return j(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=_,C.shape=s.outShape,Q.makeTensorFromDataId(I.dataId,s.outShape,I.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,s,i,o,a){var l=s.filterWidth,u=s.filterHeight,c=s.inChannels,h=s.outWidth,d=s.outHeight,f=s.dataFormat==="channelsLast",p=l*u*c,m=d*h,g=[p,m],v=t.squeeze([0]),y=r.reshape([1,p,-1]),x=new y5e(g,v.shape,s),b=this.compileAndRun(x,[v]).reshape([1,g[0],g[1]]),_=i!=null,E=a!=null,I=o?$0(o,!0):null,C=new z2(b.shape,[1,m,s.outChannels],!0,!1,_,I,E),S=[b,y];i&&S.push(i),E&&S.push(a);var T=this.compileAndRun(C,S);return f?T.reshape([1,d,h,s.outChannels]):T.reshape([1,s.outChannels,d,h])},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,i=t.convInfo,o=t.bias,a=t.activation,l=t.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,s,i,o,a,l);if(me().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,s,i,o,a,l);var u=o!=null,c=l!=null,h=a?$0(a,!1):null,d=new CB(i,u,h,c),f=[r,s];return o&&f.push(o),l&&f.push(l),this.compileAndRun(d,f)},e.prototype.conv2d=function(t,r,s){if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,s);if(me().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,s);var i=new CB(s);return this.compileAndRun(i,[t,r])},e.prototype.conv2dDerInput=function(t,r,s){var i=new P6e(s);return this.compileAndRun(i,[t,r])},e.prototype.conv2dDerFilter=function(t,r,s){var i=new $6e(s);return this.compileAndRun(i,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,s=t.input,i=t.filter,o=t.convInfo,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,h=l?$0(l,c):null,d=[s,i],f=a!=null,p=u!=null;return f&&d.push(a),p&&d.push(u),c?(r=new SB(o,f,h,p),this.compileAndRun(r,d)):(r=new IB(o,f,h,p),this.compileAndRun(r,d))},e.prototype.depthwiseConv2D=function(t,r,s){var i;return me().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1?(i=new SB(s),this.compileAndRun(i,[t,r])):(i=new IB(s),this.compileAndRun(i,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,s){var i=new L6e(s);return this.compileAndRun(i,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){var i=new M6e(s);return this.compileAndRun(i,[t,r])},e.prototype.conv3d=function(t,r,s){var i=new B6e(s);return this.compileAndRun(i,[t,r])},e.prototype.conv3dDerInput=function(t,r,s){var i=new F6e(s);return this.compileAndRun(i,[t,r])},e.prototype.conv3dDerFilter=function(t,r,s){var i=new O6e(s);return this.compileAndRun(i,[t,r])},e.prototype.maxPool=function(t,r){var s=new U2(r,"max",!1);return this.compileAndRun(s,[t])},e.prototype.avgPool=function(t,r){var s=new U2(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,s,i){var o=new U2(i,"max",!0),a=this.compileAndRun(o,[r]),l=new _5e(i),u=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),u},e.prototype.avgPoolBackprop=function(t,r,s){var i=new _6e(s);return this.compileAndRun(i,[t],r.dtype)},e.prototype.cast=function(t,r){return MK(t,r,this)},e.prototype.unstack=function(t,r){for(var s=t.shape[r],i=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==r&&(i[o++]=t.shape[a]);var l=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var c=new Array(s);for(a=0;a<c.length;a++)l[r]=a,c[a]=this.slice(t,l,u).reshape(i);return c},e.prototype.avgPool3d=function(t,r){var s=new j2(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,s){var i=new k6e(s);return this.compileAndRun(i,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var s=new j2(r,"max",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,s,i){var o=new j2(i,"max",!0),a=this.compileAndRun(o,[r]),l=new k5e(i),u=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),u},e.prototype.reshape=function(t,r){var s=this.texData.get(t.dataId);if(s.isPacked&&!N0(t.shape,r)&&(s.texture===null||!N0(s.shape,r))){var i=this.packedReshape(t,r);return Q.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return $E(t,r)},e.prototype.resizeBilinear=function(t,r,s,i){var o=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $5e(t.shape,r,s,i):new D5e(t.shape,r,s,i);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,s){var i=new R5e(t,r,s);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighbor=function(t,r,s,i){var o=new O5e(t.shape,r,s,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){var i=new P5e(t,r,s);return this.compileAndRun(i,[t])},e.prototype.multinomial=function(t,r,s,i){var o=r?t:zl(t),a=o.shape[0],l=o.shape[1],u=new C5e(a,l,s),c=u.getCustomSetupFunc(i);return this.compileAndRun(u,[o],"int32",c)},e.prototype.oneHot=function(t,r,s,i){var o=new I5e(t.size,r,s,i);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var r=new H6e(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,s,i,o){return Zw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),m$(t.dataSync(),r.dataSync(),s,i,o)},e.prototype.cropAndResize=function(t,r,s,i,o,a){var l=new V6e(t.shape,r.shape,i,o,a);return this.compileAndRun(l,[t,r,s],"float32")},e.prototype.depthToSpace=function(t,r,s){j(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=t.shape[0],o=s==="NHWC"?t.shape[1]:t.shape[2],a=s==="NHWC"?t.shape[2]:t.shape[3],l=s==="NHWC"?t.shape[3]:t.shape[1],u=o*r,c=a*r,h=l/(r*r),d=new W6e(s==="NHWC"?[i,u,c,h]:[i,h,u,c],r,s);return this.compileAndRun(d,[t])},e.prototype.split=function(t,r,s){return VK(t,r,s)},e.prototype.scatterND=function(t,r,s){var i=i1(0,t,s),o=i.sliceRank,a=i.numUpdates,l=i.sliceSize,u=i.strides,c=i.outputSize,h=[c/l,l],d=t.reshape([a,o]),f=r.reshape([a,l]);if(c===0)return $E(Gr([]),s);var p=Ae(0),m=new AB(a,o,d.rank,f.rank,u,h);return this.compileAndRun(m,[f,d,p]).reshape(s)},e.prototype.sparseToDense=function(t,r,s,i){var o=i1(0,t,s),a=o.sliceRank,l=o.numUpdates,u=o.strides,c=o.outputSize,h=new AB(l,a,t.rank,r.rank,u,[c,1]);return this.compileAndRun(h,[r,t,i]).reshape(s)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var s=this.texData.get(t.dataId),i=new TB(Y6e,t.shape,r),o=new TB(Q6e,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag)],l=this.compileAndRun(i,a),u=this.compileAndRun(o,a),c=this.complex(l,u).as2D(t.shape[0],t.shape[1]);return l.dispose(),u.dispose(),c},e.prototype.gatherND=function(t,r){var s=r.shape,i=s[s.length-1],o=AK(t,r),a=o[0],l=o[1],u=o[2],c=o[3],h=r.reshape([l,i]),d=t.reshape([t.size/u,u]),f=new e5e(i,c,[l,u]);return this.compileAndRun(f,[d,h]).reshape(a)},e.prototype.fill=function(t,r,s){if((s=s||rx(r))==="string"){var i=Xw(s,We(t));return i.fill(r),Q.makeTensor(i,t,s,this)}var o=new J6e(t,r),a=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],s,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,s){return LK(t,r,s)},e.prototype.makeTensorInfo=function(t,r){var s=this.write(null,t,r);return this.texData.get(s).usage=null,{dataId:s,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var s=this.makeTensorInfo(t,r).dataId;return Q.makeTensorFromDataId(s,t,r,this)},e.prototype.unpackTensor=function(t){var r=new sHe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new S5e(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var s=[Qw(t.shape)].concat(Jw(t.shape)),i={dtype:t.dtype,shape:s,dataId:t.dataId},o=[Qw(r)].concat(Jw(r)),a=new A5e(o,s),l=this.runWebGLProgram(a,[i],t.dtype,null,!0);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t){var r,s=this.texData.get(t),i=s.isPacked,o=s.shape,a=s.dtype,l=M2(o);return r=i?new j6e(l):new U6e(l),{dtype:a,shape:o,dataId:this.runWebGLProgram(r,[{shape:l,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,s,i,o){var a=this;o===void 0&&(o=!1);var l=this.makeTensorInfo(t.outputShape,s),u=this.texData.get(l.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===cv.DENSE){var c=cg(t.outputShape);u.texShape=c.map(function(x){return 2*x})}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),We(l.shape)===0)return u.values=lv(l.dtype,0),l;var h=[],d=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=a.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&We(x.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}else if(!!b.isPacked!=!!t.packedInputs)x=b.isPacked?a.unpackTensor(x):a.packTensor(x),h.push(x),b=a.texData.get(x.dataId);else if(b.isPacked&&!N0(b.shape,x.shape)){var _=x,E=x.shape;x.shape=b.shape,x=a.packedReshape(x,E),h.push(x),b=a.texData.get(x.dataId),_.shape=E}return a.uploadToGPU(x.dataId),{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(l.dataId);var f,p={shape:l.shape,texData:u,isUniform:!1},m=function(x,b,_){var E="";b.concat(_).forEach(function(S){var T=S.texData!=null&&S.texData.slice!=null&&S.texData.slice.flatOffset>0,N=S.isUniform?"uniform":S.texData.texShape;E+=S.shape+"_"+N+"_"+T});var I=x.userCode,C=x.constructor.name;return C+="_"+E+"_"+I}(t,d,p),g=this.getAndSaveBinary(m,function(){return function(x,b,_,E){var I=b.userCode,C=_.map(function(P,U){var W={logicalShape:P.shape,texShape:P.isUniform?null:P.texData.texShape,isUniform:P.isUniform,isPacked:!P.isUniform&&P.texData.isPacked,flatOffset:null};return P.texData!=null&&P.texData.slice!=null&&P.texData.slice.flatOffset>0&&(W.flatOffset=P.texData.slice.flatOffset),{name:b.variableNames[U],shapeInfo:W}}),S=C.map(function(P){return P.shapeInfo}),T={logicalShape:E.shape,texShape:E.texData.texShape,isUniform:!1,isPacked:E.texData.isPacked,flatOffset:null},N=g6e(C,T,I,b.packedInputs),R=x.createProgram(N),D=null,z=x.getUniformLocation(R,"NAN",!1);me().getNumber("WEBGL_VERSION")===1&&(D=x.getUniformLocation(R,"INFINITY",!1));for(var L={},O=0;O<b.variableNames.length;O++){var F=b.variableNames[O];L[F]=x.getUniformLocation(R,F,!1),L["offset"+F]=x.getUniformLocation(R,"offset"+F,!1)}return{program:b,source:N,webGLProgram:R,uniformLocations:L,inShapeInfos:S,outShapeInfo:T,infLoc:D,nanLoc:z}}(a.gpgpu,t,d,p)}),v=this.activeTimers!=null;if(v&&(f=this.startTimer()),function(x,b,_,E,I){NB(b.inShapeInfos,_),NB([b.outShapeInfo],[E]);var C=E.texData.texture,S=E.texData.texShape;E.texData.isPacked?x.setOutputPackedMatrixTexture(C,S[0],S[1]):x.setOutputMatrixTexture(C,S[0],S[1]),x.setProgram(b.webGLProgram),me().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&x.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&x.gl.uniform1f(b.nanLoc,NaN),_.forEach(function(T,N){var R=b.program.variableNames[N],D=b.uniformLocations[R],z=b.uniformLocations["offset"+R];if(D!=null)if(T.isUniform)if(We(T.shape)<2)x.gl.uniform1f(D,T.uniformValues[0]);else{var L=T.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),x.gl.uniform1fv(D,L)}else T.texData.slice!=null&&z!=null&&x.gl.uniform1i(z,T.texData.slice.flatOffset),x.setInputMatrixTexture(T.texData.texture,D,N)}),I!=null&&I(x,b.webGLProgram),x.executeProgram()}(this.gpgpu,g,d,p,i),h.forEach(function(x){return a.disposeData(x.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!me().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){var y=this.unpackTensor(l);return this.disposeData(l.dataId),y}return l},e.prototype.compileAndRun=function(t,r,s,i,o){o===void 0&&(o=!1),s=s||r[0].dtype;var a=this.runWebGLProgram(t,r,s,i,o);return Q.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(me().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Oe(function(){if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=me().getBool("DEBUG");me().set("DEBUG",!1);var s=t.abs(Ae(1e-8)).dataSync()[0];if(me().set("DEBUG",r),s>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,s=this.texData.get(t),i=s.shape,o=s.dtype,a=s.values,l=s.texture,u=s.usage,c=s.isPacked;if(l==null){var h,d=this.activeTimers!=null;d&&(h=ia());var f=s.texShape;if(f==null&&(f=dWe(i,c),s.texShape=f),a!=null){var p=M2(i),m=void 0,g=f[1],v=f[0],y=a instanceof Uint8Array;c?(g=(r=ix(f[0],f[1]))[0],v=r[1],m=new X6e(p,[v,g],y)):m=new K6e(p,[v,g],y);var x=this.makeTensorInfo([v,g],o);this.texData.get(x.dataId).usage=y?yi.PIXELS:yi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),g,v,a);var b=this.runWebGLProgram(m,[x],o,null,!0),_=this.texData.get(b.dataId);s.texture=_.texture,s.texShape=_.texShape,s.isPacked=_.isPacked,s.usage=_.usage,this.disposeData(x.dataId),this.texData.delete(b.dataId),s.values=null,d&&(this.uploadWaitMs+=ia()-h)}else{var E=this.acquireTexture(f,u,o,c);s.texture=E}}},e.prototype.convertAndCacheOnCPU=function(t,r){var s=this.texData.get(t),i=s.dtype;return this.releaseGPUData(t),r!=null&&(s.values=function(o,a){if(a==="float32"||a==="complex64")return o;if(a==="int32"||a==="bool"){for(var l=a==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<l.length;++u)l[u]=Math.round(o[u]);return l}throw new Error("Unknown dtype "+a)}(r,i)),s.values},e.prototype.acquireTexture=function(t,r,s,i){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*dK(r)},e}(OK);xK()&&Q.registerBackend("webgl",function(){return new oHe},2);var aHe=G({square_:function(n){var e=V(n,"x","square"),t=[e];return Q.runKernelFunc(function(r,s){return s([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),dv="SquaredDifference",eX=G({squaredDifference_:function(n,e){var t,r=V(n,"a","squaredDifference"),s=V(e,"b","squaredDifference");t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape);var i={a:r,b:s},o=[r,s];return Q.runKernelFunc(function(a,l){var u=a.squaredDifference(r,s);return l([r,s]),u},i,function(a,l){var u=l[0],c=l[1],h=Ae(2);return{a:function(){return a.mul(u.sub(c).mul(h))},b:function(){return a.mul(c.sub(u).mul(h))}}},dv,{},o,[])}}),lHe=G({abs_:function(n){var e=V(n,"x","abs");return e.dtype==="complex64"?Q.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):Q.runKernelFunc(function(t,r){var s=t.abs(e);return r([e]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mul(s.toFloat().step(-1))}}},"Abs")}}),uHe=G({acos_:function(n){var e=V(n,"x","acos");return Q.runKernelFunc(function(t,r){var s=t.acos(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Ae(1).sub(s.toFloat().square()).sqrt()).neg()}}})}}),cHe=G({acosh_:function(n){var e=V(n,"x","acosh");return Q.runKernelFunc(function(t,r){var s=t.acosh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(s.toFloat().square().sub(1).sqrt())}}})}}),hHe=G({asin_:function(n){var e=V(n,"x","asin");return Q.runKernelFunc(function(t,r){var s=t.asin(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Ae(1).sub(s.toFloat().square()).sqrt())}}})}}),dHe=G({asinh_:function(n){var e=V(n,"x","asinh");return Q.runKernelFunc(function(t,r){var s=t.asinh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.divStrict(Ae(1).add(s.toFloat().square()).sqrt())}}})}}),fHe=G({atan_:function(n){var e=V(n,"x","atan");return Q.runKernelFunc(function(t,r){var s=t.atan(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().square().add(1))}}})}}),pHe=G({atanh_:function(n){var e=V(n,"x","atanh");return Q.runKernelFunc(function(t,r){var s=t.atanh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(Ae(1).sub(s.toFloat().square()))}}})}}),mHe=G({ceil_:function(n){var e=V(n,"x","ceil");return Q.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),w$=G({clipByValue_:function(n,e,t){var r=V(n,"x","clipByValue");j(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var s=[r],i={min:e,max:t};return Q.runKernelFunc(function(o,a){var l=o.clip(r,e,t);return a([r]),l},{x:r},function(o,a){var l=a[0];return{x:function(){return o.where(l.greaterEqual(e).logicalAnd(l.lessEqual(t)),Pt(o))}}},"ClipByValue",i,s)}}),gHe=G({cos_:function(n){var e=V(n,"x","cos"),t=[e];return Q.runKernelFunc(function(r,s){var i=r.cos(e);return s([e]),i},{x:e},function(r,s){var i=s[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),vHe=G({cosh_:function(n){var e=V(n,"x","cosh");return Q.runKernelFunc(function(t,r){var s=t.cosh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return s.toFloat().sinh().mulStrict(t)}}})}}),yHe=G({erf_:function(n){var e=V(n,"x","erf");return j(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),Q.runKernelFunc(function(t,r){var s=t.erf(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),OE=G({exp_:function(n){var e=V(n,"x","exp");return Q.runKernelFunc(function(t,r){var s=t.exp(e);return r([s]),s},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),xHe=G({expm1_:function(n){var e=V(n,"x","expm1");return Q.runKernelFunc(function(t,r){var s=t.expm1(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.exp())}}})}}),bHe=G({floor_:function(n){var e=V(n,"x","floor");return Q.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),wHe=G({log_:function(n){var e=V(n,"x","log"),t=[e];return Q.runKernelFunc(function(r,s){var i=r.log(e);return s([e]),i},{x:e},function(r,s){var i=s[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},t)}}),_He=G({log1p_:function(n){var e=V(n,"x","log1p");return Q.runKernelFunc(function(t,r){var s=t.log1p(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.add(1))}}})}}),kHe=G({logSigmoid_:function(n){var e=V(n,"x","logSigmoid");return Q.runKernelFunc(function(t,r){var s=t.softplus(e.neg()).neg();return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.neg().sigmoid())}}})}}),u1=G({neg_:function(n){var e=V(n,"x","neg"),t=[e];return Q.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),CHe=G({reciprocal_:function(n){var e=V(n,"x","reciprocal");return Q.runKernelFunc(function(t,r){var s=t.reciprocal(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.square().neg())}}})}}),IHe=G({round_:function(n){var e=V(n,"x","round");return Q.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),tX=G({rsqrt_:function(n){var e=V(n,"x","rsqrt"),t=[e];return Q.runKernelFunc(function(r,s){var i=r.rsqrt(e);return s([e]),i},{x:e},function(r,s){var i=s[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),nX=G({sigmoid_:function(n){var e=V(n,"x","sigmoid");return Q.runKernelFunc(function(t,r){var s=t.sigmoid(e);return r([s]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mul(s.mul(Ae(1).sub(s)))}}},"Sigmoid")}}),SHe=G({sign_:function(n){var e=V(n,"x","sign");return Q.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),EHe=G({isNaN_:function(n){var e=V(n,"x","isNaN");return Q.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),THe=G({isInf_:function(n){var e=V(n,"x","isInf");return Q.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),NHe=G({isFinite_:function(n){var e=V(n,"x","isFinite");return Q.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Pt(t)}}})}}),AHe=G({sin_:function(n){var e=V(n,"x","sin"),t=[e];return Q.runKernelFunc(function(r,s){var i=r.sin(e);return s([e]),i},{x:e},function(r,s){var i=s[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},t)}}),RHe=G({sinh_:function(n){var e=V(n,"x","sinh");return Q.runKernelFunc(function(t,r){var s=t.sinh(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return s.toFloat().cosh().mulStrict(t)}}})}}),DHe=G({softplus_:function(n){var e=V(n,"x","softplus");return Q.runKernelFunc(function(t,r){var s=t.softplus(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.mul(s.sigmoid())}}})}}),$He=G({sqrt_:function(n){var e=V(n,"x","sqrt");return Q.runKernelFunc(function(t,r){var s=t.sqrt(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().sqrt().mul(2))}}})}}),PHe=G({step_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","step");return Q.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Pt(r)}}})}}),OHe=G({tan_:function(n){var e=V(n,"x","tan");return Q.runKernelFunc(function(t,r){var s=t.tan(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return t.div(s.cos().square())}}})}}),FHe=G({tanh_:function(n){var e=V(n,"x","tanh");return Q.runKernelFunc(function(t,r){var s=t.tanh(e);return r([s]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return Ae(1).sub(s.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function rX(n,e,t,r,s,i){var o,a,l=V(n,"x","batchNorm"),u=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return s!=null&&(o=V(s,"scale","batchNorm")),r!=null&&(a=V(r,"offset","batchNorm")),j(l.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),j(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."}),j(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),o!=null&&j(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),a!=null&&j(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),ax(l,u,c,a,o,i)}function sX(n,e,t,r,s,i){var o,a,l=V(n,"x","batchNorm"),u=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return s!=null&&(o=V(s,"scale","batchNorm")),r!=null&&(a=V(r,"offset","batchNorm")),j(l.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),j(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."}),j(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),o!=null&&j(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),a!=null&&j(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),ax(l,u,c,a,o,i)}function iX(n,e,t,r,s,i){var o,a,l=V(n,"x","batchNorm"),u=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return s!=null&&(o=V(s,"scale","batchNorm")),r!=null&&(a=V(r,"offset","batchNorm")),j(l.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."}),j(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."}),j(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),o!=null&&j(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),a!=null&&j(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),ax(l,u,c,a,o,i)}function ax(n,e,t,r,s,i){i==null&&(i=.001);var o,a,l,u=V(n,"x","batchNorm"),c=V(e,"mean","batchNorm"),h=V(t,"variance","batchNorm");s!=null&&(o=V(s,"scale","batchNorm")),r!=null&&(a=V(r,"offset","batchNorm")),j(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),j(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),j(o==null||c.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),l=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var d=[u,c,h,o];return Q.runKernelFunc(function(f,p){var m=f.batchNormalization(l,P0(c),P0(h),i,P0(o),P0(a));return p([u,c,h,o]),m},{x:u,mean:c,variance:h,scale:o,offset:a},function(f,p){var m=p,g=m[0],v=m[1],y=m[2],x=m[3],b=x??Ae(1),_=Cr(v.shape,l.shape),E=[];if(v.rank===1){for(var I=0;I<l.shape.length-1;++I)E.push(l.shape[I]);E.push(1)}var C=g.sub(v),S=f.mul(b),T=tX(y.add(Ae(i))),N=T.mul(T).mul(T).mul(Ae(-.5));return{x:function(){return v.rank===1?f.mul(xf(T.as4D(1,1,1,v.shape[0]),E)).mul(b).reshape(g.shape):f.mul(T).mul(b).reshape(g.shape)},mean:function(){var R=T.mul(Ae(-1)).mul(S);return v.rank===1&&(R=R.sum(_)),R.reshape(v.shape)},variance:function(){var R=N.mul(C).mul(S);return v.rank===1&&(R=R.sum(_)),R.reshape(v.shape)},scale:function(){var R=C.mul(T),D=f.mul(R);return v.rank===1&&(D=D.sum(_)),D.reshape(v.shape)},offset:function(){var R=f;return v.rank===1&&(R=R.sum(_)),R.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(u.shape)}function P0(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Mk(){bK("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var MHe=G({batchNormalization2d_:function(n,e,t,r,s,i){return r===void 0&&(r=.001),Mk(),rX(n,e,t,i,s,r)}}),LHe=G({batchNormalization3d_:function(n,e,t,r,s,i){return r===void 0&&(r=.001),Mk(),sX(n,e,t,i,s,r)}}),BHe=G({batchNormalization4d_:function(n,e,t,r,s,i){return r===void 0&&(r=.001),Mk(),iX(n,e,t,i,s,r)}}),VHe=G({batchNormalization_:function(n,e,t,r,s,i){return r===void 0&&(r=.001),Mk(),ax(n,e,t,i,s,r)}}),oX=G({batchNorm_:ax}),zHe=G({batchNorm2d_:rX}),UHe=G({batchNorm3d_:sX}),jHe=G({batchNorm4d_:iX}),Lk=G({logicalAnd_:function(n,e){var t=V(n,"a","logicalAnd","bool"),r=V(e,"b","logicalAnd","bool");return It(t.shape,r.shape),Q.runKernelFunc(function(s){return s.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),WHe=G({logicalNot_:function(n){var e=V(n,"x","logicalNot","bool");return Q.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),aX=G({logicalOr_:function(n,e){var t=V(n,"a","logicalOr","bool"),r=V(e,"b","logicalOr","bool");return It(t.shape,r.shape),Q.runKernelFunc(function(s){return s.logicalOr(t,r)},{$a:t,$b:r})}}),HHe=G({logicalXor_:function(n,e){var t=V(n,"a","logicalXor","bool"),r=V(e,"b","logicalXor","bool");return It(t.shape,r.shape),aX(n,e).logicalAnd(Lk(n,e).logicalNot())}}),Uh=G({where_:function(n,e,t){var r=V(e,"a","where"),s=V(t,"b","where"),i=V(n,"condition","where","bool");return Kt(r.shape,s.shape,"Error in where: "),i.rank===1?j(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Kt(i.shape,s.shape,"Error in where: "),Q.runKernelFunc(function(o,a){var l=o.select(i,r,s);return a([i]),l},{$condition:i,$a:r,$b:s},function(o,a){var l=a[0];return{$condition:function(){return Pt(l).toFloat()},$a:function(){return o.mul(l.cast(o.dtype))},$b:function(){return o.mul(l.logicalNot().cast(o.dtype))}}})}}),lX=function(n){return Be(this,void 0,void 0,function(){var e,t,r;return Ve(this,function(s){switch(s.label){case 0:return[4,(e=V(n,"condition","whereAsync","bool")).data()];case 1:return t=s.sent(),r=v$(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},kt=G({add_:function(n,e){var t,r=V(n,"a","add"),s=V(e,"b","add");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o){return o.add(r,s)},{a:r,b:s},function(o){return{a:function(){var a=o,l=Cr(r.shape,i);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=o,l=Cr(s.shape,i);return l.length>0&&(a=a.sum(l)),a.reshape(s.shape)}}},"Add")}}),GHe=G({addN_:function(n){j(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),j(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(s,i){return V(s,"tensors"+i,"addN")}),t=e[0];e.forEach(function(s){if(s.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(s){if(!Fr(s.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return Q.runKernelFunc(function(s){return s.addN(e)},r,function(s){var i={};return e.forEach(function(o,a){i[a]=function(){return s.clone()}}),i},"AddN")}}),qHe=G({addStrict_:function(n,e){var t=V(n,"a","addStrict"),r=V(e,"b","addStrict");return Kt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),KHe=G({atan2_:function(n,e){var t,r=V(n,"a","atan2"),s=V(e,"b","atan2");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o,a){var l=o.atan2(r,s);return a([r,s]),l},{$a:r,$b:s},function(o,a){var l=a[0],u=a[1];return{$a:function(){var c=kt(l.square(),u.square()),h=o.mul(u.div(c)),d=Cr(l.shape,i);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)},$b:function(){var c=kt(l.square(),u.square()),h=u1(o.mul(l.div(c))),d=Cr(u.shape,i);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)}}})}}),Co=G({div_:function(n,e){var t,r=V(n,"a","div"),s=V(e,"b","div");if(t=Mn(r,s),r=t[0],s=t[1],r.dtype==="int32"&&s.dtype==="int32")return uX(r,s);var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o,a){var l=o.realDivide(r,s);return a([r,s]),l},{a:r,b:s},function(o,a){var l=a[0],u=a[1];return{a:function(){var c=o.div(u.toFloat()),h=Cr(l.shape,i);return h.length>0?c.sum(h).reshape(l.shape):c},b:function(){var c=o.mul(l.toFloat()),h=Cr(u.shape,i);h.length>0&&(c=c.sum(h).reshape(u.shape));var d=u.square();return c.div(d.toFloat()).neg()}}},"Div")}}),XHe=G({divNoNan_:function(n,e){var t,r=V(n,"a","div"),s=V(e,"b","div");r=(t=Mn(r,s))[0],s=t[1];var i=Co(r,s),o=Pt(i),a=s.equal(o);return Uh(a,o,i)}}),YHe=G({divStrict_:function(n,e){var t=V(n,"a","div"),r=V(e,"b","div");return Kt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),uX=G({floorDiv_:function(n,e){var t,r=V(n,"a","floorDiv"),s=V(e,"b","floorDiv");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o,a){var l=o.floorDiv(r,s);return a([r,s]),l},{a:r,b:s},function(o,a){var l=a[0],u=a[1];return{a:function(){var c=o.div(u.toFloat()),h=Cr(l.shape,i);return h.length>0?c.sum(h).reshape(l.shape):c},b:function(){var c=o.mul(l.toFloat()),h=Cr(u.shape,i);h.length>0&&(c=c.sum(h).reshape(u.shape));var d=u.square();return c.div(d.toFloat()).neg()}}},"FloorDiv")}}),_$=G({maximum_:function(n,e){var t,r=V(n,"a","maximum"),s=V(e,"b","maximum");return t=Mn(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),It(r.shape,s.shape),Q.runKernelFunc(function(i,o){var a=i.maximum(r,s);return o([r,s]),a},{a:r,b:s},function(i,o){var a=o[0],l=o[1];return{a:function(){return i.mul(a.greaterEqual(l).toFloat())},b:function(){return i.mul(a.less(l).toFloat())}}},"Maximum")}}),QHe=G({maximumStrict_:function(n,e){var t=V(n,"a","maximumStrict"),r=V(e,"b","maximumStrict");return Kt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),cX=G({minimum_:function(n,e){var t,r=V(n,"a","minimum"),s=V(e,"b","minimum");return t=Mn(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),It(r.shape,s.shape),Q.runKernelFunc(function(i,o){var a=i.minimum(r,s);return o([r,s]),a},{a:r,b:s},function(i,o){var a=o[0],l=o[1];return{a:function(){return i.mul(a.lessEqual(l).toFloat())},b:function(){return i.mul(a.greater(l).toFloat())}}},"Minimum")}}),JHe=G({minimumStrict_:function(n,e){var t=V(n,"a","minimumStrict"),r=V(e,"b","minimumStrict");return Kt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),ZHe=G({mod_:function(n,e){var t,r=V(n,"a","mod"),s=V(e,"b","mod");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o,a){var l=o.mod(r,s);return a([r,s]),l},{$a:r,$b:s},function(o,a){var l=a[0],u=a[1];return{$a:function(){var c=Cr(l.shape,i);return c.length>0?o.sum(c).reshape(l.shape):o},$b:function(){var c=o.mul(l.div(u).floor().neg()),h=Cr(u.shape,i);return h.length>0?c.sum(h).reshape(u.shape):c}}})}}),eGe=G({modStrict_:function(n,e){var t=V(n,"a","modStrict"),r=V(e,"b","modStrict");return Kt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),_s=G({mul_:function(n,e){var t,r=V(n,"a","mul"),s=V(e,"b","mul");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o,a){var l=o.multiply(r,s);return a([r,s]),l},{a:r,b:s},function(o,a){var l=a[0],u=a[1];return{a:function(){var c=o.mul(u.toFloat()),h=Cr(l.shape,i);return h.length>0?c.sum(h).reshape(l.shape):c},b:function(){var c=o.mul(l.toFloat()),h=Cr(u.shape,i);return h.length>0?c.sum(h).reshape(u.shape):c}}},"Mul")}}),tGe=G({mulStrict_:function(n,e){var t=V(n,"a","mul"),r=V(e,"b","mul");return Kt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),c1=G({pow_:function(n,e){var t,r=V(n,"base","pow"),s=V(e,"exp","pow");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape),o=[r,s];return Q.runKernelFunc(function(a,l){var u=a.pow(r,s);return l([r,s,u]),u},{a:r,b:s},function(a,l){var u=l[0],c=l[1],h=l[2];return{a:function(){var d=c.toFloat(),f=a.mul(d.mul(u.pow(d.sub(Ae(1))))),p=Cr(u.shape,i);return p.length>0&&(f=f.sum(p)),f.reshape(u.shape)},b:function(){var d=u.greater(0),f=u.log().where(d,Pt(u)),p=a.mul(h.mul(f)),m=Cr(c.shape,i);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}},"Pow",{},o,[!0])}}),nGe=G({powStrict_:function(n,e){return Kt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),rGe=G({squaredDifferenceStrict_:function(n,e){var t=V(n,"a","squaredDifferenceStrict"),r=V(e,"b","squaredDifferenceStrict");return Kt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Ir=G({sub_:function(n,e){var t,r=V(n,"a","sub"),s=V(e,"b","sub");t=Mn(r,s),r=t[0],s=t[1];var i=It(r.shape,s.shape);return Q.runKernelFunc(function(o){return o.subtract(r,s)},{a:r,b:s},function(o){return{a:function(){var a=o,l=Cr(r.shape,i);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=o,l=Cr(s.shape,i);return l.length>0&&(a=a.sum(l)),a.neg().reshape(s.shape)}}},"Sub")}}),sGe=G({subStrict_:function(n,e){var t=V(n,"a","subStrict"),r=V(e,"b","subStrict");return Kt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),hX=G({equal_:function(n,e){var t,r=V(n,"a","equal"),s=V(e,"b","equal");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i){return i.equal(r,s)},{$a:r,$b:s})}}),iGe=G({equalStrict_:function(n,e){var t=V(n,"a","equalStrict"),r=V(e,"b","equalStrict");return Kt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),oGe=G({greater_:function(n,e){var t,r=V(n,"a","greater"),s=V(e,"b","greater");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i){return i.greater(r,s)},{a:r,b:s},null,"Greater")}}),dX=G({greaterEqual_:function(n,e){var t,r=V(n,"a","greaterEqual"),s=V(e,"b","greaterEqual");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i,o){var a=i.greaterEqual(r,s);return o([r,s]),a},{a:r,b:s},function(i,o){var a=o[0],l=o[1];return{a:function(){return Pt(a)},b:function(){return Pt(l)}}},"GreaterEqual")}}),aGe=G({greaterEqualStrict_:function(n,e){var t=V(n,"a","greaterEqualStrict"),r=V(e,"b","greaterEqualStrict");return Kt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),lGe=G({greaterStrict_:function(n,e){var t=V(n,"a","greaterStrict"),r=V(e,"b","greaterStrict");return Kt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),uGe=G({less_:function(n,e){var t,r=V(n,"a","less"),s=V(e,"b","less");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i){return i.less(r,s)},{a:r,b:s},null,"Less")}}),cGe=G({lessEqual_:function(n,e){var t,r=V(n,"a","lessEqual"),s=V(e,"b","lessEqual");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i,o){var a=i.lessEqual(r,s);return o([r,s]),a},{a:r,b:s},null,"LessEqual")}}),hGe=G({lessEqualStrict_:function(n,e){var t=V(n,"a","lessEqualStrict"),r=V(e,"b","lessEqualStrict");return Kt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),dGe=G({lessStrict_:function(n,e){var t=V(n,"a","lessStrict"),r=V(e,"b","lessStrict");return Kt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),fGe=G({notEqual_:function(n,e){var t,r=V(n,"a","notEqual"),s=V(e,"b","notEqual");return t=Mn(r,s),r=t[0],s=t[1],It(r.shape,s.shape),Q.runKernelFunc(function(i){return i.notEqual(r,s)},{a:r,b:s},null,"NotEqual")}}),pGe=G({notEqualStrict_:function(n,e){var t=V(n,"a","notEqualStrict"),r=V(e,"b","notEqualStrict");return Kt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function BB(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function VB(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var k$=G({gather_:function(n,e,t){t===void 0&&(t=0);var r=V(n,"x","gather"),s=V(e,"indices","gather","int32");t=Er(t,r.shape)[0];var i=function(o,a,l){for(var u=o.shape[l],c=[],h=1,d=1,f=0;f<l;f++)c.push(o.shape[f]),h*=o.shape[f];for(f=0;f<a.rank;f++)c.push(a.shape[f]);for(f=l+1;f<o.rank;f++)c.push(o.shape[f]),d*=o.shape[f];return{batchSize:h,sliceSize:d,dimSize:u,outputShape:c}}(r,s,t);return Q.runKernelFunc(function(o,a){var l=o.gather(r,s.flatten(),t);return a([s]),l},{x:r,indices:s},function(o,a){var l=a[0];return{x:function(){var u=r.shape,c=l.size,h=u.slice(0,t),d=h.length,f=u.slice(t,u.length).slice(1),p=f.length,m=BB(0,d),g=BB(d+1,d+1+p),v=VB([h,[c],f]),y=o.reshape(v),x=l.reshape([c]),b=VB([[d],m,g]),_=y.transpose(b),E=fX(_,x,r.shape[t]),I=u$(b);return E=E.transpose(I)},indices:function(){return l}}},"Gather",{axis:t}).reshape(i.outputShape)}}),fX=G({unsortedSegmentSum_:function(n,e,t){var r=V(n,"x","unsortedSegmentSum"),s=V(e,"segmentIds","unsortedSegmentSum","int32");return j(nr(t),function(){return"numSegments must be of dtype int"}),Q.runKernelFunc(function(i,o){var a=i.unsortedSegmentSum(r,s,t);return o([s]),a},{$x:r},function(i,o){var a=o[0];return{$x:function(){return function(l,u){for(var c=_$(u,Pt(u)),h=k$(l,c),d=dX(u,Ae(0,"int32")),f=h.rank-d.rank,p=0;p<f;++p)d=ji(d,p+1);d=Lk(d,Vp(h.shape,"bool"));var m=Pt(h);return Uh(d,h,m)}(i,a)}}})}}),mGe=function(n,e,t){return Be(this,void 0,void 0,function(){var r,s,i,o,a,l,u,c,h,d,f,p,m;return Ve(this,function(g){switch(g.label){case 0:for(r=V(n,"tensor","boolMask"),s=V(e,"mask","boolMask","bool"),i=t??0,o=s.rank,a=r.shape,j(o>0,function(){return"mask cannot be scalar"}),Kt(a.slice(i,i+o),s.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,u=i;u<i+o;u++)l*=a[u];return c=a.slice(0,i).concat([l],a.slice(i+o)),h=r.reshape(c),d=s.reshape([-1]),[4,lX(d)];case 1:return f=g.sent(),p=f.squeeze([1]),m=k$(h,p,i),n!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,m]}})})};function pX(n,e,t,r,s,i,o){i===void 0&&(i="NHWC"),j(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,l=e,u=!1;e.rank===3&&(u=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),j(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),j(l.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank}),j(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];j(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),j(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&j(nr(s),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."});var d=p$(i),f=dd(a,t.shape,r,1,s,o,!1,d),p=Q.runKernelFunc(function(m,g){var v=m.conv2dDerInput(l,t,f);return g([t,l]),v},{dy4D:l,filter:t},function(m,g){var v=g[0],y=g[1];return{dy4D:function(){return fo(m,v,r,s,i,1,o)},filter:function(){return C$(m,y,v.shape,r,s,i,o)}}});return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function H2(n){var e=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function mX(n,e,t,r,s){j(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var i=n,o=e,a=!1;e.rank===4&&(a=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,n[0],n[1],n[2],n[3]]);var l=i[4],u=o.shape[4];j(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),j(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),j(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),j(l===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[3]+"."}),j(u===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."});var c=a1(i,t.shape,r,1,s),h=Q.runKernelFunc(function(d){return d.conv3dDerInput(o,t,c)},{dy5D:o});return a?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var gGe=G({conv1d_:function(n,e,t,r,s,i,o){s===void 0&&(s="NWC"),i===void 0&&(i=1);var a=V(n,"x","conv1d"),l=V(e,"filter","conv1d"),u=a,c=!1;a.rank===2&&(c=!0,u=a.as3D(1,a.shape[0],a.shape[1])),j(u.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),j(l.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."}),o!=null&&j(nr(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),j(u.shape[2]===l.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+l.shape[1]+"."}),j(ai(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"}),j(s==="NWC",function(){return"Error in conv1d: got dataFormat of "+s+" but only NWC is currently supported."});var h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),d=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),f=fo(d,h,[1,t],r,"NHWC",[1,i],o);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),fo=G({conv2d_:function(n,e,t,r,s,i,o){s===void 0&&(s="NHWC"),i===void 0&&(i=[1,1]);var a=V(n,"x","conv2d"),l=V(e,"filter","conv2d"),u=a,c=!1;a.rank===3&&(c=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),j(u.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."}),j(l.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."}),o!=null&&j(nr(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=s==="NHWC"?u.shape[3]:u.shape[1];j(h===l.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+l.shape[2]+"."}),j(ai(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"});var d=p$(s),f=dd(u.shape,l.shape,t,i,r,o,!1,d),p=[l,u],m=Q.runKernelFunc(function(g,v){var y=g.conv2d(u,l,f);return v([l,u]),y},{x:u,filter:l},function(g,v){var y=v,x=y[0],b=y[1];return j(op(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return gX(b.shape,g,x,t,r,s)},filter:function(){return C$(b,g,x.shape,t,r,s)}}},"Conv2D",f,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),vGe=G({conv3d_:function(n,e,t,r,s,i){s===void 0&&(s="NDHWC"),i===void 0&&(i=[1,1,1]);var o=V(n,"x","conv3d"),a=V(e,"filter","conv3d"),l=o,u=!1;o.rank===4&&(u=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),j(l.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."}),j(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),j(l.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),j(function(d,f){return H2(d)||H2(f)}(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),j(s==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+s+" but only NDHWC is currently supported."});var c=a1(l.shape,a.shape,t,i,r),h=Q.runKernelFunc(function(d,f){var p=d.conv3d(l,a,c);return f([l,a]),p},{x:l,$filter:a},function(d,f){j(H2(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=f[0],m=f[1];return{x:function(){return mX(p.shape,d,m,t,r)},$filter:function(){return function(g,v,y,x,b){var _=g;g.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var E=v;E.rank===4&&(E=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),j(_.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+_.shape+"."}),j(E.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."}),j(y.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),j(_.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+_.shape[4]+") must match input depth in filter ("+y[3]+"."}),j(E.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+y[4]+")."});var I=a1(_.shape,y,x,1,b);return Q.runKernelFunc(function(C){return C.conv3dDerFilter(_,E,I)},{x5D:_,dy5D:E})}(p,d,m.shape,t,r)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),C$=G({conv2dDerFilter_:function(n,e,t,r,s,i,o){i===void 0&&(i="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var l=e;l.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),j(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),j(l.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."}),j(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];j(u===t[2],function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+t[2]+"."}),j(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),o!=null&&j(nr(s),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."});var h=p$(i),d=dd(a.shape,t,r,1,s,o,!1,h);return Q.runKernelFunc(function(f){return f.conv2dDerFilter(a,l,d)},{x4D:a,dy4D:l})}}),gX=G({conv2dDerInput_:pX}),Bk=G({depthwiseConv2d_:function(n,e,t,r,s,i,o){i===void 0&&(i=[1,1]);var a=V(n,"x","depthwiseConv2d"),l=V(e,"filter","depthwiseConv2d"),u=a,c=!1;a.rank===3&&(c=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),j(u.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."}),j(l.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."}),j(u.shape[3]===l.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."}),i==null&&(i=[1,1]),j(ai(t,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),o!=null&&j(nr(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=dd(u.shape,l.shape,t,i,r,o,!0),d=[u,l],f=Q.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(u,l,h);return m([u,l]),g},{x:u,filter:l},function(p,m){j(op(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=m[0],v=m[1];return{x:function(){return vX(g.shape,p,v,h)},filter:function(){return yX(g,p,v.shape,h)}}},"DepthwiseConv2dNative",h,d);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),vX=G({depthwiseConv2dDerInput_:function(n,e,t,r){var s=e,i=!1;e.rank===3&&(i=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=Q.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(s,t,r)},{dy4D:s});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),yX=G({depthwiseConv2dDerFilter_:function(n,e,t,r){var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=e;return i.rank===3&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Q.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(s,i,r)},{x4D:s,dy4D:i})}}),I$=G({separableConv2d_:function(n,e,t,r,s,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var a=V(n,"x","separableConv2d"),l=V(e,"depthwiseFilter","separableConv2d"),u=V(t,"pointwiseFilter","separableConv2d"),c=a,h=!1;if(a.rank===3&&(h=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");j(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),j(l.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."}),j(u.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."}),j(u.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),j(u.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var d=l.shape[2],f=l.shape[3];j(u.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+u.shape[2]+"."});var p=Bk(c,l,r,s,o,i),m=fo(p,u,1,"valid",o);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),yGe=G({conv2dTranspose_:function(n,e,t,r,s,i){return pX(t,V(n,"x","conv2dTranspose"),V(e,"filter","conv2dTranspose"),r,s,"NHWC",i)}}),xGe=G({conv3dTranspose_:function(n,e,t,r,s){return mX(t,V(n,"x","conv3dTranspose"),V(e,"filter","conv3dTranspose"),r,s)}}),Vk=G({matMul_:function(n,e,t,r){var s;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=V(n,"a","matMul"),o=V(e,"b","matMul");s=Mn(i,o),i=s[0],o=s[1];var a=t?i.shape[i.rank-2]:i.shape[i.rank-1],l=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=t?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?o.shape[o.rank-2]:o.shape[o.rank-1],h=i.shape.slice(0,-2),d=o.shape.slice(0,-2),f=We(h),p=We(d);j(i.rank>=2&&o.rank>=2&&i.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."}),j(Fr(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."}),j(a===l,function(){return"Error in matMul: inner shapes ("+a+") and ("+l+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([u,c]),g=t?i.as3D(f,a,u):i.as3D(f,u,a),v=r?o.as3D(p,c,l):o.as3D(p,l,c),y={transposeA:t,transposeB:r};return Q.runKernelFunc(function(x,b){var _=x.batchMatMul(g,v,t,r);return b([g,v]),_},{a:g,b:v},function(x,b){var _=b,E=_[0],I=_[1];return t||r?!t&&r?{a:function(){return x.matMul(I,!1,!1)},b:function(){return x.matMul(E,!0,!1)}}:t&&!r?{a:function(){return I.matMul(x,!1,!0)},b:function(){return E.matMul(x,!1,!1)}}:{a:function(){return I.matMul(x,!0,!0)},b:function(){return x.matMul(E,!0,!0)}}:{a:function(){return x.matMul(I,!1,!0)},b:function(){return E.matMul(x,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),bGe=G({dot_:function(n,e){var t=V(n,"t1","dot"),r=V(e,"t2","dot");j(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var s=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];return j(s===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+s+" and "+i+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),wGe=G({outerProduct_:function(n,e){var t=V(n,"v1","outerProduct"),r=V(e,"v2","outerProduct");return j(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),lx=G({reverse_:function(n,e){var t=V(n,"x","reverse");if(t.rank===0)return t.clone();var r=Er(e,t.shape);return Q.runKernelFunc(function(s){return s.reverse(t,r)},{$x:t},function(s){return{$x:function(){return s.reverse(r)}}}).reshapeAs(t)}}),_Ge=G({reverse1d_:function(n){var e=V(n,"x","reverse");return j(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),lx(e,0)}}),kGe=G({reverse2d_:function(n,e){var t=V(n,"x","reverse");return j(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),lx(t,e)}}),CGe=G({reverse3d_:function(n,e){var t=V(n,"x","reverse");return j(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),lx(t,e)}}),IGe=G({reverse4d_:function(n,e){var t=V(n,"x","reverse");return j(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),lx(t,e)}});function xX(n,e,t,r,s,i){var o=V(n,"x","maxPool"),a=o,l=!1;o.rank===3&&(l=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),j(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),j(ai(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),i!=null&&j(nr(s),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."});var u=hv(a.shape,e,t,r,s,i);if(u.filterWidth===1&&u.filterHeight===1&&Fr(u.inShape,u.outShape))return o.clone();var c=[a],h=Q.runKernelFunc(function(d,f){var p=d.maxPool(a,u);return f([a,p]),p},{x:a},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,y,x,b,_,E,I){var C=V(g,"dy","maxPoolBackprop"),S=V(v,"input","maxPoolBackprop"),T=V(y,"output","maxPoolBackprop");j(S.rank===C.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+C.rank+")"}),j(ai(b,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+_+"'"}),j(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),j(S.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var N=hv(S.shape,x,b,_,E,I);return Q.runKernelFunc(function(R){return R.maxPoolBackprop(C,S,T,N)},{$dy:C,$input:S})}(d,p,m,e,t,r,s)}}},"MaxPool",u,c);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function bX(n,e,t,r,s,i){var o=V(n,"x","avgPool","float32");j(ai(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=o,l=!1;o.rank===3&&(l=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),j(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),i!=null&&j(nr(s),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."});var u=hv(a.shape,e,t,r,s,i);if(u.filterWidth===1&&u.filterHeight===1&&Fr(u.inShape,u.outShape))return o.clone();var c=Q.runKernelFunc(function(h){return h.avgPool(a,u)},{x:a},function(h){return{x:function(){return function(d,f,p,m,g,v){var y=V(d,"dy","avgPoolBackprop"),x=V(f,"input","avgPoolBackprop");j(x.rank===y.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+y.rank+")"}),j(ai(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var b=x,_=y,E=!1;x.rank===3&&(E=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),_=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),j(_.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),j(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var I=hv(b.shape,p,m,g,v),C=Q.runKernelFunc(function(S){return S.avgPoolBackprop(_,b,I)},{dy4D:_,input4D:b});return E?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(h,a,e,t,r,s)}}},"AvgPool",u);return c=c.cast(o.dtype),l?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Tr=G({maxPool_:function(n,e,t,r,s){return xX(n,e,t,1,r,s)}}),ux=G({avgPool_:function(n,e,t,r,s){return bX(n,e,t,1,r,s)}}),SGe=G({pool_:function(n,e,t,r,s,i){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");var o=V(n,"x","maxPool"),a=o,l=!1;o.rank===3&&(l=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),j(ai(i,s),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+s+"'"});var u,c=hv(a.shape,e,i,s,r),h=[c.dilationHeight,c.dilationWidth];u=r==="same"?function(b,_){var E=b.map(function(S,T){return S+(S-1)*(_[T]-1)}).map(function(S){return S-1}),I=E.map(function(S){return Math.floor(S/2)}),C=E.map(function(S,T){return S-I[T]});return E.map(function(S,T){return[I[T],C[T]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,f=function(b,_,E){var I=E.map(function(z){return z[0]}),C=E.map(function(z){return z[1]}),S=b.concat(I,C),T=_.map(function(z,L){return(z-S[L]%z)%z}),N=C.map(function(z,L){return z+T[L]}),R=_.map(function(z,L){return[I[L],N[L]]}),D=_.map(function(z,L){return[0,T[L]]});return[R,D]}([c.inHeight,c.inWidth],h,u),p=f[0],m=f[1],g=d?r:"valid",v=d?a:SK(a,h,p),y=(t==="avg"?function(){return bX(v,e,i,1,g)}:function(){return xX(v,e,i,1,g)})(),x=d?y:kK(y,h,m);return l?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),EGe=G({maxPool3d_:function(n,e,t,r,s,i,o){i===void 0&&(i="NDHWC");var a=V(n,"x","maxPool3d"),l=a,u=!1;a.rank===4&&(u=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),o==null&&(o=[1,1,1]),j(l.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."}),j(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),j(ai(t,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&j(nr(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var c=o1(l.shape,e,t,o,r,s,i),h=Q.runKernelFunc(function(d,f){var p=d.maxPool3d(l,c);return f([l,p]),p},{x:l},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,y,x,b,_,E,I){var C=V(g,"dy","maxPool3dBackprop"),S=V(v,"input","maxPool3dBackprop"),T=V(y,"output","maxPool3dBackprop"),N=C,R=S,D=T,z=!1;S.rank===4&&(z=!0,N=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),R=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),D=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),j(N.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),j(R.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."}),j(D.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+D.rank+"."}),_==null&&(_=[1,1,1]),j(ai(b,_),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+_+"'"}),I!=null&&j(nr(E),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+I+" but got pad "+E+"."});var L=o1(R.shape,x,b,_,E,I),O=Q.runKernelFunc(function(F){return F.maxPool3dBackprop(N,R,D,L)},{dy5D:N,input5D:R});return z?O.as4D(O.shape[1],O.shape[2],O.shape[3],O.shape[4]):O}(d,p,m,e,t,o,r,s)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),TGe=G({avgPool3d_:function(n,e,t,r,s,i,o){i===void 0&&(i="NDHWC");var a=V(n,"x","avgPool3d","float32"),l=a,u=!1;a.rank===4&&(u=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),o==null&&(o=[1,1,1]),j(l.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."}),j(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),j(ai(t,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&j(nr(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var c=o1(l.shape,e,t,o,r,s,i),h=Q.runKernelFunc(function(d){return d.avgPool3d(l,c)},{x:l},function(d){return{x:function(){return function(f,p,m,g,v,y,x){var b=V(f,"dy","avgPool3dBackprop"),_=V(p,"input","avgPool3dBackprop"),E=b,I=_,C=!1;_.rank===4&&(C=!0,E=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),I=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),j(E.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+E.rank+"."}),j(I.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+I.rank+"."}),v==null&&(v=[1,1,1]),j(ai(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),x!=null&&j(nr(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+y+"."});var S=o1(I.shape,m,g,v,y,x),T=Q.runKernelFunc(function(N){return N.avgPool3dBackprop(E,I,S)},{dy5D:E,input5D:I});return C?T.as4D(T.shape[1],T.shape[2],T.shape[3],T.shape[4]):T}(d,l,e,t,o,r,s)}}});return h=h.cast(l.dtype),u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Pa=G({slice_:function(n,e,t){var r,s,i=V(n,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice()).forEach(function(l){j(l!==-1,function(){return"slice() does not support negative begin indexing."})}),s=(s=t==null?new Array(i.rank).fill(-1):typeof t=="number"?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map(function(l,u){return l>=0?l:(j(l===-1,function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+u+"."}),i.shape[u]-r[u])}),n6e(i,r,s);var o=i.shape,a={begin:r,size:s};return Q.runKernelFunc(function(l){return l.slice(i,r,s)},{x:i},function(l){for(var u=[],c=0;c<l.rank;c++)u.push([r[c],o[c]-r[c]-s[c]]);return{x:function(){return l.pad(u)}}},"Slice",a)}}),NGe=G({slice1d_:function(n,e,t){var r=V(n,"x","slice1d");return j(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Pa(r,[e],[t])}}),AGe=G({slice2d_:function(n,e,t){var r=V(n,"x","slice2d");return j(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Pa(r,e,t)}}),wX=G({slice3d_:function(n,e,t){var r=V(n,"x","slice3d");return j(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Pa(r,e,t)}}),RGe=G({slice4d_:function(n,e,t){var r=V(n,"x","slice4d");return j(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Pa(r,e,t)}});function _X(n,e,t,r,s){return e.rank<t.rank&&(e=e.reshape(oi(e.shape,r))),n.rank<t.rank&&(n=n.reshape(oi(n.shape,r))),{x:function(){var i=n.mul(t.equal(e).cast(n.dtype));return s==null?i:i.transpose(s)}}}var DGe=G({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","all","bool"),s=Er(e,r.shape),i=s,o=Ba(i,r.rank);o!=null&&(r=r.transpose(o),i=Va(i.length,r.rank));var a=Q.runKernelFunc(function(u){return u.all(r,i)},{$x:r});if(t){var l=oi(a.shape,s);return a.reshape(l)}return a}}),$Ge=G({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","any","bool"),s=Er(e,r.shape),i=s,o=Ba(i,r.rank);o!=null&&(r=r.transpose(o),i=Va(i.length,r.rank));var a=Q.runKernelFunc(function(u){return u.any(r,i)},{$x:r});if(t){var l=oi(a.shape,s);return a.reshape(l)}return a}}),PGe=G({argMax_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","argMax");e==null&&(e=0);var r=Er(e,t.shape),s=Ba(r,t.rank);s!=null&&(t=t.transpose(s),r=Va(r.length,t.rank));var i={axis:r[0]},o=[t];return Q.runKernelFunc(function(a,l){var u=a.argMax(t,r[0]);return l([t]),u},{x:t},function(a,l){var u=l[0];return{x:function(){return Pt(u)}}},"ArgMax",i,o)}}),OGe=G({argMin_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","argMin");e==null&&(e=0);var r=Er(e,t.shape),s=Ba(r,t.rank);return s!=null&&(t=t.transpose(s),r=Va(r.length,t.rank)),Q.runKernelFunc(function(i,o){var a=i.argMin(t,r[0]);return o([t]),a},{$x:t},function(i,o){var a=o[0];return{$x:function(){return Pt(a)}}})}}),FGe=G({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","logSumExp"),s=Er(e,r.shape),i=r.max(s,!0),o=r.sub(i).exp().sum(s).log(),a=i.reshape(o.shape).add(o);if(t){var l=oi(a.shape,s);return a.reshape(l)}return a}}),zk=G({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","max"),s=r,i=Er(e,r.shape),o=i,a=Ba(o,r.rank);a!=null&&(r=r.transpose(a),o=Va(o.length,r.rank));var l=[r],u=Q.runKernelFunc(function(h,d){var f=h.max(r,o);return d([s,f]),f},{x:r},function(h,d){return _X(h,d[1],d[0],i,a)},"Max",{axes:o},l,[!0]);if(t){var c=oi(u.shape,i);u=u.reshape(c)}return u}}),MGe=G({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","mean"),s=Er(e,r.shape),i=We(fs(r.shape,s)[1]);return Fk(function(o){var a=Ae(i);return{value:(a.dtype===o.dtype?o:o.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(l){var u=o.shape.slice();return s.forEach(function(c){u[c]=1}),l.reshape(u).mul(Vp(o.shape,"float32")).div(i)}}})(r)}}),LGe=G({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","min"),s=r,i=Er(e,r.shape),o=i,a=Ba(o,r.rank);a!=null&&(r=r.transpose(a),o=Va(o.length,r.rank));var l=[r],u=Q.runKernelFunc(function(h,d){var f=h.min(r,o);return d([s,f]),f},{x:r},function(h,d){return _X(h,d[1],d[0],i,a)},"Min",{axes:o},l,[!0]);if(t){var c=oi(u.shape,i);u=u.reshape(c)}return u}}),BGe=G({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Er(e,(n=V(n,"x","moments")).shape),s=n.mean(r,t),i=s.shape;t||(i=oi(s.shape,r));var o=n.toFloat().sub(s.reshape(i)).square();return{mean:s,variance:o.mean(r,t)}}}),kX=G({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var s=Er(e,r.shape);return Fk(function(i){var o=Ba(s,i.rank),a=s,l=i;o!=null&&(l=i.transpose(o),a=Va(a.length,i.rank));var u=function(f){var p=i.shape.slice();return s.forEach(function(m){p[m]=1}),f.reshape(p).mul(Vp(i.shape,"float32"))},c={axes:a},h=Q.runKernelFunc(function(f){return f.sum(l,a)},{x:l},function(f){return{x:function(){return u(f)}}},"Sum",c);if(t){var d=oi(h.shape,s);h=h.reshape(d)}return{value:h,gradFunc:u}})(r)}}),VGe=G({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var s=Er(e,r.shape),i=Ba(s,r.rank),o=s,a=r;i!=null&&(a=r.transpose(i),o=Va(o.length,r.rank));var l=Q.runKernelFunc(function(c){return c.prod(a,o)},{permutedX:a});if(t){var u=oi(l.shape,s);l=l.reshape(u)}return l}}),CX=G({elu_:function(n){var e=V(n,"x","elu");return Q.runKernelFunc(function(t,r){var s=t.elu(e);return r([s]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){return Q.runKernelFunc(function(i){return i.eluDer(t,s)},{dy:t,y:s})}}})}}),zGe=G({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=V(n,"x","leakyRelu");return _$(Ae(e).mul(t),t)}}),IX=G({prelu_:function(n,e){var t=V(n,"x","prelu"),r=V(e,"alpha","prelu");return Q.runKernelFunc(function(s,i){var o=s.prelu(t,r);return i([t,r]),o},{x:t,alpha:r},function(s,i){var o=i[0],a=i[1],l=o.greater(0);return{x:function(){return Uh(l,s,s.mul(a))},alpha:function(){var u=Uh(l,Pt(s),s.mul(o)),c=Cr(a.shape,s.shape);return c.length>0&&(u=u.sum(c)),u.reshape(a.shape)}}},"Prelu")}}),Dn=G({relu_:function(n){var e=V(n,"x","relu");return e.dtype==="bool"?e.toInt():Q.runKernelFunc(function(t,r){var s=t.relu(e);return r([e]),s},{x:e},function(t,r){var s=r[0];return{x:function(){return t.mulStrict(s.step().toFloat())}}},"Relu")}}),SX=G({relu6_:function(n){var e=V(n,"x","relu6");return e.dtype==="bool"?e.toInt():Q.runKernelFunc(function(t,r){var s=t.relu6(e);return r([e]),s},{x:e},function(t,r){var s=r[0],i=s.lessEqual(6).mul(s.step());return{x:function(){return t.mulStrict(i.toFloat())}}},"Relu6")}}),UGe=G({selu_:function(n){var e=V(n,"x","selu");return Q.runKernelFunc(function(t,r){var s=t.selu(e);return r([e]),s},{$x:e},function(t,r){var s=r[0];return{$x:function(){var i=s.greater(Ae(0)),o=Ae(x$),a=Ae(b$),l=t.mul(a),u=t.mul(o).mul(s.toFloat().exp());return Uh(i,l,u)}}})}}),oc=G({transpose_:function(n,e){var t=V(n,"x","transpose");if(e==null&&(e=t.shape.map(function(s,i){return i}).reverse()),j(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(s){j(s>=0&&s<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return Q.runKernelFunc(function(s){return s.transpose(t,e)},{x:t},function(s){var i=u$(e);return{x:function(){return s.transpose(i)}}},"Transpose",r)}}),jGe=G({localResponseNormalization_:function(n,e,t,r,s){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5);var i=V(n,"x","localResponseNormalization");j(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),j(nr(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var o=i,a=!1;i.rank===3&&(a=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var l=Q.runKernelFunc(function(u,c){var h=u.localResponseNormalization4D(o,e,t,r,s);return c([o,h]),h},{x4D:o},function(u,c){var h=c[0],d=c[1];return{x4D:function(){return Q.runKernelFunc(function(f){return f.LRNGrad(u,h,d,e,t,r,s)},{})}}});return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),EX=G({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var s=function a(l,u,c){if(c===void 0&&(c=null),l.rank===0)return l.abs();if(l.rank!==1&&c===null)return a(l.reshape([-1]),u,c);if(l.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(u===1)return l.abs().sum(c);if(u===1/0)return l.abs().max(c);if(u===-1/0)return l.abs().min(c);if(u==="euclidean"||u===2)return l.abs().pow(Ae(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(c)&&c.length===2){if(u===1)return l.abs().sum(c[0]).max(c[1]-1);if(u===1/0)return l.abs().sum(c[1]).max(c[0]);if(u===-1/0)return l.abs().sum(c[1]).min(c[0]);if(u==="fro"||u==="euclidean")return l.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+c)}(n=V(n,"x","norm"),e,t),i=s.shape;if(r){var o=Er(t,n.shape);i=oi(s.shape,o)}return s.reshape(i)}}),WGe=G({basicLSTMCell_:function(n,e,t,r,s,i){var o=V(n,"forgetBias","basicLSTMCell"),a=V(e,"lstmKernel","basicLSTMCell"),l=V(t,"lstmBias","basicLSTMCell"),u=V(r,"data","basicLSTMCell"),c=V(s,"c","basicLSTMCell"),h=V(i,"h","basicLSTMCell"),d=u.concat(h,1).matMul(a).add(l),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),v=d.slice([0,p],m),y=d.slice([0,2*p],m),x=d.slice([0,3*p],m),b=g.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(o.add(y).sigmoid())),_=b.tanh().mulStrict(x.sigmoid());return[b,_]}}),HGe=G({multiRNNCell_:function(n,e,t,r){for(var s=V(e,"data","multiRNNCell"),i=e1(t,"c","multiRNNCell"),o=e1(r,"h","multiRNNCell"),a=s,l=[],u=0;u<n.length;u++){var c=n[u](a,i[u],o[u]);l.push(c[0]),l.push(c[1]),a=c[1]}var h=[],d=[];for(u=0;u<l.length;u+=2)h.push(l[u]),d.push(l[u+1]);return[h,d]}}),GGe=G({movingAverage_:function(n,e,t,r,s){s===void 0&&(s=!0);var i=V(n,"v","movingAverage"),o=V(e,"x","movingAverage"),a=V(t,"decay","movingAverage");jje(i,o),j(Fr(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var l=Ae(1),u=l.sub(a),c=o.sub(i).mul(u);if(s){j(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=V(r,"step","movingAverage");c=c.div(l.sub(c1(a,h)))}return i.add(c)}}),qGe=G({stridedSlice_:function(n,e,t,r,s,i,o,a,l){if(s===void 0&&(s=0),i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),l===void 0&&(l=0),r==null&&(r=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var u=V(n,"x","stridedSlice"),c=xB(a),h=u.shape.slice();c.forEach(function(g){e[g]=0,t[g]=1,h.splice(g,0,1)}),u=u.reshape(h);for(var d=0;d<u.rank;d++)e[d]=r6e(s,e,r,u.shape,d),t[d]=s6e(i,t,r,u.shape,d),r[d]=r[d]||1;var f=xB(l);f.forEach(function(g){t[g]=e[g]+1,r[g]=1});var p=f$(e,t,r),m=p.filter(function(g,v){return f.indexOf(v)===-1});return r.every(function(g){return g===1})?Pa(u,e,p).reshape(m):Q.runKernelFunc(function(g){return g.stridedSlice(u,e,t,r)},{$x:u}).reshape(m)}}),KGe=G({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=V(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var s=r.shape[r.shape.length-1];if(e>s)throw new Error("'k' passed to topk() must be <= the last dimension ("+s+") but got "+e);var i=Q.runKernelFunc(function(o){return o.topk(r,e,t)},{$x:r});return{values:i[0],indices:i[1]}}}),XGe=G({scatterND_:function(n,e,t){var r=V(n,"indices","scatterND","int32"),s=V(e,"updates","scatterND");return t6e(s,r,t),Q.runKernelFunc(function(i){return i.scatterND(r,s,t)},{indices:r,updates:s},null,"ScatterNd",{shape:t})}}),S$=G({fft_:function(n){j(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Q.runKernelFunc(function(s){return s.fft(r)},{input:n}).reshape(n.shape)}}),h1=G({ifft_:function(n){j(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Q.runKernelFunc(function(s){return s.ifft(r)},{input:n}).reshape(n.shape)}}),E$=G({rfft_:function(n,e){j(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],s=n.size/r;if(e!=null&&e<r){var i=n.shape.map(function(v){return 0}),o=n.shape.map(function(v){return v});o[n.shape.length-1]=e,t=n.slice(i,o),r=e}else if(e!=null&&e>r){var a=n.shape.map(function(v){return v});a[n.shape.length-1]=e-r,t=n.concat(vn(a),n.shape.length-1),r=e}else t=n;var l=t.zerosLike(),u=jr(t,l).as2D(s,r),c=S$(u),h=Math.floor(r/2)+1,d=Gi(c),f=ua(c),p=d.split([h,r-h],d.shape.length-1),m=f.split([h,r-h],f.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=h,jr(p[0],m[0]).reshape(g)}}),TX=G({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),s=h1(r);return Gi(s)}var i=[t,2*(e-1)],o=Gi(n).as2D(t,e),a=ua(n).as2D(t,e),l=o.slice([0,1],[t,e-2]).reverse(1),u=a.slice([0,1],[t,e-2]).reverse(1).mul(Ae(-1)),c=o.concat(l,1),h=a.concat(u,1);return r=jr(c,h).as2D(i[0],i[1]),s=h1(r),Gi(s)}}),YGe=Object.freeze({fft:S$,ifft:h1,rfft:E$,irfft:TX}),QGe=G({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var s=V(n,"sparseIndices","sparseToDense","int32"),i=V(e,"sparseValues","sparseToDense"),o=V(r,"defaultValue","sparseToDense",i.dtype);return function(a,l,u,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var h=a.rank>0?a.shape[0]:1,d=a.rank>1?a.shape[1]:1;if(u.length!==d)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+d+".");var f=l.size;if(l.rank!==0&&(l.rank!==1||f!==h))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+h+"]");if(l.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,i,t,o),Q.runKernelFunc(function(a){return a.sparseToDense(s,i,t,o)},{$sparseIndices:s,$sparseValues:i,$defaultValue:o})}}),JGe=G({gatherND_:function(n,e){var t=V(e,"indices","gatherND","int32"),r=V(n,"x","gatherND");return Q.runKernelFunc(function(s){return s.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),ZGe=G({diag_:function(n){var e=V(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return Q.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),eqe=G({dropout_:function(n,e,t,r){var s=V(n,"x","dropout");if(j(s.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+s.dtype+" tensor instead."}),j(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof Rn?s.clone():s;var i=function(l,u){if(u==null)return l.shape.slice();if(Fr(l.shape,u))return u;if(l.shape.length===u.length){for(var c=[],h=0;h<l.shape.length;h++)u[h]==null&&l.shape[h]!=null?c.push(l.shape[h]):c.push(u[h]);return c}return u}(s,t),o=1-e,a=IK(i,0,1,"float32",r).add(o).floor().div(o);return s.mul(a)}});function NX(n,e,t){for(var r=1-n%2,s=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);s[i]=e-t*Math.cos(o)}return lr(s,"float32")}var T$=G({hannWindow_:function(n){return NX(n,.5,.5)}}),AX=G({hammingWindow_:function(n){return NX(n,.54,.46)}}),N$=G({frame_:function(n,e,t,r,s){r===void 0&&(r=!1),s===void 0&&(s=0);for(var i=0,o=[];i+e<=n.size;)o.push(Pa(n,i,e)),i+=t;if(r)for(;i<n.size;){var a=i+e-n.size,l=_r([Pa(n,i,e-a),Sa([a],s)]);o.push(l),i+=t}return o.length===0?Uu([],[0,e]):_r(o).as2D(o.length,e)}}),RX=G({stft_:function(n,e,t,r,s){var i;s===void 0&&(s=T$),r==null&&(i=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=N$(n,e,t),a=_s(o,s(e)),l=[],u=0;u<o.shape[0];u++)l.push(E$(a.slice([u,0],[1,e]),r));return _r(l)}}),tqe=Object.freeze({hannWindow:T$,hammingWindow:AX,frame:N$,stft:RX}),bs,nqe=function(n,e,t){return t===void 0&&(t=1),Be(this,void 0,void 0,function(){var r,s,i,o,a,l,u,c,h,d,f,p,m,g;return Ve(this,function(v){switch(v.label){case 0:return r=V(n,"predictions","inTopK"),s=V(e,"targets","inTopK"),j(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),j(r.rank-1===s.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+s.rank}),Kt(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],j(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+t}),[4,r.data()];case 1:return o=v.sent(),[4,s.data()];case 2:for(a=v.sent(),l=[o.length/i,i],c=l[1],h=lv("bool",u=l[0]),d=0;d<u;d++){for(f=d*c,p=o.subarray(f,f+c),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(y,x){return x.value-y.value}),h[d]=0,g=0;g<t;g++)if(m[g].index===a[d]){h[d]=1;break}}return n!==r&&r.dispose(),e!==s&&s.dispose(),[2,Gr(h,s.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(bs||(bs={}));var rqe=G({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=bs.SUM_BY_NONZERO_WEIGHTS);var s=V(n,"labels","absoluteDifference"),i=V(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=V(t,"weights","absoluteDifference")),Kt(s.shape,i.shape,"Error in absoluteDifference: ");var a=s.sub(i).abs();return Ul(a,o,r)}}),Ul=G({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=bs.SUM_BY_NONZERO_WEIGHTS);var r=V(n,"losses","computeWeightedLoss"),s=null;e!=null&&(s=V(e,"weights","computeWeightedLoss"));var i=s==null?r:r.mul(s);if(t===bs.NONE)return i;if(t===bs.SUM)return i.sum();if(t===bs.MEAN){if(s==null)return i.mean();var o=r.size/s.size,a=i.sum().div(s.sum());return o>1?a.div(Ae(o)):a}if(t===bs.SUM_BY_NONZERO_WEIGHTS){if(s==null)return i.sum().div(Ae(r.size));var l=s.mul(Vp(r.shape)).notEqual(Ae(0)).sum().toFloat();return i.sum().div(l)}throw Error("Unknown reduction: "+t)}}),sqe=G({cosineDistance_:function(n,e,t,r,s){s===void 0&&(s=bs.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","cosineDistance"),o=V(e,"predictions","cosineDistance"),a=null;r!=null&&(a=V(r,"weights","cosineDistance")),Kt(i.shape,o.shape,"Error in cosineDistance: ");var l=Ae(1).sub(i.mul(o).sum(t,!0));return Ul(l,a,s)}}),iqe=G({hingeLoss_:function(n,e,t,r){r===void 0&&(r=bs.SUM_BY_NONZERO_WEIGHTS);var s=V(n,"labels","hingeLoss"),i=V(e,"predictions","hingeLoss"),o=null;t!=null&&(o=V(t,"weights","hingeLoss")),Kt(s.shape,i.shape,"Error in hingeLoss: ");var a=Ae(1);s=Ae(2).mul(s).sub(a);var l=a.sub(s.mul(i)).relu();return Ul(l,o,r)}}),oqe=G({huberLoss_:function(n,e,t,r,s){r===void 0&&(r=1),s===void 0&&(s=bs.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","huberLoss"),o=V(e,"predictions","huberLoss"),a=null;t!=null&&(a=V(t,"weights","huberLoss")),Kt(i.shape,o.shape,"Error in huberLoss: ");var l=Ae(r),u=o.sub(i).abs(),c=cX(u,l),h=u.sub(c),d=Ae(.5).mul(c.square()).add(l.mul(h));return Ul(d,a,s)}}),aqe=G({logLoss_:function(n,e,t,r,s){r===void 0&&(r=1e-7),s===void 0&&(s=bs.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","logLoss"),o=V(e,"predictions","logLoss"),a=null;t!=null&&(a=V(t,"weights","logLoss")),Kt(i.shape,o.shape,"Error in logLoss: ");var l=Ae(1),u=Ae(r),c=i.mul(o.add(u).log()).neg().sub(l.sub(i).mul(l.sub(o).add(u).log()));return Ul(c,a,s)}}),lqe=G({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=bs.SUM_BY_NONZERO_WEIGHTS);var s=V(n,"labels","meanSquaredError"),i=V(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=V(t,"weights","meanSquaredError")),Kt(s.shape,i.shape,"Error in meanSquaredError: ");var a=s.squaredDifference(i);return Ul(a,o,r)}}),uqe=G({sigmoidCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=bs.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"multiClassLabels","sigmoidCrossEntropy"),o=V(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=V(t,"weights","sigmoidCrossEntropy")),Kt(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var l=Ae(r),u=Ae(1),c=Ae(.5);i=i.mul(u.sub(l)).add(c.mul(l))}var h=function(d,f){var p=V(d,"labels","sigmoidCrossEntropyWithLogits"),m=V(f,"logits","sigmoidCrossEntropyWithLogits");Kt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),y=m.abs().neg().exp().log1p();return g.sub(v).add(y)}(i,o);return Ul(h,a,s)}}),cqe=G({softmaxCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=bs.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"onehotLabels","softmaxCrossEntropy"),o=V(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=V(t,"weights","softmaxCrossEntropy")),Kt(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var l=Ae(r),u=Ae(1),c=Ae(i.shape[1]);i=i.mul(u.sub(l)).add(l.div(c))}var h=function(d,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return Fk(function(m,g,v){var y=g.logSumExp([p],!0),x=g.toFloat().sub(y);return v([m,x]),{value:x.mul(m).neg().sum([p]),gradFunc:function(b,_){var E=_[0],I=_[1],C=oi(b.shape,[p]);return[b.reshape(C).mul(E.toFloat().sub(I.exp())),b.reshape(C).mul(I.exp().sub(E.toFloat()))]}}})(d,f)}(i,o);return Ul(h,a,s)}}),hqe=Object.freeze({get Reduction(){return bs},absoluteDifference:rqe,computeWeightedLoss:Ul,cosineDistance:sqe,hingeLoss:iqe,huberLoss:oqe,logLoss:aqe,meanSquaredError:lqe,sigmoidCrossEntropy:uqe,softmaxCrossEntropy:cqe});function zB(n,e){return e===void 0&&(e=!1),Q.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],s=CK(t),i=n.clone(),o=Uu([[1]],[1,1]),a=o.clone(),l=t>=r?r:t,u=function(h){var d,f=i,p=a,m=s;d=Q.tidy(function(){var g=i.slice([h,h],[t-h,1]),v=g.norm(),y=i.slice([h,h],[1,1]),x=Uu([[-1]]).where(y.greater(0),Uu([[1]])),b=y.sub(x.mul(v)),_=g.div(b);a=_.shape[0]===1?o.clone():o.concat(_.slice([1,0],[_.shape[0]-1,_.shape[1]]),0);var E=x.matMul(b).div(v).neg(),I=i.slice([h,0],[t-h,r]),C=E.mul(a);if(h===0)i=I.sub(C.matMul(a.transpose().matMul(I)));else{var S=I.sub(C.matMul(a.transpose().matMul(I)));i=i.slice([0,0],[h,r]).concat(S,0)}var T=s.slice([0,h],[t,s.shape[1]-h]);if(h===0)s=T.sub(T.matMul(a).matMul(C.transpose()));else{var N=T.sub(T.matMul(a).matMul(C.transpose()));s=s.slice([0,0],[t,h]).concat(N,1)}return[a,i,s]}),a=d[0],i=d[1],s=d[2],ni([f,p,m])},c=0;c<l;++c)u(c);return!e&&t>r&&(s=s.slice([0,0],[t,r]),i=i.slice([0,0],[r,r])),[s,i]})}var dqe=G({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=V(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var s=r.shape,i=r.shape.slice(-2),o=i[0],a=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=o),t<0&&(t=a);var l=t1(0,o,1,"int32").reshape([-1,1]),u=t1(0,a,1,"int32"),c=Ir(l,u),h=Lk(c.lessEqual(Ae(+e,"int32")),c.greaterEqual(Ae(-t,"int32"))),d=vn([o,a],r.dtype);return Ci(kr(r.reshape([-1,o,a])).map(function(f){return Uh(h,f,d)})).reshape(s)}}),fqe=G({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,j(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(l){j(n[l].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[l].shape[0]+" vs. "+t+")"})},s=1;s<n.length;++s)r(s)}else e=!0,n=h$(n,n.shape[0],0).map(function(l){return EK(l,[0])});j(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var i=[],o=n,a=function(l){i.push(Q.tidy(function(){var u=o[l];if(l>0)for(var c=0;c<l;++c){var h=kX(i[c].mulStrict(u)).mul(i[c]);u=u.sub(h)}return u.div(EX(u,"euclidean"))}))};for(s=0;s<n.length;++s)a(s);return e?Ci(i,0):i}}),pqe=G({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return zB(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(o,a){return o*a}),r=kr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],i=[];return r.forEach(function(o){var a=zB(o,e),l=a[0],u=a[1];s.push(l),i.push(u)}),[Ci(s,0).reshape(n.shape),Ci(i,0).reshape(n.shape)]}}),mqe=Object.freeze({bandPart:dqe,gramSchmidt:fqe,qr:pqe});function Uk(n,e,t,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),j(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),j(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),j(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),j(e.rank===1,function(){return"scores must be a 1D tensor"}),j(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),j(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}var gqe=G({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=V(n,"images","resizeBilinear");j(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),j(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var s=r,i=!1;r.rank===3&&(i=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],a=e[1],l=Q.runKernelFunc(function(u,c){return c([s]),u.resizeBilinear(s,o,a,t)},{x:s},function(u,c){return{x:function(){return Q.runKernelFunc(function(h){return h.resizeBilinearBackprop(u,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:o,newWidth:a});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),vqe=G({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=V(n,"images","resizeNearestNeighbor");j(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),j(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),j(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var s=r,i=!1;r.rank===3&&(i=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],a=e[1],l=Q.runKernelFunc(function(u,c){return c([s]),u.resizeNearestNeighbor(s,o,a,t)},{batchImages:s},function(u,c){return{batchImages:function(){return Q.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(u,c[0],t)},{})}}});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),yqe=G({nonMaxSuppression_:function(n,e,t,r,s){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY);var i=V(n,"boxes","nonMaxSuppression"),o=V(e,"scores","nonMaxSuppression"),a=Uk(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;var l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return Q.runKernelFunc(function(u){return u.nonMaxSuppression(i,o,t,r,s)},{boxes:i,scores:o},null,"NonMaxSuppressionV3",l)}}),xqe=function(n,e,t,r,s){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),Be(this,void 0,void 0,function(){var i,o,a,l,u,c,h;return Ve(this,function(d){switch(d.label){case 0:return i=V(n,"boxes","nonMaxSuppressionAsync"),o=V(e,"scores","nonMaxSuppressionAsync"),a=Uk(i,o,t,r,s),t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return l=d.sent(),u=l[0],c=l[1],h=m$(u,c,t,r,s),i!==n&&i.dispose(),o!==e&&o.dispose(),[2,h]}})})},bqe=G({nonMaxSuppressionWithScore_:function(n,e,t,r,s,i){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=V(n,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=Uk(o,a,t,r,s,i),u={maxOutputSize:t=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:s=l.scoreThreshold,softNmsSigma:i=l.softNmsSigma},c=Q.runKernel("NonMaxSuppressionV5",{boxes:o,scores:a},u);return{selectedIndices:c[0],selectedScores:c[1]}}}),wqe=function(n,e,t,r,s,i){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Be(this,void 0,void 0,function(){var o,a,l,u,c,h,d;return Ve(this,function(f){switch(f.label){case 0:return o=V(n,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=Uk(o,a,t,r,s,i),t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma,[4,Promise.all([o.data(),a.data()])];case 1:return u=f.sent(),c=u[0],h=u[1],d=g$(c,h,t,r,s,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,d]}})})},_qe=G({cropAndResize_:function(n,e,t,r,s,i){var o=V(n,"image","cropAndResize"),a=V(e,"boxes","cropAndResize","float32"),l=V(t,"boxInd","cropAndResize","int32");s=s||"bilinear",i=i||0;var u=a.shape[0];return j(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),j(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+a.shape+"."}),j(l.rank===1&&l.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+a.shape+"."}),j(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),j(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),j(s==="bilinear"||s==="nearest",function(){return"method must be bilinear or nearest, but was "+s}),Q.runKernelFunc(function(c,h){return c.cropAndResize(o,a,l,r,s,i)},{images:o,boxes:a,boxInd:l},null,"CropAndResize",{method:s,extrapolationValue:i,cropSize:r})}}),A$=Object.freeze({resizeBilinear:gqe,resizeNearestNeighbor:vqe,nonMaxSuppression:yqe,nonMaxSuppressionAsync:xqe,nonMaxSuppressionWithScore:bqe,nonMaxSuppressionWithScoreAsync:wqe,cropAndResize:_qe}),R$=function(n,e){return!(n>0)||e==="linear"},D$=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},$$=function(n,e){var t=e,r=Cr(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},P$=function(n,e,t){if(e==="linear")return n;if(e==="relu")return Dn(n);if(e==="elu")return CX(n);if(e==="relu6")return SX(n);if(e==="prelu")return IX(n,t);throw new Error("Unknown fused activation "+e+".")},kqe=G({fusedMatMul_:function(n){var e,t=n.a,r=n.b,s=n.transposeA,i=s!==void 0&&s,o=n.transposeB,a=o!==void 0&&o,l=n.bias,u=n.activation,c=u===void 0?"linear":u,h=n.preluActivationWeights;if(R$(Q.state.gradientDepth,c)===!1){var d=Vk(t,r,i,a);return l!=null&&(d=kt(d,l)),P$(d,c,h)}var f=V(t,"a","fused matMul"),p=V(r,"b","fused matMul");e=Mn(f,p),f=e[0],p=e[1];var m=i?f.shape[f.rank-2]:f.shape[f.rank-1],g=a?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?f.shape[f.rank-1]:f.shape[f.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],x=f.shape.slice(0,-2),b=p.shape.slice(0,-2),_=We(x),E=We(b);j(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),j(Fr(x,b),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),j(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+a+" must match."});var I,C,S=f.shape.slice(0,-2).concat([v,y]),T=i?f.as3D(_,m,v):f.as3D(_,v,m),N=a?p.as3D(E,y,g):p.as3D(E,g,y);l!=null&&It(S,(I=Mn(I=V(l,"bias","fused matMul"),f)[0]).shape),h!=null&&(C=V(h,"prelu weights","fused matMul"));var R={a:T,b:N};l!=null&&(R.bias=I),h!=null&&(R.preluActivationWeights=C);var D=[T,N];return Q.runKernelFunc(function(z,L){var O=z.fusedBatchMatMul({a:T,b:N,transposeA:i,transposeB:a,bias:I,activation:c,preluActivationWeights:C});return L([T,N,O]),O},R,function(z,L){var O=L[0],F=L[1],P=L[2],U=D$(z,P,c),W={};return l!=null&&(W={bias:function(){return $$(I,U)}}),Object.assign(i||a?!i&&a?{a:function(){return U.matMul(F,!1,!1)},b:function(){return U.matMul(O,!0,!1)}}:i&&!a?{a:function(){return F.matMul(U,!1,!0)},b:function(){return O.matMul(U,!1,!1)}}:{a:function(){return F.matMul(U,!0,!0)},b:function(){return U.matMul(O,!0,!0)}}:{a:function(){return U.matMul(F,!1,!0)},b:function(){return O.matMul(U,!0,!1)}},W)},"_FusedMatMul",{transposeA:i,transposeB:a,activation:c},D,[!0]).reshape(S)}}),Cqe=G({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,i=n.dataFormat,o=i===void 0?"NHWC":i,a=n.dilations,l=a===void 0?[1,1]:a,u=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,f=n.preluActivationWeights;if(d=d||"linear",R$(Q.state.gradientDepth,d)===!1){var p=fo(e,t,r,s,o,l,u);return c!=null&&(p=kt(p,c)),P$(p,d,f)}var m=V(e,"x","conv2d"),g=V(t,"filter","conv2d"),v=m,y=!1;m.rank===3&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),j(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),j(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),u!=null&&j(nr(s),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+"."}),j(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),j(ai(r,l),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"}),j(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var x,b,_=dd(v.shape,g.shape,r,l,s,u);c!=null&&(x=Mn(x=V(c,"bias","fused conv2d"),m)[0],It(_.outShape,x.shape)),f!=null&&(b=V(f,"prelu weights","fused conv2d"));var E={x:v,filter:g};c!=null&&(E.bias=x),f!=null&&(E.preluActivationWeights=b);var I=[g,v],C=Q.runKernelFunc(function(S,T){var N=S.fusedConv2d({input:v,filter:g,convInfo:_,bias:x,activation:d,preluActivationWeights:b});return T([g,v,N]),N},E,function(S,T){var N=T,R=N[0],D=N[1],z=N[2],L=D$(S,z,d);j(op(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"});var O={};return c!=null&&(O={bias:function(){return $$(x,L)}}),Object.assign({x:function(){return gX(D.shape,L,R,r,s)},filter:function(){return C$(D,L,R.shape,r,s)}},O)},"FusedConv2D",{convInfo:_,activation:d},I,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Iqe=G({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,i=n.dataFormat,o=i===void 0?"NHWC":i,a=n.dilations,l=a===void 0?[1,1]:a,u=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,f=n.preluActivationWeights;if(R$(Q.state.gradientDepth,d)===!1){var p=Bk(e,t,r,s,o,l,u);return c!=null&&(p=kt(p,c)),P$(p,d,f)}var m=V(e,"x","depthwiseConv2d"),g=V(t,"filter","depthwiseConv2d"),v=m,y=!1;m.rank===3&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),j(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),j(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),j(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),l==null&&(l=[1,1]),j(ai(r,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"}),u!=null&&j(nr(s),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+s+"."});var x,b,_=dd(v.shape,g.shape,r,l,s,u,!0);c!=null&&(x=Mn(x=V(c,"bias","fused conv2d"),m)[0],It(_.outShape,x.shape)),f!=null&&(b=V(f,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:g};c!=null&&(E.bias=x),f!=null&&(E.preluActivationWeights=b);var I=[g,v],C=Q.runKernelFunc(function(S,T){var N=S.fusedDepthwiseConv2D({input:v,filter:g,convInfo:_,bias:x,activation:d,preluActivationWeights:b});return T([g,v,N]),N},E,function(S,T){j(op(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"});var N=T[0],R=T[1],D=T[2],z=D$(S,D,d),L={};return c!=null&&(L={bias:function(){return $$(x,z)}}),Object.assign({x:function(){return vX(R.shape,z,N,_)},filter:function(){return yX(R,z,N.shape,_)}},L)},"FusedDepthwiseConv2D",{convInfo:_,activation:d},I,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Sqe=Object.freeze({matMul:kqe,conv2d:Cqe,depthwiseConv2d:Iqe}),Eqe=Object.freeze({image:A$,linalg:mqe,losses:hqe,spectral:YGe,fused:Sqe,signal:tqe,square:aHe,squaredDifference:eX,conv1d:gGe,conv2d:fo,conv3d:vGe,depthwiseConv2d:Bk,separableConv2d:I$,conv2dTranspose:yGe,conv3dTranspose:xGe,op:G,batchNormalization2d:MHe,batchNormalization3d:LHe,batchNormalization4d:BHe,batchNormalization:VHe,batchNorm:oX,batchNorm2d:zHe,batchNorm3d:UHe,batchNorm4d:jHe,booleanMaskAsync:mGe,complex:jr,real:Gi,imag:ua,concat:_r,concat1d:SWe,concat2d:EWe,concat3d:TWe,concat4d:NWe,split:h$,matMul:Vk,dot:bGe,outerProduct:wGe,reverse:lx,reverse1d:_Ge,reverse2d:kGe,reverse3d:CGe,reverse4d:IGe,maxPool:Tr,avgPool:ux,pool:SGe,maxPool3d:EGe,avgPool3d:TGe,slice:Pa,slice1d:NGe,slice2d:AGe,slice3d:wX,slice4d:RGe,abs:lHe,acos:uHe,acosh:cHe,asin:hHe,asinh:dHe,atan:fHe,atanh:pHe,ceil:mHe,clipByValue:w$,cos:gHe,cosh:vHe,erf:yHe,exp:OE,expm1:xHe,floor:bHe,log:wHe,log1p:_He,logSigmoid:kHe,neg:u1,reciprocal:CHe,round:IHe,rsqrt:tX,sigmoid:nX,sign:SHe,isNaN:EHe,isInf:THe,isFinite:NHe,sin:AHe,sinh:RHe,softplus:DHe,sqrt:$He,step:PHe,tan:OHe,tanh:FHe,all:DGe,any:$Ge,argMax:PGe,argMin:OGe,logSumExp:FGe,max:zk,mean:MGe,min:LGe,moments:BGe,sum:kX,prod:VGe,equal:hX,equalStrict:iGe,greater:oGe,greaterEqual:dX,greaterEqualStrict:aGe,greaterStrict:lGe,less:uGe,lessEqual:cGe,lessEqualStrict:hGe,lessStrict:dGe,notEqual:fGe,notEqualStrict:pGe,add:kt,addN:GHe,addStrict:qHe,atan2:KHe,div:Co,divNoNan:XHe,divStrict:YHe,floorDiv:uX,maximum:_$,maximumStrict:QHe,minimum:cX,minimumStrict:JHe,mod:ZHe,modStrict:eGe,mul:_s,mulStrict:tGe,pow:c1,powStrict:nGe,squaredDifferenceStrict:rGe,sub:Ir,subStrict:sGe,elu:CX,leakyRelu:zGe,prelu:IX,relu:Dn,relu6:SX,selu:UGe,logicalAnd:Lk,logicalNot:WHe,logicalOr:aX,logicalXor:HHe,where:Uh,whereAsync:lX,buffer:ut,print:LWe,batchToSpaceND:kK,broadcastTo:BWe,cast:VWe,clone:zWe,cumsum:UWe,depthToSpace:jWe,expandDims:ji,eye:CK,multinomial:WWe,oneHot:RE,pad:hd,pad1d:HWe,pad2d:GWe,pad3d:qWe,pad4d:KWe,rand:XWe,randomNormal:YWe,randomGamma:QWe,randomUniform:IK,reshape:To,spaceToBatchND:SK,squeeze:EK,stack:Ci,tile:xf,truncatedNormal:JWe,unstack:kr,setdiff1dAsync:ZWe,fill:Sa,linspace:IWe,ones:Vp,range:t1,scalar:Ae,tensor:Gr,tensor1d:lr,tensor2d:Uu,tensor3d:c$,tensor4d:Gs,tensor5d:_We,tensor6d:kWe,variable:CWe,zeros:vn,onesLike:_K,zerosLike:Pt,transpose:oc,softmax:zl,logSoftmax:o6e,localResponseNormalization:jGe,norm:EX,gather:k$,unsortedSegmentSum:fX,basicLSTMCell:WGe,multiRNNCell:HGe,movingAverage:GGe,stridedSlice:qGe,topk:KGe,scatterND:XGe,fft:S$,ifft:h1,rfft:E$,irfft:TX,sparseToDense:QGe,gatherND:JGe,diag:ZGe,dropout:eqe,hannWindow:T$,hammingWindow:AX,frame:N$,stft:RX,inTopKAsync:nqe});function ye(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&j(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function G2(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var Tqe=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new PK(t,Q),t}return Wo(e,n),e.prototype.write=function(t,r,s){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&Zw(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:t,dtype:s}),i},e.prototype.move=function(t,r,s,i){this.data.set(t,{values:r,dtype:i})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),s=r.dtype,i=r.complexTensors;return s==="complex64"?PE(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),s=r;if(t.dtype==="string")try{s=r.map(function(i){return Yw(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ut(t.shape,t.dtype,s)},e.prototype.makeOutput=function(t,r,s){var i=this.write(t,r,s);return Q.makeTensorFromDataId(i,r,s,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Be(this,void 0,void 0,function(){var r;return Ve(this,function(s){return r=ia(),t(),[2,{kernelMs:ia()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var s=this.makeOutput(null,t.shape,"complex64");return this.data.get(s.dataId).complexTensors={real:Q.keep(t.clone()),imag:Q.keep(r.clone())},s},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(ye(t,"slice"),DK(t.shape,r,s)){var i=$K(r,t.strides),o=We(s);return Gr(this.readSync(t.dataId).subarray(i,i+o),s,t.dtype)}for(var a=ut(s,t.dtype),l=this.bufferSync(t),u=0;u<a.size;++u){var c=a.indexToLoc(u).map(function(h,d){return h+r[d]});a.values[u]=l.get.apply(l,c)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,s,i){ye(t,"stridedSlice");var o=f$(r,s,i);if(o.some(function(f){return f===0}))return Gr([],o);for(var a=ut(o,t.dtype),l=this.bufferSync(t),u=0;u<a.size;u++){for(var c=a.indexToLoc(u),h=new Array(c.length),d=0;d<h.length;d++)h[d]=c[d]*i[d]+r[d];a.set.apply(a,[l.get.apply(l,h)].concat(c))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),s=ut([t.size,t.size],t.dtype),i=s.values,o=0;o<r.length;o++)i[o*t.size+o]=r[o];return s.toTensor()},e.prototype.unstack=function(t,r){for(var s=t.shape[r],i=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==r&&(i[o++]=t.shape[a]);var l=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var c=new Array(s);for(a=0;a<c.length;a++)l[r]=a,c[a]=this.slice(t,l,u).reshape(i);return c},e.prototype.reverse=function(t,r){ye(t,"reverse");for(var s=ut(t.shape,t.dtype),i=this.bufferSync(t),o=function(l){var u=s.indexToLoc(l),c=u.slice();r.forEach(function(h){return c[h]=t.shape[h]-1-c[h]}),s.set.apply(s,[i.get.apply(i,c)].concat(u))},a=0;a<s.size;a++)o(a);return s.toTensor()},e.prototype.concat=function(t,r){var s=this;if(t[0].dtype==="complex64"){var i=t.map(function(f){return Gi(f)}),o=t.map(function(f){return ua(f)});return jr(this.concat(i,r),this.concat(o,r))}var a=t.map(function(f){var p=We(f.shape.slice(r));return f.as2D(-1,p)}),l=ip(a.map(function(f){return f.shape}),1),u=ut(l,t[0].dtype).values;if(a[0].shape[0]===1){var c=0;a.forEach(function(f){u.set(s.readSync(f.dataId),c),c+=f.size})}else{var h=0;a.forEach(function(f){for(var p=s.readSync(f.dataId),m=0,g=0;g<f.shape[0];++g)for(var v=g*l[1]+h,y=0;y<f.shape[1];++y)u[v+y]=p[m++];h+=f.shape[1]})}var d=ip(t.map(function(f){return f.shape}),r);return Gr(u,d,t[0].dtype)},e.prototype.neg=function(t){return ye(t,"neg"),this.multiply(Ae(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,i,o,a){return{real:s+o,imag:i+a}}):this.broadcastedBinaryOp(t,r,Hr(t.dtype,r.dtype),function(s,i){return s+i})},e.prototype.addN=function(t){var r=this;ye(t,"addN");for(var s=t.map(function(c){return r.readSync(c.dataId)}),i=ut(t[0].shape,t[0].dtype),o=i.values,a=0;a<t.length;a++)for(var l=s[a],u=0;u<o.length;u++)o[u]+=l[u];return i.toTensor()},e.prototype.softmax=function(t,r){var s=Er([r],t.shape),i=this.max(t,s),o=oi(i.shape,s),a=this.subtract(t,i.reshape(o)),l=this.exp(a),u=this.sum(l,s).reshape(o);return this.realDivide(l,u)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,i,o,a){return{real:s-o,imag:i-a}}):this.broadcastedBinaryOp(t,r,Hr(t.dtype,r.dtype),function(s,i){return s-i})},e.prototype.pow=function(t,r){return ye([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){return Math.pow(s,i)})},e.prototype.batchMatMul=function(t,r,s,i){ye([t,r],"matMul");for(var o=s?t.shape[1]:t.shape[2],a=s?t.shape[2]:t.shape[1],l=i?r.shape[1]:r.shape[2],u=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=s?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=d[0],p=d[1],m=d[2],g=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=g[0],y=g[1],x=g[2],b=a*l,_=ut([u,a,l],t.dtype),E=_.values,I=this.blockSize,C=0;C<u;C++)for(var S=0;S<a;S+=I)for(var T=0;T<l;T+=I)for(var N=0;N<o;N+=I)for(var R=Math.min(S+I,a),D=Math.min(T+I,l),z=Math.min(N+I,o),L=S;L<R;L++)for(var O=T;O<D;O++){for(var F=0,P=N;P<z;P++)F+=c[C*f+L*p+P*m]*h[P*v+O*y+C*x];E[C*b+(L*l+O)]+=F}return _.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,i=t.transposeA,o=t.transposeB,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=this.batchMatMul(r,s,i,o);return a&&(c=this.add(c,a)),l&&(c=G2(this,c,l,u)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(s,i,o,a){return{real:s*o-i*a,imag:s*a+i*o}}):this.broadcastedBinaryOp(t,r,Hr(t.dtype,r.dtype),function(s,i){return s*i})},e.prototype.realDivide=function(t,r){return ye([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(s,i){return s/i})},e.prototype.floorDiv=function(t,r){return ye([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(s,i){return Math.floor(s/i)})},e.prototype.sum=function(t,r){ye(t,"sum"),fi("sum",r,t.rank);for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,Hr(t.dtype,"int32")),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=0,p=0;p<l;++p)f+=c[d+p];u[h]=f}return a},e.prototype.prod=function(t,r){ye(t,"sum");for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,Hr(t.dtype,"int32")),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=1,p=0;p<l;++p)f*=c[d+p];u[h]=f}return a},e.prototype.unsortedSegmentSum=function(t,r,s){ye(t,"unsortedSegmentSum");for(var i=[],o=t.rank-r.rank,a=0;a<o;++a)r=r.expandDims(a+1);for(a=0;a<s;++a){var l=Ae(a,"int32"),u=hX(l,r).asType("float32").mul(t).sum(0);i.push(u)}return Ci(i)},e.prototype.argMin=function(t,r){ye(t,"argMin");var s=[r];fi("argMin",s,t.rank);for(var i=fs(t.shape,s),o=i[0],a=i[1],l=vn(o,"int32"),u=We(a),c=this.readSync(l.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],m=0,g=0;g<u;++g){var v=h[f+g];v<p&&(p=v,m=g)}c[d]=m}return l},e.prototype.argMax=function(t,r){ye(t,"argMax");var s=[r];fi("argMax",s,t.rank);for(var i=fs(t.shape,s),o=i[0],a=i[1],l=vn(o,"int32"),u=We(a),c=this.readSync(l.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],m=0,g=0;g<u;++g){var v=h[f+g];v>p&&(p=v,m=g)}c[d]=m}return l},e.prototype.cumsum=function(t,r,s,i){if(ye(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var o=Hr(t.dtype,"int32"),a=vn(t.shape,o),l=this.readSync(a.dataId),u=this.readSync(t.dataId),c=t.shape[t.rank-1],h=i?function(g,v){return g+c-v-1}:function(g,v){return g+v},d=0;d<u.length;d+=c)for(var f=0;f<c;f++){var p=h(d,f);if(f===0)l[p]=s?0:u[p];else{var m=h(d,f-1);l[p]=s?u[m]+l[m]:u[p]+l[m]}}return a},e.prototype.equal=function(t,r){return ye([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s===i?1:0})},e.prototype.notEqual=function(t,r){return ye([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s!==i?1:0})},e.prototype.less=function(t,r){return ye([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s<i?1:0})},e.prototype.lessEqual=function(t,r){return ye([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s<=i?1:0})},e.prototype.greater=function(t,r){return ye([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s>i?1:0})},e.prototype.greaterEqual=function(t,r){return ye([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s>=i?1:0})},e.prototype.logicalNot=function(t){ye(t,"logicalNot");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),i=0;i<r.length;++i)s[i]=r[i]?0:1;return this.makeOutput(s,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return ye([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s&&i})},e.prototype.logicalOr=function(t,r){return ye([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(s,i){return s||i})},e.prototype.select=function(t,r,s){ye([t,r,s],"select");for(var i=this.readSync(t.dataId),o=this.readSync(r.dataId),a=this.readSync(s.dataId),l=vn(r.shape,Hr(r.dtype,s.dtype)),u=this.readSync(l.dataId),c=0,h=t.rank===0||t.rank>1||r.rank===1?1:We(r.shape.slice(1)),d=0;d<i.length;d++)for(var f=0;f<h;f++)i[d]===1?u[c++]=o[d]:u[c++]=a[d];return l},e.prototype.where=function(t){ye([t],"where");var r=this.readSync(t.dataId);return v$(t.shape,r)},e.prototype.topk=function(t,r,s){return ye(t,"topk"),UK(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){ye(t,"min"),fi("min",r,t.rank);for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,t.dtype),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=c[d],p=0;p<l;++p){var m=c[d+p];m<f&&(f=m)}u[h]=f}return a},e.prototype.minimum=function(t,r){return ye([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){return Math.min(s,i)})},e.prototype.mod=function(t,r){return ye([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){var o=s%i;return s<0&&i<0||s>=0&&i>=0?o:(o+i)%i})},e.prototype.max=function(t,r){ye(t,"max"),fi("max",r,t.rank);for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,t.dtype),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=c[d],p=0;p<l;++p){var m=c[d+p];m>f&&(f=m)}u[h]=f}return a},e.prototype.maximum=function(t,r){return ye([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){return Math.max(s,i)})},e.prototype.all=function(t,r){ye(t,"all"),fi("all",r,t.rank);for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,t.dtype),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=c[d],p=0;p<l;++p){var m=c[d+p];f=f&&m}u[h]=f}return a},e.prototype.any=function(t,r){ye(t,"any"),fi("any",r,t.rank);for(var s=fs(t.shape,r),i=s[0],o=s[1],a=vn(i,t.dtype),l=We(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<u.length;++h){for(var d=h*l,f=c[d],p=0;p<l;++p){var m=c[d+p];f=f||m}u[h]=f}return a},e.prototype.squaredDifference=function(t,r){return ye([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){var o=s-i;return o*o})},e.prototype.ceil=function(t){ye(t,"ceil");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)s[i]=Math.ceil(r[i]);return this.makeOutput(s,t.shape,"float32")},e.prototype.floor=function(t){ye(t,"floor");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)s[i]=Math.floor(r[i]);return this.makeOutput(s,t.shape,"float32")},e.prototype.sign=function(t){ye(t,"x");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?s[i]=-1:r[i]>0?s[i]=1:s[i]=0;return this.makeOutput(s,t.shape,"float32")},e.prototype.isNaN=function(t){ye(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(s[i]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isInf=function(t){ye(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(s[i]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isFinite=function(t){ye(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(s[i]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.round=function(t){ye(t,"round");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i){var o=Math.floor(r[i]);r[i]-o<.5?s[i]=Math.floor(r[i]):r[i]-o>.5?s[i]=Math.ceil(r[i]):s[i]=o%2==0?o:o+1}return this.makeOutput(s,t.shape,"float32")},e.prototype.exp=function(t){ye(t,"exp");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)s[i]=Math.exp(r[i]);return this.makeOutput(s,t.shape,"float32")},e.prototype.expm1=function(t){ye(t,"expm1");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)s[i]=Math.expm1(r[i]);return this.makeOutput(s,t.shape,"float32")},e.prototype.log=function(t){ye(t,"log");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i){var o=r[i];s[i]=Math.log(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.log1p=function(t){ye(t,"log1p");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i){var o=r[i];s[i]=Math.log1p(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.sqrt=function(t){ye(t,"sqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i){var o=r[i];s[i]=Math.sqrt(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.rsqrt=function(t){ye(t,"rsqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i){var o=r[i];s[i]=1/Math.sqrt(o)}return this.makeOutput(s,t.shape,"float32")},e.prototype.reciprocal=function(t){ye(t,"reciprocal");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),i=0;i<r.length;++i)s[i]=1/r[i];return this.makeOutput(s,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){ye(t,"relu");for(var r=vn(t.shape,t.dtype),s=this.readSync(r.dataId),i=this.readSync(t.dataId),o=0;o<i.length;++o)s[o]=Math.max(0,i[o]);return r},e.prototype.relu6=function(t){ye(t,"relu");for(var r=vn(t.shape,t.dtype),s=this.readSync(r.dataId),i=this.readSync(t.dataId),o=0;o<i.length;++o)s[o]=Math.min(Math.max(0,i[o]),6);return r},e.prototype.prelu=function(t,r){return ye([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){return s<0?i*s:s})},e.prototype.elu=function(t){ye(t,"elu");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i){var o=s[i];r[i]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){ye([t,r],"eluDer");for(var s=new Float32Array(r.size),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<i.length;++a){var l=i[a];s[a]=l>=1?o[a]:o[a]*(l+1)}return this.makeOutput(s,r.shape,"float32")},e.prototype.selu=function(t){ye(t,"selu");for(var r=x$,s=b$,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var l=o[a];i[a]=l>=0?s*l:r*(Math.exp(l)-1)}return this.makeOutput(i,t.shape,"float32")},e.prototype.clip=function(t,r,s){ye(t,"clip");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var l=o[a];i[a]=l>s?s:l<r?r:l}return this.makeOutput(i,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.abs(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<t.size;++i){var o=s[2*i],a=s[2*i+1];r[i]=Math.hypot(o,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){ye(t,"int");for(var r=new Int32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=s[i];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){ye(t,"sigmoid");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=1/(1+Math.exp(-s[i]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){ye(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,s=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o]>-r,l=i[o]<r,u=Math.exp(i[o]),c=void 0;c=l?u:a?i[o]:Math.log(1+u),s[o]=c}return this.makeOutput(s,t.shape,"float32")},e.prototype.sin=function(t){ye(t,"sin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.sin(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){ye(t,"cos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.cos(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){ye(t,"tan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.tan(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){ye(t,"asin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.asin(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){ye(t,"acos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.acos(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){ye(t,"atan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.atan(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return ye([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(s,i){return Math.atan2(s,i)})},e.prototype.sinh=function(t){ye(t,"sinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.sinh(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){ye(t,"cosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.cosh(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){ye(t,"tanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Nje(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){ye(t,"asinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.asinh(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){ye(t,"acosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.acosh(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){ye(t,"atanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i)r[i]=Math.atanh(s[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){ye(t,"erf");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),i=0;i<s.length;++i){var o=Math.sign(s[i]),a=Math.abs(s[i]),l=1/(1+.3275911*a);r[i]=o*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),ye(t,"step");for(var s=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];isNaN(a)?s[o]=NaN:s[o]=a>0?1:r}return this.makeOutput(s,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,i=t.convInfo,o=t.bias,a=t.activation,l=t.preluActivationWeights,u=this.conv2d(r,s,i);return o&&(u=this.add(u,o)),a&&(u=G2(this,u,a,l)),u},e.prototype.conv2d=function(t,r,s){ye([t,r],"conv2d");for(var i=s.filterHeight,o=s.filterWidth,a=s.dilationHeight,l=s.dilationWidth,u=s.padInfo.left,c=s.padInfo.top,h=s.dataFormat==="channelsLast",d=ut(s.outShape,t.dtype),f=t.strides[0],p=h?t.strides[1]:t.strides[2],m=h?t.strides[2]:1,g=h?1:t.strides[1],v=d.strides[0],y=h?d.strides[1]:d.strides[2],x=h?d.strides[2]:1,b=h?1:d.strides[1],_=this.readSync(t.dataId),E=this.readSync(r.dataId),I=d.values,C=0;C<s.batchSize;++C)for(var S=C*f,T=C*v,N=0;N<s.outHeight;++N)for(var R=T+N*y,D=N*s.strideHeight-c,z=0;z<i;z++){var L=D+z*a;if(!(L<0||L>=s.inHeight))for(var O=z*r.strides[0],F=S+L*p,P=0;P<s.outWidth;++P)for(var U=R+P*x,W=P*s.strideWidth-u,X=0;X<o;X++){var Z=W+X*l;if(!(Z<0||Z>=s.inWidth))for(var ne=F+Z*m,he=O+X*r.strides[1],le=0;le<s.inChannels;++le){for(var pe=_[ne+le*g],be=0;be<s.outChannels;++be)I[U+be*b]+=pe*E[he+be];he+=s.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,r,s){for(var i=s.filterDepth,o=s.filterHeight,a=s.filterWidth,l=s.dilationDepth,u=s.dilationHeight,c=s.dilationWidth,h=s.padInfo.front,d=s.padInfo.left,f=s.padInfo.top,p=ut(s.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(r.dataId),v=p.values,y=0;y<s.batchSize;++y)for(var x=y*t.strides[0],b=y*p.strides[0],_=0;_<s.outDepth;++_)for(var E=b+_*p.strides[1],I=_*s.strideDepth-h,C=0;C<i;C++){var S=I+C*l;if(!(S<0||S>=s.inDepth))for(var T=C*r.strides[0],N=x+S*t.strides[1],R=0;R<s.outHeight;++R)for(var D=E+R*p.strides[2],z=R*s.strideHeight-f,L=0;L<o;L++){var O=z+L*u;if(!(O<0||O>=s.inHeight))for(var F=T+L*r.strides[1],P=N+O*t.strides[2],U=0;U<s.outWidth;++U)for(var W=D+U*s.outChannels,X=U*s.strideWidth-d,Z=0;Z<a;Z++){var ne=X+Z*c;if(!(ne<0||ne>=s.inWidth))for(var he=F+Z*r.strides[2],le=P+ne*s.inChannels,pe=he,be=0;be<s.inChannels;++be){for(var Ce=m[le+be],ke=0;ke<s.outChannels;++ke)v[W+ke]+=Ce*g[pe+ke];pe+=s.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,s){ye([t,r],"conv2dDerInput");for(var i=ut(s.inShape,"float32"),o=i.values,a=this.readSync(t.dataId),l=this.readSync(r.dataId),u=r.strides,c=u[0],h=u[1],d=u[2],f=s.batchSize,p=s.filterHeight,m=s.filterWidth,g=s.inChannels,v=s.inHeight,y=s.inWidth,x=s.outChannels,b=s.outHeight,_=s.outWidth,E=s.strideHeight,I=s.strideWidth,C=s.dataFormat,S=p-1-s.padInfo.top,T=m-1-s.padInfo.left,N=C==="channelsLast",R=i.strides[0],D=N?i.strides[1]:i.strides[2],z=N?i.strides[2]:1,L=N?1:i.strides[1],O=t.strides[0],F=N?t.strides[1]:t.strides[2],P=N?t.strides[2]:1,U=N?1:t.strides[1],W=0;W<f;++W)for(var X=0;X<g;++X)for(var Z=0;Z<v;++Z)for(var ne=Z-S,he=Math.max(0,Math.ceil(ne/E)),le=Math.min(b,(p+ne)/E),pe=0;pe<y;++pe){for(var be=pe-T,Ce=Math.max(0,Math.ceil(be/I)),ke=Math.min(_,(m+be)/I),$e=0,Se=he;Se<le;++Se)for(var Ue=Se*E-ne,je=Ce;je<ke;++je)for(var tt=O*W+F*Se+P*je,Qe=c*(p-1-Ue)+h*(m-1-(je*I-be))+d*X,Xe=0;Xe<x;++Xe)$e+=a[tt+U*Xe]*l[Qe+Xe];o[R*W+D*Z+z*pe+L*X]=$e}return i.toTensor()},e.prototype.conv3dDerInput=function(t,r,s){for(var i=ut(s.inShape,"float32"),o=i.values,a=i.strides,l=a[0],u=a[1],c=a[2],h=a[3],d=this.readSync(t.dataId),f=t.strides,p=f[0],m=f[1],g=f[2],v=f[3],y=this.readSync(r.dataId),x=r.strides,b=x[0],_=x[1],E=x[2],I=x[3],C=s.batchSize,S=s.filterDepth,T=s.filterHeight,N=s.filterWidth,R=s.inChannels,D=s.inDepth,z=s.inHeight,L=s.inWidth,O=s.outChannels,F=s.outDepth,P=s.outHeight,U=s.outWidth,W=s.strideDepth,X=s.strideHeight,Z=s.strideWidth,ne=S-1-s.padInfo.front,he=T-1-s.padInfo.top,le=N-1-s.padInfo.left,pe=0;pe<C;++pe)for(var be=0;be<R;++be)for(var Ce=0;Ce<D;++Ce)for(var ke=Ce-ne,$e=Math.max(0,Math.ceil(ke/W)),Se=Math.min(F,(S+ke)/W),Ue=0;Ue<z;++Ue)for(var je=Ue-he,tt=Math.max(0,Math.ceil(je/X)),Qe=Math.min(P,(T+je)/X),Xe=0;Xe<L;++Xe){for(var Ct=Xe-le,_t=Math.max(0,Math.ceil(Ct/Z)),ln=Math.min(U,(N+Ct)/Z),Yt=0,Xn=$e;Xn<Se;++Xn)for(var kn=Xn*W-ke,Yn=tt;Yn<Qe;++Yn)for(var Ln=Yn*X-je,Bn=_t;Bn<ln;++Bn)for(var Qt=p*pe+m*Xn+g*Yn+v*Bn,jt=b*(S-1-kn)+_*(T-1-Ln)+E*(N-1-(Bn*Z-Ct))+I*be,Cn=0;Cn<O;++Cn)Yt+=d[Qt+Cn]*y[jt+Cn];o[l*pe+u*Ce+c*Ue+h*Xe+be]=Yt}return i.toTensor()},e.prototype.conv2dDerFilter=function(t,r,s){ye([t,r],"conv2dDerFilter");for(var i=s.strideHeight,o=s.strideWidth,a=s.filterHeight,l=s.filterWidth,u=s.dataFormat==="channelsLast",c=ut(s.filterShape,"float32"),h=s.padInfo.left,d=s.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((d-m)/i)),v=Math.min(s.outHeight,(s.inHeight+d-m)/i),y=0;y<l;++y)for(var x=Math.max(0,Math.ceil((h-y)/o)),b=Math.min(s.outWidth,(s.inWidth+h-y)/o),_=0;_<s.inChannels;++_)for(var E=0;E<s.outChannels;++E){for(var I=0,C=0;C<s.batchSize;++C)for(var S=g;S<v;++S)for(var T=m+S*i-d,N=x;N<b;++N){var R=y+N*o-h;I+=u?f.get(C,T,R,_)*p.get(C,S,N,E):f.get(C,_,T,R)*p.get(C,E,S,N)}c.set(I,m,y,_,E)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,s){for(var i=s.strideDepth,o=s.strideHeight,a=s.strideWidth,l=s.filterDepth,u=s.filterHeight,c=s.filterWidth,h=ut(s.filterShape,"float32"),d=h.values,f=h.strides,p=f[0],m=f[1],g=f[2],v=f[3],y=this.readSync(r.dataId),x=r.strides,b=x[0],_=x[1],E=x[2],I=x[3],C=this.readSync(t.dataId),S=t.strides,T=S[0],N=S[1],R=S[2],D=S[3],z=s.padInfo.front,L=s.padInfo.left,O=s.padInfo.top,F=0;F<l;++F)for(var P=Math.max(0,Math.ceil((z-F)/i)),U=Math.min(s.outDepth,(s.inDepth+z-F)/i),W=F*p,X=0;X<u;++X)for(var Z=Math.max(0,Math.ceil((O-X)/o)),ne=Math.min(s.outHeight,(s.inHeight+O-X)/o),he=X*m+W,le=0;le<c;++le)for(var pe=Math.max(0,Math.ceil((L-le)/a)),be=Math.min(s.outWidth,(s.inWidth+L-le)/a),Ce=le*g+he,ke=0;ke<s.inChannels;++ke)for(var $e=ke*v+Ce,Se=0;Se<s.outChannels;++Se){for(var Ue=0,je=0;je<s.batchSize;++je)for(var tt=je*T,Qe=je*b,Xe=P;Xe<U;++Xe)for(var Ct=(F+Xe*i-z)*N+tt,_t=Xe*_+Qe,ln=Z;ln<ne;++ln)for(var Yt=(X+ln*o-O)*R+Ct,Xn=ln*E+_t,kn=pe;kn<be;++kn){var Yn=kn*I+Xn;Ue+=C[(le+kn*a-L)*D+Yt+ke]*y[Yn+Se]}d[$e+Se]=Ue}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,s=t.filter,i=t.convInfo,o=t.bias,a=t.activation,l=t.preluActivationWeights,u=this.depthwiseConv2D(r,s,i);return o&&(u=this.add(u,o)),a&&(u=G2(this,u,a,l)),u},e.prototype.depthwiseConv2D=function(t,r,s){ye([t,r],"depthwiseConv2D");for(var i=s.filterHeight,o=s.filterWidth,a=s.dilationHeight,l=s.dilationWidth,u=s.padInfo.left,c=s.padInfo.top,h=s.outChannels/s.inChannels,d=ut(s.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(r.dataId),m=d.values,g=0;g<s.batchSize;++g)for(var v=g*t.strides[0],y=g*d.strides[0],x=0;x<s.outHeight;++x)for(var b=y+x*d.strides[1],_=x*s.strideHeight-u,E=0;E<i;++E){var I=_+E*a;if(!(I<0||I>=s.inHeight))for(var C=E*r.strides[0],S=v+I*t.strides[1],T=0;T<s.outWidth;++T)for(var N=b+T*d.strides[2],R=T*s.strideWidth-c,D=0;D<o;++D){var z=R+D*l;if(!(z<0||z>=s.inWidth))for(var L=C+D*r.strides[1],O=S+z*s.inChannels,F=N,P=L,U=0;U<s.inChannels;++U){for(var W=f[O+U],X=0;X<h;++X)m[F+X]+=W*p[P+X];F+=h,P+=h}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,s){ye([t,r],"depthwiseConv2DDerInput");for(var i=ut(s.inShape,"float32"),o=i.values,a=i.strides,l=a[0],u=a[1],c=a[2],h=this.readSync(t.dataId),d=t.strides,f=d[0],p=d[1],m=d[2],g=this.readSync(r.dataId),v=r.strides,y=v[0],x=v[1],b=v[2],_=s.batchSize,E=s.filterHeight,I=s.filterWidth,C=s.inChannels,S=s.inHeight,T=s.inWidth,N=s.outChannels,R=s.outHeight,D=s.outWidth,z=s.strideHeight,L=s.strideWidth,O=E-1-s.padInfo.top,F=I-1-s.padInfo.left,P=N/C,U=0;U<_;++U)for(var W=0;W<C;++W)for(var X=0;X<S;++X)for(var Z=X-O,ne=Math.max(0,Math.ceil(Z/z)),he=Math.min(R,(E+Z)/z),le=0;le<T;++le){for(var pe=le-F,be=Math.max(0,Math.ceil(pe/L)),Ce=Math.min(D,(I+pe)/L),ke=0,$e=ne;$e<he;++$e)for(var Se=$e*z-Z,Ue=be;Ue<Ce;++Ue)for(var je=f*U+p*$e+m*Ue,tt=y*(E-1-Se)+x*(I-1-(Ue*L-pe))+b*W,Qe=0;Qe<P;++Qe)ke+=h[je+(W*P+Qe)]*g[tt+Qe];o[l*U+u*X+c*le+W]=ke}return i.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){ye([t,r],"depthwiseConv2DDerFilter");for(var i=s.strideHeight,o=s.strideWidth,a=s.filterHeight,l=s.filterWidth,u=ut(s.filterShape,"float32"),c=s.padInfo.left,h=s.padInfo.top,d=s.outChannels/s.inChannels,f=this.bufferSync(t),p=this.bufferSync(r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((h-m)/i)),v=Math.min(s.outHeight,(s.inHeight+h-m)/i),y=0;y<l;++y)for(var x=Math.max(0,Math.ceil((c-y)/o)),b=Math.min(s.outWidth,(s.inWidth+c-y)/o),_=0;_<s.outChannels;++_){for(var E=Math.trunc(_/d),I=_%d,C=0,S=0;S<s.batchSize;++S)for(var T=g;T<v;++T)for(var N=m+T*i-h,R=x;R<b;++R){var D=y+R*o-c;C+=f.get(S,N,D,E)*p.get(S,T,R,_)}u.set(C,m,y,E,I)}return u.toTensor()},e.prototype.tile=function(t,r){return ye(t,"tile"),zK(this.bufferSync(t),r)},e.prototype.pad=function(t,r,s){ye(t,"pad");var i=r.map(function(d,f){return d[0]+t.shape[f]+d[1]}),o=r.map(function(d){return d[0]}),a=this.bufferSync(t),l=ut(i,t.dtype);s!==0&&l.values.fill(s);for(var u=0;u<t.size;u++){var c=a.indexToLoc(u),h=c.map(function(d,f){return d+o[f]});l.set.apply(l,[a.get.apply(a,c)].concat(h))}return l.toTensor()},e.prototype.transpose=function(t,r){ye(t,"transpose");for(var s=new Array(t.rank),i=0;i<s.length;i++)s[i]=t.shape[r[i]];var o=this.readSync(t.dataId),a=ut(s,t.dtype),l=this.bufferSync(t);for(i=0;i<t.size;++i){for(var u=l.indexToLoc(i),c=new Array(u.length),h=0;h<c.length;h++)c[h]=u[r[h]];var d=a.locToIndex(c);a.values[d]=o[i]}return a.toTensor()},e.prototype.gather=function(t,r,s){ye([t,r],"gather");var i=t.shape.slice(),o=this.readSync(r.dataId);i[s]=o.length;for(var a=ut(i,t.dtype),l=this.bufferSync(t),u=0;u<a.size;++u){var c=a.indexToLoc(u),h=c.slice();h[s]=o[c[s]];var d=l.locToIndex(h);a.values[u]=l.values[d]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,s){ye([t],"batchToSpaceND");var i=r.reduce(function(h,d){return h*d}),o=n1(t.shape,r,i),a=r1(o.length,r.length),l=s1(t.shape,r,i),u=TK(s,r.length),c=NK(l,s,r.length);return t.reshape(o).transpose(a).reshape(l).slice(u,c)},e.prototype.spaceToBatchND=function(t,r,s){ye([t],"spaceToBatchND");var i=r.reduce(function(d,f){return d*f}),o=[[0,0]];o.push.apply(o,s);for(var a=1+r.length;a<t.shape.length;++a)o.push([0,0]);var l=t.pad(o),u=n1(l.shape,r,i,!1),c=r1(u.length,r.length,!1),h=s1(l.shape,r,i,!1);return l.reshape(u).transpose(c).reshape(h)},e.prototype.pool=function(t,r,s){ye(t,"pool");for(var i=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,f=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),m=ut(r.outShape,t.dtype),g=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],x=r.outShape[3],b=0;b<r.batchSize;++b)for(var _=b*v,E=b*t.strides[0],I=0;I<r.inChannels;++I)for(var C=0;C<r.outHeight;++C)for(var S=C*i-h,T=Math.max(0,S),N=Math.min(r.inHeight,u+S),R=_+C*y,D=0;D<r.outWidth;++D){for(var z=D*o-d,L=Math.max(0,z),O=Math.min(r.inWidth,c+z),F=f,P=0,U=0,W=T;W<N;W+=a){for(var X=E+W*t.strides[1],Z=L;Z<O;Z+=l){var ne=p[X+Z*t.strides[2]+I];s==="max"&&ne>F?F=ne:s==="avg"&&(P+=ne,U++)}if(isNaN(F))break}g[R+D*x+I]=s==="avg"?P/U:F}return m.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var s=ut(r.outShape,"int32"),i=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,f=this.bufferSync(t),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var g=0;g<r.outHeight;++g){for(var v=g*i-h,y=v;y<0;)y+=a;for(var x=Math.min(r.inHeight,u+v),b=0;b<r.outWidth;++b){for(var _=b*o-d,E=_;E<0;)E+=l;for(var I=Math.min(r.inWidth,c+_),C=Number.NEGATIVE_INFINITY,S=-1,T=y;T<x;T+=a)for(var N=T-v,R=E;R<I;R+=l){var D=R-_,z=f.get(p,T,R,m);z>C&&(C=z,S=N*c+D)}s.set(S,p,g,b,m)}}return s.toTensor()},e.prototype.maxPoolBackprop=function(t,r,s,i){ye([r,s],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,i),a=i.strideHeight,l=i.strideWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=d-1-i.padInfo.left,p=h-1-i.padInfo.top,m=ut(r.shape,"float32"),g=this.bufferSync(o),v=this.bufferSync(t),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var b=0;b<i.inHeight;++b)for(var _=0;_<i.inWidth;++_){for(var E=b-p,I=_-f,C=0,S=0;S<h;S+=u){var T=(E+S)/a;if(!(T<0||T>=i.outHeight||Math.floor(T)!==T))for(var N=0;N<d;N+=c){var R=(I+N)/l;if(!(R<0||R>=i.outWidth||Math.floor(R)!==R)){var D=h*d-1-g.get(y,T,R,x)===S*d+N?1:0;D!==0&&(C+=v.get(y,T,R,x)*D)}}}m.set(C,y,b,_,x)}return m.toTensor()},e.prototype.avgPoolBackprop=function(t,r,s){ye([t,r],"avgPoolBackprop");for(var i=s.strideHeight,o=s.strideWidth,a=s.filterHeight,l=s.filterWidth,u=s.dilationHeight,c=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=d-1-s.padInfo.left,p=h-1-s.padInfo.top,m=ut(r.shape,"float32"),g=1/(a*l),v=this.bufferSync(t),y=0;y<s.batchSize;++y)for(var x=0;x<s.inChannels;++x)for(var b=0;b<s.inHeight;++b)for(var _=0;_<s.inWidth;++_){for(var E=b-p,I=_-f,C=0,S=0;S<h;S+=u){var T=(E+S)/i;if(!(T<0||T>=s.outHeight||Math.floor(T)!==T))for(var N=0;N<d;N+=c){var R=(I+N)/o;R<0||R>=s.outWidth||Math.floor(R)!==R||(C+=v.get(y,T,R,x))}}m.set(C*g,y,b,_,x)}return m.toTensor()},e.prototype.pool3d=function(t,r,s){ye(t,"pool3d");for(var i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(t.dataId),x=ut(r.outShape,t.dtype),b=x.values,_=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[3]*r.outShape[4],C=r.outShape[4],S=0;S<r.batchSize;++S)for(var T=S*_,N=S*t.strides[0],R=0;R<r.inChannels;++R)for(var D=0;D<r.outDepth;++D){for(var z=D*i-p,L=z;L<0;)L+=l;for(var O=Math.min(r.inDepth,h+z),F=T+D*E,P=0;P<r.outHeight;++P){for(var U=P*o-m,W=U;W<0;)W+=u;for(var X=Math.min(r.inHeight,d+U),Z=F+P*I,ne=0;ne<r.outWidth;++ne){for(var he=ne*a-g,le=he;le<0;)le+=c;for(var pe=Math.min(r.inWidth,f+he),be=Z+ne*C,Ce=v,ke=0,$e=0,Se=L;Se<O;Se+=l){for(var Ue=N+Se*t.strides[1],je=W;je<X;je+=u){for(var tt=Ue+je*t.strides[2],Qe=le;Qe<pe;Qe+=c){var Xe=y[tt+Qe*t.strides[3]+R];if(s==="max"&&Xe>Ce?Ce=Xe:s==="avg"&&(ke+=Xe,$e++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}b[be+R]=s==="avg"?ke/$e:Ce}}}return x.toTensor()},e.prototype.avgPool3d=function(t,r){return ye(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,s){ye([t,r],"avgPool3dBackprop");for(var i=s.strideDepth,o=s.strideHeight,a=s.strideWidth,l=s.filterDepth,u=s.filterHeight,c=s.filterWidth,h=s.dilationDepth,d=s.dilationHeight,f=s.dilationWidth,p=s.effectiveFilterDepth,m=s.effectiveFilterHeight,g=s.effectiveFilterWidth,v=p-1-s.padInfo.front,y=g-1-s.padInfo.left,x=m-1-s.padInfo.top,b=ut(r.shape,"float32"),_=1/(l*u*c),E=this.bufferSync(t),I=0;I<s.batchSize;++I)for(var C=0;C<s.inChannels;++C)for(var S=0;S<s.inDepth;++S)for(var T=0;T<s.inHeight;++T)for(var N=0;N<s.inWidth;++N){for(var R=S-v,D=T-x,z=N-y,L=0,O=0;O<p;O+=h){var F=(R+O)/i;if(!(F<0||F>=s.outDepth||Math.floor(F)!==F))for(var P=0;P<m;P+=d){var U=(D+P)/o;if(!(U<0||U>=s.outHeight||Math.floor(U)!==U))for(var W=0;W<g;W+=f){var X=(z+W)/a;X<0||X>=s.outWidth||Math.floor(X)!==X||(L+=E.get(I,F,U,X,C))}}}b.set(L*_,I,S,T,N,C)}return b.toTensor()},e.prototype.maxPool3d=function(t,r){return ye(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var s=ut(r.outShape,"int32"),i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(t),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var b=0;b<r.outDepth;++b){for(var _=b*i-p,E=_;E<0;)E+=l;for(var I=Math.min(r.inDepth,h+_),C=0;C<r.outHeight;++C){for(var S=C*o-m,T=S;T<0;)T+=u;for(var N=Math.min(r.inHeight,d+S),R=0;R<r.outWidth;++R){for(var D=R*a-g,z=D;z<0;)z+=c;for(var L=Math.min(r.inWidth,f+D),O=Number.NEGATIVE_INFINITY,F=-1,P=E;P<I;P+=l)for(var U=P-_,W=T;W<N;W+=u)for(var X=W-S,Z=z;Z<L;Z+=c){var ne=Z-D,he=v.get(y,P,W,Z,x);he>=O&&(O=he,F=U*d*f+X*d+ne)}s.set(F,y,b,C,R,x)}}}return s.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,s,i){ye([r,s],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,i),a=i.strideDepth,l=i.strideHeight,u=i.strideWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,f=i.effectiveFilterDepth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,g=f-1-i.padInfo.front,v=m-1-i.padInfo.left,y=p-1-i.padInfo.top,x=ut(r.shape,"float32"),b=this.bufferSync(o),_=this.bufferSync(t),E=0;E<i.batchSize;++E)for(var I=0;I<i.inChannels;++I)for(var C=0;C<i.inDepth;++C)for(var S=0;S<i.inHeight;++S)for(var T=0;T<i.inWidth;++T){for(var N=C-g,R=S-y,D=T-v,z=0,L=0;L<f;L+=c){var O=(N+L)/a;if(!(O<0||O>=i.outDepth||Math.floor(O)!==O))for(var F=0;F<p;F+=h){var P=(R+F)/l;if(!(P<0||P>=i.outHeight||Math.floor(P)!==P))for(var U=0;U<m;U+=d){var W=(D+U)/u;if(!(W<0||W>=i.outWidth||Math.floor(W)!==W)){var X=f*p*m-1-b.get(E,O,P,W,I)===L*p*m+F*m+U?1:0;X!==0&&(z+=_.get(E,O,P,W,I)*X)}}}}x.set(z,E,C,S,T,I)}return x.toTensor()},e.prototype.cast=function(t,r){return MK(t,r,this)},e.prototype.reshape=function(t,r){return $E(t,r)},e.prototype.avgPool=function(t,r){return ye(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,s,i){ye(t,"resizeBilinear");for(var o=t.shape,a=o[0],l=o[1],u=o[2],c=o[3],h=this.readSync(t.dataId),d=new Float32Array(We([a,r,s,c])),f=[i&&r>1?l-1:l,i&&s>1?u-1:u],p=[i&&r>1?r-1:r,i&&s>1?s-1:s],m=0,g=f[0]/p[0],v=f[1]/p[1],y=0;y<a;y++)for(var x=0;x<r;x++)for(var b=g*x,_=Math.floor(b),E=b-_,I=Math.min(l-1,Math.ceil(b)),C=y*t.strides[0]+_*t.strides[1],S=y*t.strides[0]+I*t.strides[1],T=0;T<s;T++)for(var N=v*T,R=Math.floor(N),D=N-R,z=Math.min(u-1,Math.ceil(N)),L=C+R*t.strides[2],O=S+R*t.strides[2],F=C+z*t.strides[2],P=S+z*t.strides[2],U=0;U<c;U++){var W=h[L+U],X=h[O+U],Z=W+(h[F+U]-W)*D,ne=Z+(X+(h[P+U]-X)*D-Z)*E;d[m++]=ne}return Gr(d,[a,r,s,c])},e.prototype.resizeBilinearBackprop=function(t,r,s){ye([t,r],"resizeBilinearBackprop");for(var i=r.shape,o=i[0],a=i[1],l=i[2],u=i[3],c=t.shape,h=c[1],d=c[2],f=new Float32Array(o*a*l*u),p=[s&&h>1?a-1:a,s&&d>1?l-1:l],m=[s&&h>1?h-1:h,s&&d>1?d-1:d],g=p[0]/m[0],v=p[1]/m[1],y=this.readSync(t.dataId),x=0,b=0;b<o;b++)for(var _=b*r.strides[0],E=0;E<h;E++)for(var I=E*g,C=Math.floor(I),S=Math.min(Math.ceil(I),a-1),T=_+C*r.strides[1],N=_+S*r.strides[1],R=I-C,D=1-R,z=0;z<d;z++)for(var L=z*v,O=Math.floor(L),F=Math.min(Math.ceil(L),l-1),P=L-O,U=1-P,W=T+O*r.strides[2],X=T+F*r.strides[2],Z=N+O*r.strides[2],ne=N+F*r.strides[2],he=D*U,le=D*P,pe=R*U,be=R*P,Ce=0;Ce<u;Ce++){var ke=y[x++];f[W+Ce]+=ke*he,f[X+Ce]+=ke*le,f[Z+Ce]+=ke*pe,f[ne+Ce]+=ke*be}return Gs(f,[o,l,a,u],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,s,i){ye(t,"resizeNearestNeighbor");for(var o=t.shape,a=o[0],l=o[1],u=o[2],c=o[3],h=this.readSync(t.dataId),d=new Float32Array(a*r*s*c),f=[i&&r>1?l-1:l,i&&s>1?u-1:u],p=[i&&r>1?r-1:r,i&&s>1?s-1:s],m=f[0]/p[0],g=f[1]/p[1],v=0,y=0;y<a;y++)for(var x=y*t.strides[0],b=0;b<r;b++)for(var _=m*b,E=x+Math.min(l-1,i?Math.round(_):Math.floor(_))*t.strides[1],I=0;I<s;I++)for(var C=g*I,S=E+Math.min(u-1,i?Math.round(C):Math.floor(C))*t.strides[2],T=0;T<c;T++){var N=h[S+T];d[v++]=N}return Gr(d,[a,r,s,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){ye([t,r],"resizeNearestNeighborBackprop");for(var i=r.shape,o=i[0],a=i[1],l=i[2],u=i[3],c=t.shape,h=c[1],d=c[2],f=new Float32Array(o*a*l*u),p=this.readSync(t.dataId),m=[s&&h>1?a-1:a,s&&d>1?l-1:l],g=[s&&h>1?h-1:h,s&&d>1?d-1:d],v=m[0]/g[0],y=m[1]/g[1],x=1/v,b=1/y,_=2*Math.ceil(x)+2,E=2*Math.ceil(b)+2,I=0;I<o;I++)for(var C=I*r.strides[0],S=0;S<a;S++)for(var T=C+S*r.strides[1],N=Math.floor(S*x),R=Math.floor(N-_/2),D=0;D<l;D++)for(var z=T+D*r.strides[2],L=Math.floor(D*b),O=Math.floor(L-E/2),F=0;F<u;F++){for(var P=0,U=0;U<_;U++){var W=U+R;if(!(W<0||W>=h)){var X=C+W*t.strides[1],Z=W*v;if(S===Math.min(a-1,s?Math.round(Z):Math.floor(Z)))for(var ne=0;ne<E;ne++){var he=ne+O;if(!(he<0||he>=d)){var le=X+he*t.strides[2],pe=he*y;D===Math.min(l-1,s?Math.round(pe):Math.floor(pe))&&(P+=p[le+F])}}}}f[z+F]=P}return Gs(f,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,s,i,o,a){ye([t,r,s,o,a],"batchNorm");for(var l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=this.readSync(s.dataId),h=o?this.readSync(o.dataId):new Float32Array([1]),d=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(l.length),p=d.length,m=h.length,g=c.length,v=u.length,y=0,x=0,b=0,_=0,E=0;E<l.length;++E)f[E]=d[y++]+(l[E]-u[x++])*h[b++]/Math.sqrt(c[_++]+i),y>=p&&(y=0),x>=v&&(x=0),b>=m&&(b=0),_>=g&&(_=0);return Gs(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,s,i,o){ye(t,"localResponseNormalization4D");var a=t.shape[3],l=a-1,u=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function d(g){for(var v=g%a,y=g-v+Math.max(0,v-r),x=g-v+Math.min(v+r,l),b=0;y<=x;y++){var _=u[y];b+=_*_}return b}for(var f=0;f<c;f++){var p=d(f),m=u[f]*Math.pow(s+i*p,-o);h[f]=m}return Gs(h,t.shape)},e.prototype.LRNGrad=function(t,r,s,i,o,a,l){ye(t,"LRNGrad");for(var u=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=this.readSync(s.dataId),f=new Float32Array(t.size),p=t.size,m=0;m<p;m++){for(var g=m%u,v=m-g+Math.max(0,g-i),y=m-g+Math.min(u,g+i+1),x=0,b=v;b<y;b++)x+=Math.pow(h[b],2);for(x=a*x+o,b=v;b<y;b++){var _=-2*a*l*h[b]*d[m]/x;m===b&&(_+=Math.pow(x,-l)),_*=c[m],f[b]+=_}}return Gs(f,t.shape)},e.prototype.multinomial=function(t,r,s,i){ye(t,"multinomial");for(var o=r?t:zl(t),a=o.shape[0],l=o.shape[1],u=vn([a,s],"int32"),c=this.readSync(u.dataId),h=this.readSync(o.dataId),d=0;d<a;++d){var f=d*l,p=new Float32Array(l-1);p[0]=h[f];for(var m=1;m<p.length;++m)p[m]=p[m-1]+h[f+m];for(var g=Ok(i.toString()),v=d*s,y=0;y<s;++y){var x=g();c[v+y]=p.length;for(var b=0;b<p.length;b++)if(x<p[b]){c[v+y]=b;break}}}return u},e.prototype.oneHot=function(t,r,s,i){ye(t,"oneHot");var o=new Float32Array(t.size*r);o.fill(i);for(var a=this.readSync(t.dataId),l=0;l<t.size;++l)a[l]>=0&&a[l]<r&&(o[l*r+a[l]]=s);return Uu(o,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,s,i,o){return ye(t,"nonMaxSuppression"),m$(this.readSync(t.dataId),this.readSync(r.dataId),s,i,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var s=t.shape[0],i=t.shape[1],o=ut(t.shape,"float32"),a=ut(t.shape,"float32"),l=Gi(t).as2D(s,i),u=ua(t).as2D(s,i),c=0;c<s;c++)for(var h=l.slice([c,0],[1,i]),d=u.slice([c,0],[1,i]),f=jr(h,d),p=this.readSync(this.fftImpl(f,r).dataId),m=0;m<i;m++){var g=bB(p,m);o.values[c*i+m]=g.real,a.values[c*i+m]=g.imag}return jr(o.toTensor(),a.toTensor()).as2D(s,i)},e.prototype.fftImpl=function(t,r){var s=t.as1D(),i=s.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(s,i,r).as2D(t.shape[0],t.shape[1]);return r&&(o=jr(Gi(o).div(Ae(i)),ua(o).div(Ae(i)))),o}var a=this.readSync(t.dataId),l=function(u){for(var c=new Float32Array(u.length/2),h=new Float32Array(u.length/2),d=0;d<u.length;d+=2)c[d/2]=u[d],h[d/2]=u[d+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(a,i,r));return jr(l.real,l.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,s){if(r===1)return t;var i=this.readSync(t.dataId),o=r/2,a=function(v){for(var y=Math.ceil(v.length/4),x=new Float32Array(y),b=new Float32Array(y),_=0;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],b[Math.floor(_/4)]=v[_+1];return{real:x,imag:b}}(i),l=jr(a.real,a.imag).as1D(),u=function(v){for(var y=Math.floor(v.length/4),x=new Float32Array(y),b=new Float32Array(y),_=2;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],b[Math.floor(_/4)]=v[_+1];return{real:x,imag:b}}(i),c=jr(u.real,u.imag).as1D();l=this.fftRadix2(l,o,s),c=this.fftRadix2(c,o,s);var h=function(v,y){for(var x=new Float32Array(v/2),b=new Float32Array(v/2),_=0;_<Math.ceil(v/2);_++){var E=(y?2:-2)*Math.PI*(_/v);x[_]=Math.cos(E),b[_]=Math.sin(E)}return{real:x,imag:b}}(r,s),d=jr(h.real,h.imag).mul(c),f=l.add(d),p=l.sub(d),m=Gi(f).concat(Gi(p)),g=ua(f).concat(ua(p));return jr(m,g).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,s){for(var i=new Float32Array(2*r),o=0;o<r;o++){for(var a=0,l=0,u=0;u<r;u++){var c=l6e(o*u,r,s),h=bB(t,u);a+=h.real*c.real-h.imag*c.imag,l+=h.real*c.imag+h.imag*c.real}s&&(a/=r,l/=r),a6e(i,a,l,o)}return i},e.prototype.depthToSpace=function(t,r,s){j(s==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+s}),j(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=t.shape[0],o=t.shape[1],a=t.shape[2],l=t.shape[3],u=o*r,c=a*r,h=l/(r*r),d=this.readSync(t.dataId),f=new Float32Array(i*u*c*h),p=0,m=0;m<i;++m)for(var g=0;g<u;++g)for(var v=Math.floor(g/r),y=g%r,x=0;x<c;++x)for(var b=Math.floor(x/r),_=(y*r+x%r)*h,E=0;E<h;++E){var I=E+_+l*(b+a*(v+o*m));f[p++]=d[I]}return Gs(f,[i,u,c,h])},e.prototype.broadcastedBinaryOp=function(t,r,s,i){var o=It(t.shape,r.shape),a=ut(o,s),l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=bu(t.shape,o),h=bu(r.shape,o),d=a.values;if(c.length+h.length===0)for(var f=0;f<d.length;++f)d[f]=i(l[f%l.length],u[f%u.length]);else{var p=this.bufferSync(t),m=this.bufferSync(r),g=function(v){var y=a.indexToLoc(v),x=y.slice(-t.rank);c.forEach(function(I){return x[I]=0});var b=p.locToIndex(x),_=y.slice(-r.rank);h.forEach(function(I){return _[I]=0});var E=m.locToIndex(_);d[v]=i(l[b],u[E])};for(f=0;f<d.length;++f)g(f)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,s){var i=It(t.shape,r.shape),o=ut(i,"float32"),a=ut(i,"float32"),l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=bu(t.shape,i),h=bu(r.shape,i),d=o.values,f=a.values;if(c.length+h.length===0)for(var p=0;p<d.length;p++){var m=p%l.length,g=p%u.length,v=s(l[2*m],l[2*m+1],u[2*g],u[2*g+1]);d[p]=v.real,f[p]=v.imag}else{var y=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(_){var E=o.indexToLoc(_),I=E.slice(-t.rank);c.forEach(function(R){return I[R]=0});var C=y.locToIndex(I),S=E.slice(-r.rank);h.forEach(function(R){return S[R]=0});var T=x.locToIndex(S),N=s(l[2*C],l[2*C+1],u[2*T],u[2*T+1]);d[_]=N.real,f[_]=N.imag};for(p=0;p<d.length;p++)b(p)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(t,r,s){return VK(t,r,s)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,s,i,o,a){for(var l=t.shape,u=l[0],c=l[1],h=l[2],d=l[3],f=r.shape[0],p=i[0],m=i[1],g=ut([f,p,m,d],"float32"),v=this.readSync(r.dataId),y=this.readSync(s.dataId),x=this.readSync(t.dataId),b=t.strides,_=g.strides,E=0;E<f;E++){var I=4*E,C=v[I],S=v[I+1],T=v[I+2],N=v[I+3],R=y[E];if(!(R>=u))for(var D=p>1?(T-C)*(c-1)/(p-1):0,z=m>1?(N-S)*(h-1)/(m-1):0,L=0;L<p;L++){var O=p>1?C*(c-1)+L*D:.5*(C+T)*(c-1);if(O<0||O>c-1)for(var F=0;F<m;F++)for(var P=0;P<d;P++){var U=P+F*_[2]+L*_[1]+E*_[0];g.values[U]=a}else if(o==="bilinear"){var W=Math.floor(O),X=Math.ceil(O),Z=O-W;for(F=0;F<m;F++)if((Se=m>1?S*(h-1)+F*z:.5*(S+N)*(h-1))<0||Se>h-1)for(P=0;P<d;P++)U=P+F*_[2]+L*_[1]+E*_[0],g.values[U]=a;else{var ne=Math.floor(Se),he=Math.ceil(Se),le=Se-ne;for(P=0;P<d;P++){var pe=x[U=P+ne*b[2]+W*b[1]+R*b[0]],be=x[U=P+he*b[2]+W*b[1]+R*b[0]],Ce=x[U=P+ne*b[2]+X*b[1]+R*b[0]],ke=pe+(be-pe)*le,$e=Ce+(x[U=P+he*b[2]+X*b[1]+R*b[0]]-Ce)*le;U=P+F*_[2]+L*_[1]+E*_[0],g.values[U]=ke+($e-ke)*Z}}}else for(F=0;F<m;++F){var Se;if((Se=m>1?S*(h-1)+F*z:.5*(S+N)*(h-1))<0||Se>h-1)for(P=0;P<d;P++)U=P+F*_[2]+L*_[1]+E*_[0],g.values[U]=a;else{var Ue=Math.round(Se),je=Math.round(O);for(P=0;P<d;P++){var tt=P+Ue*b[2]+je*b[1]+R*b[0],Qe=P+F*_[2]+L*_[1]+E*_[0];g.values[Qe]=x[tt]}}}}}return g.toTensor()},e.prototype.sparseToDense=function(t,r,s,i){var o=i1(0,t,s),a=o.sliceRank,l=o.numUpdates,u=o.sliceSize,c=o.strides,h=o.outputSize;return this.scatter(t,r,s,h,u,l,a,c,i,!1)},e.prototype.gatherND=function(t,r){var s=r.shape,i=s[s.length-1],o=AK(t,r),a=o[0],l=o[1],u=o[2],c=o[3];if(l===0)return Gr([],a,t.dtype);for(var h=new uv([l,u],t.dtype),d=this.readSync(r.dataId),f=this.readSync(t.dataId),p=0;p<l;p++){for(var m=[],g=0,v=0;v<i;v++){var y=d[p*i+v];g+=y*c[v],m.push(y)}if(g<0||g>=t.size/u)throw new Error("Invalid indices: "+m+" does not index into "+t.shape);for(var x=0;x<u;x++)h.values[p*u+x]=f[g*u+x]}return h.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,s){var i=i1(0,t,s),o=i.sliceRank,a=i.numUpdates,l=i.sliceSize,u=i.strides,c=i.outputSize,h=Ae(0);return this.scatter(t,r,s,c,l,a,o,u,h,!0)},e.prototype.fill=function(t,r,s){var i=Xw(s=s||rx(r),We(t));return i.fill(r),Q.makeTensor(i,t,s,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=Xw(t.dtype,We(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,s){return LK(t,r,s)},e.prototype.scatter=function(t,r,s,i,o,a,l,u,c,h){var d=[i/o,o],f=this.readSync(t.dataId),p=this.readSync(r.dataId);if(i===0)return Gr([],s,r.dtype);var m=new uv(d,r.dtype);m.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<a;g++){for(var v=[],y=0,x=0;x<l;x++){var b=f[g*l+x];v.push(b),y+=b*u[x]}if(y<0||y>=i/o)throw new Error("Invalid indices: "+v+" does not index into "+s);for(var _=0;_<o;_++)h?m.values[y*o+_]+=p[g*o+_]:m.values[y*o+_]=r.rank===0?p[0]:p[g*o+_]}return m.toTensor().reshape(s)},e}(OK);Q.registerBackend("cpu",function(){return new Tqe},1);for(var q2=0,UB=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e,i=s.boxes,o=s.scores,a=r,l=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,d=t;ye(i,"NonMaxSuppressionWithScore");var f=g$(d.data.get(i.dataId).values,d.data.get(o.dataId).values,l,u,c,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t;ye(r,"square");for(var i=s.data.get(r.dataId).values,o=new Float32Array(i.length),a=0;a<i.length;++a){var l=i[a];o[a]=l*l}return{dataId:s.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:dv,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,i=r.b,o=t;ye([s,i],dv);var a=o.data.get(s.dataId).values,l=o.data.get(i.dataId).values,u=function(d,f,p,m,g,v){var y=It(d,f),x=y.length,b=Ia(y),_=lv(g,We(y)),E=d.length,I=f.length,C=Ia(d),S=Ia(f),T=bu(d,y),N=bu(f,y);if(T.length+N.length===0)for(var R=0;R<_.length;++R)_[R]=v(p[R%p.length],m[R%m.length]);else{var D=function(z){var L=Lje(z,x,b),O=L.slice(-E);T.forEach(function(W){return O[W]=0});var F=hB(O,E,C),P=L.slice(-I);N.forEach(function(W){return P[W]=0});var U=hB(P,I,S);_[z]=v(p[F],m[U])};for(R=0;R<_.length;++R)D(R)}return[_,y]}(s.shape,i.shape,a,l,s.dtype,function(d,f){var p=d-f;return p*p}),c=u[0],h=u[1];return{dataId:o.write(c,h,s.dtype),shape:h,dtype:s.dtype}}}];q2<UB.length;q2++)uK(UB[q2]);var Id,Nqe=function(n){this.variableNames=["A"];var e=xs(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},Aqe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=xs(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var K2=0,jB=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e.pixels,i=r.numChannels,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,l=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],u=l[0],c=l[1],h=[c,u],d=[c,u,i];(a||o)&&(Id==null&&(Id=document.createElement("canvas").getContext("2d")),Id.canvas.width=u,Id.canvas.height=c,Id.drawImage(s,0,0,u,c),s=Id.canvas);var f=t.makeTensorInfo(h,"int32");t.texData.get(f.dataId).usage=yi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),s);var p=me().getBool("WEBGL_PACK")?new Aqe(d):new Nqe(d),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;Zw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=e,i=s.boxes,o=s.scores,a=r,l=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,d=t,f=g$(d.readSync(i.dataId),d.readSync(o.dataId),l,u,c,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t,i=new pt(r.shape,"return x * x;");return s.runWebGLProgram(i,[r],r.dtype)}},{kernelName:dv,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,i=r.b,o=t,a=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ya("return (a - b) * (a - b);",s.shape,i.shape):new zn("return (a - b) * (a - b);",s.shape,i.shape);return o.compileAndRun(a,[s,i])}}];K2<jB.length;K2++)uK(jB[K2]);for(var X2=0,WB=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:dv,gradFunc:function(n,e){var t=e[0],r=e[1],s=Ae(2);return{a:function(){return _s(n,_s(s,Ir(t,r)))},b:function(){return _s(n,_s(s,Ir(r,t)))}}}}];X2<WB.length;X2++)Eje(WB[X2]);var Rqe=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();me().get("IS_BROWSER")&&me().setPlatform("browser",new Rqe);var Y2,Dqe=function(){return require("node-fetch")},$qe=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return me().global.fetch!=null?me().global.fetch(e,t):(Y2==null&&(Y2=Dqe()),Y2(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();me().get("IS_NODE")&&me().setPlatform("node",new $qe);var FE={float32:4,int32:4,uint16:2,uint8:1,bool:1},d1=4;function DX(n,e){for(var t={},r=0,s=function(a){var l=a.name,u=a.dtype,c=a.shape,h=We(c),d=void 0;if("quantization"in a){var f=a.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=FE[f.dtype],m=n.slice(r,r+h*p),g=f.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(u==="float32")d=Float32Array.from(g,function(E){return E*f.scale+f.min});else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+u);d=Int32Array.from(g,function(E){return Math.round(E*f.scale+f.min)})}r+=h*p}else if(u==="string"){var v=We(a.shape);d=[];for(var y=0;y<v;y++){var x=new Uint32Array(n.slice(r,r+d1))[0];r+=d1;var b=new Uint8Array(n.slice(r,r+x));d.push(b),r+=x}}else{var _=FE[u];if(m=n.slice(r,r+h*_),u==="float32")d=new Float32Array(m);else if(u==="int32")d=new Int32Array(m);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+u);d=new Uint8Array(m)}r+=h*_}t[l]=Gr(d,c,u)},i=0,o=e;i<o.length;i++)s(o[i]);return t}function Pqe(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(e),s=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}var ME=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function HB(n){return ME?Buffer.byteLength(n):new Blob([n]).size}function O$(n){var e=0;n.forEach(function(s){e+=s.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(s){t.set(new Uint8Array(s),r),r+=s.byteLength}),t.buffer}function GB(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function cx(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:HB(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:HB(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var xi=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var s=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(i){var o=i(e,r);o!==null&&s.push(o)}),s},n}(),wf="://",ju=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){j(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(wf)&&(e=e.slice(0,e.indexOf(wf))),j(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();j(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function xb(n){if(n.indexOf(wf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ju.getSchemes().join(","));return{scheme:n.split(wf)[0],path:n.split(wf)[1]}}function qB(n,e,t){return t===void 0&&(t=!1),Be(this,void 0,void 0,function(){var r,s,i,o,a,l,u,c,h;return Ve(this,function(d){switch(d.label){case 0:return j(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),j((r=xi.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),j(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),s=r[0],j((i=xi.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),j(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),o=i[0],a=xb(n).scheme,l=xb(n).path,u=a===xb(n).scheme,[4,s.load()];case 1:return c=d.sent(),t&&u?[4,ju.getManager(a).removeModel(l)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,o.save(c)];case 4:return h=d.sent(),!t||u?[3,6]:[4,ju.getManager(a).removeModel(l)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var sh="models_store",wu="model_info_store";function $X(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function LE(n){var e=n.result;e.createObjectStore(sh,{keyPath:"modelPath"}),e.createObjectStore(wu,{keyPath:"modelPath"})}var _f=function(){function n(e){if(this.indexedDB=$X(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Be(this,void 0,void 0,function(){return Ve(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(s,i){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return LE(o)},o.onsuccess=function(){var a=o.result;if(t==null){var l=a.transaction(sh,"readonly"),u=l.objectStore(sh).get(r.modelPath);u.onsuccess=function(){if(u.result==null)return a.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));s(u.result.modelArtifacts)},u.onerror=function(m){return a.close(),i(u.error)},l.oncomplete=function(){return a.close()}}else{var c,h=cx(t),d=a.transaction(wu,"readwrite"),f=d.objectStore(wu),p=f.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var m=(c=a.transaction(sh,"readwrite")).objectStore(sh).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});m.onsuccess=function(){return s({modelArtifactsInfo:h})},m.onerror=function(g){var v=(f=d.objectStore(wu)).delete(r.modelPath);v.onsuccess=function(){return a.close(),i(m.error)},v.onerror=function(y){return a.close(),i(m.error)}}},p.onerror=function(m){return a.close(),i(p.error)},d.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},o.onerror=function(a){return i(o.error)}})},n.URL_SCHEME="indexeddb://",n}(),KB=function(n){return me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(_f.URL_SCHEME)?(e=n.slice(_f.URL_SCHEME.length),new _f(e)):null;var e};xi.registerSaveRouter(KB),xi.registerLoadRouter(KB);var Oqe=function(){function n(){this.indexedDB=$X()}return n.prototype.listModels=function(){return Be(this,void 0,void 0,function(){var e=this;return Ve(this,function(t){return[2,new Promise(function(r,s){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return LE(i)},i.onsuccess=function(){var o=i.result,a=o.transaction(wu,"readonly"),l=a.objectStore(wu).getAll();l.onsuccess=function(){for(var u={},c=0,h=l.result;c<h.length;c++){var d=h[c];u[d.modelPath]=d.modelArtifactsInfo}r(u)},l.onerror=function(u){return o.close(),s(l.error)},a.oncomplete=function(){return o.close()}},i.onerror=function(o){return s(i.error)}})]})})},n.prototype.removeModel=function(e){return Be(this,void 0,void 0,function(){var t=this;return Ve(this,function(r){var s;return e=(s=e).startsWith(_f.URL_SCHEME)?s.slice(_f.URL_SCHEME.length):s,[2,new Promise(function(i,o){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return LE(a)},a.onsuccess=function(){var l,u=a.result,c=u.transaction(wu,"readwrite"),h=c.objectStore(wu),d=h.get(e);d.onsuccess=function(){if(d.result==null)return u.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=h.delete(e),p=function(){var m=(l=u.transaction(sh,"readwrite")).objectStore(sh).delete(e);m.onsuccess=function(){return i(d.result.modelArtifactsInfo)},m.onerror=function(g){return o(d.error)}};f.onsuccess=p,f.onerror=function(m){return p(),u.close(),o(d.error)}},d.onerror=function(f){return u.close(),o(d.error)},c.oncomplete=function(){l==null?u.close():l.oncomplete=function(){return u.close()}}},a.onerror=function(l){return o(a.error)}})]})})},n}();if(me().getBool("IS_BROWSER"))try{ju.registerManager(_f.URL_SCHEME,new Oqe)}catch{}var nl="/",Vd="tensorflowjs_models",PX="info",Fqe="model_topology",Mqe="weight_specs",Lqe="weight_data",Bqe="model_metadata";function OX(n){return{info:[Vd,n,PX].join(nl),topology:[Vd,n,Fqe].join(nl),weightSpecs:[Vd,n,Mqe].join(nl),weightData:[Vd,n,Lqe].join(nl),modelMetadata:[Vd,n,Bqe].join(nl)}}function Vqe(n){var e=n.split(nl);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(nl)}var kf=function(){function n(e){if(!me().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=OX(this.modelPath)}return n.prototype.save=function(e){return Be(this,void 0,void 0,function(){var t,r,s;return Ve(this,function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=cx(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(o){if(ME)return Buffer.from(o).toString("base64");for(var a=new Uint8Array(o),l="",u=0,c=a.length;u<c;u++)l+=String.fromCharCode(a[u]);return btoa(l)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:s}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+s.modelTopologyBytes+", weightSpecsBytes="+s.weightSpecsBytes+", weightDataBytes="+s.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Be(this,void 0,void 0,function(){var e,t,r,s,i,o,a;return Ve(this,function(l){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(s=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=s,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(u){if(ME){var c=Buffer.from(u,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(u),d=new Uint8Array(h.length),f=0;f<h.length;++f)d.set([h.charCodeAt(f)],f);return d.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),XB=function(n){return me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(kf.URL_SCHEME)?(e=n.slice(kf.URL_SCHEME.length),new kf(e)):null;var e};xi.registerSaveRouter(XB),xi.registerLoadRouter(XB);var zqe=function(){function n(){j(me().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),j(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Be(this,void 0,void 0,function(){var e,t,r,s,i,o;return Ve(this,function(a){for(e={},t=Vd+nl,r=nl+PX,s=0;s<this.LS.length;++s)(i=this.LS.key(s)).startsWith(t)&&i.endsWith(r)&&(o=Vqe(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return Be(this,void 0,void 0,function(){var t,r;return Ve(this,function(s){var i;if(e=(i=e).startsWith(kf.URL_SCHEME)?i.slice(kf.URL_SCHEME.length):i,t=OX(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(me().getBool("IS_BROWSER"))try{ju.registerManager(kf.URL_SCHEME,new zqe)}catch{}var Uqe="model",jqe=".json",Wqe=".weights.bin";function YB(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Q2=function(){function n(e){if(!me().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=Uqe),this.modelTopologyFileName=e+jqe,this.weightDataFileName=e+Wqe}return n.prototype.save=function(e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a;return Ve(this,function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,[4,YB(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return l.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,YB(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:cx(e)}]}})})},n.URL_SCHEME="downloads://",n}(),Hqe=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Be(this,void 0,void 0,function(){var e,t,r=this;return Ve(this,function(s){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(i,o){var a=new FileReader;a.onload=function(l){var u=JSON.parse(l.target.result),c=u.modelTopology;if(c!=null){t.length===0&&i({modelTopology:c});var h=u.weightsManifest;if(h!=null){var d;try{d=r.checkManifestAndWeightFiles(h,t)}catch(g){return void o(g)}var f=[],p=[],m=[];h.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),f.push.apply(f,g.weights)}),h.forEach(function(g){g.paths.forEach(function(v){var y=new FileReader;y.onload=function(x){var b=x.target.result,_=p.indexOf(v);m[_]=b,m.indexOf(null)===-1&&i({modelTopology:c,weightSpecs:f,weightData:O$(m),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},y.onerror=function(x){return o("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(d[v])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(l){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],s=t.map(function(l){return GB(l.name)}),i={},o=0,a=e;o<a.length;o++)a[o].paths.forEach(function(l){var u=GB(l);if(r.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(r.push(u),s.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");i[l]=t[s.indexOf(u)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},n}();function QB(n,e,t,r){(function(i){j(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(n),function(i,o){j(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),j(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),j(o>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+o})}(t=t??0,r=r??1);var s=0;return Promise.all(n.map(function(i){return i.then(function(o){var a=t+ ++s/n.length*(r-t);return e(a),o}),i}))}function FX(n,e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a,l,u,c;return Ve(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?me().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),s=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=h.sent(),[3,4];case 2:return[4,QB(r,e.onProgress,s,i)];case 3:o=h.sent(),h.label=4;case 4:return a=o.map(function(d){return d.arrayBuffer()}),l=.5,u=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=h.sent(),[3,8];case 6:return[4,QB(a,e.onProgress,l,u)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function JB(n){var e=this;return function(t,r,s){return r===void 0&&(r=""),Be(e,void 0,void 0,function(){var i,o,a,l,u,c,h,d,f,p;return Ve(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},a=s!=null?s.map(function(){return!1}):[],l=[],t.forEach(function(g,v){var y=0;g.weights.forEach(function(x){var b="quantization"in x?x.quantization.dtype:x.dtype,_=FE[b]*We(x.shape),E=function(){i[v]=!0,o[v]==null&&(o[v]=[]),o[v].push({manifestEntry:x,groupOffset:y,sizeBytes:_})};s!=null?s.forEach(function(I,C){I===x.name&&(E(),a[C]=!0)}):E(),l.push(x.name),y+=_})}),!a.every(function(g){return g}))throw u=s.filter(function(g,v){return!a[v]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return c=i.reduce(function(g,v,y){return v&&g.push(y),g},[]),h=[],c.forEach(function(g){t[g].paths.forEach(function(v){var y=r+(r.endsWith("/")?"":"/")+v;h.push(y)})}),[4,n(h)];case 1:return d=m.sent(),f={},p=0,c.forEach(function(g){for(var v=t[g].paths.length,y=0,x=0;x<v;x++)y+=d[p+x].byteLength;for(var b=new ArrayBuffer(y),_=new Uint8Array(b),E=0,I=0;I<v;I++){var C=new Uint8Array(d[p+I]);_.set(C,E),E+=C.byteLength}o[g].forEach(function(S){var T=DX(b.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var N in T)f[N]=T[N]}),p+=v}),[2,f]}})})}}xi.registerSaveRouter(function(n){return me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Q2.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new Q2(e)}(n.slice(Q2.URL_SCHEME.length)):null});var MX=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(j(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=me().platform.fetch,j(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&j(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Be(this,void 0,void 0,function(){var t,r,s,i;return Ve(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(s)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:cx(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},n.prototype.load=function(){return Be(this,void 0,void 0,function(){var e,t,r,s,i,o,a,l,u,c,h,d;return Ve(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(s=t.modelTopology,i=t.weightsManifest,o=t.generatedBy,a=t.convertedBy,l=t.format,u=t.userDefinedMetadata,s==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:d=f.sent(),c=d[0],h=d[1],f.label=7;case 7:return[2,{modelTopology:s,weightSpecs:c,weightData:h,userDefinedMetadata:u,generatedBy:o,convertedBy:a,format:l}]}})})},n.prototype.loadWeights=function(e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a,l,u,c,h,d;return Ve(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),v=p.substring(0,m),y=g>m?p.substring(g):"";return[v+"/",y]}(t),s=r[0],i=r[1],o=this.weightPathPrefix||s,a=[],l=0,u=e;l<u.length;l++)c=u[l],a.push.apply(a,c.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(m){h.push(o+m+i)})}),[4,FX(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[a,O$(d)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function BE(n){return n.match(MX.URL_SCHEME_REGEX)!=null}var ZB=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return BE(t)}):BE(n))?VE(n,{onProgress:e}):null};function VE(n,e){return new MX(n,e)}xi.registerSaveRouter(ZB),xi.registerLoadRouter(ZB);var J2=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(e){return[2,this.modelArtifacts]})})},n}(),Gqe=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Be(this,void 0,void 0,function(){return Ve(this,function(t){return[2,this.saveHandler(e)]})})},n}(),LX=Object.freeze({browserFiles:function(n){return new Hqe(n)},browserHTTPRequest:function(n,e){return VE(n,e)},concatenateArrayBuffers:O$,decodeWeights:DX,encodeWeights:function(n,e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a=this;return Ve(this,function(l){switch(l.label){case 0:for(t=[],r=[],s=Array.isArray(n)?n.map(function(u){return u.name}):Object.keys(n),i=function(u){var c=s[u],h=Array.isArray(n)?n[u].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var d={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var f=new Promise(function(p){return Be(a,void 0,void 0,function(){var m,g,v,y,x,b,_;return Ve(this,function(E){switch(E.label){case 0:return[4,h.bytes()];case 1:for(m=E.sent(),g=m.reduce(function(I,C){return I+C.length},0)+d1*m.length,v=new Uint8Array(g),y=0,x=0;x<m.length;x++)b=m[x],_=new Uint8Array(new Uint32Array([b.length]).buffer),v.set(_,y),y+=d1,v.set(b,y),y+=b.length;return p(v),[2]}})})});r.push(f)}else r.push(h.data());e!=null&&(d.group=e),t.push(d)},o=0;o<s.length;++o)i(o);return[4,Promise.all(r)];case 1:return[2,{data:Pqe(l.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new J2(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new J2({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new J2({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return xi.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:cx,getSaveHandlers:function(n){return xi.getSaveHandlers(n)},http:VE,isHTTPScheme:BE,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Be(this,void 0,void 0,function(){return Ve(this,function(s){return[2,JB(function(i){return FX(i,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return xi.registerLoadRouter(n)},registerSaveRouter:function(n){return xi.registerSaveRouter(n)},weightsLoaderFactory:JB,withSaveHandler:function(n){return new Gqe(n)},copyModel:function(n,e){return Be(this,void 0,void 0,function(){return Ve(this,function(t){return[2,qB(n,e,!1)]})})},listModels:function(){return Be(this,void 0,void 0,function(){var n,e,t,r,s,i,o;return Ve(this,function(a){switch(a.label){case 0:n=ju.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(s=r[t],[4,ju.getManager(s).listModels()]):[3,4];case 2:for(o in i=a.sent())e[s+wf+o]=i[o];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return Be(this,void 0,void 0,function(){return Ve(this,function(t){return[2,qB(n,e,!0)]})})},removeModel:function(n){return Be(this,void 0,void 0,function(){var e;return Ve(this,function(t){return e=xb(n),[2,ju.getManager(e.scheme).removeModel(e.path)]})})}}),Sd;G({confusionMatrix_:function(n,e,t){var r=V(n,"labels","confusionMatrix"),s=V(e,"predictions","confusionMatrix");j(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),j(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),j(s.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+s.rank}),j(r.shape[0]===s.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+s.shape[0]+". Labels and predictions should have the same number of elements."}),j(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var i=RE(r.asType("int32"),t),o=RE(s.asType("int32"),t);return i.transpose().matMul(o).asType("int32")}});var qqe=G({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,s=!1,i=!1,o=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);o=!0}if(s&&s&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(lK("FromPixels",Q.backendName)!=null)return Q.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,l,u=s?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=u[0],h=u[1];if(o?a=n.getContext("2d").getImageData(0,0,c,h).data:r||t?a=n.data:(i||s)&&(Sd==null&&(Sd=document.createElement("canvas").getContext("2d")),Sd.canvas.width=c,Sd.canvas.height=h,Sd.drawImage(n,0,0,c,h),a=Sd.getImageData(0,0,c,h).data),e===4)l=new Int32Array(a);else{var d=c*h;l=new Int32Array(d*e);for(var f=0;f<d;f++)for(var p=0;p<e;++p)l[f*e+p]=a[4*f+p]}return c$(l,[h,c,e],"int32")}}),F$=Object.freeze({toPixels:function(n,e){return Be(this,void 0,void 0,function(){var t,r,s,i,o,a,l,u,c,h,d,f,p,m,g,v,y,x,b,_,E,I,C;return Ve(this,function(S){switch(S.label){case 0:if(t=V(n,"img","toPixels"),n instanceof Rn||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),s=r[0],i=r[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return a=S.sent(),l=t.min(),u=t.max(),[4,Promise.all([l.data(),u.data()])];case 2:if(c=S.sent(),h=c[0],d=c[1],f=h[0],p=d[0],l.dispose(),u.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(i*s*4),v=0;v<s*i;++v)y=void 0,x=void 0,b=void 0,_=void 0,o===1?(y=a[v]*m,x=a[v]*m,b=a[v]*m,_=255):o===3?(y=a[3*v]*m,x=a[3*v+1]*m,b=a[3*v+2]*m,_=255):o===4&&(y=a[4*v]*m,x=a[4*v+1]*m,b=a[4*v+2]*m,_=a[4*v+3]*m),g[(E=4*v)+0]=Math.round(y),g[E+1]=Math.round(x),g[E+2]=Math.round(b),g[E+3]=Math.round(_);return e!=null&&(e.width=i,e.height=s,I=e.getContext("2d"),C=new ImageData(g,i,s),I.putImageData(C,0,0)),t!==n&&t.dispose(),[2,g]}})})},fromPixels:qqe}),Kqe=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),Xqe=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function fd(n){j(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),j(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),j(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Xqe.register(n)}var pd=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Wo(e,n),e.prototype.minimize=function(t,r,s){r===void 0&&(r=!1);var i=this.computeGradients(t,s),o=i.value,a=i.grads;if(s!=null){var l=s.map(function(u){return{name:u.name,tensor:a[u.name]}});this.applyGradients(l)}else this.applyGradients(a);return ni(a),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return i6e(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ni(this.iterations_)},e.prototype.saveIterations=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ae(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Be(this,void 0,void 0,function(){var r;return Ve(this,function(s){switch(s.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=s.sent()[0],[2,t.slice(1)]}})})},e}(Kqe);Object.defineProperty(pd,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var Yqe=function(n){function e(t,r,s){s===void 0&&(s=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=s,i.accumulatedGrads=[],i.accumulatedUpdates=[],s==null&&(i.epsilon=Q.backend.epsilon()),i}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,i){var o=Q.registeredVariables[s];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:s+"/accum_grad",variable:Oe(function(){return Pt(o).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:s+"/accum_var",variable:Oe(function(){return Pt(o).variable(!1)})});var a=Array.isArray(t)?t[i].tensor:t[s];if(a!=null){var l=r.accumulatedGrads[i].variable,u=r.accumulatedUpdates[i].variable;Oe(function(){var c=l.mul(r.rho).add(a.square().mul(1-r.rho)),h=u.add(r.epsilon).sqrt().div(l.add(r.epsilon).sqrt()).mul(a),d=u.mul(r.rho).add(h.square().mul(1-r.rho));l.assign(c),u.assign(d);var f=h.mul(-r.learningRate).add(o);o.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ni(this.accumulatedGrads.map(function(t){return t.variable})),ni(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var t;return Ve(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){var r;return Ve(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(pd);fd(Yqe);var Qqe=function(n){function e(t,r){r===void 0&&(r=.1);var s=n.call(this)||this;return s.learningRate=t,s.initialAccumulatorValue=r,s.accumulatedGrads=[],s}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,i){var o=Q.registeredVariables[s];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:s+"/accumulator",variable:Oe(function(){return Sa(o.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[i].tensor:t[s];if(a!=null){var l=r.accumulatedGrads[i].variable;Oe(function(){var u=l.add(a.square());l.assign(u);var c=a.div(u.add(Q.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ni(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(pd);fd(Qqe);var Jqe=function(n){function e(t,r,s,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=s,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Oe(function(){o.accBeta1=Ae(r).variable(),o.accBeta2=Ae(s).variable()}),i==null&&(o.epsilon=Q.backend.epsilon()),o}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Oe(function(){var i=Ir(1,r.accBeta1),o=Ir(1,r.accBeta2);s.forEach(function(a,l){var u=Q.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:Oe(function(){return Pt(u).variable(!1)})}),r.accumulatedSecondMoment[l]==null&&(r.accumulatedSecondMoment[l]={originalName:a+"/v",variable:Oe(function(){return Pt(u).variable(!1)})});var c=Array.isArray(t)?t[l].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[l].variable,d=r.accumulatedSecondMoment[l].variable,f=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2).add(c.square().mul(1-r.beta2)),m=f.div(i),g=p.div(o);h.assign(f),d.assign(p);var v=m.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(u);u.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ni(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ni(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var t;return Ve(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){var r,s=this;return Ve(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),Oe(function(){s.accBeta1.assign(c1(s.beta1,s.iterations_+1)),s.accBeta2.assign(c1(s.beta2,s.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(pd);fd(Jqe);var Zqe=function(n){function e(t,r,s,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=s,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Oe(function(){a.iteration=Ae(0).variable(),a.accBeta1=Ae(r).variable()}),i==null&&(a.epsilon=Q.backend.epsilon()),a}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Oe(function(){var i=Ir(1,r.accBeta1),o=Co(-r.learningRate,r.iteration.mul(r.decay).add(1));s.forEach(function(a,l){var u=Q.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:Pt(u).variable(!1)}),r.accumulatedWeightedInfNorm[l]==null&&(r.accumulatedWeightedInfNorm[l]={originalName:a+"/v",variable:Pt(u).variable(!1)});var c=Array.isArray(t)?t[l].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[l].variable,d=r.accumulatedWeightedInfNorm[l].variable,f=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2),m=c.abs(),g=p.maximum(m);h.assign(f),d.assign(g);var v=o.div(i).mul(f.div(g.add(r.epsilon))).add(u);u.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ni(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ni(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(pd);fd(Zqe);var BX=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,i){var o=Array.isArray(t)?t[i].tensor:t[s];if(o!=null){var a=Q.registeredVariables[s];Oe(function(){var l=r.c.mul(o).add(a);a.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=xWe(Ae(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(pd);fd(BX);var e8e=function(n){function e(t,r,s){s===void 0&&(s=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=s,i.accumulations=[],i.m=Ae(i.momentum),i}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,i){var o=Q.registeredVariables[s];r.accumulations[i]==null&&(r.accumulations[i]={originalName:s+"/momentum",variable:Oe(function(){return Pt(o).variable(!1)})});var a=r.accumulations[i].variable,l=Array.isArray(t)?t[i].tensor:t[s];l!=null&&Oe(function(){var u,c=r.m.mul(a).add(l);u=r.useNesterov?r.c.mul(l.add(c.mul(r.m))).add(o):r.c.mul(c).add(o),a.assign(c),o.assign(u)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ni(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){return Ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(BX);fd(e8e);var t8e=function(n){function e(t,r,s,i,o){r===void 0&&(r=.9),s===void 0&&(s=0),i===void 0&&(i=null),o===void 0&&(o=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=s,a.epsilon=i,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,i==null&&(a.epsilon=Q.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Wo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t)).forEach(function(s,i){var o=Q.registeredVariables[s];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:s+"/rms",variable:Oe(function(){return Pt(o).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:s+"/momentum",variable:Oe(function(){return Pt(o).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:s+"/mg",variable:Oe(function(){return Pt(o).variable(!1)})});var a=Array.isArray(t)?t[i].tensor:t[s];if(a!=null){var l=r.accumulatedMeanSquares[i].variable,u=r.accumulatedMoments[i].variable;Oe(function(){var c=l.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[i].variable,d=h.mul(r.decay).add(a.mul(1-r.decay)),f=u.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(d.square().add(r.epsilon)).sqrt()));l.assign(c),h.assign(d),u.assign(f);var p=o.sub(f);o.assign(p)}else{var m=l.mul(r.decay).add(a.square().mul(1-r.decay));f=u.mul(r.momentum).add(a.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),l.assign(m),u.assign(f),p=o.sub(f),o.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ni(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ni(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ni(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var t;return Ve(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(s){return{name:s.originalName,tensor:s.variable}}))]}})})},e.prototype.setWeights=function(t){return Be(this,void 0,void 0,function(){var r;return Ve(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(pd);fd(t8e);Rn.prototype.squaredDifference=function(n){return eX(this,n)},ue=Eqe;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var zE=function(n,e){return zE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])},zE(n,e)};function lt(n,e){zE(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vs=function(){return vs=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},vs.apply(this,arguments)};function Ge(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):s(c.value).then(a,l)}u((r=r.apply(n,[])).next())})}function qe(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function dg(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),s=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)r[s]=i[o];return r}var ph=function(){function n(e,t){if(!mh(e)||!mh(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function jk(n,e){return n instanceof Rn&&n.shape.length===e}function n8e(n){return jk(n,2)}function Wk(n){return jk(n,3)}function Wu(n){return jk(n,4)}function r8e(n){return n%1!==0}function eV(n){return n%2===0}function M$(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function tV(n){return n&&n.width&&n.height}function s8e(n,e){var t=n.width,r=n.height,s=e/Math.max(r,t);return new ph(Math.round(t*s),Math.round(r*s))}function L$(n){return n.reduce(function(e,t){return e.add(t)},new Bt(0,0)).div(new Bt(n.length,n.length))}function fv(n,e,t){return Array(n).fill(0).map(function(r,s){return e+s*t})}function mh(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function nV(n){return mh(n)&&0<=n&&n<=1}var Bt=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),Oa=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},s=[r.left,r.top,r.right,r.bottom].every(mh),i=[r.x,r.y,r.width,r.height].every(mh);if(!i&&!s)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=o[0],l=o[1],u=o[2],c=o[3];n.assertIsValidBox({x:a,y:l,width:u,height:c},"Box.constructor",t),this._x=a,this._y=l,this._width=u,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(mh)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Bt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Bt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Bt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Bt(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),t=e[0],r=e[1],s=e[2],i=e[3];return new n({x:t,y:r,width:s,height:i})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),t=e[0],r=e[1],s=e[2],i=e[3];return new n({x:t,y:r,width:s,height:i})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,s=e.width,i=e.height,o=Math.abs(s-i);return s<i&&(t-=o/2,s+=o),i<s&&(r-=o/2,i+=o),new n({x:t,y:r,width:s,height:i})},n.prototype.rescale=function(e){var t=tV(e)?e.width:e,r=tV(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],s=r[0],i=r[1],o=r[2],a=r[3];return new n({x:s,y:i,width:o,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,s=r.x,i=r.y,o=r.right,a=r.bottom,l=Math.max(s,0),u=Math.max(i,0),c=o-l,h=a-u,d=Math.min(c,e-l),f=Math.min(h,t-u);return new n({x:l,y:u,width:d,height:f}).floor()},n.prototype.shift=function(e,t){var r=this,s=r.width,i=r.height,o=this.x+e,a=this.y+t;return new n({x:o,y:a,width:s,height:i})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,s=this.height+1,i=1,o=1,a=r,l=s,u=this.left,c=this.top,h=this.right,d=this.bottom;return h>t&&(a=-h+t+r,h=t),d>e&&(l=-d+e+s,d=e),u<1&&(l=2-u,u=1),c<1&&(l=2-c,c=1),{dy:o,edy:l,dx:i,edx:a,y:c,ey:d,x:u,ex:h,w:r,h:s}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),Hk=function(n){lt(e,n);function e(t,r,s,i,o){return o===void 0&&(o=!1),n.call(this,{left:t,top:r,right:s,bottom:i},o)||this}return e}(Oa),VX=function(){function n(e,t,r,s,i){this._imageDims=new ph(i.width,i.height),this._score=e,this._classScore=t,this._className=r,this._box=new Oa(s).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Oa(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),Ti=function(n){lt(e,n);function e(t,r,s){return n.call(this,t,t,"",r,s)||this}return e.prototype.forSize=function(t,r){var s=n.prototype.forSize.call(this,t,r),i=s.score,o=s.relativeBox,a=s.imageDims;return new e(i,o,a)},e}(VX);function i8e(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),s=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),i=r*s;return t?i/(n.area+e.area-i):i/Math.min(n.area,e.area)}function o8e(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,l){return l<a?l:a},1/0),s=t.reduce(function(a,l){return l<a?l:a},1/0),i=e.reduce(function(a,l){return a<l?l:a},0),o=t.reduce(function(a,l){return a<l?l:a},0);return new Hk(r,s,i,o)}function pv(n,e,t,r){r===void 0&&(r=!0);for(var s=e.map(function(a,l){return{score:a,boxIndex:l}}).sort(function(a,l){return a.score-l.score}).map(function(a){return a.boxIndex}),i=[],o=function(){var a=s.pop();i.push(a);for(var l=s,u=[],c=0;c<l.length;c++){var h=l[c],d=n[a],f=n[h];u.push(i8e(d,f,r))}s=s.filter(function(p,m){return u[m]<=t})};s.length>0;)o();return i}function hx(n,e){return Oe(function(){var t=e[0],r=e[1],s=e[2],i=Sa(dg(n.shape.slice(0,3),[1]),t),o=Sa(dg(n.shape.slice(0,3),[1]),r),a=Sa(dg(n.shape.slice(0,3),[1]),s),l=_r([i,o,a],3);return Ir(n,l)})}function a8e(n,e){return e===void 0&&(e=!1),Oe(function(){var t=n.shape.slice(1),r=t[0],s=t[1];if(r===s)return n;var i=Math.abs(r-s),o=Math.round(i*(e?.5:1)),a=r>s?2:1,l=function(f){var p=n.shape.slice();return p[a]=f,Sa(p,0)},u=l(o),c=i-u.shape[a],h=e&&c?l(c):null,d=[h,n,u].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return _r(d,a)})}function Z2(n){return 1/(1+Math.exp(-n))}var B$=function(n){lt(e,n);function e(t,r,s,i,o){return o===void 0&&(o=!1),n.call(this,{x:t,y:r,width:s,height:i},o)||this}return e}(Oa),l8e=.5,u8e=.43,c8e=.45,mv=function(){function n(e,t,r){r===void 0&&(r=new Bt(0,0));var s=t.width,i=t.height;this._imgDims=new ph(s,i),this._shift=r,this._positions=e.map(function(o){return o.mul(new Bt(s,i)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Bt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Bt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Bt(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof Ti?e.box.floor():new Oa(e);return this.shiftBy(r.x,r.y).align(null,t)}var s=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=s.useDlibAlignment,o=s.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],s=e[2],i=function(h){return s.sub(h).magnitude()},o=(i(t)+i(r))/2,a=Math.floor(o/c8e),l=L$(e),u=Math.floor(Math.max(0,l.x-l8e*a)),c=Math.floor(Math.max(0,l.y-u8e*a));return new B$(u,c,Math.min(a,this.imageWidth+u),Math.min(a,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=o8e(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),h8e=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],L$([t[3],t[4]])]},e}(mv),d8e=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(L$)},e}(mv),rV=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+M$(this.distance)+")":"")},n}(),sV=function(n){lt(e,n);function e(t,r){var s=n.call(this,t)||this;return s._label=r,s}return e.assertIsValidLabeledBox=function(t,r){if(Oa.assertIsValidBox(t,r),!mh(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Oa),O0=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();(function(n){lt(e,n);function e(t,r,s,i){var o=n.call(this,t,r)||this;return o._score=s,o._classScore=i,o}return e.assertIsValidPredictedBox=function(t,r){if(sV.assertIsValidLabeledBox(t,r),!nV(t.score)||!nV(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(sV);function gv(n){return n.detection instanceof Ti}function vv(n,e){var t={detection:e};return Object.assign({},n,t)}function zX(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function UX(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(s,i){n.readFile(r,function(o,a){return o?i(o):s(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function jX(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=UX();return vs({Canvas:n||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:e||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:t,createImageElement:r,fetch:s},i)}function WX(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function HX(){return typeof global=="object"&&typeof require=="function"&&typeof NY<"u"&&typeof process<"u"&&!!process.version}var mr;function f8e(){if(!mr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return mr}function UE(n){mr=n}function V$(){WX()&&UE(zX()),HX()&&UE(jX())}function p8e(n){if(mr||V$(),!mr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?mr.Canvas:e,r=n.Image,s=r===void 0?mr.Image:r;mr.Canvas=t,mr.Image=s,mr.createCanvasElement=n.createCanvasElement||function(){return new t},mr.createImageElement=n.createImageElement||function(){return new s},mr.ImageData=n.ImageData||mr.ImageData,mr.Video=n.Video||mr.Video,mr.fetch=n.fetch||mr.fetch,mr.readFile=n.readFile||mr.readFile}var Es={getEnv:f8e,setEnv:UE,initialize:V$,createBrowserEnv:zX,createFileSystem:UX,createNodejsEnv:jX,monkeyPatch:p8e,isBrowser:WX,isNodejs:HX};V$();function z$(n){return!Es.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Nl(n){var e=Es.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var s=z$(n);if(!(s instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=s.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var _u;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(_u||(_u={}));var GX=function(){function n(e){e===void 0&&(e={});var t=e.anchorPosition,r=e.backgroundColor,s=e.fontColor,i=e.fontSize,o=e.fontStyle,a=e.padding;this.anchorPosition=t||_u.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=s||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=a||4}return n}(),qX=function(){function n(e,t,r){r===void 0&&(r={}),this.text=typeof e=="string"?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new GX(r)}return n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,s){return r<s?s:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,r=e.padding;return this.text.length*t+2*r},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,s=r===_u.BOTTOM_RIGHT||r===_u.TOP_RIGHT,i=r===_u.BOTTOM_LEFT||r===_u.BOTTOM_RIGHT,o=this.measureWidth(e),a=this.measureHeight(),l=s?this.anchor.x-o:this.anchor.x,u=i?this.anchor.y-a:this.anchor.y;if(t){var c=t.width,h=t.height,d=Math.max(Math.min(l,c-o),0),f=Math.max(Math.min(u,h-a),0);return{x:d,y:f}}return{x:l,y:u}},n.prototype.draw=function(e){var t=z$(e),r=Nl(t),s=this.options,i=s.backgroundColor,o=s.fontColor,a=s.fontSize,l=s.fontStyle,u=s.padding;r.font=a+"px "+l;var c=this.measureWidth(r),h=this.measureHeight();r.fillStyle=i;var d=this.getUpperLeft(r,t);r.fillRect(d.x,d.y,c,h),r.fillStyle=o,this.text.forEach(function(f,p){var m=u+d.x,g=u+d.y+(p+1)*a;r.fillText(f,m,g)})},n}(),m8e=function(){function n(e){e===void 0&&(e={});var t=e.boxColor,r=e.lineWidth,s=e.label,i=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=s;var o={anchorPosition:_u.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new GX(Object.assign({},o,i))}return n}(),g8e=function(){function n(e,t){t===void 0&&(t={}),this.box=new Oa(e),this.options=new m8e(t)}return n.prototype.draw=function(e){var t=Nl(e),r=this.options,s=r.boxColor,i=r.lineWidth,o=this.box,a=o.x,l=o.y,u=o.width,c=o.height;t.strokeStyle=s,t.lineWidth=i,t.strokeRect(a,l,u,c);var h=this.options.label;h&&new qX([h],{x:a-i/2,y:l},this.options.drawLabelOptions).draw(e)},n}();function v8e(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var s=r instanceof Ti?r.score:gv(r)?r.detection.score:void 0,i=r instanceof Ti?r.box:gv(r)?r.detection.box:new Oa(r),o=s?""+M$(s):void 0;new g8e(i,{label:o}).draw(n)})}function KX(n){var e=Es.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function y8e(n){return new Promise(function(e,t){if(n instanceof Es.getEnv().Canvas||KX(n))return e();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",s),e(i))}function s(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",s),t(i))}n.addEventListener("load",r),n.addEventListener("error",s)})}function U$(n){var e=Es.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new ph(n.naturalWidth,n.naturalHeight):n instanceof r?new ph(n.videoWidth,n.videoHeight):new ph(n.width,n.height)}function Gk(n){var e=n.width,t=n.height,r=Es.getEnv().createCanvasElement,s=r();return s.width=e,s.height=t,s}function j$(n,e){var t=Es.getEnv().ImageData;if(!(n instanceof t)&&!KX(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=U$(n),s=r.width,i=r.height,o=Gk({width:s,height:i});return n instanceof t?Nl(o).putImageData(n,0,0):Nl(o).drawImage(n,0,0,s,i),o}function x8e(n,e){return Ge(this,void 0,void 0,function(){var t,r,s,i,o,a;return qe(this,function(l){switch(l.label){case 0:return t=Es.getEnv().createCanvasElement(),r=n.shape.slice(Wu(n)?1:0),s=r[0],i=r[1],o=r[2],a=Oe(function(){return n.as3D(s,i,o).toInt()}),[4,F$.toPixels(a,t)];case 1:return l.sent(),a.dispose(),[2,t]}})})}function iV(n){var e=Es.getEnv(),t=e.Image,r=e.Canvas,s=e.Video;return n instanceof t||n instanceof r||n instanceof s}function b8e(n,e,t){t===void 0&&(t=!1);var r=Es.getEnv(),s=r.Image,i=r.Canvas;if(!(n instanceof s||n instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=U$(n),a=e/Math.max(o.height,o.width),l=a*o.width,u=a*o.height,c=Gk({width:e,height:e}),h=n instanceof i?n:j$(n),d=Math.abs(l-u)/2,f=t&&l<u?d:0,p=t&&u<l?d:0;return Nl(c).drawImage(h,f,p,l,u),c}var f1=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(s,i){if(Wk(s)){r._imageTensors[i]=s,r._inputDimensions[i]=s.shape;return}if(Wu(s)){var o=s.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[i]=s,r._inputDimensions[i]=s.shape.slice(1);return}var a=s instanceof Es.getEnv().Canvas?s:j$(s);r._canvases[i]=a,r._inputDimensions[i]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return fv(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return s8e({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Oe(function(){var s=fv(r.batchSize,0,1).map(function(o){var a=r.getInput(o);if(a instanceof Rn){var l=Wu(a)?a:a.expandDims();return l=a8e(l,t),(l.shape[1]!==e||l.shape[2]!==e)&&(l=A$.resizeBilinear(l,[e,e])),l.as3D(e,e,3)}if(a instanceof Es.getEnv().Canvas)return F$.fromPixels(b8e(a,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),i=Ci(s.map(function(o){return o.toFloat()})).as4D(r.batchSize,e,e,3);return i})},n}();function Mr(n){return Ge(this,void 0,void 0,function(){var e,t,r;return qe(this,function(s){switch(s.label){case 0:if(n instanceof f1)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(i){return Array.isArray(n)?" at input index "+i+":":""},r=e.map(z$),r.forEach(function(i,o){if(!iV(i)&&!Wk(i)&&!Wu(i))throw typeof e[o]=="string"?new Error("toNetInput -"+t(o)+" string passed, but could not resolve HTMLElement for element id "+e[o]):new Error("toNetInput -"+t(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Wu(i)){var a=i.shape[0];if(a!==1)throw new Error("toNetInput -"+t(o)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return iV(i)&&y8e(i)}))];case 1:return s.sent(),[2,new f1(r,Array.isArray(n))]}})})}function W$(n,e){return Ge(this,void 0,void 0,function(){var t,r,s,i,o,a,l;return qe(this,function(u){switch(u.label){case 0:return t=Es.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Mr(n)];case 1:if(s=u.sent(),s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=s.getInput(0),i instanceof t?(o=i,[3,4]):[3,2];case 2:return[4,x8e(i)];case 3:o=u.sent(),u.label=4;case 4:r=o,u.label=5;case 5:return a=Nl(r),l=e.map(function(c){return c instanceof Ti?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,l.map(function(c){var h=c.x,d=c.y,f=c.width,p=c.height,m=Gk({width:f,height:p});return Nl(m).putImageData(a.getImageData(h,d,f,p),0,0),m})]}})})}function H$(n,e){return Ge(this,void 0,void 0,function(){return qe(this,function(t){if(!Wk(n)&&!Wu(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Wu(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Oe(function(){var r=n.shape.slice(Wu(n)?1:0),s=r[0],i=r[1],o=r[2],a=e.map(function(u){return u instanceof Ti?u.forSize(i,s).box:u}).map(function(u){return u.clipAtImageBorders(i,s)}),l=a.map(function(u){var c=u.x,h=u.y,d=u.width,f=u.height;return wX(n.as3D(s,i,o),[h,c,0],[f,d,o])});return l})]})})}function w8e(n,e){return Ge(this,void 0,void 0,function(){var t,r;return qe(this,function(s){switch(s.label){case 0:return t=Es.getEnv().fetch,[4,t(n,e)];case 1:if(r=s.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function _8e(n){return Ge(this,void 0,void 0,function(){return qe(this,function(e){switch(e.label){case 0:return[4,w8e(n)];case 1:return[2,e.sent().json()]}})})}function XX(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var s=n.split("/").filter(function(a){return a}),i=n.endsWith(".json")?s[s.length-1]:t,o=r+(n.endsWith(".json")?s.slice(0,s.length-1):s).join("/");return o=n.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+i:o+"/"+i}}function k8e(n,e){return Ge(this,void 0,void 0,function(){var t,r,s,i;return qe(this,function(o){switch(o.label){case 0:return t=XX(n,e),r=t.manifestUri,s=t.modelBaseUri,[4,_8e(r)];case 1:return i=o.sent(),[2,LX.loadWeights(i,s)]}})})}function C8e(n,e,t){t===void 0&&(t=!1);var r=t?U$(e):e,s=r.width,i=r.height;return n.width=s,n.height=i,{width:s,height:i}}var jl=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,s=t.objProp;return r[s]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),s=r.obj,i=r.objProp;s[i].dispose(),s[i]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof sp})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof sp)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,s=t.tensor;e.reassignParamFromPath(r,s.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,s=t.tensor,i=Gr(s.dataSync());s.dispose(),e.reassignParamFromPath(r,i)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return Ge(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return Ge(this,void 0,void 0,function(){var t;return qe(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,k8e(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return Ge(this,void 0,void 0,function(){var t,r,s,i,o,a,l,u,c,h;return qe(this,function(d){switch(d.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Es.getEnv().readFile,r=XX(e,this.getDefaultModelName()),s=r.manifestUri,i=r.modelBaseUri,o=function(f){return Promise.all(f.map(function(p){return t(p).then(function(m){return m.buffer})}))},a=LX.weightsLoaderFactory(o),c=(u=JSON).parse,[4,t(s)];case 1:return l=c.apply(u,[d.sent().toString()]),[4,a(l,i)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(i,o){if(!i.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+e);return{obj:i.nextObj,objProp:o,nextObj:i.nextObj[o]}},{nextObj:this.params}),r=t.obj,s=t.objProp;if(!r||!s||!(r[s]instanceof Rn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:s}},n}();function bi(n,e,t){return Oe(function(){var r=I$(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=kt(r,e.bias),r})}function eI(n,e,t){return t===void 0&&(t=!1),Oe(function(){var r=Dn(t?kt(fo(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):bi(n,e.conv0,[2,2])),s=bi(r,e.conv1,[1,1]),i=Dn(kt(r,s)),o=bi(i,e.conv2,[1,1]);return Dn(kt(r,kt(s,o)))})}function F0(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Oe(function(){var s=Dn(t?kt(fo(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):bi(n,e.conv0,r?[2,2]:[1,1])),i=bi(s,e.conv1,[1,1]),o=Dn(kt(s,i)),a=bi(o,e.conv2,[1,1]),l=Dn(kt(s,kt(i,a))),u=bi(l,e.conv3,[1,1]);return Dn(kt(s,kt(i,kt(a,u))))})}function Po(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Oe(function(){var s=kt(fo(n,e.filters,[1,1],t),e.bias);return r?Dn(s):s})}function Wl(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function qk(n,e){return function(t,r,s,i){var o=Gs(n(t*r*s*s),[s,s,t,r]),a=lr(n(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:a}}}function G$(n,e){return function(t,r,s){var i=Uu(n(t*r),[t,r]),o=lr(n(r));return e.push({paramPath:s+"/weights"},{paramPath:s+"/bias"}),{weights:i,bias:o}}}var YX=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function q$(n,e){return function(t,r,s){var i=Gs(n(9*t),[3,3,t,1]),o=Gs(n(t*r),[1,1,t,r]),a=lr(n(r));return e.push({paramPath:s+"/depthwise_filter"},{paramPath:s+"/pointwise_filter"},{paramPath:s+"/bias"}),new YX(i,o,a)}}function K$(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),s=n(e+"/bias",1);return new YX(t,r,s)}}function _c(n,e){return function(t,r,s){var i=n[t];if(!jk(i,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:t,paramPath:s||t}),i}}function Hl(n){var e=n;function t(s){var i=e.slice(0,s);return e=e.slice(s),i}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function QX(n,e){var t=qk(n,e),r=q$(n,e);function s(o,a,l,u){u===void 0&&(u=!1);var c=u?t(o,a,3,l+"/conv0"):r(o,a,l+"/conv0"),h=r(a,a,l+"/conv1"),d=r(a,a,l+"/conv2");return{conv0:c,conv1:h,conv2:d}}function i(o,a,l,u){u===void 0&&(u=!1);var c=s(o,a,l,u),h=c.conv0,d=c.conv1,f=c.conv2,p=r(a,a,l+"/conv3");return{conv0:h,conv1:d,conv2:f,conv3:p}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:i}}function I8e(n){var e=[],t=Hl(n),r=t.extractWeights,s=t.getRemainingWeights,i=QX(r,e).extractDenseBlock4Params,o=i(3,32,"dense0",!0),a=i(32,64,"dense1"),l=i(64,128,"dense2"),u=i(128,256,"dense3");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:o,dense1:a,dense2:l,dense3:u}}}function JX(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function ZX(n,e){var t=_c(n,e),r=JX(t),s=K$(t);function i(a,l){l===void 0&&(l=!1);var u=l?r(a+"/conv0"):s(a+"/conv0"),c=s(a+"/conv1"),h=s(a+"/conv2");return{conv0:u,conv1:c,conv2:h}}function o(a,l){l===void 0&&(l=!1);var u=l?r(a+"/conv0"):s(a+"/conv0"),c=s(a+"/conv1"),h=s(a+"/conv2"),d=s(a+"/conv3");return{conv0:u,conv1:c,conv2:h,conv3:d}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function S8e(n){var e=[],t=ZX(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Wl(n,e),{params:r,paramMappings:e}}var eY=function(n){lt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Oe(function(){var s=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=hx(s,i).div(Ae(255)),a=F0(o,r.dense0,!0);return a=F0(a,r.dense1),a=F0(a,r.dense2),a=F0(a,r.dense3),a=ux(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return S8e(t)},e.prototype.extractParams=function(t){return I8e(t)},e}(jl);function ha(n,e){return Oe(function(){return kt(Vk(n,e.weights),e.bias)})}function E8e(n,e,t){var r=[],s=Hl(n),i=s.extractWeights,o=s.getRemainingWeights,a=G$(i,r),l=a(e,t,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:l}}}function T8e(n){var e=[],t=_c(n,e);function r(i){var o=t(i+"/weights",2),a=t(i+"/bias",1);return{weights:o,bias:a}}var s={fc:r("fc")};return Wl(n,e),{params:s,paramMappings:e}}function tY(n){var e={},t={};return Object.keys(n).forEach(function(r){var s=r.startsWith("fc")?t:e;s[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var nY=function(n){lt(e,n);function e(t,r){var s=n.call(this,t)||this;return s._faceFeatureExtractor=r,s}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return Oe(function(){var i=t instanceof f1?r.faceFeatureExtractor.forwardInput(t):t;return ha(i.as2D(i.shape[0],-1),s.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,i=r.paramMappings;this._params=s,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return E8e(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=tY(t),s=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),T8e(i)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),s=this.getClassifierChannelsOut(),i=s*r+s,o=t.slice(0,t.length-i),a=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},e}(jl),oV=["neutral","happy","sad","angry","fearful","disgusted","surprised"],X$=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);oV.forEach(function(r,s){t[r]=e[s]})}return n.prototype.asSortedArray=function(){var e=this;return oV.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),N8e=function(n){lt(e,n);function e(t){return t===void 0&&(t=new eY),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Oe(function(){return zl(r.runNet(t))})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictExpressions=function(t){return Ge(this,void 0,void 0,function(){var r,s,i,o,a=this;return qe(this,function(l){switch(l.label){case 0:return[4,Mr(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return s=l.sent(),[4,Promise.all(kr(s).map(function(u){return Ge(a,void 0,void 0,function(){var c;return qe(this,function(h){switch(h.label){case 0:return[4,u.data()];case 1:return c=h.sent(),u.dispose(),[2,c]}})})}))];case 3:return i=l.sent(),s.dispose(),o=i.map(function(u){return new X$(u)}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(nY);function A8e(n){return n.expressions instanceof X$}function rY(n,e){var t={expressions:e};return Object.assign({},n,t)}function R8e(n,e,t,r){var s=Array.isArray(e)?e:[e];s.forEach(function(i){var o=i instanceof X$?i:A8e(i)?i.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=o.asSortedArray(),l=a.filter(function(h){return h.probability>t}),u=gv(i)?i.detection.box.bottomLeft:new Bt(0,0),c=new qX(l.map(function(h){return h.expression+" ("+M$(h.probability)+")"}),u);c.draw(n)})}function sY(n){return gv(n)&&n.landmarks instanceof mv&&n.unshiftedLandmarks instanceof mv&&n.alignedRect instanceof Ti}function Kk(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),s=r.align(),i=n.detection.imageDims,o=new Ti(n.detection.score,s.rescale(i.reverse()),i),a={landmarks:r,unshiftedLandmarks:e,alignedRect:o};return Object.assign({},n,a)}function D8e(n,e){var t=qk(n,e),r=q$(n,e);function s(o,a,l){var u=r(o,a,l+"/separable_conv0"),c=r(a,a,l+"/separable_conv1"),h=t(o,a,1,l+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:h}}function i(o,a){var l=r(o,o,a+"/separable_conv0"),u=r(o,o,a+"/separable_conv1"),c=r(o,o,a+"/separable_conv2");return{separable_conv0:l,separable_conv1:u,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:s,extractMainBlockParams:i}}function $8e(n,e){var t=[],r=Hl(n),s=r.extractWeights,i=r.getRemainingWeights,o=D8e(s,t),a=o.extractConvParams,l=o.extractSeparableConvParams,u=o.extractReductionBlockParams,c=o.extractMainBlockParams,h=a(3,32,3,"entry_flow/conv_in"),d=u(32,64,"entry_flow/reduction_block_0"),f=u(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:d,reduction_block_1:f},m={};fv(e,0,1).forEach(function(x){m["main_block_"+x]=c(128,"middle_flow/main_block_"+x)});var g=u(128,256,"exit_flow/reduction_block"),v=l(256,512,"exit_flow/separable_conv"),y={reduction_block:g,separable_conv:v};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:m,exit_flow:y}}}function P8e(n,e){var t=_c(n,e),r=JX(t),s=K$(t);function i(a){var l=s(a+"/separable_conv0"),u=s(a+"/separable_conv1"),c=r(a+"/expansion_conv");return{separable_conv0:l,separable_conv1:u,expansion_conv:c}}function o(a){var l=s(a+"/separable_conv0"),u=s(a+"/separable_conv1"),c=s(a+"/separable_conv2");return{separable_conv0:l,separable_conv1:u,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:s,extractReductionBlockParams:i,extractMainBlockParams:o}}function O8e(n,e){var t=[],r=P8e(n,t),s=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,a=r.extractMainBlockParams,l=s("entry_flow/conv_in"),u=o("entry_flow/reduction_block_0"),c=o("entry_flow/reduction_block_1"),h={conv_in:l,reduction_block_0:u,reduction_block_1:c},d={};fv(e,0,1).forEach(function(g){d["main_block_"+g]=a("middle_flow/main_block_"+g)});var f=o("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),m={reduction_block:f,separable_conv:p};return Wl(n,t),{params:{entry_flow:h,middle_flow:d,exit_flow:m},paramMappings:t}}function iY(n,e,t){return kt(fo(n,e.filters,t,"same"),e.bias)}function tI(n,e,t){t===void 0&&(t=!0);var r=t?Dn(n):n;return r=bi(r,e.separable_conv0,[1,1]),r=bi(Dn(r),e.separable_conv1,[1,1]),r=Tr(r,[3,3],[2,2],"same"),r=kt(r,iY(n,e.expansion_conv,[2,2])),r}function F8e(n,e){var t=bi(Dn(n),e.separable_conv0,[1,1]);return t=bi(Dn(t),e.separable_conv1,[1,1]),t=bi(Dn(t),e.separable_conv2,[1,1]),t=kt(t,n),t}var M8e=function(n){lt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,s=this.params;if(!s)throw new Error("TinyXception - load model before inference");return Oe(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=hx(i,o).div(Ae(256)),l=Dn(iY(a,s.entry_flow.conv_in,[2,2]));return l=tI(l,s.entry_flow.reduction_block_0,!1),l=tI(l,s.entry_flow.reduction_block_1),fv(r._numMainBlocks,0,1).forEach(function(u){l=F8e(l,s.middle_flow["main_block_"+u])}),l=tI(l,s.exit_flow.reduction_block),l=Dn(bi(l,s.exit_flow.separable_conv,[1,1])),l})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return O8e(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return $8e(t,this._numMainBlocks)},e}(jl);function L8e(n){var e=[],t=Hl(n),r=t.extractWeights,s=t.getRemainingWeights,i=G$(r,e),o=i(512,1,"fc/age"),a=i(512,2,"fc/gender");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{fc:{age:o,gender:a}}}}function B8e(n){var e=[],t=_c(n,e);function r(i){var o=t(i+"/weights",2),a=t(i+"/bias",1);return{weights:o,bias:a}}var s={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Wl(n,e),{params:s,paramMappings:e}}var p1;(function(n){n.FEMALE="female",n.MALE="male"})(p1||(p1={}));var V8e=function(n){lt(e,n);function e(t){t===void 0&&(t=new M8e(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return Oe(function(){var i=t instanceof f1?r.faceFeatureExtractor.forwardInput(t):t,o=ux(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),a=ha(o,s.fc.age).as1D(),l=ha(o,s.fc.gender);return{age:a,gender:l}})},e.prototype.forwardInput=function(t){var r=this;return Oe(function(){var s=r.runNet(t),i=s.age,o=s.gender;return{age:i,gender:zl(o)}})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Ge(this,void 0,void 0,function(){var r,s,i,o,a,l,u=this;return qe(this,function(c){switch(c.label){case 0:return[4,Mr(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return s=c.sent(),i=kr(s.age),o=kr(s.gender),a=i.map(function(h,d){return{ageTensor:h,genderTensor:o[d]}}),[4,Promise.all(a.map(function(h){var d=h.ageTensor,f=h.genderTensor;return Ge(u,void 0,void 0,function(){var p,m,g,v,y;return qe(this,function(x){switch(x.label){case 0:return[4,d.data()];case 1:return p=x.sent()[0],[4,f.data()];case 2:return m=x.sent()[0],g=m>.5,v=g?p1.MALE:p1.FEMALE,y=g?m:1-m,d.dispose(),f.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return l=c.sent(),s.age.dispose(),s.gender.dispose(),[2,r.isBatchInput?l:l[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,i=r.paramMappings;this._params=s,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return L8e(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=tY(t),s=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),B8e(i)},e.prototype.extractParams=function(t){var r=1539,s=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(i)},e}(jl),oY=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,s){var i=s.map(function(a){var l=a.width,u=a.height,c=r/Math.max(u,l);return{width:l*c,height:u*c}}),o=i.length;return Oe(function(){var a=function(d,f){return Ci([Sa([68],d),Sa([68],f)],1).as2D(1,136).as1D()},l=function(d,f){var p=i[d],m=p.width,g=p.height;return f(m,g)?Math.abs(m-g)/2:0},u=function(d){return l(d,function(f,p){return f<p})},c=function(d){return l(d,function(f,p){return p<f})},h=t.mul(Sa([o,136],r)).sub(Ci(Array.from(Array(o),function(d,f){return a(u(f),c(f))}))).div(Ci(Array.from(Array(o),function(d,f){return a(i[f].width,i[f].height)})));return h})},e.prototype.forwardInput=function(t){var r=this;return Oe(function(){var s=r.runNet(t);return r.postProcess(s,t.inputSize,t.inputDimensions.map(function(i){var o=i[0],a=i[1];return{height:o,width:a}}))})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Ge(this,void 0,void 0,function(){var r,s,i,o=this;return qe(this,function(a){switch(a.label){case 0:return[4,Mr(t)];case 1:return r=a.sent(),s=Oe(function(){return kr(o.forwardInput(r))}),[4,Promise.all(s.map(function(l,u){return Ge(o,void 0,void 0,function(){var c,h,d,f,p;return qe(this,function(m){switch(m.label){case 0:return d=(h=Array).from,[4,l.data()];case 1:return c=d.apply(h,[m.sent()]),f=c.filter(function(g,v){return eV(v)}),p=c.filter(function(g,v){return!eV(v)}),[2,new d8e(Array(68).fill(0).map(function(g,v){return new Bt(f[v],p[v])}),{height:r.getInputHeight(u),width:r.getInputWidth(u)})]}})})}))];case 2:return i=a.sent(),s.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(nY),aY=function(n){lt(e,n);function e(t){return t===void 0&&(t=new eY),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(oY);function z8e(n){var e=[],t=ZX(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Wl(n,e),{params:r,paramMappings:e}}function U8e(n){var e=[],t=Hl(n),r=t.extractWeights,s=t.getRemainingWeights,i=QX(r,e).extractDenseBlock3Params,o=i(3,32,"dense0",!0),a=i(32,64,"dense1"),l=i(64,128,"dense2");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:o,dense1:a,dense2:l}}}var j8e=function(n){lt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Oe(function(){var s=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=hx(s,i).div(Ae(255)),a=eI(o,r.dense0,!0);return a=eI(a,r.dense1),a=eI(a,r.dense2),a=ux(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return z8e(t)},e.prototype.extractParams=function(t){return U8e(t)},e}(jl),W8e=function(n){lt(e,n);function e(t){return t===void 0&&(t=new j8e),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(oY);(function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(aY);function H8e(n,e){return kt(_s(n,e.weights),e.biases)}function Y$(n,e,t,r,s){s===void 0&&(s="same");var i=e.conv,o=i.filters,a=i.bias,l=fo(n,o,t,s);return l=kt(l,a),l=H8e(l,e.scale),r?Dn(l):l}function G8e(n,e){return Y$(n,e,[1,1],!0)}function lY(n,e){return Y$(n,e,[1,1],!1)}function uY(n,e){return Y$(n,e,[2,2],!0,"valid")}function q8e(n,e){function t(a,l,u){var c=n(a),h=c.length/(l*u*u);if(r8e(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+l+", filterSize: "+u);return Oe(function(){return oc(Gs(c,[l,h,u,u]),[2,3,1,0])})}function r(a,l,u,c){var h=t(a,l,u),d=lr(n(l));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:d}}function s(a,l){var u=lr(n(a)),c=lr(n(a));return e.push({paramPath:l+"/weights"},{paramPath:l+"/biases"}),{weights:u,biases:c}}function i(a,l,u,c){var h=r(a,l,u,c+"/conv"),d=s(l,c+"/scale");return{conv:h,scale:d}}function o(a,l,u,c,h){h===void 0&&(h=!1);var d=i((h?.5:1)*a,l,u,c+"/conv1"),f=i(a,l,u,c+"/conv2");return{conv1:d,conv2:f}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function K8e(n){var e=Hl(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],i=q8e(t,s),o=i.extractConvLayerParams,a=i.extractResidualLayerParams,l=o(4704,32,7,"conv32_down"),u=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),h=a(9216,32,3,"conv32_3"),d=a(36864,64,3,"conv64_down",!0),f=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),m=a(36864,64,3,"conv64_3"),g=a(147456,128,3,"conv128_down",!0),v=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),x=a(589824,256,3,"conv256_down",!0),b=a(589824,256,3,"conv256_1"),_=a(589824,256,3,"conv256_2"),E=a(589824,256,3,"conv256_down_out"),I=Oe(function(){return oc(Uu(t(256*128),[128,256]),[1,0])});if(s.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var C={conv32_down:l,conv32_1:u,conv32_2:c,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:x,conv256_1:b,conv256_2:_,conv256_down_out:E,fc:I};return{params:C,paramMappings:s}}function X8e(n,e){var t=_c(n,e);function r(o){var a=t(o+"/scale/weights",1),l=t(o+"/scale/biases",1);return{weights:a,biases:l}}function s(o){var a=t(o+"/conv/filters",4),l=t(o+"/conv/bias",1),u=r(o);return{conv:{filters:a,bias:l},scale:u}}function i(o){return{conv1:s(o+"/conv1"),conv2:s(o+"/conv2")}}return{extractConvLayerParams:s,extractResidualLayerParams:i}}function Y8e(n){var e=[],t=X8e(n,e),r=t.extractConvLayerParams,s=t.extractResidualLayerParams,i=r("conv32_down"),o=s("conv32_1"),a=s("conv32_2"),l=s("conv32_3"),u=s("conv64_down"),c=s("conv64_1"),h=s("conv64_2"),d=s("conv64_3"),f=s("conv128_down"),p=s("conv128_1"),m=s("conv128_2"),g=s("conv256_down"),v=s("conv256_1"),y=s("conv256_2"),x=s("conv256_down_out"),b=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!n8e(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var _={conv32_down:i,conv32_1:o,conv32_2:a,conv32_3:l,conv64_down:u,conv64_1:c,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:x,fc:b};return Wl(n,e),{params:_,paramMappings:e}}function Ko(n,e){var t=G8e(n,e.conv1);return t=lY(t,e.conv2),t=kt(t,n),t=Dn(t),t}function M0(n,e){var t=uY(n,e.conv1);t=lY(t,e.conv2);var r=ux(n,2,2,"valid"),s=vn(r.shape),i=r.shape[3]!==t.shape[3],o=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(o){var a=dg(t.shape);a[1]=1;var l=vn(a);t=_r([t,l],1);var u=dg(t.shape);u[2]=1;var c=vn(u);t=_r([t,c],2)}return r=i?_r([r,s],3):r,t=kt(r,t),t=Dn(t),t}var Q8e=function(n){lt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Oe(function(){var s=t.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],o=hx(s,i).div(Ae(256)),a=uY(o,r.conv32_down);a=Tr(a,3,2,"valid"),a=Ko(a,r.conv32_1),a=Ko(a,r.conv32_2),a=Ko(a,r.conv32_3),a=M0(a,r.conv64_down),a=Ko(a,r.conv64_1),a=Ko(a,r.conv64_2),a=Ko(a,r.conv64_3),a=M0(a,r.conv128_down),a=Ko(a,r.conv128_1),a=Ko(a,r.conv128_2),a=M0(a,r.conv256_down),a=Ko(a,r.conv256_1),a=Ko(a,r.conv256_2),a=M0(a,r.conv256_down_out);var l=a.mean([1,2]),u=Vk(l,r.fc);return u})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Ge(this,void 0,void 0,function(){var r,s,i,o=this;return qe(this,function(a){switch(a.label){case 0:return[4,Mr(t)];case 1:return r=a.sent(),s=Oe(function(){return kr(o.forwardInput(r))}),[4,Promise.all(s.map(function(l){return l.data()}))];case 2:return i=a.sent(),s.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Y8e(t)},e.prototype.extractParams=function(t){return K8e(t)},e}(jl);function cY(n,e){var t={descriptor:e};return Object.assign({},n,t)}function hY(n,e){var t={age:e};return Object.assign({},n,t)}function dY(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var fY=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,s=t.scaleFactor,i=t.maxNumScales,o=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=s||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(l){return typeof l!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(l){return typeof l!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function J8e(n,e){function t(l,u){var c=Gs(n(9*l),[3,3,l,1]),h=lr(n(l)),d=lr(n(l)),f=lr(n(l)),p=lr(n(l));return e.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:f,batch_norm_variance:p}}function r(l,u,c,h,d){var f=Gs(n(l*u*c*c),[c,c,l,u]),p=lr(n(u));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function s(l,u,c,h){var d=r(l,u,c,h,!0),f=d.filters,p=d.bias;return{filters:f,batch_norm_offset:p}}function i(l,u,c){var h=t(l,c+"/depthwise_conv"),d=s(l,u,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function o(){var l=s(3,32,3,"mobilenetv1/conv_0"),u=i(32,64,"mobilenetv1/conv_1"),c=i(64,128,"mobilenetv1/conv_2"),h=i(128,128,"mobilenetv1/conv_3"),d=i(128,256,"mobilenetv1/conv_4"),f=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),m=i(512,512,"mobilenetv1/conv_7"),g=i(512,512,"mobilenetv1/conv_8"),v=i(512,512,"mobilenetv1/conv_9"),y=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),b=i(512,1024,"mobilenetv1/conv_12"),_=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:u,conv_2:c,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,conv_8:g,conv_9:v,conv_10:y,conv_11:x,conv_12:b,conv_13:_}}function a(){var l=s(1024,256,1,"prediction_layer/conv_0"),u=s(256,512,3,"prediction_layer/conv_1"),c=s(512,128,1,"prediction_layer/conv_2"),h=s(128,256,3,"prediction_layer/conv_3"),d=s(256,128,1,"prediction_layer/conv_4"),f=s(128,256,3,"prediction_layer/conv_5"),p=s(256,64,1,"prediction_layer/conv_6"),m=s(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),_=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),T=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),R={box_encoding_predictor:g,class_predictor:v},D={box_encoding_predictor:y,class_predictor:x},z={box_encoding_predictor:b,class_predictor:_},L={box_encoding_predictor:E,class_predictor:I},O={box_encoding_predictor:C,class_predictor:S},F={box_encoding_predictor:T,class_predictor:N};return{conv_0:l,conv_1:u,conv_2:c,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,box_predictor_0:R,box_predictor_1:D,box_predictor_2:z,box_predictor_3:L,box_predictor_4:O,box_predictor_5:F}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:a}}function Z8e(n){var e=[],t=Hl(n),r=t.extractWeights,s=t.getRemainingWeights,i=J8e(r,e),o=i.extractMobilenetV1Params,a=i.extractPredictionLayerParams,l=o(),u=a(),c=c$(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:{mobilenetv1:l,prediction_layer:u,output_layer:h},paramMappings:e}}function e9e(n,e){var t=_c(n,e);function r(u,c,h){var d=t(u+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),f=t(u+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:f}}function s(u){var c="mobilenetv1/conv_"+u,h="MobilenetV1/Conv2d_"+u+"_depthwise",d=c+"/depthwise_conv",f=c+"/pointwise_conv",p=t(h+"/depthwise_weights",4,d+"/filters"),m=t(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),g=t(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),v=t(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),y=t(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",u,f)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:s(1),conv_2:s(2),conv_3:s(3),conv_4:s(4),conv_5:s(5),conv_6:s(6),conv_7:s(7),conv_8:s(8),conv_9:s(9),conv_10:s(10),conv_11:s(11),conv_12:s(12),conv_13:s(13)}}function o(u,c){var h=t(u+"/weights",4,c+"/filters"),d=t(u+"/biases",1,c+"/bias");return{filters:h,bias:d}}function a(u){var c=o("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),h=o("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:l}}function t9e(n){var e=[],t=e9e(n,e),r=t.extractMobilenetV1Params,s=t.extractPredictionLayerParams,i=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Wk(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:r(),prediction_layer:s(),output_layer:{extra_dim:i}};return Wl(n,e),{params:o,paramMappings:e}}function Zo(n,e,t){return Oe(function(){var r=fo(n,e.filters,t,"same");return r=kt(r,e.batch_norm_offset),w$(r,0,6)})}var n9e=.0010000000474974513;function r9e(n,e,t){return Oe(function(){var r=Bk(n,e.filters,t,"same");return r=oX(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,n9e),w$(r,0,6)})}function s9e(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function i9e(n,e){return Oe(function(){var t=null,r=Zo(n,e.conv_0,[2,2]),s=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(s.forEach(function(i,o){var a=o+1,l=s9e(a);r=r9e(r,i.depthwise_conv,l),r=Zo(r,i.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function o9e(n,e,t,r,s){var i=n.shape[0],o=Math.min(t,i),a=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>s}).sort(function(c,h){return h.score-c.score}),l=function(c){return c<=r?1:0},u=[];return a.forEach(function(c){if(!(u.length>=o)){for(var h=c.score,d=u.length-1;d>=0;--d){var f=a9e(n,c.boxIndex,u[d]);if(f!==0&&(c.score*=l(f),c.score<=s))break}h===c.score&&u.push(c.boxIndex)}}),u}function a9e(n,e,t){var r=n.arraySync(),s=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),o=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),l=Math.min(r[t][0],r[t][2]),u=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),h=Math.max(r[t][1],r[t][3]),d=(o-s)*(a-i),f=(c-l)*(h-u);if(d<=0||f<=0)return 0;var p=Math.max(s,l),m=Math.max(i,u),g=Math.min(o,c),v=Math.min(a,h),y=Math.max(g-p,0)*Math.max(v-m,0);return y/(d+f-y)}function l9e(n){var e=kr(oc(n,[1,0])),t=[Ir(e[2],e[0]),Ir(e[3],e[1])],r=[kt(e[0],Co(t[0],Ae(2))),kt(e[1],Co(t[1],Ae(2)))];return{sizes:t,centers:r}}function u9e(n,e){var t=l9e(n),r=t.sizes,s=t.centers,i=kr(oc(e,[1,0])),o=Co(_s(OE(Co(i[2],Ae(5))),r[0]),Ae(2)),a=kt(_s(Co(i[0],Ae(10)),r[0]),s[0]),l=Co(_s(OE(Co(i[3],Ae(5))),r[1]),Ae(2)),u=kt(_s(Co(i[1],Ae(10)),r[1]),s[1]);return oc(Ci([Ir(a,o),Ir(u,l),kt(a,o),kt(u,l)]),[1,0])}function c9e(n,e,t){return Oe(function(){var r=n.shape[0],s=u9e(To(xf(t.extra_dim,[r,1,1]),[-1,4]),To(n,[-1,4]));s=To(s,[r,s.shape[0]/r,4]);var i=nX(Pa(e,[0,0,1],[-1,-1,-1])),o=Pa(i,[0,0,0],[-1,-1,1]);o=To(o,[r,o.shape[1]]);var a=kr(s),l=kr(o);return{boxes:a,scores:l}})}function Ed(n,e){return Oe(function(){var t=n.shape[0],r=To(Po(n,e.box_encoding_predictor),[t,-1,1,4]),s=To(Po(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:s}})}function h9e(n,e,t){return Oe(function(){var r=Zo(n,t.conv_0,[1,1]),s=Zo(r,t.conv_1,[2,2]),i=Zo(s,t.conv_2,[1,1]),o=Zo(i,t.conv_3,[2,2]),a=Zo(o,t.conv_4,[1,1]),l=Zo(a,t.conv_5,[2,2]),u=Zo(l,t.conv_6,[1,1]),c=Zo(u,t.conv_7,[2,2]),h=Ed(e,t.box_predictor_0),d=Ed(n,t.box_predictor_1),f=Ed(s,t.box_predictor_2),p=Ed(o,t.box_predictor_3),m=Ed(l,t.box_predictor_4),g=Ed(c,t.box_predictor_5),v=_r([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),y=_r([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:v,classPredictions:y}})}var Xk=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,s=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=s||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),pY=function(n){lt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Oe(function(){var s=t.toBatchTensor(512,!1).toFloat(),i=Ir(_s(s,Ae(.007843137718737125)),Ae(1)),o=i9e(i,r.mobilenetv1),a=h9e(o.out,o.conv11,r.prediction_layer),l=a.boxPredictions,u=a.classPredictions;return c9e(l,u,r.output_layer)})},e.prototype.forward=function(t){return Ge(this,void 0,void 0,function(){var r;return qe(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,Mr(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),Ge(this,void 0,void 0,function(){var s,i,o,a,l,u,c,h,d,f,p,m,g,v,y,x,b,_,E,I,C;return qe(this,function(S){switch(S.label){case 0:return s=new Xk(r),i=s.maxResults,o=s.minConfidence,[4,Mr(t)];case 1:for(a=S.sent(),l=this.forwardInput(a),u=l.boxes,c=l.scores,h=u[0],d=c[0],f=1;f<u.length;f++)u[f].dispose(),c[f].dispose();return g=(m=Array).from,[4,d.data()];case 2:return p=g.apply(m,[S.sent()]),v=.5,y=o9e(h,p,i,v,o),x=a.getReshapedInputDimensions(0),b=a.inputSize,_=b/x.width,E=b/x.height,I=h.arraySync(),C=y.map(function(T){var N=[Math.max(0,I[T][0]),Math.min(1,I[T][2])].map(function(F){return F*E}),R=N[0],D=N[1],z=[Math.max(0,I[T][1]),Math.min(1,I[T][3])].map(function(F){return F*_}),L=z[0],O=z[1];return new Ti(p[T],new B$(L,R,O-L,D-R),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,C]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return t9e(t)},e.prototype.extractParams=function(t){return Z8e(t)},e}(jl);(function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(pY);var d9e=.4,f9e=[new Bt(.738768,.874946),new Bt(2.42204,2.65704),new Bt(4.30971,7.04493),new Bt(10.246,4.59428),new Bt(12.6868,11.8741)],p9e=[new Bt(1.603231,2.094468),new Bt(6.041143,7.080126),new Bt(2.882459,3.518061),new Bt(4.266906,5.178857),new Bt(9.041765,10.66308)],m9e=[117.001,114.697,97.404],g9e="tiny_yolov2_model",v9e="tiny_yolov2_separable_conv_model",L0=function(n){return typeof n=="number"};function y9e(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!L0(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return L0(e.x)&&L0(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(L0)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function Q$(n){return Oe(function(){var e=_s(n,Ae(.10000000149011612));return kt(Dn(Ir(n,e)),e)})}function Zl(n,e){return Oe(function(){var t=hd(n,[[0,0],[1,1],[1,1],[0,0]]);return t=fo(t,e.conv.filters,[1,1],"valid"),t=Ir(t,e.bn.sub),t=_s(t,e.bn.truediv),t=kt(t,e.conv.bias),Q$(t)})}function eu(n,e){return Oe(function(){var t=hd(n,[[0,0],[1,1],[1,1],[0,0]]);return t=I$(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=kt(t,e.bias),Q$(t)})}function x9e(n,e){var t=qk(n,e);function r(o,a){var l=lr(n(o)),u=lr(n(o));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:l,truediv:u}}function s(o,a,l){var u=t(o,a,3,l+"/conv"),c=r(a,l+"/bn");return{conv:u,bn:c}}var i=q$(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:s,extractSeparableConvParams:i}}function b9e(n,e,t,r){var s=Hl(n),i=s.extractWeights,o=s.getRemainingWeights,a=[],l=x9e(i,a),u=l.extractConvParams,c=l.extractConvWithBatchNormParams,h=l.extractSeparableConvParams,d;if(e.withSeparableConvs){var f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],x=r[6],b=r[7],_=r[8],E=e.isFirstLayerConv2d?u(f,p,3,"conv0"):h(f,p,"conv0"),I=h(p,m,"conv1"),C=h(m,g,"conv2"),S=h(g,v,"conv3"),T=h(v,y,"conv4"),N=h(y,x,"conv5"),R=b?h(x,b,"conv6"):void 0,D=_?h(b,_,"conv7"):void 0,z=u(_||b||x,5*t,1,"conv8");d={conv0:E,conv1:I,conv2:C,conv3:S,conv4:T,conv5:N,conv6:R,conv7:D,conv8:z}}else{var f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],x=r[6],b=r[7],_=r[8],E=c(f,p,"conv0"),I=c(p,m,"conv1"),C=c(m,g,"conv2"),S=c(g,v,"conv3"),T=c(v,y,"conv4"),N=c(y,x,"conv5"),R=c(x,b,"conv6"),D=c(b,_,"conv7"),z=u(_,5*t,1,"conv8");d={conv0:E,conv1:I,conv2:C,conv3:S,conv4:T,conv5:N,conv6:R,conv7:D,conv8:z}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:d,paramMappings:a}}function w9e(n,e){var t=_c(n,e);function r(a){var l=t(a+"/sub",1),u=t(a+"/truediv",1);return{sub:l,truediv:u}}function s(a){var l=t(a+"/filters",4),u=t(a+"/bias",1);return{filters:l,bias:u}}function i(a){var l=s(a+"/conv"),u=r(a+"/bn");return{conv:l,bn:u}}var o=K$(t);return{extractConvParams:s,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function _9e(n,e){var t=[],r=w9e(n,t),s=r.extractConvParams,i=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var l=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?s("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:l>7?o("conv6"):void 0,conv7:l>8?o("conv7"):void 0,conv8:s("conv8")}}else a={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:s("conv8")};return Wl(n,t),{params:a,paramMappings:t}}var aV;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(aV||(aV={}));var J$=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,s=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=s||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),mY=function(n){lt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return y9e(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var s=Zl(t,r.conv0);return s=Tr(s,[2,2],[2,2],"same"),s=Zl(s,r.conv1),s=Tr(s,[2,2],[2,2],"same"),s=Zl(s,r.conv2),s=Tr(s,[2,2],[2,2],"same"),s=Zl(s,r.conv3),s=Tr(s,[2,2],[2,2],"same"),s=Zl(s,r.conv4),s=Tr(s,[2,2],[2,2],"same"),s=Zl(s,r.conv5),s=Tr(s,[2,2],[1,1],"same"),s=Zl(s,r.conv6),s=Zl(s,r.conv7),Po(s,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var s=this.config.isFirstLayerConv2d?Q$(Po(t,r.conv0,"valid",!1)):eu(t,r.conv0);return s=Tr(s,[2,2],[2,2],"same"),s=eu(s,r.conv1),s=Tr(s,[2,2],[2,2],"same"),s=eu(s,r.conv2),s=Tr(s,[2,2],[2,2],"same"),s=eu(s,r.conv3),s=Tr(s,[2,2],[2,2],"same"),s=eu(s,r.conv4),s=Tr(s,[2,2],[2,2],"same"),s=eu(s,r.conv5),s=Tr(s,[2,2],[1,1],"same"),s=r.conv6?eu(s,r.conv6):s,s=r.conv7?eu(s,r.conv7):s,Po(s,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var s=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Oe(function(){var o=t.toBatchTensor(r,!1).toFloat();return o=s.config.meanRgb?hx(o,s.config.meanRgb):o,o=o.div(Ae(256)),s.config.withSeparableConvs?s.runMobilenet(o,i):s.runTinyYolov2(o,i)})},e.prototype.forward=function(t,r){return Ge(this,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return s=this.forwardInput,[4,Mr(t)];case 1:return[4,s.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),Ge(this,void 0,void 0,function(){var s,i,o,a,l,u,c,h,d,f,p,m,g,v,y=this;return qe(this,function(x){switch(x.label){case 0:return s=new J$(r),i=s.inputSize,o=s.scoreThreshold,[4,Mr(t)];case 1:return a=x.sent(),[4,this.forwardInput(a,i)];case 2:return l=x.sent(),u=Oe(function(){return kr(l)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(u,a.getReshapedInputDimensions(0),o)];case 3:return h=x.sent(),l.dispose(),u.dispose(),d=h.map(function(b){return b.box}),f=h.map(function(b){return b.score}),p=h.map(function(b){return b.classScore}),m=h.map(function(b){return y.config.classes[b.label]}),g=pv(d.map(function(b){return b.rescale(i)}),f,this.config.iouThreshold,!0),v=g.map(function(b){return new VX(f[b],p[b],m[b],d[b],c)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return _9e(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,s=r?r.length:void 0;if(s!==7&&s!==8&&s!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+s+" filterSizes in config");return b9e(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,s){return Ge(this,void 0,void 0,function(){var i,o,a,l,u,c,h,d,f,p,m,g,v,y,x,b,_,E,I,C,S,T,N,R,D,z,L,O,F,P=this;return qe(this,function(U){switch(U.label){case 0:return i=r.width,o=r.height,a=Math.max(i,o),l=a/i,u=a/o,c=t.shape[1],h=this.config.anchors.length,d=Oe(function(){var W=t.reshape([c,c,h,P.boxEncodingSize]),X=W.slice([0,0,0,0],[c,c,h,4]),Z=W.slice([0,0,0,4],[c,c,h,1]),ne=P.withClassScores?zl(W.slice([0,0,0,5],[c,c,h,P.config.classes.length]),3):Ae(0);return[X,Z,ne]}),f=d[0],p=d[1],m=d[2],g=[],[4,p.array()];case 1:return v=U.sent(),[4,f.array()];case 2:y=U.sent(),x=0,U.label=3;case 3:if(!(x<c))return[3,12];b=0,U.label=4;case 4:if(!(b<c))return[3,11];_=0,U.label=5;case 5:return _<h?(E=Z2(v[x][b][_][0]),!s||E>s?(I=(b+Z2(y[x][b][_][0]))/c*l,C=(x+Z2(y[x][b][_][1]))/c*u,S=Math.exp(y[x][b][_][2])*this.config.anchors[_].x/c*l,T=Math.exp(y[x][b][_][3])*this.config.anchors[_].y/c*u,N=I-S/2,R=C-T/2,D={row:x,col:b,anchor:_},this.withClassScores?[4,this.extractPredictedClass(m,D)]:[3,7]):[3,9]):[3,10];case 6:return F=U.sent(),[3,8];case 7:F={classScore:1,label:0},U.label=8;case 8:z=F,L=z.classScore,O=z.label,g.push(vs({box:new Hk(N,R,N+S,R+T),score:E,classScore:E*L,label:O},D)),U.label=9;case 9:return _++,[3,5];case 10:return b++,[3,4];case 11:return x++,[3,3];case 12:return f.dispose(),p.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,r){return Ge(this,void 0,void 0,function(){var s,i,o,a;return qe(this,function(l){switch(l.label){case 0:return s=r.row,i=r.col,o=r.anchor,[4,t.array()];case 1:return a=l.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,c){return a[s][i][o][c]}).map(function(u,c){return{classScore:u,label:c}}).reduce(function(u,c){return u.classScore>c.classScore?u:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(jl),k9e=function(n){lt(e,n);function e(t){t===void 0&&(t=!0);var r=this,s=Object.assign({},{withSeparableConvs:t,iouThreshold:d9e,classes:["face"]},t?{anchors:p9e,meanRgb:m9e}:{anchors:f9e,withClassScores:!0});return r=n.call(this,s)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ge(this,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return s=i.sent(),[2,s.map(function(o){return new Ti(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?v9e:g9e},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(mY),gY=function(n){lt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(J$),dx=function(){function n(){}return n.prototype.then=function(e){return Ge(this,void 0,void 0,function(){var t;return qe(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Ge(this,void 0,void 0,function(){return qe(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function Yk(n,e,t,r,s){return s===void 0&&(s=function(i){var o=i.alignedRect;return o}),Ge(this,void 0,void 0,function(){var i,o,a,l,u;return qe(this,function(c){switch(c.label){case 0:return i=n.map(function(h){return sY(h)?s(h):h.detection}),a=r,a?[3,5]:e instanceof Rn?[4,H$(e,i)]:[3,2];case 1:return l=c.sent(),[3,4];case 2:return[4,W$(e,i)];case 3:l=c.sent(),c.label=4;case 4:a=l,c.label=5;case 5:return o=a,[4,t(o)];case 6:return u=c.sent(),o.forEach(function(h){return h instanceof Rn&&h.dispose()}),[2,u]}})})}function Z$(n,e,t,r,s){return Ge(this,void 0,void 0,function(){var i=this;return qe(this,function(o){return[2,Yk([n],e,function(a){return Ge(i,void 0,void 0,function(){return qe(this,function(l){return[2,t(a[0])]})})},r,s)]})})}function C9e(n){return Oe(function(){return Ci(kr(n,3).reverse(),3)})}var B0=2,m1=12;function I9e(n,e){var t=qk(n,e),r=G$(n,e);function s(u,c){var h=lr(n(u));return e.push({paramPath:c}),h}function i(u,c,h){h===void 0&&(h=!1);var d=t(u[0],u[1],3,c+"/conv1"),f=s(u[1],c+"/prelu1_alpha"),p=t(u[1],u[2],3,c+"/conv2"),m=s(u[2],c+"/prelu2_alpha"),g=t(u[2],u[3],h?2:3,c+"/conv3"),v=s(u[3],c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function o(){var u=i([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return vs(vs({},u),{conv4_1:c,conv4_2:h})}function a(){var u=i([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=s(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return vs(vs({},u),{fc1:c,prelu4_alpha:h,fc2_1:d,fc2_2:f})}function l(){var u=i([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=s(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),f=s(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return vs(vs({},u),{conv4:c,prelu4_alpha:h,fc1:d,prelu5_alpha:f,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:o,extractRNetParams:a,extractONetParams:l}}function S9e(n){var e=Hl(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],i=I9e(t,s),o=i.extractPNetParams,a=i.extractRNetParams,l=i.extractONetParams,u=o(),c=a(),h=l();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:c,onet:h},paramMappings:s}}function E9e(n,e){var t=_c(n,e);function r(c){var h=t(c+"/weights",4,c+"/filters"),d=t(c+"/bias",1);return{filters:h,bias:d}}function s(c){var h=t(c+"/weights",2),d=t(c+"/bias",1);return{weights:h,bias:d}}function i(c){return t(c,1)}function o(c){var h=r(c+"/conv1"),d=i(c+"/prelu1_alpha"),f=r(c+"/conv2"),p=i(c+"/prelu2_alpha"),m=r(c+"/conv3"),g=i(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:f,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function a(){var c=o("pnet"),h=r("pnet/conv4_1"),d=r("pnet/conv4_2");return vs(vs({},c),{conv4_1:h,conv4_2:d})}function l(){var c=o("rnet"),h=s("rnet/fc1"),d=i("rnet/prelu4_alpha"),f=s("rnet/fc2_1"),p=s("rnet/fc2_2");return vs(vs({},c),{fc1:h,prelu4_alpha:d,fc2_1:f,fc2_2:p})}function u(){var c=o("onet"),h=r("onet/conv4"),d=i("onet/prelu4_alpha"),f=s("onet/fc1"),p=i("onet/prelu5_alpha"),m=s("onet/fc2_1"),g=s("onet/fc2_2"),v=s("onet/fc2_3");return vs(vs({},c),{conv4:h,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:l,extractONetParams:u}}function T9e(n){var e=[],t=E9e(n,e),r=t.extractPNetParams,s=t.extractRNetParams,i=t.extractONetParams,o=r(),a=s(),l=i();return Wl(n,e),{params:{pnet:o,rnet:a,onet:l},paramMappings:e}}function jE(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function N9e(n,e,t){for(var r=t[0],s=t[1],i=m1/n,o=[],a=Math.min(r,s)*i,l=0;a>=12;)o.push(i*Math.pow(e,l)),a=a*e,l+=1;return o}var eP=function(n){lt(e,n);function e(t,r,s,i){return n.call(this,{left:t,top:r,right:s,bottom:i},!0)||this}return e}(Oa);function vY(n){return Oe(function(){return _s(Ir(n,Ae(127.5)),Ae(.0078125))})}function Cf(n,e){return Oe(function(){return kt(Dn(n),_s(e,u1(Dn(u1(n)))))})}function tP(n,e,t){return t===void 0&&(t=!1),Oe(function(){var r=Po(n,e.conv1,"valid");return r=Cf(r,e.prelu1_alpha),r=Tr(r,t?[2,2]:[3,3],[2,2],"same"),r=Po(r,e.conv2,"valid"),r=Cf(r,e.prelu2_alpha),r=t?r:Tr(r,[3,3],[2,2],"valid"),r=Po(r,e.conv3,"valid"),r=Cf(r,e.prelu3_alpha),r})}function A9e(n,e){return Oe(function(){var t=tP(n,e,!0),r=Po(t,e.conv4_1,"valid"),s=ji(zk(r,3),3),i=zl(Ir(r,s),3),o=Po(t,e.conv4_2,"valid");return{prob:i,regions:o}})}function R9e(n,e){return Oe(function(){var t=jE(e,n.shape.slice(1)),r=t.height,s=t.width,i=A$.resizeBilinear(n,[r,s]),o=vY(i);return oc(o,[0,2,1,3])})}function D9e(n,e,t,r){for(var s=[],i=n.arraySync(),o=0;o<n.shape[0];o++)for(var a=0;a<n.shape[1];a++)i[o][a]>=r&&s.push(new Bt(a,o));var l=s.map(function(u){var c=new Hk(Math.round((u.y*B0+1)/t),Math.round((u.x*B0+1)/t),Math.round((u.y*B0+m1)/t),Math.round((u.x*B0+m1)/t)),h=i[u.y][u.x],d=e.arraySync(),f=new eP(d[u.y][u.x][0],d[u.y][u.x][1],d[u.y][u.x][2],d[u.y][u.x][3]);return{cell:c,score:h,region:f}});return l}function $9e(n,e,t,r,s){s.stage1=[];var i=e.map(function(d){return Oe(function(){var f={scale:d},p=R9e(n,d),m=Date.now(),g=A9e(p,r),v=g.prob,y=g.regions;f.pnet=Date.now()-m;var x=kr(kr(v,3)[1])[0],b=kr(y)[0];return{scoresTensor:x,regionsTensor:b,scale:d,statsForScale:f}})}),o=i.map(function(d){var f=d.scoresTensor,p=d.regionsTensor,m=d.scale,g=d.statsForScale,v=D9e(f,p,m,t);if(f.dispose(),p.dispose(),!v.length)return s.stage1.push(g),[];var y=Date.now(),x=pv(v.map(function(b){return b.cell}),v.map(function(b){return b.score}),.5);return g.nms=Date.now()-y,g.numBoxes=x.length,s.stage1.push(g),x.map(function(b){return v[b]})}),a=o.reduce(function(d,f){return d.concat(f)},[]),l=[],u=[];if(a.length>0){var c=Date.now(),h=pv(a.map(function(d){return d.cell}),a.map(function(d){return d.score}),.7);s.stage1_nms=Date.now()-c,u=h.map(function(d){return a[d].score}),l=h.map(function(d){return a[d]}).map(function(d){var f=d.cell,p=d.region;return new Hk(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:l,scores:u}}function yY(n,e,t){var r=t.width,s=t.height;return Ge(this,void 0,void 0,function(){var i,o,a,l=this;return qe(this,function(u){switch(u.label){case 0:return i=Nl(n),[4,Promise.all(e.map(function(c){return Ge(l,void 0,void 0,function(){var h,d,f,p,m,g,v,y;return qe(this,function(x){return h=c.padAtBorders(n.height,n.width),d=h.y,f=h.ey,p=h.x,m=h.ex,g=p-1,v=d-1,y=i.getImageData(g,v,m-g,f-v),[2,Es.isNodejs()?j$(y):createImageBitmap(y)]})})}))];case 1:return o=u.sent(),a=[],o.forEach(function(c){var h=Gk({width:r,height:s}),d=Nl(h);d.drawImage(c,0,0,r,s);for(var f=d.getImageData(0,0,r,s).data,p=[],m=0;m<f.length;m+=4)p.push(f[m+2]),p.push(f[m+1]),p.push(f[m]);a.push(p)}),[2,a.map(function(c){var h=Oe(function(){var d=oc(Gs(c,[1,r,s,3]),[0,2,1,3]).toFloat();return vY(d)});return h})]}})})}function P9e(n,e){return Oe(function(){var t=tP(n,e),r=To(t,[t.shape[0],e.fc1.weights.shape[0]]),s=ha(r,e.fc1),i=Cf(s,e.prelu4_alpha),o=ha(i,e.fc2_1),a=ji(zk(o,1),1),l=zl(Ir(o,a),1),u=ha(i,e.fc2_2),c=kr(l,1)[1];return{scores:c,regions:u}})}function O9e(n,e,t,r,s){return Ge(this,void 0,void 0,function(){var i,o,a,l,u,c,h,d,f,p,m,g,v,y;return qe(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,yY(n,e,{width:24,height:24})];case 1:return o=x.sent(),s.stage2_extractImagePatches=Date.now()-i,i=Date.now(),a=o.map(function(b){var _=P9e(b,r);return b.dispose(),_}),s.stage2_rnet=Date.now()-i,l=a.length>1?_r(a.map(function(b){return b.scores})):a[0].scores,h=(c=Array).from,[4,l.data()];case 2:return u=h.apply(c,[x.sent()]),l.dispose(),d=u.map(function(b,_){return{score:b,idx:_}}).filter(function(b){return b.score>t}).map(function(b){var _=b.idx;return _}),f=d.map(function(b){return e[b]}),p=d.map(function(b){return u[b]}),m=[],g=[],f.length>0&&(i=Date.now(),v=pv(f,p,.7),s.stage2_nms=Date.now()-i,y=v.map(function(b){var _=a[d[b]].regions.arraySync();return new eP(_[0][0],_[0][1],_[0][2],_[0][3])}),g=v.map(function(b){return p[b]}),m=v.map(function(b,_){return f[b].calibrate(y[_])})),a.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function F9e(n,e){return Oe(function(){var t=tP(n,e);t=Tr(t,[2,2],[2,2],"same"),t=Po(t,e.conv4,"valid"),t=Cf(t,e.prelu4_alpha);var r=To(t,[t.shape[0],e.fc1.weights.shape[0]]),s=ha(r,e.fc1),i=Cf(s,e.prelu5_alpha),o=ha(i,e.fc2_1),a=ji(zk(o,1),1),l=zl(Ir(o,a),1),u=ha(i,e.fc2_2),c=ha(i,e.fc2_3),h=kr(l,1)[1];return{scores:h,regions:u,points:c}})}function M9e(n,e,t,r,s){return Ge(this,void 0,void 0,function(){var i,o,a,l,u,c,h,d,f,p,m,g,v,y,x;return qe(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,yY(n,e,{width:48,height:48})];case 1:return o=b.sent(),s.stage3_extractImagePatches=Date.now()-i,i=Date.now(),a=o.map(function(_){var E=F9e(_,r);return _.dispose(),E}),s.stage3_onet=Date.now()-i,l=a.length>1?_r(a.map(function(_){return _.scores})):a[0].scores,h=(c=Array).from,[4,l.data()];case 2:return u=h.apply(c,[b.sent()]),l.dispose(),d=u.map(function(_,E){return{score:_,idx:E}}).filter(function(_){return _.score>t}).map(function(_){var E=_.idx;return E}),f=d.map(function(_){var E=a[_].regions.arraySync();return new eP(E[0][0],E[0][1],E[0][2],E[0][3])}),p=d.map(function(_,E){return e[_].calibrate(f[E])}),m=d.map(function(_){return u[_]}),g=[],v=[],y=[],p.length>0&&(i=Date.now(),x=pv(p,m,.7,!1),s.stage3_nms=Date.now()-i,g=x.map(function(_){return p[_]}),v=x.map(function(_){return m[_]}),y=x.map(function(_,E){return Array(5).fill(0).map(function(I,C){var S=a[_].points.arraySync();return new Bt(S[0][C]*(g[E].width+1)+g[E].left,S[0][C+5]*(g[E].height+1)+g[E].top)})})),a.forEach(function(_){_.regions.dispose(),_.scores.dispose(),_.points.dispose()}),[2,{boxes:g,scores:v,points:y}]}})})}var L9e=function(n){lt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return Ge(this,void 0,void 0,function(){return qe(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return Ge(this,void 0,void 0,function(){return qe(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),Ge(this,void 0,void 0,function(){var s,i,o,a,l,u,c,h,d,f,p,m,g,v,y,x,b,_,E,I,C;return qe(this,function(S){switch(S.label){case 0:if(s=this.params,!s)throw new Error("Mtcnn - load model before inference");if(i=t.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),l=Oe(function(){return C9e(ji(F$.fromPixels(i)).toFloat())}),u=function(T){return l.dispose(),o.total=Date.now()-a,T},c=l.shape.slice(1),h=c[0],d=c[1],f=new fY(r),p=f.minFaceSize,m=f.scaleFactor,g=f.maxNumScales,v=f.scoreThresholds,y=f.scaleSteps,x=(y||N9e(p,m,[h,d])).filter(function(T){var N=jE(T,[h,d]);return Math.min(N.width,N.height)>m1}).slice(0,g),o.scales=x,o.pyramid=x.map(function(T){return jE(T,[h,d])}),b=Date.now(),[4,$9e(l,x,v[0],s.pnet,o)];case 1:return _=S.sent(),o.total_stage1=Date.now()-b,_.boxes.length?(o.stage2_numInputBoxes=_.boxes.length,b=Date.now(),[4,O9e(i,_.boxes,v[1],s.rnet,o)]):[2,u({results:[],stats:o})];case 2:return E=S.sent(),o.total_stage2=Date.now()-b,E.boxes.length?(o.stage3_numInputBoxes=E.boxes.length,b=Date.now(),[4,M9e(i,E.boxes,v[2],s.onet,o)]):[2,u({results:[],stats:o})];case 3:return I=S.sent(),o.total_stage3=Date.now()-b,C=I.boxes.map(function(T,N){return Kk(vv({},new Ti(I.scores[N],new B$(T.left/d,T.top/h,T.width/d,T.height/h),{height:h,width:d})),new h8e(I.points[N].map(function(R){return R.sub(new Bt(T.left,T.top)).div(new Bt(T.width,T.height))}),{width:T.width,height:T.height}))}),[2,u({results:C,stats:o})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),Ge(this,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return s=this.forwardInput,[4,Mr(t)];case 1:return[4,s.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),Ge(this,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return s=this.forwardInput,[4,Mr(t)];case 1:return[2,s.apply(this,[i.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return T9e(t)},e.prototype.extractParams=function(t){return S9e(t)},e}(jl),B9e=.4,V9e=[new Bt(1.603231,2.094468),new Bt(6.041143,7.080126),new Bt(2.882459,3.518061),new Bt(4.266906,5.178857),new Bt(9.041765,10.66308)],z9e=[117.001,114.697,97.404],U9e=function(n){lt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:B9e,classes:["face"],anchors:V9e,meanRgb:z9e,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ge(this,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return s=i.sent(),[2,s.map(function(o){return new Ti(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(mY),Ps={ssdMobilenetv1:new pY,tinyFaceDetector:new U9e,tinyYolov2:new k9e,mtcnn:new L9e,faceLandmark68Net:new aY,faceLandmark68TinyNet:new W8e,faceRecognitionNet:new Q8e,faceExpressionNet:new N8e,ageGenderNet:new V8e},xY=function(n){lt(e,n);function e(t,r,s){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=s,i}return e}(dx),nP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s=this;return qe(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Yk(t,this.input,function(o){return Ge(s,void 0,void 0,function(){return qe(this,function(a){switch(a.label){case 0:return[4,Promise.all(o.map(function(l){return Ps.faceExpressionNet.predictExpressions(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(o,a){return rY(o,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new oP(this,this.input)},e}(xY),rP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r;return qe(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,Z$(t,this.input,function(i){return Ps.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=s.sent(),[2,rY(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new aP(this,this.input)},e}(xY),sP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new lP(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cP(this,this.input)},e}(nP),iP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new uP(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hP(this,this.input)},e}(rP),bY=function(n){lt(e,n);function e(t,r,s){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=s,i}return e}(dx),oP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s=this;return qe(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Yk(t,this.input,function(o){return Ge(s,void 0,void 0,function(){return qe(this,function(a){switch(a.label){case 0:return[4,Promise.all(o.map(function(l){return Ps.ageGenderNet.predictAgeAndGender(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(o,a){var l=r[a],u=l.age,c=l.gender,h=l.genderProbability;return hY(dY(o,c,h),u)})]}})})},e.prototype.withFaceExpressions=function(){return new nP(this,this.input)},e}(bY),aP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s,i,o;return qe(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,Z$(t,this.input,function(l){return Ps.ageGenderNet.predictAgeAndGender(l)},this.extractedFaces)]:[2];case 2:return r=a.sent(),s=r.age,i=r.gender,o=r.genderProbability,[2,hY(dY(t,i,o),s)]}})})},e.prototype.withFaceExpressions=function(){return new rP(this,this.input)},e}(bY),lP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new sP(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cP(this,this.input)},e}(oP),uP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new iP(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hP(this,this.input)},e}(aP),wY=function(n){lt(e,n);function e(t,r){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s}return e}(dx),cP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r;return qe(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,Yk(t,this.input,function(i){return Promise.all(i.map(function(o){return Ps.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=s.sent(),[2,r.map(function(i,o){return cY(t[o],i)})]}})})},e.prototype.withFaceExpressions=function(){return new sP(this,this.input)},e.prototype.withAgeAndGender=function(){return new lP(this,this.input)},e}(wY),hP=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r;return qe(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,Z$(t,this.input,function(i){return Ps.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=s.sent(),[2,cY(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new iP(this,this.input)},e.prototype.withAgeAndGender=function(){return new uP(this,this.input)},e}(wY),_Y=function(n){lt(e,n);function e(t,r,s){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.useTinyLandmarkNet=s,i}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Ps.faceLandmark68TinyNet:Ps.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(dx),j9e=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s,i,o,a=this;return qe(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),r=t.map(function(u){return u.detection}),this.input instanceof Rn?[4,H$(this.input,r)]:[3,3];case 2:return i=l.sent(),[3,5];case 3:return[4,W$(this.input,r)];case 4:i=l.sent(),l.label=5;case 5:return s=i,[4,Promise.all(s.map(function(u){return a.landmarkNet.detectLandmarks(u)}))];case 6:return o=l.sent(),s.forEach(function(u){return u instanceof Rn&&u.dispose()}),[2,t.map(function(u,c){return Kk(u,o[c])})]}})})},e.prototype.withFaceExpressions=function(){return new sP(this,this.input)},e.prototype.withAgeAndGender=function(){return new lP(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cP(this,this.input)},e}(_Y),W9e=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s,i,o;return qe(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof Rn?[4,H$(this.input,[r])]:[3,3]):[2];case 2:return i=a.sent(),[3,5];case 3:return[4,W$(this.input,[r])];case 4:i=a.sent(),a.label=5;case 5:return s=i,[4,this.landmarkNet.detectLandmarks(s[0])];case 6:return o=a.sent(),s.forEach(function(l){return l instanceof Rn&&l.dispose()}),[2,Kk(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new iP(this,this.input)},e.prototype.withAgeAndGender=function(){return new uP(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hP(this,this.input)},e}(_Y),kY=function(n){lt(e,n);function e(t,r){r===void 0&&(r=new Xk);var s=n.call(this)||this;return s.input=t,s.options=r,s}return e}(dx),CY=function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r,s,i;return qe(this,function(o){switch(o.label){case 0:return t=this,r=t.input,s=t.options,s instanceof fY?[4,Ps.mtcnn.forward(r,s)]:[3,2];case 1:return[2,o.sent().map(function(a){return a.detection})];case 2:if(i=s instanceof gY?function(a){return Ps.tinyFaceDetector.locateFaces(a,s)}:s instanceof Xk?function(a){return Ps.ssdMobilenetv1.locateFaces(a,s)}:s instanceof J$?function(a){return Ps.tinyYolov2.locateFaces(a,s)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return Ge(t,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return s=i.sent(),[2,r(s.map(function(o){return vv({},o)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new j9e(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new nP(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new oP(this.runAndExtendWithFaceDetections(),this.input)},e}(kY);(function(n){lt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ge(this,void 0,void 0,function(){var t,r;return qe(this,function(s){switch(s.label){case 0:return[4,new CY(this.input,this.options)];case 1:return t=s.sent(),r=t[0],t.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return Ge(t,void 0,void 0,function(){var s;return qe(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return s=i.sent(),[2,r(s?vv({},s):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new W9e(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new rP(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new aP(this.runAndExtendWithFaceDetection(),this.input)},e})(kY);function H9e(n,e){return e===void 0&&(e=new Xk),new CY(n,e)}function G9e(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(s,i){return s-r[i]}).reduce(function(s,i){return s+Math.pow(i,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var s=1,i=function(){return"person "+s++};this._labeledDescriptors=r.map(function(o){if(o instanceof O0)return o;if(o instanceof Float32Array)return new O0(i(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new O0(i(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return G9e(r,e)}).reduce(function(r,s){return r+s},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var s=r.descriptors,i=r.label;return new rV(i,t.computeMeanDistance(e,s))}).reduce(function(r,s){return r.distance<s.distance?r:s})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new rV("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return O0.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();function IY(n,e){var t=new ph(e.width,e.height),r=t.width,s=t.height;if(r<=0||s<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:s}));if(Array.isArray(n))return n.map(function(a){return IY(a,{width:r,height:s})});if(sY(n)){var i=n.detection.forSize(r,s),o=n.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Kk(vv(n,i),o)}return gv(n)?vv(n,n.detection.forSize(r,s)):n instanceof mv||n instanceof Ti?n.forSize(r,s):n}const SY=({onStressChange:n})=>{const e=q.useRef(null),[t,r]=q.useState(0),[s,i]=q.useState(0),[o,a]=q.useState(!1),[l,u]=q.useState(null),[c,h]=q.useState(!1),d=q.useRef(null),f=q.useRef(null),p=q.useRef(null),[m,g]=q.useState(0),v=q.useRef(0),y=q.useRef(null);q.useEffect(()=>{const S=()=>{i(T=>{const N=t-T;return Math.abs(N)<1?t:T+N*.1})};return y.current=setInterval(S,100),()=>{y.current&&clearInterval(y.current)}},[t]),q.useEffect(()=>((async()=>{u(null),g(0);try{u(null),g(0);const T="/models",N=[{name:"tiny_face_detector",url:`${T}/tiny_face_detector_model-weights_manifest.json`},{name:"face_expression",url:`${T}/face_expression_model-weights_manifest.json`},{name:"face_landmarks",url:`${T}/face_landmark_68_model-weights_manifest.json`}];for(let R=0;R<N.length;R++){const D=N[R];console.log(`Loading model: ${D.name} from ${D.url}`);try{switch(D.name){case"tiny_face_detector":await Ps.tinyFaceDetector.loadFromUri(T);break;case"face_expression":await Ps.faceExpressionNet.loadFromUri(T);break;case"face_landmarks":await Ps.faceLandmark68Net.loadFromUri(T);break}console.log(`Successfully loaded model: ${D.name}`)}catch(z){throw console.error(`Error loading model ${D.name}:`,z),new Error(`Failed to load model: ${D.name}. Please check if the model files are present in the /public/models directory.`)}g((R+1)/N.length*100)}a(!0),console.log("All face detection models loaded successfully")}catch(T){console.error("Error loading models from /models directory:",T),u(T instanceof Error?T.message:"Failed to load face detection models. Please check if the model files are present in the /public/models directory.")}})(),()=>{b()}),[]);const x=async()=>{try{u(null);const S=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"}});e.current&&(e.current.srcObject=S,await new Promise(T=>{e.current&&(e.current.onloadedmetadata=T)})),d.current=S,h(!0),_()}catch(S){console.error("Error accessing webcam:",S),u("Unable to access webcam. Please make sure you have granted camera permissions.")}},b=()=>{d.current&&(d.current.getTracks().forEach(S=>S.stop()),d.current=null),f.current&&cancelAnimationFrame(f.current),e.current&&(e.current.srcObject=null),y.current&&clearInterval(y.current),h(!1)},_=async()=>{if(!e.current||!o||!p.current){console.error("Required refs or model not ready:",{video:!!e.current,modelLoaded:o,canvas:!!p.current});return}const S=e.current,T=p.current;(!S.width||!S.height)&&(S.width=640,S.height=480);const N={width:S.width,height:S.height};T.width=N.width,T.height=N.height,C8e(T,N);const R=async()=>{try{const D=await H9e(S,new gY({inputSize:320,scoreThreshold:.3})).withFaceExpressions(),z=T.getContext("2d");z&&z.clearRect(0,0,T.width,T.height);const L=IY(D,N);v8e(T,L),R8e(T,L,.05);const O=Date.now();if(O-v.current>=1e3){if(D.length>0){const F=D[0].expressions,P=E(F);r(P),n(P)}else r(F=>Math.max(0,F-2)),n(Math.max(0,t-2));v.current=O}c&&(f.current=requestAnimationFrame(R))}catch(D){console.error("Error detecting faces:",D),D instanceof Error&&D.message.includes("Failed to load model")&&u("Error detecting faces. Please check if the model files are present in the /public/models directory.")}};setTimeout(R,100)},E=S=>{const T={angry:100,disgusted:90,fearful:80,sad:70,surprised:40,happy:0};let N=0,R=0;return Object.entries(S).forEach(([D,z])=>{T[D]!==void 0&&(N+=T[D]*z,R+=z)}),R>0?Math.round(N/R):0},I=S=>S<30?"bg-green-500":S<60?"bg-yellow-500":"bg-red-500",C=S=>S<30?"Low Stress":S<60?"Moderate Stress":"High Stress";return k.jsx("div",{className:"w-full max-w-md mx-auto space-y-4",children:l?k.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:l}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"relative aspect-video",children:[k.jsx("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full rounded-lg shadow-lg"}),k.jsx("canvas",{ref:p,className:"absolute top-0 left-0 w-full h-full"}),!o&&k.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 rounded-lg",children:[k.jsx("p",{className:"text-white mb-2",children:"Loading face detection models..."}),k.jsx("div",{className:"w-48 h-2 bg-gray-700 rounded-full overflow-hidden",children:k.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${m}%`}})}),k.jsxs("p",{className:"text-white mt-2",children:[Math.round(m),"%"]})]})]}),k.jsx("div",{className:"flex justify-center space-x-4",children:c?k.jsx("button",{onClick:b,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Stop Detection"}):k.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Start Detection"})}),k.jsxs("div",{className:"space-y-2",children:[k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("span",{className:"text-lg font-medium",children:"Stress Level:"}),k.jsxs("span",{className:"text-lg font-bold",children:[Math.round(s),"%"]})]}),k.jsx("div",{className:"h-6 w-full bg-gray-200 rounded-full overflow-hidden",children:k.jsx("div",{className:`h-full ${I(s)} transition-all duration-300`,style:{width:`${s}%`}})}),k.jsxs("p",{className:"text-center font-medium",children:["Status: ",C(s)]})]})]})})};function EY({onStressChange:n}){const[e,t]=q.useState(""),[r,s]=q.useState({speed:0,errors:0,stressScore:0}),i=q.useRef(null),o=q.useRef("");q.useEffect(()=>{e.length>0&&!i.current&&(i.current=Date.now())},[e]);const a=c=>{if(!i.current)return;const h=(Date.now()-i.current)/1e3,d=c.length/h,f=l(o.current,c),p=u(d,f);s({speed:d,errors:f,stressScore:p}),n(p),o.current=c},l=(c,h)=>Math.abs(c.length-h.length),u=(c,h)=>{const f=Math.min(1,c/10),p=Math.min(1,h/5);return Math.min(100,50+f*20+p*30)};return k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[k.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Type your thoughts..."}),k.jsx("textarea",{value:e,onChange:c=>{t(c.target.value),a(c.target.value)},className:"w-full h-32 p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Start typing to analyze your stress level..."})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Typing Speed"}),k.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[r.speed.toFixed(1)," cps"]})]}),k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Errors"}),k.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:r.errors})]}),k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Stress Level"}),k.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[r.stressScore.toFixed(1),"%"]})]})]}),k.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:k.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${r.stressScore}%`}})})]})}function TY({onStressChange:n}){const[e,t]=q.useState(!1),[r,s]=q.useState({pitch:0,volume:0,stressScore:0}),i=q.useRef(null),o=q.useRef(null),a=q.useRef(null),l=async()=>{try{const f=await navigator.mediaDevices.getUserMedia({audio:!0}),p=new MediaRecorder(f);i.current=p;const m=new AudioContext;o.current=m;const g=m.createMediaStreamSource(f),v=m.createAnalyser();a.current=v,g.connect(v),p.start(),t(!0);const y=new Float32Array(v.frequencyBinCount),x=()=>{if(!e||!a.current)return;a.current.getFloatTimeDomainData(y);const b=c(y),_=h(y),E=d(b,_);s({volume:b,pitch:_,stressScore:E}),n(E),requestAnimationFrame(x)};x()}catch(f){console.error("Error accessing microphone:",f)}},u=()=>{i.current&&e&&(i.current.stop(),i.current.stream.getTracks().forEach(f=>f.stop()),t(!1))},c=f=>{const p=Math.sqrt(f.reduce((m,g)=>m+g*g,0)/f.length);return Math.min(100,p*100)},h=f=>{const p=f.length,m=.1;let g=-1/0,v=-1;for(let b=0;b<p;b++)f[b]>g&&(g=f[b],v=b);const x=v*44100/p;return x>m?x:0},d=(f,p)=>{const g=f/100,v=p>0?p/100:0;return Math.min(100,50+g*30+v*20)};return k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[k.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Voice Analysis"}),k.jsx("div",{className:"flex justify-center space-x-4",children:k.jsx("button",{onClick:e?u:l,className:`px-6 py-3 rounded-lg font-medium transition-colors ${e?"bg-red-500 text-white hover:bg-red-600":"bg-indigo-500 text-white hover:bg-indigo-600"}`,children:e?"Stop Recording":"Start Recording"})})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Voice Volume"}),k.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[r.volume.toFixed(1),"%"]})]}),k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Pitch"}),k.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[r.pitch.toFixed(1),"%"]})]}),k.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[k.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Stress Level"}),k.jsxs("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:[r.stressScore.toFixed(1),"%"]})]})]}),k.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:k.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${r.stressScore}%`}})})]})}function q9e(){const[n,e]=q.useState("facial"),t=()=>{};return k.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:k.jsxs("div",{className:"max-w-7xl mx-auto",children:[k.jsxs("div",{className:"text-center mb-8",children:[k.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Stress Detection"}),k.jsx("p",{className:"mt-2 text-gray-600",children:"Choose a method to analyze your stress level"})]}),k.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[k.jsxs("div",{className:"flex justify-center space-x-4 mb-8",children:[k.jsx("button",{onClick:()=>e("facial"),className:`px-4 py-2 rounded-md text-sm font-medium ${n==="facial"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:"Facial Analysis"}),k.jsx("button",{onClick:()=>e("typing"),className:`px-4 py-2 rounded-md text-sm font-medium ${n==="typing"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:"Typing Analysis"}),k.jsx("button",{onClick:()=>e("voice"),className:`px-4 py-2 rounded-md text-sm font-medium ${n==="voice"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:"Voice Analysis"})]}),k.jsxs("div",{className:"mt-8",children:[n==="facial"&&k.jsx(SY,{onStressChange:t}),n==="typing"&&k.jsx(EY,{onStressChange:t}),n==="voice"&&k.jsx(TY,{onStressChange:t})]})]}),k.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[k.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Tips for Stress Management"}),k.jsxs("ul",{className:"space-y-2 text-gray-600",children:[k.jsx("li",{children:"• Take deep breaths and practice mindfulness"}),k.jsx("li",{children:"• Take regular breaks from work"}),k.jsx("li",{children:"• Exercise regularly"}),k.jsx("li",{children:"• Maintain a healthy sleep schedule"}),k.jsx("li",{children:"• Practice meditation or yoga"}),k.jsx("li",{children:"• Stay hydrated and eat well"}),k.jsx("li",{children:"• Connect with friends and family"}),k.jsx("li",{children:"• Set realistic goals and boundaries"})]})]})]})})}const V0=[{type:"breathing",title:"Deep Breathing",description:"Take slow, deep breaths to calm your mind and reduce stress.",duration:5,intensity:"low"},{type:"breathing",title:"Box Breathing",description:"Inhale, hold, exhale, and hold again in equal counts.",duration:10,intensity:"medium"},{type:"meditation",title:"Mindful Pause",description:"Take a moment to observe your thoughts without judgment.",duration:5,intensity:"low"},{type:"meditation",title:"Body Scan",description:"Focus on different parts of your body, releasing tension.",duration:15,intensity:"medium"},{type:"exercise",title:"Quick Stretch",description:"Simple stretches to release physical tension.",duration:5,intensity:"low"},{type:"exercise",title:"Desk Yoga",description:"Gentle yoga poses you can do at your desk.",duration:10,intensity:"medium"}];function K9e(n){const e=[n.facialStress,n.typingStress,n.voiceStress].filter(s=>s!==void 0),t=e.length>0?e.reduce((s,i)=>s+i,0)/e.length:0;let r=[];return t>70?r=V0.filter(s=>s.intensity==="low"&&s.duration<=5).slice(0,2):t>40?r=V0.filter(s=>s.intensity==="medium"||s.duration<=10).slice(0,3):r=V0.filter(s=>s.intensity==="medium"&&s.duration>=10).slice(0,2),n.sentiment!==void 0&&n.sentiment<.3&&(r=[...r,...V0.filter(s=>s.type==="breathing"&&s.intensity==="low")].slice(0,3)),r}function X9e(n){return n>70?"High stress level detected. Consider taking a break and practicing deep breathing.":n>40?"Moderate stress level. Try some gentle exercises or meditation.":"Stress level is manageable. Focus on maintaining good habits."}function Y9e(){const[n,e]=q.useState({facialStress:0,typingStress:0,voiceStress:0,sentiment:.5}),[t,r]=q.useState([]),[s,i]=q.useState(null),[o,a]=q.useState(!1);q.useEffect(()=>{const f=K9e(n);r(f)},[n]);const l=f=>{e(p=>({...p,facialStress:f}))},u=f=>{e(p=>({...p,typingStress:f}))},c=f=>{e(p=>({...p,voiceStress:f}))},h=()=>{a(!0),i(null)},d=Object.values(n).reduce((f,p)=>f+p,0)/4;return k.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:k.jsxs("div",{className:"max-w-7xl mx-auto",children:[k.jsxs("div",{className:"text-center mb-8",children:[k.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Personalized Recommendations"}),k.jsx("p",{className:"mt-2 text-gray-600",children:X9e(d)})]}),s?k.jsx(C7,{recommendation:s,onComplete:h}):k.jsxs("div",{className:"space-y-8",children:[k.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[k.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Stress Assessment"}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[k.jsx(SY,{onStressChange:l}),k.jsx(EY,{onStressChange:u}),k.jsx(TY,{onStressChange:c})]})]}),k.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[k.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Recommended Activities"}),k.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map((f,p)=>k.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>i(f),children:[k.jsx("h3",{className:"text-lg font-medium text-gray-900",children:f.title}),k.jsx("p",{className:"mt-2 text-sm text-gray-600",children:f.description}),k.jsxs("div",{className:"mt-4 flex justify-between items-center text-sm text-gray-500",children:[k.jsxs("span",{children:[f.duration," minutes"]}),k.jsx("span",{className:"capitalize",children:f.intensity})]})]},p))})]})]}),o&&k.jsx("div",{className:"mt-8 text-center",children:k.jsx("p",{className:"text-green-600 font-medium",children:"Great job completing the session! Would you like to try another activity?"})})]})})}function Q9e(){return k.jsxs("div",{className:"min-h-screen bg-gray-50",children:[k.jsx("nav",{className:"bg-white shadow-sm",children:k.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:k.jsx("div",{className:"flex justify-between h-16",children:k.jsxs("div",{className:"flex",children:[k.jsx("div",{className:"flex-shrink-0 flex items-center",children:k.jsx(Ui,{to:"/",className:"text-xl font-bold text-indigo-600",children:"Meditation Coach"})}),k.jsxs("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[k.jsx(Ui,{to:"/features/guided-wellness/",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Home"}),k.jsx(Ui,{to:"/features/guided-wellness/session",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Session"}),k.jsx(Ui,{to:"/features/guided-wellness/stress",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Stress Detection"}),k.jsx(Ui,{to:"/features/guided-wellness/recommendations",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Recommendations"}),k.jsx(Ui,{to:"/features/guided-wellness/reports",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Reports"})]})]})})})}),k.jsx("main",{children:k.jsxs(zU,{children:[k.jsx(us,{path:"/",element:k.jsx(yze,{})}),k.jsx(us,{path:"/session",element:k.jsx(_je,{})}),k.jsx(us,{path:"/stress",element:k.jsx(q9e,{})}),k.jsx(us,{path:"/recommendations",element:k.jsx(Y9e,{})}),k.jsx(us,{path:"/reports",element:k.jsx(kje,{})})]})})]})}const J9e=()=>k.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:[k.jsxs("div",{className:"text-center mb-16",children:[k.jsx("div",{className:"flex items-center justify-center mb-6",children:k.jsx("div",{className:"w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center",children:k.jsx(NU,{className:"w-10 h-10 text-indigo-600"})})}),k.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Student Mental Health Community"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"A safe and supportive space where students can connect, share experiences, and find the support they need on their mental health journey."})]}),k.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 mb-16",children:[{number:"5000+",label:"Students Supported"},{number:"24/7",label:"Support Available"},{number:"100+",label:"Peer Mentors"},{number:"50+",label:"Support Groups"}].map((n,e)=>k.jsxs("div",{className:"text-center",children:[k.jsx("div",{className:"text-3xl font-bold text-indigo-600 mb-2",children:n.number}),k.jsx("div",{className:"text-gray-600",children:n.label})]},e))}),k.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mb-16",children:[k.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow",children:[k.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6",children:k.jsx(KZ,{className:"w-6 h-6 text-indigo-600"})}),k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Support Groups"}),k.jsxs("ul",{className:"space-y-3 text-gray-600",children:[k.jsx("li",{children:"• Anxiety & Stress Management"}),k.jsx("li",{children:"• Academic Pressure"}),k.jsx("li",{children:"• Work-Life Balance"}),k.jsx("li",{children:"• Personal Growth"})]})]}),k.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow",children:[k.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6",children:k.jsx(VT,{className:"w-6 h-6 text-indigo-600"})}),k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Safe Space"}),k.jsxs("ul",{className:"space-y-3 text-gray-600",children:[k.jsx("li",{children:"• 24/7 Moderated Forums"}),k.jsx("li",{children:"• Anonymous Sharing"}),k.jsx("li",{children:"• Confidential Support"}),k.jsx("li",{children:"• Crisis Resources"})]})]}),k.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow",children:[k.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6",children:k.jsx(LZ,{className:"w-6 h-6 text-indigo-600"})}),k.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Resources"}),k.jsxs("ul",{className:"space-y-3 text-gray-600",children:[k.jsx("li",{children:"• Mental Health Guides"}),k.jsx("li",{children:"• Wellness Workshops"}),k.jsx("li",{children:"• Self-Help Tools"}),k.jsx("li",{children:"• Expert Articles"})]})]})]}),k.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 mb-16",children:[k.jsx("h2",{className:"text-3xl font-bold mb-8 text-center",children:"Upcoming Community Events"}),k.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{title:"Stress Management Workshop",date:"Every Monday",time:"6:00 PM - 7:30 PM",type:"Virtual"},{title:"Mindfulness Meditation",date:"Every Wednesday",time:"5:00 PM - 6:00 PM",type:"Hybrid"},{title:"Peer Support Circle",date:"Every Friday",time:"7:00 PM - 8:30 PM",type:"In-Person"}].map((n,e)=>k.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:border-indigo-300 transition-colors",children:[k.jsx("h3",{className:"font-semibold text-xl mb-2",children:n.title}),k.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[k.jsx(BT,{className:"w-4 h-4 mr-2"}),k.jsx("span",{children:n.date})]}),k.jsxs("div",{className:"flex items-center text-gray-600",children:[k.jsx(cp,{className:"w-4 h-4 mr-2"}),k.jsx("span",{children:n.time})]}),k.jsx("span",{className:"inline-block mt-4 px-3 py-1 bg-indigo-100 text-indigo-600 rounded-full text-sm",children:n.type})]},e))})]}),k.jsxs("div",{className:"text-center",children:[k.jsx("button",{className:"bg-indigo-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-indigo-700 transition-colors",children:"Join Our Community"}),k.jsx("p",{className:"mt-4 text-gray-600",children:"Your journey to better mental health starts with community support."})]})]})}),Z9e=()=>k.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white",children:[k.jsxs("div",{className:"relative pt-16",children:[k.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1532012197267-da84d127e765')] bg-cover bg-center",children:k.jsx("div",{className:"absolute inset-0 bg-indigo-900 bg-opacity-80"})}),k.jsx("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24",children:k.jsxs("div",{className:"text-center",children:[k.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:["Empowering Student Mental Health",k.jsx("span",{className:"block text-indigo-300 mt-2",children:"Through AI and Community"})]}),k.jsx("p",{className:"text-xl text-gray-200 mb-8 max-w-3xl mx-auto",children:"Discover how MindfulStudent is revolutionizing mental health support for students worldwide through innovative technology and compassionate care."})]})})]}),k.jsx("div",{className:"py-16 bg-white",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"The Challenge We're Addressing"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Students today face unprecedented mental health challenges that traditional support systems struggle to address effectively."})]}),k.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:[{icon:LT,title:"Mental Health Crisis",description:"73% of students experience some form of mental health crisis during their academic career."},{icon:cp,title:"Limited Access",description:"Only 1 in 3 students who need mental health support have access to professional help."},{icon:VT,title:"Privacy Concerns",description:"Students often hesitate to seek help due to stigma and privacy concerns."}].map((n,e)=>k.jsxs("div",{className:"bg-indigo-50 rounded-xl p-6",children:[k.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mb-4",children:k.jsx(n.icon,{className:"w-6 h-6 text-indigo-600"})}),k.jsx("h3",{className:"text-xl font-semibold mb-2",children:n.title}),k.jsx("p",{className:"text-gray-600",children:n.description})]},e))})]})}),k.jsx("div",{className:"py-16 bg-gradient-to-b from-white to-indigo-50",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Our Comprehensive Solution"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"We've developed a holistic approach that combines AI technology with human support to create a complete mental health ecosystem."})]}),k.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[k.jsxs("div",{className:"space-y-8",children:[k.jsxs("div",{className:"flex items-start space-x-4",children:[k.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center",children:k.jsx(VC,{className:"w-5 h-5"})}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-xl font-semibold mb-2",children:"AI-Powered Support"}),k.jsx("p",{className:"text-gray-600",children:"24/7 intelligent mental health monitoring and support through advanced AI algorithms."})]})]}),k.jsxs("div",{className:"flex items-start space-x-4",children:[k.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center",children:k.jsx(VC,{className:"w-5 h-5"})}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Personalized Experience"}),k.jsx("p",{className:"text-gray-600",children:"Customized wellness plans and recommendations based on individual needs and patterns."})]})]}),k.jsxs("div",{className:"flex items-start space-x-4",children:[k.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center",children:k.jsx(VC,{className:"w-5 h-5"})}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Safe Community"}),k.jsx("p",{className:"text-gray-600",children:"Moderated peer support groups and forums for sharing experiences and support."})]})]})]}),k.jsx("div",{className:"relative",children:k.jsx("img",{src:"https://images.unsplash.com/photo-1516321318423-f06f85e504b3",alt:"Student using MindfulStudent",className:"rounded-xl shadow-lg"})})]})]})}),k.jsx("div",{className:"py-16 bg-white",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Key Benefits"}),k.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our platform delivers tangible results for students' mental well-being and academic success."})]}),k.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{stat:"89%",label:"Stress Reduction",description:"Students report lower stress levels after 3 months"},{stat:"94%",label:"Accessibility",description:"Students can access support whenever they need it"},{stat:"78%",label:"Academic Performance",description:"Users report improved academic focus"},{stat:"92%",label:"User Satisfaction",description:"Students would recommend to peers"}].map((n,e)=>k.jsxs("div",{className:"text-center p-6 bg-indigo-50 rounded-xl",children:[k.jsx("div",{className:"text-4xl font-bold text-indigo-600 mb-2",children:n.stat}),k.jsx("div",{className:"text-xl font-semibold mb-2",children:n.label}),k.jsx("p",{className:"text-gray-600",children:n.description})]},e))})]})}),k.jsx("div",{className:"bg-indigo-900 py-16",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[k.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Transform Your Mental Well-being?"}),k.jsx("p",{className:"text-xl text-indigo-200 mb-8 max-w-2xl mx-auto",children:"Join thousands of students who have already taken the first step towards better mental health."}),k.jsxs("div",{className:"flex justify-center space-x-4",children:[k.jsx("button",{className:"bg-white text-indigo-600 px-8 py-3 rounded-full text-lg font-semibold hover:bg-indigo-50 transition-colors duration-300",children:"Get Started Now"}),k.jsx("button",{className:"border-2 border-white text-white px-8 py-3 rounded-full text-lg font-semibold hover:bg-white hover:text-indigo-600 transition-colors duration-300",children:"Schedule a Demo"})]})]})})]});function e7e(){const[n,e]=q.useState(!1),t=Dl(),r=Iv(),s=i=>{if(t.pathname!=="/"){r("/?section="+i);return}const o=document.getElementById(i);o&&(o.scrollIntoView({behavior:"smooth"}),e(!1))};return q.useEffect(()=>{if(t.hash){const i=t.hash.replace("#",""),o=document.getElementById(i);setTimeout(()=>{o&&o.scrollIntoView({behavior:"smooth"})},0)}else if(t.search){const o=new URLSearchParams(t.search).get("section");if(o){const a=document.getElementById(o);setTimeout(()=>{a&&a.scrollIntoView({behavior:"smooth"})},0)}}},[t]),k.jsx("nav",{className:"bg-white shadow-sm fixed w-full z-50",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"flex justify-between h-16",children:[k.jsx("div",{className:"flex items-center",children:k.jsxs(Ui,{to:"/",className:"flex items-center group",children:[k.jsx(kU,{className:"h-8 w-8 text-indigo-600 transition-transform duration-300 group-hover:scale-110"}),k.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 transition-transform duration-300 group-hover:scale-110",children:"MindfulStudent"})]})}),k.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[k.jsxs("button",{onClick:()=>s("features"),className:"text-gray-600 hover:text-indigo-600 relative group",children:["Features",k.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]}),k.jsxs("button",{onClick:()=>s("how-it-works"),className:"text-gray-600 hover:text-indigo-600 relative group",children:["How It Works",k.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]}),k.jsxs("button",{onClick:()=>s("testimonials"),className:"text-gray-600 hover:text-indigo-600 relative group",children:["Testimonials",k.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]}),k.jsxs("button",{onClick:()=>s("contact"),className:"text-gray-600 hover:text-indigo-600 relative group",children:["Contact",k.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]}),k.jsx("button",{onClick:()=>s("features"),className:"bg-indigo-600 text-white px-4 py-2 rounded-full hover:bg-indigo-700",children:"Get Started"})]}),k.jsx("div",{className:"md:hidden flex items-center",children:k.jsx("button",{onClick:()=>e(!n),className:"text-gray-600",children:n?k.jsx(eee,{className:"h-6 w-6"}):k.jsx(qZ,{className:"h-6 w-6"})})})]}),n&&k.jsx("div",{className:"md:hidden",children:k.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1",children:[k.jsxs("button",{onClick:()=>s("features"),className:"block w-full text-left px-3 py-2 text-gray-600 hover:text-indigo-600 relative group",children:["Features",k.jsx("span",{className:"absolute bottom-0 left-3 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-20"})]}),k.jsxs("button",{onClick:()=>s("how-it-works"),className:"block w-full text-left px-3 py-2 text-gray-600 hover:text-indigo-600 relative group",children:["How It Works",k.jsx("span",{className:"absolute bottom-0 left-3 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-24"})]}),k.jsxs("button",{onClick:()=>s("testimonials"),className:"block w-full text-left px-3 py-2 text-gray-600 hover:text-indigo-600 relative group",children:["Testimonials",k.jsx("span",{className:"absolute bottom-0 left-3 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-24"})]}),k.jsxs("button",{onClick:()=>s("contact"),className:"block w-full text-left px-3 py-2 text-gray-600 hover:text-indigo-600 relative group",children:["Contact",k.jsx("span",{className:"absolute bottom-0 left-3 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-16"})]}),k.jsx("button",{onClick:()=>s("features"),className:"w-full text-center bg-indigo-600 text-white px-4 py-2 rounded-full hover:bg-indigo-700",children:"Get Started"})]})})]})})}function Td({icon:n,title:e,description:t,to:r}){const s=Iv();return k.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-transform duration-300 cursor-pointer transform hover:-translate-y-2 hover:scale-105",onClick:()=>s(r),style:{perspective:"1000px"},children:k.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full",style:{transformStyle:"preserve-3d"},children:[k.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-full mb-4",children:k.jsx(n,{className:"w-6 h-6 text-indigo-600"})}),k.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:e}),k.jsx("p",{className:"text-gray-600",children:t})]})})}function Nd({number:n,title:e,description:t}){return k.jsxs("div",{className:"flex items-start space-x-4",children:[k.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold transition-transform duration-300 hover:rotate-12 hover:scale-110",children:n}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-lg font-semibold mb-2 transition-transform duration-300 hover:scale-110 hover:translate-x-4",children:e}),k.jsx("p",{className:"text-gray-600",children:t})]})]})}function nI({name:n,role:e,quote:t,image:r}){return k.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg transition-transform duration-300 hover:scale-105 hover:bg-indigo-50",children:[k.jsxs("div",{className:"flex items-center mb-4",children:[k.jsx("img",{src:r,alt:n,className:"w-12 h-12 rounded-full object-cover"}),k.jsxs("div",{className:"ml-4",children:[k.jsx("h4",{className:"font-semibold text-gray-900",children:n}),k.jsx("p",{className:"text-gray-600 text-sm",children:e})]})]}),k.jsx("p",{className:"text-gray-700 italic",children:t})]})}function t7e(){const n=Iv(),e=Dl(),t=()=>{const r=document.getElementById("features");r&&r.scrollIntoView({behavior:"smooth"})};return q.useEffect(()=>{if(e.search){const s=new URLSearchParams(e.search).get("section");if(s){const i=document.getElementById(s);i&&i.scrollIntoView({behavior:"smooth"})}}},[e]),k.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white",children:[k.jsx(e7e,{}),k.jsxs("div",{className:"relative pt-16",children:[k.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1517048676732-d65bc937f952')] bg-cover bg-center",children:k.jsx("div",{className:"absolute inset-0 bg-indigo-900 bg-opacity-70"})}),k.jsx("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-32",children:k.jsxs("div",{className:"text-center",children:[k.jsxs("h1",{className:"text-5xl font-bold text-white mb-6",children:["Transform Your Mental Well-being",k.jsx("span",{className:"block text-indigo-300",children:"With AI-Powered Support"})]}),k.jsx("p",{className:"text-xl text-gray-200 mb-8 max-w-2xl mx-auto",children:"Join thousands of students who've found peace, focus, and balance through our innovative mental health platform. Get personalized support exactly when you need it."}),k.jsxs("div",{className:"flex justify-center space-x-4",children:[k.jsx("button",{onClick:t,className:"bg-white text-indigo-600 px-8 py-3 rounded-full text-lg font-semibold transition-all duration-500 overflow-hidden",children:k.jsxs("span",{className:"inline-block relative transition-all duration-500 hover:pr-6",children:["Start Free Trial",k.jsx("span",{className:"absolute opacity-0 top-0 right-[-20px] transition-all duration-500 hover:opacity-100 hover:right-0 text-indigo-500",children:"»"})]})}),k.jsx("button",{onClick:()=>n("/learn-more"),className:"border-2 border-white text-white px-8 py-3 rounded-full text-lg font-semibold hover:bg-white hover:text-indigo-600 transition-all duration-500 overflow-hidden",children:k.jsxs("span",{className:"inline-block relative transition-all duration-500 hover:pr-6",children:["Learn More",k.jsx("span",{className:"absolute opacity-0 top-0 right-[-20px] transition-all duration-500 hover:opacity-100 hover:right-0",children:"»"})]})})]})]})})]}),k.jsxs("div",{id:"features",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4 relative group",children:k.jsxs("span",{className:"inline-block relative",children:["Features Designed for Your Well-being",k.jsx("span",{className:"absolute top-11 left-0 w-0 h-0.5  bg-indigo-600 transition-all duration-300 group-hover:w-full"})]})}),k.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Every feature is thoughtfully crafted to support your mental health journey and academic success."})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[k.jsx(Td,{icon:VZ,title:"AI-Powered Stress Tracking",description:"Advanced AI analysis of your stress patterns with personalized wellness recommendations.",to:"/features/ai-stress-tracking"}),k.jsx(Td,{icon:cl,title:"Digital Detox Assistant",description:"Smart screen time tracking and gentle nudges to help you maintain focus.",to:"/features/digital-detox"}),k.jsx(Td,{icon:zT,title:"24/7 AI Support",description:"Intelligent chatbot offering round-the-clock mental health support and guidance.",to:"/ai-mental-health-chatbot"}),k.jsx(Td,{icon:cp,title:"Study & Break Scheduler",description:"Personalized study sessions with integrated Pomodoro timer and break reminders.",to:"/features/study-scheduler"}),k.jsx(Td,{icon:ah,title:"Guided Wellness",description:"AI-curated meditation and breathing exercises for stress reduction.",to:"/features/guided-wellness"}),k.jsx(Td,{icon:NU,title:"Community Support",description:"Connect with peers in a safe, moderated space for sharing and support.",to:"/features/community-support"})]})]}),k.jsx("div",{id:"how-it-works",className:"bg-gray-50 py-16",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4 relative group",children:k.jsxs("span",{className:"inline-block relative",children:["How Our Platform Works",k.jsx("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]})}),k.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Our AI-powered platform provides comprehensive mental health support through an intuitive step-by-step process."})]}),k.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[k.jsxs("div",{className:"space-y-8",children:[k.jsx(Nd,{number:1,title:"AI-Powered Mental Health Assessment",description:"Start with our intelligent stress tracking system that analyzes your mental state and creates a personalized wellness profile."}),k.jsx(Nd,{number:2,title:"Digital Wellness Management",description:"Receive smart screen time monitoring and scheduled breaks to maintain a healthy study-life balance with our Digital Detox Assistant."}),k.jsx(Nd,{number:3,title:"24/7 AI Chatbot Support",description:"Access immediate support through our AI mental health chatbot, providing guidance and coping strategies whenever you need them."}),k.jsx(Nd,{number:4,title:"Structured Study Planning",description:"Use our Study Break Scheduler to create optimized study sessions with built-in Pomodoro timing and wellness breaks."}),k.jsx(Nd,{number:5,title:"Guided Wellness Activities",description:"Follow AI-curated meditation and mindfulness exercises designed to reduce stress and improve mental clarity."}),k.jsx(Nd,{number:6,title:"Community Connection",description:"Join our moderated community platform to connect with peers, share experiences, and build a support network."})]}),k.jsxs("div",{className:"relative group w-full h-96 overflow-hidden rounded-xl shadow-lg",children:[k.jsx("img",{src:"https://images.unsplash.com/photo-1522202176988-66273c2fd55f",alt:"Students using the platform",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),k.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-end p-6",children:k.jsxs("div",{className:"space-y-3 bg-white bg-opacity-90 p-4 rounded-lg shadow-md",children:[k.jsx("p",{className:"text-gray-600",children:"Combines AI technology with proven mental health practices"}),k.jsx("p",{className:"text-gray-600",children:"Provides personalized support based on individual needs"}),k.jsx("p",{className:"text-gray-600",children:"Offers continuous support through multiple channels"}),k.jsx("p",{className:"text-gray-600",children:"Creates a balanced approach to academic success and mental wellness"})]})})]})]})]})}),k.jsx("div",{id:"testimonials",className:"py-16",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"text-center mb-12",children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4 relative group",children:k.jsxs("span",{className:"inline-block relative",children:["What Students Say",k.jsx("span",{className:"absolute top-10 left-0 w-0 h-0.5 bg-indigo-600 transition-all duration-300 group-hover:w-full"})]})}),k.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Hear from students who've transformed their mental well-being with our platform."})]}),k.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[k.jsx(nI,{name:"Sarah Johnson",role:"Computer Science Student",quote:"This platform helped me manage my anxiety during finals. The AI suggestions were spot-on, and the meditation exercises made a real difference.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330"}),k.jsx(nI,{name:"Michael Chen",role:"Engineering Student",quote:"The study scheduler and focus tools helped me stay productive without burning out. It's like having a personal wellness coach.",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d"}),k.jsx(nI,{name:"Emily Rodriguez",role:"Psychology Student",quote:"The community support feature connected me with other students facing similar challenges. It's comforting to know you're not alone.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80"})]})]})}),k.jsx("div",{id:"contact",className:"bg-gray-50 py-16",children:k.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:k.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[k.jsxs("div",{children:[k.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4 transition-transform duration-300 hover:scale-105 hover:text-indigo-600",children:"Get in Touch"}),k.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Have questions about our platform? We're here to help you on your mental wellness journey."}),k.jsxs("div",{className:"space-y-6",children:[k.jsxs("div",{className:"flex items-center",children:[k.jsx(HZ,{className:"w-6 h-6 text-indigo-600 mr-4"}),k.jsx("span",{className:"text-gray-600",children:"support@mindfulstudent.com"})]}),k.jsxs("div",{className:"flex items-center",children:[k.jsx(EU,{className:"w-6 h-6 text-indigo-600 mr-4"}),k.jsx("span",{className:"text-gray-600",children:"1-800-MINDFUL"})]}),k.jsxs("div",{className:"flex items-center",children:[k.jsx(GZ,{className:"w-6 h-6 text-indigo-600 mr-4"}),k.jsx("span",{className:"text-gray-600",children:"123 Wellness Street, Education City"})]})]})]}),k.jsxs("form",{className:"space-y-6",children:[k.jsxs("div",{children:[k.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),k.jsx("input",{type:"text",id:"name",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent"})]}),k.jsxs("div",{children:[k.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),k.jsx("input",{type:"email",id:"email",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent"})]}),k.jsxs("div",{children:[k.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),k.jsx("textarea",{id:"message",rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent"})]}),k.jsx("button",{className:"w-full bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors duration-300",children:"Send Message"})]})]})})}),k.jsx("footer",{className:"bg-gray-900 text-white py-12",children:k.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[k.jsxs("div",{className:"grid md:grid-cols-4 gap-8",children:[k.jsxs("div",{children:[k.jsxs("div",{className:"flex items-center mb-4",children:[k.jsx(kU,{className:"h-8 w-8 text-indigo-400"}),k.jsx("span",{className:"ml-2 text-xl font-bold",children:"MindfulStudent"})]}),k.jsx("p",{className:"text-gray-400",children:"Empowering students with AI-powered mental health support and wellness tools."})]}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),k.jsxs("ul",{className:"space-y-2",children:[k.jsx("li",{children:k.jsx("a",{href:"#features",className:"text-gray-400 hover:text-white",children:"Features"})}),k.jsx("li",{children:k.jsx("a",{href:"#how-it-works",className:"text-gray-400 hover:text-white",children:"How It Works"})}),k.jsx("li",{children:k.jsx("a",{href:"#testimonials",className:"text-gray-400 hover:text-white",children:"Testimonials"})}),k.jsx("li",{children:k.jsx("a",{href:"#contact",className:"text-gray-400 hover:text-white",children:"Contact"})})]})]}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Resources"}),k.jsxs("ul",{className:"space-y-2",children:[k.jsx("li",{children:k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Blog"})}),k.jsx("li",{children:k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Mental Health Tips"})}),k.jsx("li",{children:k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Student Stories"})}),k.jsx("li",{children:k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Support Guide"})})]})]}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Connect With Us"}),k.jsxs("div",{className:"flex space-x-4",children:[k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:k.jsx(CU,{className:"h-6 w-6"})}),k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:k.jsx(WZ,{className:"h-6 w-6"})}),k.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:k.jsx(VT,{className:"h-6 w-6"})})]})]})]}),k.jsxs("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:[k.jsx("p",{children:"© 2025 MindfulStudent. All rights reserved."}),k.jsx("p",{className:"mt-2",children:"Made with ❤️ for students worldwide"})]})]})})]})}function n7e(){return k.jsx(wte,{children:k.jsxs(zU,{children:[k.jsx(us,{path:"/",element:k.jsx(t7e,{})}),k.jsx(us,{path:"/learn-more",element:k.jsx(Z9e,{})}),k.jsx(us,{path:"/features/ai-stress-tracking",element:k.jsx(lve,{})}),k.jsx(us,{path:"/features/digital-detox",element:k.jsx(uve,{})}),k.jsx(us,{path:"/features/ai-support",element:k.jsx(cve,{})}),k.jsx(us,{path:"/ai-mental-health-chatbot",element:k.jsx("iframe",{src:"/ai_mental_health_chatbot_Final.html",style:{width:"100%",height:"100vh",border:"none"},title:"AI Mental Health Chatbot"})}),k.jsx(us,{path:"/features/study-scheduler",element:k.jsx(vze,{})}),k.jsx(us,{path:"/features/guided-wellness/*",element:k.jsx(Q9e,{})}),k.jsx(us,{path:"/features/community-support",element:k.jsx(J9e,{})}),k.jsx(us,{path:"/features/game",element:k.jsx("iframe",{src:"/detoxing_media/game.html",style:{width:"100%",height:"100vh",border:"none"},title:"Game"})})]})})}_U(document.getElementById("root")).render(k.jsx(q.StrictMode,{children:k.jsx(n7e,{})}))});export default r7e();
